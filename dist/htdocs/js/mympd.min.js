var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(a,b,c){a!=Array.prototype&&a!=Object.prototype&&(a[b]=c.value)};$jscomp.getGlobal=function(a){return"undefined"!=typeof window&&window===a?a:"undefined"!=typeof global&&null!=global?global:a};$jscomp.global=$jscomp.getGlobal(this);$jscomp.SYMBOL_PREFIX="jscomp_symbol_";
$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};$jscomp.Symbol=function(){var a=0;return function(b){return $jscomp.SYMBOL_PREFIX+(b||"")+a++}}();
$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var a=$jscomp.global.Symbol.iterator;a||(a=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("iterator"));"function"!=typeof Array.prototype[a]&&$jscomp.defineProperty(Array.prototype,a,{configurable:!0,writable:!0,value:function(){return $jscomp.arrayIterator(this)}});$jscomp.initSymbolIterator=function(){}};$jscomp.arrayIterator=function(a){var b=0;return $jscomp.iteratorPrototype(function(){return b<a.length?{done:!1,value:a[b++]}:{done:!0}})};
$jscomp.iteratorPrototype=function(a){$jscomp.initSymbolIterator();a={next:a};a[$jscomp.global.Symbol.iterator]=function(){return this};return a};$jscomp.makeIterator=function(a){$jscomp.initSymbolIterator();$jscomp.initSymbol();$jscomp.initSymbolIterator();var b=a[Symbol.iterator];return b?b.call(a):$jscomp.arrayIterator(a)};
$jscomp.polyfill=function(a,b,c,d){if(b){c=$jscomp.global;a=a.split(".");for(d=0;d<a.length-1;d++){var f=a[d];f in c||(c[f]={});c=c[f]}a=a[a.length-1];d=c[a];b=b(d);b!=d&&null!=b&&$jscomp.defineProperty(c,a,{configurable:!0,writable:!0,value:b})}};$jscomp.FORCE_POLYFILL_PROMISE=!1;
$jscomp.polyfill("Promise",function(a){function b(){this.batch_=null}function c(a){return a instanceof f?a:new f(function(b,c){b(a)})}if(a&&!$jscomp.FORCE_POLYFILL_PROMISE)return a;b.prototype.asyncExecute=function(a){null==this.batch_&&(this.batch_=[],this.asyncExecuteBatch_());this.batch_.push(a);return this};b.prototype.asyncExecuteBatch_=function(){var a=this;this.asyncExecuteFunction(function(){a.executeBatch_()})};var d=$jscomp.global.setTimeout;b.prototype.asyncExecuteFunction=function(a){d(a,
0)};b.prototype.executeBatch_=function(){for(;this.batch_&&this.batch_.length;){var a=this.batch_;this.batch_=[];for(var b=0;b<a.length;++b){var c=a[b];a[b]=null;try{c()}catch(m){this.asyncThrow_(m)}}}this.batch_=null};b.prototype.asyncThrow_=function(a){this.asyncExecuteFunction(function(){throw a;})};var f=function(a){this.state_=0;this.result_=void 0;this.onSettledCallbacks_=[];var b=this.createResolveAndReject_();try{a(b.resolve,b.reject)}catch(k){b.reject(k)}};f.prototype.createResolveAndReject_=
function(){function a(a){return function(d){c||(c=!0,a.call(b,d))}}var b=this,c=!1;return{resolve:a(this.resolveTo_),reject:a(this.reject_)}};f.prototype.resolveTo_=function(a){if(a===this)this.reject_(new TypeError("A Promise cannot resolve to itself"));else if(a instanceof f)this.settleSameAsPromise_(a);else{a:switch(typeof a){case "object":var b=null!=a;break a;case "function":b=!0;break a;default:b=!1}b?this.resolveToNonPromiseObj_(a):this.fulfill_(a)}};f.prototype.resolveToNonPromiseObj_=function(a){var b=
void 0;try{b=a.then}catch(k){this.reject_(k);return}"function"==typeof b?this.settleSameAsThenable_(b,a):this.fulfill_(a)};f.prototype.reject_=function(a){this.settle_(2,a)};f.prototype.fulfill_=function(a){this.settle_(1,a)};f.prototype.settle_=function(a,b){if(0!=this.state_)throw Error("Cannot settle("+a+", "+b+"): Promise already settled in state"+this.state_);this.state_=a;this.result_=b;this.executeOnSettledCallbacks_()};f.prototype.executeOnSettledCallbacks_=function(){if(null!=this.onSettledCallbacks_){for(var a=
0;a<this.onSettledCallbacks_.length;++a)g.asyncExecute(this.onSettledCallbacks_[a]);this.onSettledCallbacks_=null}};var g=new b;f.prototype.settleSameAsPromise_=function(a){var b=this.createResolveAndReject_();a.callWhenSettled_(b.resolve,b.reject)};f.prototype.settleSameAsThenable_=function(a,b){var c=this.createResolveAndReject_();try{a.call(b,c.resolve,c.reject)}catch(m){c.reject(m)}};f.prototype.then=function(a,b){function c(a,b){return"function"==typeof a?function(b){try{d(a(b))}catch(q){h(q)}}:
b}var d,h,g=new f(function(a,b){d=a;h=b});this.callWhenSettled_(c(a,d),c(b,h));return g};f.prototype.catch=function(a){return this.then(void 0,a)};f.prototype.callWhenSettled_=function(a,b){function c(){switch(d.state_){case 1:a(d.result_);break;case 2:b(d.result_);break;default:throw Error("Unexpected state: "+d.state_);}}var d=this;null==this.onSettledCallbacks_?g.asyncExecute(c):this.onSettledCallbacks_.push(c)};f.resolve=c;f.reject=function(a){return new f(function(b,c){c(a)})};f.race=function(a){return new f(function(b,
d){for(var f=$jscomp.makeIterator(a),h=f.next();!h.done;h=f.next())c(h.value).callWhenSettled_(b,d)})};f.all=function(a){var b=$jscomp.makeIterator(a),d=b.next();return d.done?c([]):new f(function(a,f){function h(b){return function(c){g[b]=c;l--;0==l&&a(g)}}var g=[],l=0;do g.push(void 0),l++,c(d.value).callWhenSettled_(h(g.length-1),f),d=b.next();while(!d.done)})};return f},"es6","es3");$jscomp.underscoreProtoCanBeSet=function(){var a={a:!0},b={};try{return b.__proto__=a,b.a}catch(c){}return!1};
$jscomp.setPrototypeOf="function"==typeof Object.setPrototypeOf?Object.setPrototypeOf:$jscomp.underscoreProtoCanBeSet()?function(a,b){a.__proto__=b;if(a.__proto__!==b)throw new TypeError(a+" is not extensible");return a}:null;$jscomp.generator={};$jscomp.generator.ensureIteratorResultIsObject_=function(a){if(!(a instanceof Object))throw new TypeError("Iterator result "+a+" is not an object");};
$jscomp.generator.Context=function(){this.isRunning_=!1;this.yieldAllIterator_=null;this.yieldResult=void 0;this.nextAddress=1;this.finallyAddress_=this.catchAddress_=0;this.finallyContexts_=this.abruptCompletion_=null};$jscomp.generator.Context.prototype.start_=function(){if(this.isRunning_)throw new TypeError("Generator is already running");this.isRunning_=!0};$jscomp.generator.Context.prototype.stop_=function(){this.isRunning_=!1};
$jscomp.generator.Context.prototype.jumpToErrorHandler_=function(){this.nextAddress=this.catchAddress_||this.finallyAddress_};$jscomp.generator.Context.prototype.next_=function(a){this.yieldResult=a};$jscomp.generator.Context.prototype.throw_=function(a){this.abruptCompletion_={exception:a,isException:!0};this.jumpToErrorHandler_()};$jscomp.generator.Context.prototype.return=function(a){this.abruptCompletion_={return:a};this.nextAddress=this.finallyAddress_};
$jscomp.generator.Context.prototype.jumpThroughFinallyBlocks=function(a){this.abruptCompletion_={jumpTo:a};this.nextAddress=this.finallyAddress_};$jscomp.generator.Context.prototype.yield=function(a,b){this.nextAddress=b;return{value:a}};$jscomp.generator.Context.prototype.yieldAll=function(a,b){a=$jscomp.makeIterator(a);var c=a.next();$jscomp.generator.ensureIteratorResultIsObject_(c);if(c.done)this.yieldResult=c.value,this.nextAddress=b;else return this.yieldAllIterator_=a,this.yield(c.value,b)};
$jscomp.generator.Context.prototype.jumpTo=function(a){this.nextAddress=a};$jscomp.generator.Context.prototype.jumpToEnd=function(){this.nextAddress=0};$jscomp.generator.Context.prototype.setCatchFinallyBlocks=function(a,b){this.catchAddress_=a;void 0!=b&&(this.finallyAddress_=b)};$jscomp.generator.Context.prototype.setFinallyBlock=function(a){this.catchAddress_=0;this.finallyAddress_=a||0};$jscomp.generator.Context.prototype.leaveTryBlock=function(a,b){this.nextAddress=a;this.catchAddress_=b||0};
$jscomp.generator.Context.prototype.enterCatchBlock=function(a){this.catchAddress_=a||0;a=this.abruptCompletion_.exception;this.abruptCompletion_=null;return a};$jscomp.generator.Context.prototype.enterFinallyBlock=function(a,b,c){c?this.finallyContexts_[c]=this.abruptCompletion_:this.finallyContexts_=[this.abruptCompletion_];this.catchAddress_=a||0;this.finallyAddress_=b||0};
$jscomp.generator.Context.prototype.leaveFinallyBlock=function(a,b){b=this.finallyContexts_.splice(b||0)[0];if(b=this.abruptCompletion_=this.abruptCompletion_||b){if(b.isException)return this.jumpToErrorHandler_();void 0!=b.jumpTo&&this.finallyAddress_<b.jumpTo?(this.nextAddress=b.jumpTo,this.abruptCompletion_=null):this.nextAddress=this.finallyAddress_}else this.nextAddress=a};$jscomp.generator.Context.prototype.forIn=function(a){return new $jscomp.generator.Context.PropertyIterator(a)};
$jscomp.generator.Context.PropertyIterator=function(a){this.object_=a;this.properties_=[];for(var b in a)this.properties_.push(b);this.properties_.reverse()};$jscomp.generator.Context.PropertyIterator.prototype.getNext=function(){for(;0<this.properties_.length;){var a=this.properties_.pop();if(a in this.object_)return a}return null};$jscomp.generator.Engine_=function(a){this.context_=new $jscomp.generator.Context;this.program_=a};
$jscomp.generator.Engine_.prototype.next_=function(a){this.context_.start_();if(this.context_.yieldAllIterator_)return this.yieldAllStep_(this.context_.yieldAllIterator_.next,a,this.context_.next_);this.context_.next_(a);return this.nextStep_()};
$jscomp.generator.Engine_.prototype.return_=function(a){this.context_.start_();var b=this.context_.yieldAllIterator_;if(b)return this.yieldAllStep_("return"in b?b["return"]:function(a){return{value:a,done:!0}},a,this.context_.return);this.context_.return(a);return this.nextStep_()};
$jscomp.generator.Engine_.prototype.throw_=function(a){this.context_.start_();if(this.context_.yieldAllIterator_)return this.yieldAllStep_(this.context_.yieldAllIterator_["throw"],a,this.context_.next_);this.context_.throw_(a);return this.nextStep_()};
$jscomp.generator.Engine_.prototype.yieldAllStep_=function(a,b,c){try{var d=a.call(this.context_.yieldAllIterator_,b);$jscomp.generator.ensureIteratorResultIsObject_(d);if(!d.done)return this.context_.stop_(),d;var f=d.value}catch(g){return this.context_.yieldAllIterator_=null,this.context_.throw_(g),this.nextStep_()}this.context_.yieldAllIterator_=null;c.call(this.context_,f);return this.nextStep_()};
$jscomp.generator.Engine_.prototype.nextStep_=function(){for(;this.context_.nextAddress;)try{var a=this.program_(this.context_);if(a)return this.context_.stop_(),{value:a.value,done:!1}}catch(b){this.context_.yieldResult=void 0,this.context_.throw_(b)}this.context_.stop_();if(this.context_.abruptCompletion_){a=this.context_.abruptCompletion_;this.context_.abruptCompletion_=null;if(a.isException)throw a.exception;return{value:a.return,done:!0}}return{value:void 0,done:!0}};
$jscomp.generator.Generator_=function(a){this.next=function(b){return a.next_(b)};this.throw=function(b){return a.throw_(b)};this.return=function(b){return a.return_(b)};$jscomp.initSymbolIterator();$jscomp.initSymbol();$jscomp.initSymbolIterator();this[Symbol.iterator]=function(){return this}};$jscomp.generator.createGenerator=function(a,b){b=new $jscomp.generator.Generator_(new $jscomp.generator.Engine_(b));$jscomp.setPrototypeOf&&$jscomp.setPrototypeOf(b,a.prototype);return b};
$jscomp.asyncExecutePromiseGenerator=function(a){function b(b){return a.next(b)}function c(b){return a.throw(b)}return new Promise(function(d,f){function g(a){a.done?d(a.value):Promise.resolve(a.value).then(b,c).then(g,f)}g(a.next())})};$jscomp.asyncExecutePromiseGeneratorFunction=function(a){return $jscomp.asyncExecutePromiseGenerator(a())};$jscomp.asyncExecutePromiseGeneratorProgram=function(a){return $jscomp.asyncExecutePromiseGenerator(new $jscomp.generator.Generator_(new $jscomp.generator.Engine_(a)))};
$jscomp.arrayFromIterator=function(a){for(var b,c=[];!(b=a.next()).done;)c.push(b.value);return c};$jscomp.arrayFromIterable=function(a){return a instanceof Array?a:$jscomp.arrayFromIterator($jscomp.makeIterator(a))};$jscomp.polyfill("Object.is",function(a){return a?a:function(a,c){return a===c?0!==a||1/a===1/c:a!==a&&c!==c}},"es6","es3");
$jscomp.polyfill("Array.prototype.includes",function(a){return a?a:function(a,c){var b=this;b instanceof String&&(b=String(b));var f=b.length;c=c||0;for(0>c&&(c=Math.max(c+f,0));c<f;c++){var g=b[c];if(g===a||Object.is(g,a))return!0}return!1}},"es7","es3");
$jscomp.checkStringArgs=function(a,b,c){if(null==a)throw new TypeError("The 'this' value for String.prototype."+c+" must not be null or undefined");if(b instanceof RegExp)throw new TypeError("First argument to String.prototype."+c+" must not be a regular expression");return a+""};$jscomp.polyfill("String.prototype.includes",function(a){return a?a:function(a,c){return-1!==$jscomp.checkStringArgs(this,a,"includes").indexOf(a,c||0)}},"es6","es3");
$jscomp.owns=function(a,b){return Object.prototype.hasOwnProperty.call(a,b)};$jscomp.assign="function"==typeof Object.assign?Object.assign:function(a,b){for(var c=1;c<arguments.length;c++){var d=arguments[c];if(d)for(var f in d)$jscomp.owns(d,f)&&(a[f]=d[f])}return a};$jscomp.polyfill("Object.assign",function(a){return a||$jscomp.assign},"es6","es3");
$jscomp.polyfill("String.prototype.repeat",function(a){return a?a:function(a){var b=$jscomp.checkStringArgs(this,null,"repeat");if(0>a||1342177279<a)throw new RangeError("Invalid count value");a|=0;for(var d="";a;)if(a&1&&(d+=b),a>>>=1)b+=b;return d}},"es6","es3");
function sendAPI(a,b,c,d){var f={jsonrpc:"2.0",id:0,method:a,params:b},g=new XMLHttpRequest;g.open("POST",subdir+"/api",!0);g.setRequestHeader("Content-type","application/json");g.onreadystatechange=function(){if(4===g.readyState)if(""!==g.responseText){var a=JSON.parse(g.responseText);if(a.error)showNotification(t(a.error.message,a.error.data),"","","danger"),logError(JSON.stringify(a.error)),!0===d&&void 0!==c&&"function"===typeof c&&(logDebug("Got API response of type error calling "+c.name),c(a));
else if(a.result&&a.result.message&&"ok"!==a.result.message)logDebug("Got API response: "+JSON.stringify(a.result)),showNotification(t(a.result.message,a.result.data),"","","success");else if(a.result&&a.result.message&&"ok"===a.result.message)logDebug("Got API response: "+JSON.stringify(a.result));else if(a.result&&a.result.method)logDebug("Got API response of type: "+a.result.method);else if(logError("Got invalid API response: "+JSON.stringify(a)),!0!==d)return;void 0!==c&&"function"===typeof c&&
(logDebug("Calling "+c.name),c(a))}else logError("Empty response for request: "+JSON.stringify(f)),!0===d&&void 0!==c&&"function"===typeof c&&(logDebug("Got empty API response calling "+c.name),c(""))};g.send(JSON.stringify(f));logDebug("Send API request: "+a)}
function webSocketConnect(){if(null!==socket)logInfo("Socket already connected");else{var a=getWsUrl();socket=new WebSocket(a);logInfo("Connecting to "+a);try{socket.onopen=function(){logInfo("Websocket is connected");websocketConnected=!0;null!==websocketTimer&&(clearTimeout(websocketTimer),websocketTimer=null)},socket.onmessage=function(b){try{var c=JSON.parse(b.data);logDebug("Websocket notification: "+JSON.stringify(c))}catch(d){logError("Invalid JSON data received: "+b.data)}switch(c.method){case "welcome":websocketConnected=
!0;showNotification(t("Connected to myMPD")+": "+a,"","","success");appRoute();sendAPI("MPD_API_PLAYER_STATE",{},parseState,!0);break;case "update_state":c.result=c.params;parseState(c);break;case "mpd_disconnected":progressTimer&&clearTimeout(progressTimer);getSettings(!0);break;case "mpd_connected":showNotification(t("Connected to MPD"),"","","success");sendAPI("MPD_API_PLAYER_STATE",{},parseState);getSettings(!0);break;case "update_queue":"Queue"===app.current.app&&getQueue();c.result=c.params;
parseUpdateQueue(c);break;case "update_options":getSettings();break;case "update_outputs":sendAPI("MPD_API_PLAYER_OUTPUT_LIST",{},parseOutputs);break;case "update_started":updateDBstarted(!1);break;case "update_database":case "update_finished":updateDBfinished(c.method);break;case "update_volume":c.result=c.params;parseVolume(c);break;case "update_stored_playlist":"Browse"===app.current.app&&"Playlists"===app.current.tab&&"All"===app.current.view?sendAPI("MPD_API_PLAYLIST_LIST",{offset:app.current.page,
filter:app.current.filter},parsePlaylists):"Browse"===app.current.app&&"Playlists"===app.current.tab&&"Detail"===app.current.view&&sendAPI("MPD_API_PLAYLIST_CONTENT_LIST",{offset:app.current.page,filter:app.current.filter,uri:app.current.search,cols:settings.colsBrowsePlaylistsDetail},parsePlaylists);break;case "update_lastplayed":"Queue"===app.current.app&&"LastPlayed"===app.current.tab&&sendAPI("MPD_API_QUEUE_LAST_PLAYED",{offset:app.current.page,cols:settings.colsQueueLastPlayed},parseLastPlayed);
break;case "error":document.getElementById("alertMpdState").classList.contains("hide")&&showNotification(t(c.params.message),"","","danger")}},socket.onclose=function(){logError("Websocket is disconnected");websocketConnected=!1;!0===appInited?(toggleUI(),progressTimer&&clearTimeout(progressTimer)):(showAppInitAlert(t("Websocket connection failed")),logError("Websocket connection failed."));null!==websocketTimer&&(clearTimeout(websocketTimer),websocketTimer=null);websocketTimer=setTimeout(function(){logInfo("Reconnecting websocket");
toggleAlert("alertMympdState",!0,t("Websocket connection failed, trying to reconnect")+'&nbsp;&nbsp;<div class="spinner-border spinner-border-sm"></div>');webSocketConnect()},3E3);socket=null}}catch(b){logError(b)}}}function getWsUrl(){var a=window.location.hostname,b=window.location.protocol,c=window.location.port;return("https:"===b?"wss://":"ws://")+a+(""!==c?":"+c:"")+subdir+"/ws/"}
function gotoBrowse(a){var b=a.parentNode.getAttribute("data-tag");a=decodeURI(a.parentNode.getAttribute("data-name"));""!==b&&""!==a&&"-"!==a&&settings.browsetags.includes(b)&&appGoto("Browse","Database",b,"0/-/-/"+a)}
function parseFilesystem(a){var b=app.current.app+("Filesystem"===app.current.tab?app.current.tab:""),c=settings["cols"+b].length;c--;var d=a.result.returnedEntities,f=document.getElementById(app.current.app+(void 0===app.current.tab?"":app.current.tab)+"List"),g=f.getElementsByTagName("tbody")[0],h=g.getElementsByTagName("tr");f=document.activeElement.parentNode.parentNode===f?!0:!1;for(var l=0,k=0;k<d;k++){var m=encodeURI(a.result.data[k].uri),p=document.createElement("tr"),n="";p.setAttribute("data-type",
a.result.data[k].Type);p.setAttribute("data-uri",m);p.setAttribute("tabindex",0);"song"===a.result.data[k].Type?p.setAttribute("data-name",a.result.data[k].Title):p.setAttribute("data-name",a.result.data[k].name);switch(a.result.data[k].Type){case "dir":case "smartpls":case "plist":for(m=0;m<settings["cols"+b].length;m++)n+='<td data-col="'+settings["cols"+b][m]+'">',"Type"===settings["cols"+b][m]?n="dir"===a.result.data[k].Type?n+'<span class="material-icons">folder_open</span>':n+('<span class="material-icons">'+
("smartpls"===a.result.data[k].Type?"queue_music":"list")+"</span>"):"Title"===settings["cols"+b][m]&&(n+=e(a.result.data[k].name)),n+="</td>";n+='<td data-col="Action"><a href="#" class="material-icons color-darkgrey">'+ligatureMore+"</a></td>";p.innerHTML=n;break;case "song":a.result.data[k].Duration=beautifySongDuration(a.result.data[k].Duration);for(m=0;m<settings["cols"+b].length;m++)n+='<td data-col="'+settings["cols"+b][m]+'">',n="Type"===settings["cols"+b][m]?n+'<span class="material-icons">music_note</span>':
n+e(a.result.data[k][settings["cols"+b][m]]),n+="</td>";n+='<td data-col="Action"><a href="#" class="material-icons color-darkgrey">'+ligatureMore+"</a></td>";p.innerHTML=n}k<h.length?l=!0===replaceTblRow(h[k],p)?k:l:g.append(p)}for(b=h.length-1;b>=d;b--)h[b].remove();!0===f&&focusTable(0);setPagination(a.result.totalEntities,a.result.returnedEntities);0===d&&(g.innerHTML='<tr><td><span class="material-icons">error_outline</span></td><td colspan="'+c+'">'+t("Empty list")+"</td></tr>");document.getElementById(app.current.app+
(void 0===app.current.tab?"":app.current.tab)+"List").classList.remove("opacity05");document.getElementById("cardFooterBrowse").innerText=t("Num entries",a.result.totalEntities)}
function parseListDBtags(a){scrollToPosY(0);if(""!==app.current.search){document.getElementById("BrowseDatabaseAlbumList").classList.remove("hide");document.getElementById("BrowseDatabaseTagList").classList.add("hide");document.getElementById("btnBrowseDatabaseByTag").parentNode.classList.add("hide");document.getElementById("btnBrowseDatabaseTag").parentNode.classList.remove("hide");document.getElementById("BrowseDatabaseAddAllSongs").parentNode.parentNode.classList.remove("hide");document.getElementById("BrowseDatabaseColsBtn").parentNode.classList.remove("hide");
document.getElementById("btnBrowseDatabaseTag").innerHTML="&laquo; "+t(app.current.view);document.getElementById("BrowseDatabaseAlbumListCaption").innerHTML="<h2>"+t(a.result.searchtagtype)+": "+e(a.result.searchstr)+"</h2><hr/>";document.getElementById("cardFooterBrowse").innerText=t("Num entries",a.result.totalEntities);for(var b=a.result.returnedEntities,c=document.getElementById("BrowseDatabaseAlbumList"),d=c.getElementsByClassName("card"),f=0;f<b;f++){var g=genId(a.result.data[f].value),h=document.createElement("div");
h.classList.add("card","ml-4","mr-4","mb-4","w-100");h.setAttribute("id","card"+g);h.setAttribute("data-album",encodeURI(a.result.data[f].value));var l='<div class="card-header"><span id="albumartist'+g+'"></span> &ndash; '+e(a.result.data[f].value)+'</div><div class="card-body"><div class="row">';!0===settings.featCoverimage&&!0===settings.coverimage&&(l+='<div class="col-md-auto"><a class="card-img-left album-cover-loading"></a></div>');l+='<div class="col"><table class="tblAlbumTitles table table-sm table-hover" tabindex="0" id="tbl'+
g+'"><thead><tr></tr></thead><tbody></tbody><tfoot class="bg-light border-bottom"></tfoot></table></div></div></div></div><div class="card-footer"></div>';h.innerHTML=l;f<d.length?d[f].replaceWith(h):c.append(h);"IntersectionObserver"in window?createListTitleObserver(document.getElementById("card"+g)):sendAPI("MPD_API_DATABASE_TAG_ALBUM_TITLE_LIST",{album:a.result.data[f].value,search:app.current.search,tag:app.current.view,cols:settings.colsBrowseDatabase},parseListTitles)}for(c=d.length-1;c>=b;c--)d[c].remove();
setPagination(a.result.totalEntities,a.result.returnedEntities);setCols("BrowseDatabase",".tblAlbumTitles");a=document.querySelectorAll(".tblAlbumTitles");for(b=0;b<a.length;b++)dragAndDropTableHeader(a[b]);document.getElementById("BrowseDatabaseAlbumList").classList.remove("opacity05")}else{document.getElementById("BrowseDatabaseAlbumList").classList.add("hide");document.getElementById("BrowseDatabaseTagList").classList.remove("hide");document.getElementById("btnBrowseDatabaseByTag").parentNode.classList.remove("hide");
document.getElementById("BrowseDatabaseAddAllSongs").parentNode.parentNode.classList.add("hide");document.getElementById("BrowseDatabaseColsBtn").parentNode.classList.add("hide");document.getElementById("btnBrowseDatabaseTag").parentNode.classList.add("hide");document.getElementById("BrowseDatabaseTagListCaption").innerText=t(app.current.view);document.getElementById("cardFooterBrowse").innerText=t("Num entries",a.result.totalEntities);b=a.result.returnedEntities;c=document.getElementById(app.current.app+
app.current.tab+"TagList");d=c.getElementsByTagName("tbody")[0];c=document.activeElement.parentNode.parentNode===c?!0:!1;g=0;f=d.getElementsByTagName("tr");for(h=0;h<b;h++){l=encodeURI(a.result.data[h].value);var k=document.createElement("tr");k.setAttribute("data-uri",l);k.setAttribute("tabindex",0);k.innerHTML='<td data-col="Type"><span class="material-icons">album</span></td><td>'+e(a.result.data[h].value)+"</td>";h<f.length?g=!0===replaceTblRow(f[h],k)?h:g:d.append(k)}for(g=f.length-1;g>=b;g--)f[g].remove();
!0===c&&focusTable(0);setPagination(a.result.totalEntities,a.result.returnedEntities);0===b&&(d.innerHTML='<tr><td><span class="material-icons">error_outline</span></td><td>No entries found.</td></tr>');document.getElementById("BrowseDatabaseTagList").classList.remove("opacity05")}}function createListTitleObserver(a){(new IntersectionObserver(getListTitles,{root:null,rootMargin:"0px"})).observe(a)}
function getListTitles(a,b){a.forEach(function(a){0<a.intersectionRatio&&(b.unobserve(a.target),a=decodeURI(a.target.getAttribute("data-album")),sendAPI("MPD_API_DATABASE_TAG_ALBUM_TITLE_LIST",{album:a,search:app.current.search,tag:app.current.view,cols:settings.colsBrowseDatabase},parseListTitles))})}
function parseListTitles(a){var b=genId(a.result.Album),c=document.getElementById("card"+b),d=c.getElementsByTagName("table")[0],f=c.getElementsByTagName("tbody")[0],g=c.querySelector(".card-footer"),h=c.querySelector(".card-header");h.setAttribute("data-uri",encodeURI(a.result.data[0].uri.replace(/\/[^/]+$/,"")));h.setAttribute("data-name",a.result.Album);h.setAttribute("data-type","dir");h.addEventListener("click",function(a){showMenu(this,a)},!1);h.classList.add("clickable");d.addEventListener("keydown",
function(a){navigateTable(this,a.key)},!1);if(c=c.getElementsByTagName("a")[0])c.style.backgroundImage='url("'+subdir+a.result.cover+'"), url("'+subdir+'/assets/coverimage-loading.png")',c.setAttribute("data-uri",encodeURI(a.result.data[0].uri.replace(/\/[^/]+$/,""))),c.setAttribute("data-name",a.result.Album),c.setAttribute("data-type","dir"),c.addEventListener("click",function(a){showMenu(this,a)},!1);document.getElementById("albumartist"+b).innerText=a.result.AlbumArtist;b="";c=a.result.returnedEntities;
for(d=0;d<c;d++){a.result.data[d].Duration&&(a.result.data[d].Duration=beautifySongDuration(a.result.data[d].Duration));b+='<tr tabindex="0" data-type="song" data-name="'+a.result.data[d].Title+'" data-uri="'+encodeURI(a.result.data[d].uri)+'">';for(h=0;h<settings.colsBrowseDatabase.length;h++)b+='<td data-col="'+settings.colsBrowseDatabase[h]+'">'+e(a.result.data[d][settings.colsBrowseDatabase[h]])+"</td>";b+='<td data-col="Action"><a href="#" class="material-icons color-darkgrey">'+ligatureMore+
"</a></td></tr>"}f.innerHTML=b;g.innerHTML=t("Num songs",a.result.totalEntities)+" &ndash; "+beautifyDuration(a.result.totalTime);f.parentNode.addEventListener("click",function(a){"TD"===a.target.nodeName?appendQueue("song",decodeURI(a.target.parentNode.getAttribute("data-uri")),a.target.parentNode.getAttribute("data-name")):"A"===a.target.nodeName&&showMenu(a.target,a)},!1)}
function addAllFromBrowseFilesystem(){sendAPI("MPD_API_QUEUE_ADD_TRACK",{uri:app.current.search});showNotification(t("Added all songs"),"","","success")}function addAllFromBrowseDatabasePlist(a){2<=app.current.search.length&&sendAPI("MPD_API_DATABASE_SEARCH",{plist:a,filter:app.current.view,searchstr:app.current.search,offset:0,cols:settings.colsSearch})}
function parseBookmarks(a){for(var b='<table class="table table-sm table-dark table-borderless mb-0">',c=0;c<a.result.returnedEntities;c++)b+='<tr data-id="'+a.result.data[c].id+'" data-type="'+a.result.data[c].type+'" data-uri="'+encodeURI(a.result.data[c].uri)+'"><td class="nowrap"><a class="text-light" href="#" data-href="goto">'+e(a.result.data[c].name)+'</a></td><td><a class="text-light material-icons material-icons-small" href="#" data-href="edit">edit</a></td><td><a class="text-light material-icons material-icons-small" href="#" data-href="delete">delete</a></td></tr>';
0===a.result.returnedEntities&&(b+='<tr><td class="text-light nowrap">'+t("No bookmarks found")+"</td></tr>");b+="</table>";document.getElementById("BrowseFilesystemBookmarks").innerHTML=b}
function showBookmarkSave(a,b,c,d){document.getElementById("saveBookmarkName").classList.remove("is-invalid");document.getElementById("saveBookmarkId").value=a;document.getElementById("saveBookmarkName").value=b;document.getElementById("saveBookmarkUri").value=c;document.getElementById("saveBookmarkType").value=d;modalSaveBookmark.show()}
function saveBookmark(){var a=parseInt(document.getElementById("saveBookmarkId").value),b=document.getElementById("saveBookmarkName").value,c=document.getElementById("saveBookmarkUri").value,d=document.getElementById("saveBookmarkType").value;""!==b?(sendAPI("MYMPD_API_BOOKMARK_SAVE",{id:a,name:b,uri:c,type:d}),modalSaveBookmark.hide()):document.getElementById("saveBookmarkName").classList.add("is-invalid")}
function e(a){return isNaN(a)?a.replace(/([<>])/g,function(a,c){if("<"===c)return"&lt;";if(">"===c)return"&gt;"}):a}
function t(a,b,c){var d=void 0;isNaN(b)&&(c=b);phrases[a]&&(d=phrases[a][locale],void 0===d&&("en-US"!==locale&&logWarn('Phrase "'+a+'" for locale '+locale+" not found"),d=phrases[a]["en-US"]));void 0===d&&(d=a);!1===isNaN(b)&&(a=d.split(" |||| "),1<a.length&&(d=a[smartCount(b)]),d=d.replace("%{smart_count}",b));null!=c&&(d=d.replace(/%\{(\w+)\}/g,function(a,b){return c[b]}));return e(d)}function smartCount(a){return 0===a?1:1===a?0:1}
function localeDate(a){return(new Date(1E3*a)).toLocaleString(locale)}function beautifyDuration(a){var b=Math.floor(a/86400),c=Math.floor(a/3600)-24*b,d=Math.floor(a/60)-60*c-1440*b;a=a-86400*b-3600*c-60*d;return(0<b?b+"\u2009"+t("Days")+" ":"")+(0<c?c+"\u2009"+t("Hours")+" "+(10>d?"0":""):"")+d+"\u2009"+t("Minutes")+" "+(10>a?"0":"")+a+"\u2009"+t("Seconds")}
function beautifySongDuration(a){var b=Math.floor(a/3600),c=Math.floor(a/60)-60*b;a=a-3600*b-60*c;return(0<b?b+":"+(10>c?"0":""):"")+c+":"+(10>a?"0":"")+a}function gtPage(a,b,c){return-1<c?t(a,c):b+app.current.page<settings.maxElementsPerPage?t(a,b):"> "+t(a,settings.maxElementsPerPage)}
function i18nHtml(a){for(var b=[["data-phrase","innerText"],["data-title-phrase","title"],["data-placeholder-phrase","placeholder"]],c=0;c<b.length;c++)for(var d=a.querySelectorAll("["+b[c][0]+"]"),f=d.length,g=0;g<f;g++)d[g][b[c][1]]=t(d[g].getAttribute(b[c][0]))}function logError(a){logLog(0,"ERROR: "+a)}function logWarn(a){logLog(1,"WARN: "+a)}function logInfo(a){logLog(2,"INFO: "+a)}function logVerbose(a){logLog(3,"VERBOSE: "+a)}function logDebug(a){logLog(4,"DEBUG: "+a)}
function logLog(a,b){settings.loglevel>=a&&(0===a?console.error(b):1===a?console.warn(b):4===a?console.debug(b):console.log(b))}
function localplayerPlay(){var a;return $jscomp.asyncExecutePromiseGeneratorProgram(function(b){if(1==b.nextAddress){a=document.getElementById("localPlayer");if(!a.paused)return b.jumpTo(0);b.setCatchFinallyBlocks(3);return b.yield(a.play(),5)}if(3!=b.nextAddress)return b.leaveTryBlock(0);b.enterCatchBlock();showNotification(t("Local playback"),t("Can not start playing"),"","error");b.jumpToEnd()})}
function addStream(){var a=document.getElementById("streamUrl");!0===validateStream(a)&&(sendAPI("MPD_API_QUEUE_ADD_TRACK",{uri:a.value}),modalAddToPlaylist.hide(),showNotification(t("Added stream %{streamUri} to queue",{streamUri:a.value}),"","","success"))}function clickPlay(){"play"!==playstate?sendAPI("MPD_API_PLAYER_PLAY",{}):sendAPI("MPD_API_PLAYER_PAUSE",{})}function clickStop(){sendAPI("MPD_API_PLAYER_STOP",{})}function clickPrev(){sendAPI("MPD_API_PLAYER_PREV",{})}
function clickNext(){sendAPI("MPD_API_PLAYER_NEXT",{})}function execSyscmd(a){sendAPI("MYMPD_API_SYSCMD",{cmd:a})}function updateDB(){sendAPI("MPD_API_DATABASE_UPDATE",{});updateDBstarted(!0)}function rescanDB(){sendAPI("MPD_API_DATABASE_RESCAN",{});updateDBstarted(!0)}
function updateDBstarted(a){!0===a?(document.getElementById("updateDBfinished").innerText="",document.getElementById("updateDBfooter").classList.add("hide"),a=document.getElementById("updateDBprogress"),a.style.width="20px",a.style.marginLeft="-20px",modalUpdateDB.show(),a.classList.add("updateDBprogressAnimate")):showNotification(t("Database update started"),"","","success")}
function updateDBfinished(a){document.getElementById("modalUpdateDB").classList.contains("show")?("update_database"===a?document.getElementById("updateDBfinished").innerText=t("Database successfully updated"):"update_finished"===a&&(document.getElementById("updateDBfinished").innerText=t("Database update finished")),a=document.getElementById("updateDBprogress"),a.classList.remove("updateDBprogressAnimate"),a.style.width="100%",a.style.marginLeft="0px",document.getElementById("updateDBfooter").classList.remove("hide")):
"update_database"===a?showNotification(t("Database successfully updated"),"","","success"):"update_finished"===a&&showNotification(t("Database update finished"),"","","success")}
var socket=null,lastSong="",lastSongObj={},lastState,currentSong={},playstate="",settingsLock=!1,settingsParsed=!1,settingsNew={},settings={loglevel:2},alertTimeout=null,progressTimer=null,deferredPrompt,dragEl,playlistEl,websocketConnected=!1,websocketTimer=null,appInited=!1,subdir="",uiEnabled=!0,locale=navigator.language||navigator.userLanguage,ligatureMore="menu",app={apps:{Playback:{state:"0/-/-/",scrollPos:0},Queue:{active:"Current",tabs:{Current:{state:"0/any/-/",scrollPos:0},LastPlayed:{state:"0/any/-/",
scrollPos:0}}},Browse:{active:"Database",tabs:{Filesystem:{state:"0/-/-/",scrollPos:0},Playlists:{active:"All",views:{All:{state:"0/-/-/",scrollPos:0},Detail:{state:"0/-/-/",scrollPos:0}}},Database:{active:"AlbumArtist",views:{}}}},Search:{state:"0/any/-/",scrollPos:0}},current:{app:"Playback",tab:void 0,view:void 0,page:0,filter:"",search:"",sort:"",scrollPos:0},last:{app:void 0,tab:void 0,view:void 0,filter:"",search:"",sort:"",scrollPos:0}},domCache={};domCache.navbarBottomBtns=document.getElementById("navbar-bottom").getElementsByTagName("div");
domCache.navbarBottomBtnsLen=domCache.navbarBottomBtns.length;domCache.cardHeaderBrowse=document.getElementById("cardHeaderBrowse").getElementsByTagName("a");domCache.cardHeaderBrowseLen=domCache.cardHeaderBrowse.length;domCache.cardHeaderQueue=document.getElementById("cardHeaderQueue").getElementsByTagName("a");domCache.cardHeaderQueueLen=domCache.cardHeaderQueue.length;domCache.counter=document.getElementById("counter");domCache.volumePrct=document.getElementById("volumePrct");
domCache.volumeControl=document.getElementById("volumeControl");domCache.volumeMenu=document.getElementById("volumeMenu");domCache.btnsPlay=document.getElementsByClassName("btnPlay");domCache.btnsPlayLen=domCache.btnsPlay.length;domCache.btnPrev=document.getElementById("btnPrev");domCache.btnNext=document.getElementById("btnNext");domCache.progressBar=document.getElementById("progressBar");domCache.volumeBar=document.getElementById("volumeBar");domCache.outputs=document.getElementById("outputs");
domCache.btnAdd=document.getElementById("nav-add2homescreen");domCache.currentCover=document.getElementById("currentCover");domCache.currentTitle=document.getElementById("currentTitle");domCache.btnVoteUp=document.getElementById("btnVoteUp");domCache.btnVoteDown=document.getElementById("btnVoteDown");domCache.badgeQueueItems=document.getElementById("badgeQueueItems");domCache.searchstr=document.getElementById("searchstr");domCache.searchCrumb=document.getElementById("searchCrumb");
var modalConnection=new Modal(document.getElementById("modalConnection")),modalSettings=new Modal(document.getElementById("modalSettings")),modalAbout=new Modal(document.getElementById("modalAbout")),modalSaveQueue=new Modal(document.getElementById("modalSaveQueue")),modalAddToQueue=new Modal(document.getElementById("modalAddToQueue")),modalSongDetails=new Modal(document.getElementById("modalSongDetails")),modalAddToPlaylist=new Modal(document.getElementById("modalAddToPlaylist")),modalRenamePlaylist=
new Modal(document.getElementById("modalRenamePlaylist")),modalUpdateDB=new Modal(document.getElementById("modalUpdateDB")),modalSaveSmartPlaylist=new Modal(document.getElementById("modalSaveSmartPlaylist")),modalDeletePlaylist=new Modal(document.getElementById("modalDeletePlaylist")),modalSaveBookmark=new Modal(document.getElementById("modalSaveBookmark")),dropdownMainMenu,dropdownVolumeMenu=new Dropdown(document.getElementById("volumeMenu")),dropdownBookmarks=new Dropdown(document.getElementById("BrowseFilesystemBookmark")),
dropdownLocalPlayer=new Dropdown(document.getElementById("localPlaybackMenu")),collapseDBupdate=new Collapse(document.getElementById("navDBupdate")),collapseSyscmds=new Collapse(document.getElementById("navSyscmds"));
function appPrepare(a){if(app.current.app!==app.last.app||app.current.tab!==app.last.tab||app.current.view!==app.last.view){for(var b=0;b<domCache.navbarBottomBtnsLen;b++)domCache.navbarBottomBtns[b].classList.remove("active");document.getElementById("cardPlayback").classList.add("hide");document.getElementById("cardQueue").classList.add("hide");document.getElementById("cardBrowse").classList.add("hide");document.getElementById("cardSearch").classList.add("hide");for(b=0;b<domCache.cardHeaderBrowseLen;b++)domCache.cardHeaderBrowse[b].classList.remove("active");
for(b=0;b<domCache.cardHeaderQueueLen;b++)domCache.cardHeaderQueue[b].classList.remove("active");document.getElementById("cardQueueCurrent").classList.add("hide");document.getElementById("cardQueueLastPlayed").classList.add("hide");document.getElementById("cardBrowsePlaylists").classList.add("hide");document.getElementById("cardBrowseDatabase").classList.add("hide");document.getElementById("cardBrowseFilesystem").classList.add("hide");document.getElementById("card"+app.current.app).classList.remove("hide");
document.getElementById("nav"+app.current.app)&&document.getElementById("nav"+app.current.app).classList.add("active");void 0!==app.current.tab&&(document.getElementById("card"+app.current.app+app.current.tab).classList.remove("hide"),document.getElementById("card"+app.current.app+"Nav"+app.current.tab).classList.add("active"));scrollToPosY(a)}(a=document.getElementById(app.current.app+(void 0===app.current.tab?"":app.current.tab)+(void 0===app.current.view?"":app.current.view)+"List"))&&a.classList.add("opacity05")}
function appGoto(a,b,c,d){var f=document.body.scrollTop?document.body.scrollTop:document.documentElement.scrollTop;void 0!==app.apps[app.current.app].scrollPos?app.apps[app.current.app].scrollPos=f:void 0!==app.apps[app.current.app].tabs[app.current.tab].scrollPos?app.apps[app.current.app].tabs[app.current.tab].scrollPos=f:void 0!==app.apps[app.current.app].tabs[app.current.tab].views[app.current.view].scrollPos&&(app.apps[app.current.app].tabs[app.current.tab].views[app.current.view].scrollPos=f);
app.apps[a].tabs?(void 0===b&&(b=app.apps[a].active),app.apps[a].tabs[b].views?(void 0===c&&(c=app.apps[a].tabs[b].active),a="/"+a+"/"+b+"/"+c+"!"+(void 0===d?app.apps[a].tabs[b].views[c].state:d)):a="/"+a+"/"+b+"!"+(void 0===d?app.apps[a].tabs[b].state:d)):a="/"+a+"!"+(void 0===d?app.apps[a].state:d);location.hash=a}
function appRoute(){if(!1===settingsParsed)appInitStart();else{var a=decodeURI(location.hash).match(/^#\/(\w+)\/?(\w+)?\/?(\w+)?!((\d+)\/([^/]+)\/([^/]+)\/(.*))$/);if(a){app.current.app=a[1];app.current.tab=a[2];app.current.view=a[3];app.apps[app.current.app].state?(app.apps[app.current.app].state=a[4],app.current.scrollPos=app.apps[app.current.app].scrollPos):app.apps[app.current.app].tabs[app.current.tab].state?(app.apps[app.current.app].tabs[app.current.tab].state=a[4],app.apps[app.current.app].active=
app.current.tab,app.current.scrollPos=app.apps[app.current.app].tabs[app.current.tab].scrollPos):app.apps[app.current.app].tabs[app.current.tab].views[app.current.view].state&&(app.apps[app.current.app].tabs[app.current.tab].views[app.current.view].state=a[4],app.apps[app.current.app].active=app.current.tab,app.apps[app.current.app].tabs[app.current.tab].active=app.current.view,app.current.scrollPos=app.apps[app.current.app].tabs[app.current.tab].views[app.current.view].scrollPos);app.current.page=
parseInt(a[5]);app.current.filter=a[6];app.current.sort=a[7];app.current.search=a[8];appPrepare(app.current.scrollPos);if("Playback"===app.current.app)sendAPI("MPD_API_PLAYER_CURRENT_SONG",{},songChange);else if("Queue"===app.current.app&&"Current"===app.current.tab)selectTag("searchqueuetags","searchqueuetagsdesc",app.current.filter),getQueue();else if("Queue"===app.current.app&&"LastPlayed"===app.current.tab)sendAPI("MPD_API_QUEUE_LAST_PLAYED",{offset:app.current.page,cols:settings.colsQueueLastPlayed},
parseLastPlayed);else if("Browse"===app.current.app&&"Playlists"===app.current.tab&&"All"===app.current.view)sendAPI("MPD_API_PLAYLIST_LIST",{offset:app.current.page,filter:app.current.filter},parsePlaylists),doSetFilterLetter("BrowsePlaylistsFilter");else if("Browse"===app.current.app&&"Playlists"===app.current.tab&&"Detail"===app.current.view)sendAPI("MPD_API_PLAYLIST_CONTENT_LIST",{offset:app.current.page,filter:app.current.filter,uri:app.current.search,cols:settings.colsBrowsePlaylistsDetail},
parsePlaylists),doSetFilterLetter("BrowsePlaylistsFilter");else if("Browse"===app.current.app&&"Database"===app.current.tab)""!==app.current.search?(sendAPI("MPD_API_DATABASE_TAG_ALBUM_LIST",{offset:app.current.page,filter:app.current.filter,search:app.current.search,tag:app.current.view},parseListDBtags),doSetFilterLetter("BrowseDatabaseFilter")):(sendAPI("MPD_API_DATABASE_TAG_LIST",{offset:app.current.page,filter:app.current.filter,tag:app.current.view},parseListDBtags),doSetFilterLetter("BrowseDatabaseFilter"),
selectTag("BrowseDatabaseByTagDropdown","btnBrowseDatabaseByTag",app.current.view));else if("Browse"===app.current.app&&"Filesystem"===app.current.tab){sendAPI("MPD_API_DATABASE_FILESYSTEM_LIST",{offset:app.current.page,path:app.current.search?app.current.search:"/",filter:app.current.filter,cols:settings.colsBrowseFilesystem},parseFilesystem);app.current.search?(document.getElementById("BrowseFilesystemAddAllSongs").removeAttribute("disabled"),document.getElementById("BrowseFilesystemAddAllSongsBtn").removeAttribute("disabled")):
(document.getElementById("BrowseFilesystemAddAllSongs").setAttribute("disabled","disabled"),document.getElementById("BrowseFilesystemAddAllSongsBtn").setAttribute("disabled","disabled"));a='<li class="breadcrumb-item"><a data-uri="" class="material-icons">home</a></li>';for(var b=app.current.search.split("/"),c=b.length,d="",f=0;f<c;f++){if(c-1===f){a+='<li class="breadcrumb-item active">'+e(b[f])+"</li>";break}d+=b[f];a+='<li class="breadcrumb-item"><a class="text-body" href="#" data-uri="'+encodeURI(d)+
'">'+e(b[f])+"</a></li>";d+="/"}document.getElementById("BrowseBreadcrumb").innerHTML=a;doSetFilterLetter("BrowseFilesystemFilter")}else if("Search"===app.current.app){domCache.searchstr.focus();if(settings.featAdvsearch){a="";b=app.current.search.substring(1,app.current.search.length-1).split(" AND ");for(c=0;c<b.length-1;c++)d=b[c].substring(1,b[c].length-1),a+='<button data-filter="'+encodeURI(d)+'" class="btn btn-light mr-2">'+e(d)+'<span class="ml-2 badge badge-secondary">&times</span></button>';
domCache.searchCrumb.innerHTML=a;""===domCache.searchstr.value&&1<=b.length&&(a=b[b.length-1].substring(1,b[b.length-1].length-1),b=a.substring(a.indexOf("'")+1,a.length-1),domCache.searchstr.value!==b&&(domCache.searchCrumb.innerHTML+='<button data-filter="'+encodeURI(a)+'" class="btn btn-light mr-2">'+e(a)+'<span href="#" class="ml-2 badge badge-secondary">&times;</span></button>'),a=a.substring(a.indexOf(" ")+1),a=a.substring(0,a.indexOf(" ")),""===a&&(a="contains"),document.getElementById("searchMatch").value=
a)}else""===domCache.searchstr.value&&""!==app.current.search&&(domCache.searchstr.value=app.current.search);app.last.app!==app.current.app&&""!==app.current.search&&(a=settings["cols"+app.current.app].length,a--,document.getElementById("SearchList").getElementsByTagName("tbody")[0].innerHTML='<tr><td><span class="material-icons">search</span></td><td colspan="'+a+'">'+t("Searching...")+"</td></tr>");2<=domCache.searchstr.value.length||0<domCache.searchCrumb.children.length?settings.featAdvsearch?
(a=app.current.sort,b=!1,"-"===a?(a=settings.tags.includes("Title")?"Title":"-",document.getElementById("SearchList").setAttribute("data-sort",a)):0===a.indexOf("-")&&(b=!0,a=a.substring(1)),sendAPI("MPD_API_DATABASE_SEARCH_ADV",{plist:"",offset:app.current.page,sort:a,sortdesc:b,expression:app.current.search,cols:settings.colsSearch},parseSearch)):sendAPI("MPD_API_DATABASE_SEARCH",{plist:"",offset:app.current.page,filter:app.current.filter,searchstr:app.current.search,cols:settings.colsSearch},parseSearch):
(document.getElementById("SearchList").getElementsByTagName("tbody")[0].innerHTML="",document.getElementById("searchAddAllSongs").setAttribute("disabled","disabled"),document.getElementById("searchAddAllSongsBtn").setAttribute("disabled","disabled"),document.getElementById("panel-heading-search").innerText="",document.getElementById("cardFooterSearch").innerText="",document.getElementById("SearchList").classList.remove("opacity05"),setPagination(0,0));selectTag("searchtags","searchtagsdesc",app.current.filter)}else appGoto("Playback");
app.last.app=app.current.app;app.last.tab=app.current.tab;app.last.view=app.current.view}else appGoto("Playback")}}function showAppInitAlert(a){document.getElementById("splashScreenAlert").innerHTML='<p class="text-danger">'+t(a)+'</p><p><a id="appReloadBtn" class="btn btn-danger text-light clickable">Reload</a></p>';document.getElementById("appReloadBtn").addEventListener("click",function(){location.reload()},!1)}
function appInitStart(){subdir=window.location.pathname.replace("/index.html","").replace(/\/$/,"");for(var a='<option value="default" data-phrase="Browser default"></option>',b=0;b<locales.length;b++)a+='<option value="'+e(locales[b].code)+'">'+e(locales[b].desc)+" ("+e(locales[b].code)+")</option>";document.getElementById("selectLocale").innerHTML=a;i18nHtml(document.getElementById("splashScreenAlert"));a=document.getElementsByTagName("script")[0].src.replace(/^.*[/]/,"");"serviceWorker"in navigator&&
"https"===document.URL.substring(0,5)&&"localhost"!==window.location.hostname&&"combined.js"===a&&window.addEventListener("load",function(){navigator.serviceWorker.register("/sw.js",{scope:"/"}).then(function(a){logInfo("ServiceWorker registration successful.");a.update()},function(a){logError("ServiceWorker registration failed: "+a)})});appInited=!1;document.getElementById("splashScreen").classList.remove("hide");document.getElementsByTagName("body")[0].classList.add("overflow-hidden");document.getElementById("splashScreenAlert").innerText=
t("Fetch myMPD settings");getSettings(!0);appInitWait()}
function appInitWait(){setTimeout(function(){if("true"===settingsParsed&&!0===websocketConnected)document.getElementById("splashScreenAlert").innerText=t("Applying settings"),document.getElementById("splashScreen").classList.add("hide-fade"),setTimeout(function(){document.getElementById("splashScreen").classList.add("hide");document.getElementById("splashScreen").classList.remove("hide-fade");document.getElementsByTagName("body")[0].classList.remove("overflow-hidden")},500),appInit(),appInited=!0;
else{if("true"===settingsParsed)document.getElementById("splashScreenAlert").innerText=t("Connect to websocket"),webSocketConnect();else if("error"===settingsParsed)return;appInitWait()}},500)}
function appInit(){document.getElementById("btnChVolumeDown").addEventListener("click",function(a){a.stopPropagation()},!1);document.getElementById("btnChVolumeUp").addEventListener("click",function(a){a.stopPropagation()},!1);domCache.volumeBar.addEventListener("click",function(a){a.stopPropagation()},!1);domCache.volumeBar.addEventListener("change",function(){sendAPI("MPD_API_PLAYER_VOLUME_SET",{volume:domCache.volumeBar.value})},!1);domCache.progressBar.value=0;domCache.progressBar.addEventListener("change",
function(){currentSong&&0<=currentSong.currentSongId&&sendAPI("MPD_API_PLAYER_SEEK",{songid:currentSong.currentSongId,seek:Math.ceil(domCache.progressBar.value/1E3*currentSong.totalTime)})},!1);for(var a=document.querySelectorAll(".subMenu"),b=a.length,c=0;c<b;c++)a[c].addEventListener("click",function(a){a.stopPropagation();a.preventDefault();a=this.getElementsByTagName("span")[0];a.innerText="keyboard_arrow_right"===a.innerText?"keyboard_arrow_down":"keyboard_arrow_right"},!1);document.getElementById("volumeMenu").parentNode.addEventListener("show.bs.dropdown",
function(){sendAPI("MPD_API_PLAYER_OUTPUT_LIST",{},parseOutputs)});document.getElementById("BrowseFilesystemBookmark").parentNode.addEventListener("show.bs.dropdown",function(){sendAPI("MYMPD_API_BOOKMARK_LIST",{offset:0},parseBookmarks)});document.getElementById("modalAbout").addEventListener("shown.bs.modal",function(){sendAPI("MPD_API_DATABASE_STATS",{},parseStats);var a="",b;for(b in keymap)if(void 0===keymap[b].req||!0===settings[keymap[b].req])a+='<tr><td><div class="key'+(keymap[b].key&&1<
keymap[b].key.length?" material-icons material-icons-small":"")+'">'+(void 0!==keymap[b].key?keymap[b].key:b)+"</div></td><td>"+t(keymap[b].desc)+"</td></tr>";document.getElementById("tbodyShortcuts").innerHTML=a});document.getElementById("modalAddToPlaylist").addEventListener("shown.bs.modal",function(){document.getElementById("addStreamFrm").classList.contains("hide")?document.getElementById("addToPlaylistPlaylist").focus():(document.getElementById("streamUrl").focus(),document.getElementById("streamUrl").value=
"")});document.getElementById("modalAddToQueue").addEventListener("shown.bs.modal",function(){document.getElementById("inputAddToQueueQuantity").classList.remove("is-invalid");settings.featPlaylists&&(playlistEl="selectAddToQueuePlaylist",sendAPI("MPD_API_PLAYLIST_LIST",{offset:0,filter:"-"},getAllPlaylists))});document.getElementById("modalUpdateDB").addEventListener("hidden.bs.modal",function(){document.getElementById("updateDBprogress").classList.remove("updateDBprogressAnimate")});document.getElementById("modalSaveQueue").addEventListener("shown.bs.modal",
function(){var a=document.getElementById("saveQueueName");a.focus();a.value="";a.classList.remove("is-invalid")});document.getElementById("modalSettings").addEventListener("shown.bs.modal",function(){getSettings();document.getElementById("inputCrossfade").classList.remove("is-invalid");document.getElementById("inputMixrampdb").classList.remove("is-invalid");document.getElementById("inputMixrampdelay").classList.remove("is-invalid")});document.getElementById("modalConnection").addEventListener("shown.bs.modal",
function(){getSettings();document.getElementById("inputMpdHost").classList.remove("is-invalid");document.getElementById("inputMpdPort").classList.remove("is-invalid");document.getElementById("inputMpdPass").classList.remove("is-invalid")});document.getElementById("selectJukeboxMode").addEventListener("change",function(){var a=this.options[this.selectedIndex].value;"0"===a?(document.getElementById("inputJukeboxQueueLength").setAttribute("disabled","disabled"),document.getElementById("selectJukeboxPlaylist").setAttribute("disabled",
"disabled")):"2"===a?(document.getElementById("inputJukeboxQueueLength").setAttribute("disabled","disabled"),document.getElementById("selectJukeboxPlaylist").setAttribute("disabled","disabled"),document.getElementById("selectJukeboxPlaylist").value="Database"):"1"===a&&(document.getElementById("inputJukeboxQueueLength").removeAttribute("disabled"),document.getElementById("selectJukeboxPlaylist").removeAttribute("disabled"));"0"!==a&&toggleBtnChk("btnConsume",!0);checkConsume()});document.getElementById("btnConsume").addEventListener("mouseup",
function(){setTimeout(function(){checkConsume()},100)});document.getElementById("selectAddToQueueMode").addEventListener("change",function(){var a=this.options[this.selectedIndex].value;"2"===a?(document.getElementById("inputAddToQueueQuantity").setAttribute("disabled","disabled"),document.getElementById("selectAddToQueuePlaylist").setAttribute("disabled","disabled"),document.getElementById("selectAddToQueuePlaylist").value="Database"):"1"===a&&(document.getElementById("inputAddToQueueQuantity").removeAttribute("disabled"),
document.getElementById("selectAddToQueuePlaylist").removeAttribute("disabled"))});document.getElementById("addToPlaylistPlaylist").addEventListener("change",function(){"new"===this.options[this.selectedIndex].value?(document.getElementById("addToPlaylistNewPlaylistDiv").classList.remove("hide"),document.getElementById("addToPlaylistNewPlaylist").focus()):document.getElementById("addToPlaylistNewPlaylistDiv").classList.add("hide")},!1);document.getElementById("selectMusicDirectory").addEventListener("change",
function(){"auto"===this.options[this.selectedIndex].value?(document.getElementById("inputMusicDirectory").value=settings.musicDirectoryValue,document.getElementById("inputMusicDirectory").setAttribute("readonly","readonly")):"none"===this.options[this.selectedIndex].value?(document.getElementById("inputMusicDirectory").value="",document.getElementById("inputMusicDirectory").setAttribute("readonly","readonly")):(document.getElementById("inputMusicDirectory").value="",document.getElementById("inputMusicDirectory").removeAttribute("readonly"))},
!1);addFilterLetter("BrowseFilesystemFilterLetters");addFilterLetter("BrowseDatabaseFilterLetters");addFilterLetter("BrowsePlaylistsFilterLetters");document.getElementById("syscmds").addEventListener("click",function(a){"A"===a.target.nodeName&&parseCmd(a,a.target.getAttribute("data-href"))},!1);a=document.querySelectorAll("[data-href]");b=a.length;for(c=0;c<b;c++)a[c].classList.add("clickable"),!0!==(a[c].parentNode.classList.contains("noInitChilds")?!0:!1)&&a[c].addEventListener("click",function(a){parseCmd(a,
this.getAttribute("data-href"))},!1);a=document.getElementsByClassName("pages");b=a.length;for(c=0;c<b;c++)a[c].addEventListener("click",function(a){"BUTTON"===a.target.nodeName&&gotoPage(a.target.getAttribute("data-page"))},!1);document.getElementById("cardPlaybackTags").addEventListener("click",function(a){"H4"===a.target.nodeName&&gotoBrowse(a.target)},!1);document.getElementById("BrowseBreadcrumb").addEventListener("click",function(a){"A"===a.target.nodeName&&(a.preventDefault(),appGoto("Browse",
"Filesystem",void 0,"0/"+app.current.filter+"/"+app.current.sort+"/"+decodeURI(a.target.getAttribute("data-uri"))))},!1);document.getElementById("modalSongDetails").getElementsByTagName("tbody")[0].addEventListener("click",function(a){if("A"===a.target.nodeName)if("calcFingerprint"===a.target.id){sendAPI("MPD_API_DATABASE_FINGERPRINT",{uri:decodeURI(a.target.getAttribute("data-uri"))},parseFingerprint);a.preventDefault();var b=a.target.parentNode,c=document.createElement("div");c.classList.add("spinner-border",
"spinner-border-sm");a.target.classList.add("hide");b.appendChild(c)}else void 0!==a.target.parentNode.getAttribute("data-tag")&&(modalSongDetails.hide(),a.preventDefault(),gotoBrowse(a.target));else"BUTTON"===a.target.nodeName&&a.target.getAttribute("data-href")&&parseCmd(a,a.target.getAttribute("data-href"))},!1);document.getElementById("outputs").addEventListener("click",function(a){"BUTTON"===a.target.nodeName&&(a.stopPropagation(),sendAPI("MPD_API_PLAYER_TOGGLE_OUTPUT",{output:a.target.getAttribute("data-output-id"),
state:a.target.classList.contains("active")?0:1}),toggleBtn(a.target.id))},!1);document.getElementById("QueueCurrentList").addEventListener("click",function(a){"TD"===a.target.nodeName?sendAPI("MPD_API_PLAYER_PLAY_TRACK",{track:a.target.parentNode.getAttribute("data-trackid")}):"A"===a.target.nodeName&&showMenu(a.target,a)},!1);document.getElementById("QueueLastPlayedList").addEventListener("click",function(a){"A"===a.target.nodeName&&showMenu(a.target,a)},!1);document.getElementById("BrowseFilesystemList").addEventListener("click",
function(a){if("TD"===a.target.nodeName)switch(a.target.parentNode.getAttribute("data-type")){case "parentDir":case "dir":appGoto("Browse","Filesystem",void 0,"0/"+app.current.filter+"/"+app.current.sort+"/"+decodeURI(a.target.parentNode.getAttribute("data-uri")));break;case "song":appendQueue("song",decodeURI(a.target.parentNode.getAttribute("data-uri")),a.target.parentNode.getAttribute("data-name"));break;case "plist":appendQueue("plist",decodeURI(a.target.parentNode.getAttribute("data-uri")),a.target.parentNode.getAttribute("data-name"))}else"A"===
a.target.nodeName&&showMenu(a.target,a)},!1);document.getElementById("BrowseFilesystemBookmarks").addEventListener("click",function(a){if("A"===a.target.nodeName){var b=a.target.parentNode.parentNode.getAttribute("data-id"),c=a.target.parentNode.parentNode.getAttribute("data-type"),d=decodeURI(a.target.parentNode.parentNode.getAttribute("data-uri")),l=a.target.parentNode.parentNode.firstChild.innerText,k=a.target.getAttribute("data-href");"delete"===k?(sendAPI("MYMPD_API_BOOKMARK_RM",{id:b},function(){sendAPI("MYMPD_API_BOOKMARK_LIST",
{offset:0},parseBookmarks)}),a.preventDefault(),a.stopPropagation()):"edit"===k?showBookmarkSave(b,l,d,c):"goto"===k&&appGoto("Browse","Filesystem",void 0,"0/-/-/"+d)}},!1);document.getElementById("BrowsePlaylistsAllList").addEventListener("click",function(a){"TD"===a.target.nodeName?appendQueue("plist",decodeURI(a.target.parentNode.getAttribute("data-uri")),a.target.parentNode.getAttribute("data-name")):"A"===a.target.nodeName&&showMenu(a.target,a)},!1);document.getElementById("BrowsePlaylistsDetailList").addEventListener("click",
function(a){"TD"===a.target.nodeName?appendQueue("plist",decodeURI(a.target.parentNode.getAttribute("data-uri")),a.target.parentNode.getAttribute("data-name")):"A"===a.target.nodeName&&showMenu(a.target,a)},!1);document.getElementById("BrowseDatabaseTagList").addEventListener("click",function(a){"TD"===a.target.nodeName&&appGoto("Browse","Database",app.current.view,"0/-/-/"+a.target.parentNode.getAttribute("data-uri"))},!1);document.getElementById("SearchList").addEventListener("click",function(a){"TD"===
a.target.nodeName?appendQueue("song",decodeURI(a.target.parentNode.getAttribute("data-uri")),a.target.parentNode.getAttribute("data-name")):"A"===a.target.nodeName&&showMenu(a.target,a)},!1);document.getElementById("BrowseFilesystemAddAllSongsDropdown").addEventListener("click",function(a){"BUTTON"===a.target.nodeName&&("Add all to queue"===a.target.getAttribute("data-phrase")?addAllFromBrowseFilesystem():"Add all to playlist"===a.target.getAttribute("data-phrase")&&showAddToPlaylist(app.current.search))},
!1);document.getElementById("searchAddAllSongsDropdown").addEventListener("click",function(a){"BUTTON"===a.target.nodeName&&("Add all to queue"===a.target.getAttribute("data-phrase")?addAllFromSearchPlist("queue"):"Add all to playlist"===a.target.getAttribute("data-phrase")?showAddToPlaylist("SEARCH"):"Save as smart playlist"===a.target.getAttribute("data-phrase")&&saveSearchAsSmartPlaylist())},!1);document.getElementById("BrowseDatabaseAddAllSongsDropdown").addEventListener("click",function(a){"BUTTON"===
a.target.nodeName&&("Add all to queue"===a.target.getAttribute("data-phrase")?addAllFromBrowseDatabasePlist("queue"):"Add all to playlist"===a.target.getAttribute("data-phrase")&&showAddToPlaylist("DATABASE"))},!1);document.getElementById("searchtags").addEventListener("click",function(a){"BUTTON"===a.target.nodeName&&(app.current.filter=a.target.getAttribute("data-tag"),search(domCache.searchstr.value))},!1);document.getElementById("searchqueuestr").addEventListener("keyup",function(a){"Escape"===
a.key?this.blur():appGoto(app.current.app,app.current.tab,app.current.view,"0/"+app.current.filter+"/"+app.current.sort+"/"+this.value)},!1);document.getElementById("searchqueuetags").addEventListener("click",function(a){"BUTTON"===a.target.nodeName&&appGoto(app.current.app,app.current.tab,app.current.view,app.current.page+"/"+a.target.getAttribute("data-tag")+"/"+app.current.sort+"/"+app.current.search)},!1);a="QueueCurrentColsDropdown BrowseFilesystemColsDropdown SearchColsDropdown BrowsePlaylistsDetailColsDropdown BrowseDatabaseColsDropdown PlaybackColsDropdown QueueLastPlayedColsDropdown".split(" ");
for(b=0;b<a.length;b++)document.getElementById(a[b]).addEventListener("click",function(a){"INPUT"===a.target.nodeName&&a.stopPropagation()},!1);document.getElementById("search").addEventListener("submit",function(){return!1},!1);document.getElementById("searchqueue").addEventListener("submit",function(){return!1},!1);domCache.searchstr.addEventListener("keyup",function(a){if("Escape"===a.key)this.blur();else if("Enter"===a.key&&settings.featAdvsearch)if(""!==this.value){a=document.getElementById("searchMatch");
var b=document.createElement("button");b.classList.add("btn","btn-light","mr-2");b.setAttribute("data-filter",encodeURI(app.current.filter+" "+a.options[a.selectedIndex].value+" '"+this.value+"'"));b.innerHTML=app.current.filter+" "+a.options[a.selectedIndex].value+" '"+e(this.value)+'\'<span class="ml-2 badge badge-secondary">&times;</span>';this.value="";domCache.searchCrumb.appendChild(b)}else search(this.value);else search(this.value)},!1);domCache.searchCrumb.addEventListener("click",function(a){a.preventDefault();
a.stopPropagation();if("SPAN"===a.target.nodeName)a.target.parentNode.remove(),search("");else if("BUTTON"===a.target.nodeName){var b=decodeURI(a.target.getAttribute("data-filter"));domCache.searchstr.value=b.substring(b.indexOf("'")+1,b.length-1);var c=b.substring(0,b.indexOf(" "));selectTag("searchtags","searchtagsdesc",c);b=b.substring(b.indexOf(" ")+1);b=b.substring(0,b.indexOf(" "));document.getElementById("searchMatch").value=b;a.target.remove();search(domCache.searchstr.value)}},!1);document.getElementById("searchMatch").addEventListener("change",
function(){search(domCache.searchstr.value)},!1);document.getElementById("SearchList").getElementsByTagName("tr")[0].addEventListener("click",function(a){if(settings.featAdvsearch&&"TH"===a.target.nodeName){var b=a.target.getAttribute("data-col");if("Duration"!==b){var c=app.current.sort,d=!0;if(c===b||c==="-"+b)0===c.indexOf("-")?(d=!0,b=c.substring(1)):d=!1;!1===d?(c="-"+b,d=!0):(d=!1,c=b);for(var l=document.getElementById("SearchList").getElementsByClassName("sort-dir"),k=0;k<l.length;k++)l[k].remove();
app.current.sort=c;a.target.innerHTML=t(b)+'<span class="sort-dir material-icons pull-right">'+(!0===d?"arrow_drop_up":"arrow_drop_down")+"</span>";appGoto(app.current.app,app.current.tab,app.current.view,app.current.page+"/"+app.current.filter+"/"+app.current.sort+"/"+app.current.search)}}},!1);document.getElementById("BrowseDatabaseByTagDropdown").addEventListener("click",function(a){"BUTTON"===a.target.nodeName&&appGoto(app.current.app,app.current.tab,a.target.getAttribute("data-tag"),"0/"+app.current.filter+
"/"+app.current.sort+"/"+app.current.search)},!1);document.getElementsByTagName("body")[0].addEventListener("click",function(){hideMenu()},!1);dragAndDropTable("QueueCurrentList");dragAndDropTable("BrowsePlaylistsDetailList");dragAndDropTableHeader("QueueCurrent");dragAndDropTableHeader("QueueLastPlayed");dragAndDropTableHeader("Search");dragAndDropTableHeader("BrowseFilesystem");dragAndDropTableHeader("BrowsePlaylistsDetail");window.addEventListener("hashchange",appRoute,!1);window.addEventListener("focus",
function(){sendAPI("MPD_API_PLAYER_STATE",{},parseState)},!1);document.addEventListener("keydown",function(a){if("INPUT"!==a.target.tagName&&"SELECT"!==a.target.tagName&&!a.ctrlKey&&!a.altKey){var b=keymap[a.key];b&&"function"===typeof window[b.cmd]&&(void 0===keymap[a.key].req||!0===settings[keymap[a.key].req])&&parseCmd(a,b)}},!1);a=document.getElementsByTagName("table");for(b=0;b<a.length;b++)a[b].setAttribute("tabindex",0),a[b].addEventListener("keydown",function(a){navigateTable(this,a.key)},
!1);window.addEventListener("beforeinstallprompt",function(a){a.preventDefault();deferredPrompt=a});window.addEventListener("beforeinstallprompt",function(a){a.preventDefault();deferredPrompt=a;domCache.btnAdd.classList.remove("hide")});domCache.btnAdd.addEventListener("click",function(){domCache.btnAdd.classList.add("hide");deferredPrompt.prompt();deferredPrompt.userChoice.then(function(a){"accepted"===a.outcome?logVerbose("User accepted the A2HS prompt"):logVerbose("User dismissed the A2HS prompt");
deferredPrompt=null})});window.addEventListener("appinstalled",function(){logInfo("myMPD installed as app");showNotification(t("myMPD installed as app"),"","","success")});window.addEventListener("beforeunload",function(){null!==websocketTimer&&(clearTimeout(websocketTimer),websocketTimer=null);null!==socket&&(socket.onclose=function(){},socket.close(),socket=null);websocketConnected=!1});document.getElementById("localPlayer").addEventListener("canplay",function(){document.getElementById("alertLocalPlayback").classList.add("hide");
1==settings.featLocalplayer&&1==settings.localplayerAutoplay&&localplayerPlay()})}appInitStart();function toggleAlert(a,b,c){a=document.getElementById(a);!1===b?(a.innerHTML="",a.classList.add("hide")):(a.innerHTML=c,a.classList.remove("hide"))}
function showNotification(a,b,c,d){if(1==settings.notificationWeb){var f=new Notification(a,{icon:"assets/favicon.ico",body:b});setTimeout(function(a){a.close()},3E3,f)}!0===settings.notificationPage&&(document.getElementById("alertBox")?f=document.getElementById("alertBox"):(f=document.createElement("div"),f.setAttribute("id","alertBox"),f.addEventListener("click",function(){hideNotification()},!1)),f.classList.remove("alert-success","alert-danger"),f.classList.add("alert","alert-"+d),f.innerHTML=
"<div><strong>"+e(a)+"</strong><br/>"+(""==c?e(b):c)+"</div>",document.getElementsByTagName("main")[0].append(f),document.getElementById("alertBox").classList.add("alertBoxActive"),alertTimeout&&clearTimeout(alertTimeout),alertTimeout=setTimeout(function(){hideNotification()},3E3))}
function hideNotification(){document.getElementById("alertBox")&&(document.getElementById("alertBox").classList.remove("alertBoxActive"),setTimeout(function(){var a=document.getElementById("alertBox");a&&a.remove()},600))}function notificationsSupported(){return"Notification"in window}
function setElsState(a,b){a=document.getElementsByTagName(a);for(var c=a.length,d=0;d<c;d++)"disabled"==b?!a[d].classList.contains("alwaysEnabled")&&a[d].getAttribute("disabled")&&(a[d].setAttribute("disabled","disabled"),a[d].classList.add("disabled")):a[d].classList.contains("disabled")&&(a[d].removeAttribute("disabled"),a[d].classList.remove("disabled"))}
function toggleUI(){var a="disabled";1==websocketConnected&&1==settings.mpdConnected&&(a="enabled");var b="disabled"==a?!1:!0;b!=uiEnabled&&(setElsState("a",a),setElsState("input",a),setElsState("button",a),uiEnabled=b);1==settings.mpdConnected?toggleAlert("alertMpdState",!1,""):toggleAlert("alertMpdState",!0,t("MPD disconnected"));1==websocketConnected?toggleAlert("alertMympdState",!1,""):toggleAlert("alertMympdState",!0,t("Websocket connection failed"))}
function parsePlaylists(a){"All"===app.current.view?(document.getElementById("BrowsePlaylistsAllList").classList.remove("hide"),document.getElementById("BrowsePlaylistsDetailList").classList.add("hide"),document.getElementById("btnBrowsePlaylistsAll").parentNode.classList.add("hide"),document.getElementById("btnPlaylistClear").parentNode.classList.add("hide"),document.getElementById("BrowsePlaylistsDetailColsBtn").parentNode.classList.add("hide")):(-1<a.result.uri.indexOf(".")||!0===a.result.smartpls?
(document.getElementById("BrowsePlaylistsDetailList").setAttribute("data-ro","true"),document.getElementById("btnPlaylistClear").parentNode.classList.add("hide")):(document.getElementById("BrowsePlaylistsDetailList").setAttribute("data-ro","false"),document.getElementById("btnPlaylistClear").parentNode.classList.remove("hide")),document.getElementById("BrowsePlaylistsDetailList").setAttribute("data-uri",a.result.uri),document.getElementById("BrowsePlaylistsDetailList").getElementsByTagName("caption")[0].innerHTML=
(!0===a.result.smartpls?t("Smart playlist"):t("Playlist"))+": "+a.result.uri,document.getElementById("BrowsePlaylistsDetailList").classList.remove("hide"),document.getElementById("BrowsePlaylistsAllList").classList.add("hide"),document.getElementById("btnBrowsePlaylistsAll").parentNode.classList.remove("hide"),settings.featTags&&document.getElementById("BrowsePlaylistsDetailColsBtn").parentNode.classList.remove("hide"));var b=a.result.returnedEntities,c=document.getElementById(app.current.app+app.current.tab+
app.current.view+"List"),d=c.getElementsByTagName("tbody")[0],f=d.getElementsByTagName("tr");c=document.activeElement.parentNode.parentNode===c?!0:!1;var g=0;if("All"===app.current.view){for(var h=0;h<b;h++){var l=encodeURI(a.result.data[h].uri),k=document.createElement("tr");k.setAttribute("data-uri",l);k.setAttribute("data-type",a.result.data[h].Type);k.setAttribute("data-name",a.result.data[h].name);k.setAttribute("tabindex",0);k.innerHTML='<td data-col="Type"><span class="material-icons">'+("smartpls"===
a.result.data[h].Type?"queue_music":"list")+"</span></td><td>"+e(a.result.data[h].name)+"</td><td>"+localeDate(a.result.data[h].last_modified)+'</td><td data-col="Action"><a href="#" class="material-icons color-darkgrey">'+ligatureMore+"</a></td>";h<f.length?g=!0===replaceTblRow(f[h],k)?h:g:d.append(k)}document.getElementById("cardFooterBrowse").innerText=gtPage("Num playlists",a.result.returnedEntities,a.result.totalEntities)}else if("Detail"===app.current.view){for(h=0;h<b;h++){k=encodeURI(a.result.data[h].uri);
l=document.createElement("tr");!1===a.result.smartpls&&l.setAttribute("draggable","true");l.setAttribute("id","playlistTrackId"+a.result.data[h].Pos);l.setAttribute("data-type",a.result.data[h].Type);l.setAttribute("data-uri",k);l.setAttribute("data-name",a.result.data[h].Title);l.setAttribute("data-songpos",a.result.data[h].Pos);l.setAttribute("tabindex",0);a.result.data[h].Duration=beautifySongDuration(a.result.data[h].Duration);k="";for(var m=0;m<settings.colsBrowsePlaylistsDetail.length;m++)k+=
'<td data-col="'+settings.colsBrowsePlaylistsDetail[m]+'">'+e(a.result.data[h][settings.colsBrowsePlaylistsDetail[m]])+"</td>";k+='<td data-col="Action"><a href="#" class="material-icons color-darkgrey">'+ligatureMore+"</a></td>";l.innerHTML=k;h<f.length?g=!0===replaceTblRow(f[h],l)?h:g:d.append(l)}document.getElementById("cardFooterBrowse").innerText=gtPage("Num songs",a.result.returnedEntities,a.result.totalEntities)}for(g=f.length-1;g>=b;g--)f[g].remove();!0===c&&focusTable(0);setPagination(a.result.totalEntities,
a.result.returnedEntities);0===b&&(d.innerHTML="All"===app.current.view?'<tr><td><span class="material-icons">error_outline</span></td><td colspan="3>'+t("No playlists found")+"</td></tr>":'<tr><td><span class="material-icons">error_outline</span></td><td colspan="'+(settings.colsBrowsePlaylistsDetail.length-1)+'">'+t("Empty playlist")+"</td></tr>");document.getElementById(app.current.app+app.current.tab+app.current.view+"List").classList.remove("opacity05")}
function playlistDetails(a){document.getElementById("BrowsePlaylistsAllList").classList.add("opacity05");appGoto("Browse","Playlists","Detail","0/-/-/"+a)}function playlistClear(){var a=document.getElementById("BrowsePlaylistsDetailList").getAttribute("data-uri");sendAPI("MPD_API_PLAYLIST_CLEAR",{uri:a});document.getElementById("BrowsePlaylistsDetailList").classList.add("opacity05")}
function getAllPlaylists(a){var b=a.result.returnedEntities,c="";if(0===a.result.offset)if("addToPlaylistPlaylist"===playlistEl)c='<option value=""></option><option value="new">'+t("New playlist")+"</option>";else if("selectJukeboxPlaylist"===playlistEl||"selectAddToQueuePlaylist"===playlistEl)c='<option value="Database">'+t("Database")+"</option>";for(var d=0;d<b;d++)if("addToPlaylistPlaylist"!==playlistEl||"smartpls"!==a.result.data[d].Type)c+='<option value="'+e(a.result.data[d].uri)+'"',"selectJukeboxPlaylist"===
playlistEl&&a.result.data[d].uri===settings.jukeboxPlaylist&&(c+=" selected"),c+=">"+e(a.result.data[d].uri)+"</option>";0===a.result.offset?document.getElementById(playlistEl).innerHTML=c:document.getElementById(playlistEl).innerHTML+=c;a.result.totalEntities>a.result.returnedEntities&&(a.result.offset+=settings.maxElementsPerPage,sendAPI("MPD_API_PLAYLIST_LIST",{offset:a.result.offset,filter:"-"},getAllPlaylists))}function updateSmartPlaylists(){sendAPI("MPD_API_SMARTPLS_UPDATE_ALL",{})}
function removeFromPlaylist(a,b){b--;sendAPI("MPD_API_PLAYLIST_RM_TRACK",{uri:a,track:b});document.getElementById("BrowsePlaylistsDetailList").classList.add("opacity05")}
function toggleAddToPlaylistFrm(){var a=document.getElementById("toggleAddToPlaylistBtn");toggleBtn("toggleAddToPlaylistBtn");a.classList.contains("active")?(document.getElementById("addToPlaylistFrm").classList.remove("hide"),document.getElementById("addStreamFooter").classList.add("hide"),document.getElementById("addToPlaylistFooter").classList.remove("hide")):(document.getElementById("addToPlaylistFrm").classList.add("hide"),document.getElementById("addStreamFooter").classList.remove("hide"),document.getElementById("addToPlaylistFooter").classList.add("hide"))}
function parseSmartPlaylist(a){var b=document.getElementById("saveSmartPlaylistName");b.value=a.result.playlist;b.classList.remove("is-invalid");document.getElementById("saveSmartPlaylistType").value=a.result.type;document.getElementById("saveSmartPlaylistSearch").classList.add("hide");document.getElementById("saveSmartPlaylistSticker").classList.add("hide");document.getElementById("saveSmartPlaylistNewest").classList.add("hide");var c;settings.featTags&&(c='<option value="any">'+t("Any Tag")+"</option>");
c+='<option value="filename">'+t("Filename")+"</option>";for(var d=0;d<settings.searchtags.length;d++)c+='<option value="'+settings.searchtags[d]+'">'+t(settings.searchtags[d])+"</option>";document.getElementById("selectSaveSmartPlaylistTag").innerHTML=c;"search"===a.result.type?(document.getElementById("saveSmartPlaylistSearch").classList.remove("hide"),document.getElementById("selectSaveSmartPlaylistTag").value=a.result.tag,document.getElementById("inputSaveSmartPlaylistSearchstr").value=a.result.searchstr,
settings.featAdvsearch?(document.getElementById("selectSaveSmartPlaylistTag").parentNode.classList.add("hide"),document.getElementById("inputSaveSmartPlaylistSearchstr").parentNode.classList.replace("col-md-6","col-md-12")):(document.getElementById("selectSaveSmartPlaylistTag").parentNode.classList.remove("hide"),document.getElementById("inputSaveSmartPlaylistSearchstr").parentNode.classList.replace("col-md-12","col-md-6"))):"sticker"===a.result.type?(document.getElementById("saveSmartPlaylistSticker").classList.remove("hide"),
document.getElementById("selectSaveSmartPlaylistSticker").value=a.result.sticker,document.getElementById("inputSaveSmartPlaylistStickerMaxentries").value=a.result.maxentries):"newest"===a.result.type&&(document.getElementById("saveSmartPlaylistNewest").classList.remove("hide"),a=a.result.timerange/24/60/60,document.getElementById("inputSaveSmartPlaylistNewestTimerange").value=a);modalSaveSmartPlaylist.show();b.focus()}
function saveSmartPlaylist(){var a=document.getElementById("saveSmartPlaylistName").value,b=document.getElementById("saveSmartPlaylistType").value;if(!0===validatePlname(a)){if("search"===b){var c=document.getElementById("selectSaveSmartPlaylistTag");c=c.options[c.selectedIndex].value;settings.featAdvsearch&&(c="expression");var d=document.getElementById("inputSaveSmartPlaylistSearchstr").value;sendAPI("MPD_API_SMARTPLS_SAVE",{type:b,playlist:a,tag:c,searchstr:d})}else if("sticker"===b){c=document.getElementById("selectSaveSmartPlaylistSticker");
c=c.options[c.selectedIndex].value;d=document.getElementById("inputSaveSmartPlaylistStickerMaxentries");if(!validateInt(d))return;sendAPI("MPD_API_SMARTPLS_SAVE",{type:b,playlist:a,sticker:c,maxentries:d.value})}else if("newest"===b){c=document.getElementById("inputSaveSmartPlaylistNewestTimerange");if(!validateInt(c))return;c=86400*parseInt(c.value);sendAPI("MPD_API_SMARTPLS_SAVE",{type:b,playlist:a,timerange:c})}else{document.getElementById("saveSmartPlaylistType").classList.add("is-invalid");return}modalSaveSmartPlaylist.hide();
showNotification(t("Saved smart playlist %{name}",{name:a}),"","","success")}else document.getElementById("saveSmartPlaylistName").classList.add("is-invalid")}
function showAddToPlaylist(a){document.getElementById("addToPlaylistUri").value=a;document.getElementById("addToPlaylistPlaylist").innerHTML="";document.getElementById("addToPlaylistNewPlaylist").value="";document.getElementById("addToPlaylistNewPlaylistDiv").classList.add("hide");document.getElementById("addToPlaylistNewPlaylist").classList.remove("is-invalid");toggleBtn("toggleAddToPlaylistBtn",0);var b=document.getElementById("streamUrl");b.focus();b.value="";b.classList.remove("is-invalid");"stream"!==
a?(document.getElementById("addStreamFooter").classList.add("hide"),document.getElementById("addStreamFrm").classList.add("hide"),document.getElementById("addToPlaylistFooter").classList.remove("hide"),document.getElementById("addToPlaylistFrm").classList.remove("hide"),document.getElementById("addToPlaylistCaption").innerText=t("Add to playlist")):(document.getElementById("addStreamFooter").classList.remove("hide"),document.getElementById("addStreamFrm").classList.remove("hide"),document.getElementById("addToPlaylistFooter").classList.add("hide"),
document.getElementById("addToPlaylistFrm").classList.add("hide"),document.getElementById("addToPlaylistCaption").innerText=t("Add stream"));modalAddToPlaylist.show();settings.featPlaylists&&(playlistEl="addToPlaylistPlaylist",sendAPI("MPD_API_PLAYLIST_LIST",{offset:0,filter:"-"},getAllPlaylists))}
function addToPlaylist(){var a=document.getElementById("addToPlaylistUri").value;if("stream"===a&&(a=document.getElementById("streamUrl").value,""===a||-1===a.indexOf("http"))){document.getElementById("streamUrl").classList.add("is-invalid");return}var b=document.getElementById("addToPlaylistPlaylist");b=b.options[b.selectedIndex].value;if("new"===b&&(b=document.getElementById("addToPlaylistNewPlaylist").value,!0!==validatePlname(b))){document.getElementById("addToPlaylistNewPlaylist").classList.add("is-invalid");
return}""!==b?("SEARCH"===a?addAllFromSearchPlist(b):"DATABASE"===a?addAllFromBrowseDatabasePlist(b):sendAPI("MPD_API_PLAYLIST_ADD_TRACK",{uri:a,plist:b}),modalAddToPlaylist.hide()):document.getElementById("addToPlaylistPlaylist").classList.add("is-invalid")}function showRenamePlaylist(a){document.getElementById("renamePlaylistTo").classList.remove("is-invalid");modalRenamePlaylist.show();document.getElementById("renamePlaylistFrom").value=a;document.getElementById("renamePlaylistTo").value=""}
function renamePlaylist(){var a=document.getElementById("renamePlaylistFrom").value,b=document.getElementById("renamePlaylistTo").value;b!==a&&!0===validatePlname(b)&&!0===validatePlname(a)?(sendAPI("MPD_API_PLAYLIST_RENAME",{from:a,to:b}),modalRenamePlaylist.hide()):document.getElementById("renamePlaylistTo").classList.add("is-invalid")}function showSmartPlaylist(a){sendAPI("MPD_API_SMARTPLS_GET",{playlist:a},parseSmartPlaylist)}
function updateSmartPlaylist(a){sendAPI("MPD_API_SMARTPLS_UPDATE",{playlist:a},parseSmartPlaylist)}function showDelPlaylist(a){document.getElementById("deletePlaylist").value=a;modalDeletePlaylist.show()}function delPlaylist(){var a=document.getElementById("deletePlaylist").value;sendAPI("MPD_API_PLAYLIST_RM",{uri:a});modalDeletePlaylist.hide()}function playlistMoveTrack(a,b){sendAPI("MPD_API_PLAYLIST_MOVE_TRACK",{plist:app.current.search,from:a,to:b})}
function addSelectedItemToPlaylist(){var a=document.activeElement;a&&"BrowsePlaylistsAllList"!==a.parentNode.parentNode.id&&showAddToPlaylist(a.getAttribute("data-uri"))}function b64EncodeUnicode(a){return btoa(encodeURIComponent(a).replace(/%([0-9A-F]{2})/g,function(a,c){return String.fromCharCode("0x"+c)}))}function b64DecodeUnicode(a){return decodeURIComponent(atob(a).split("").map(function(a){return"%"+("00"+a.charCodeAt(0).toString(16)).slice(-2)}).join(""))}
function addMenuItem(a,b){return'<a class="dropdown-item" href="#" data-href=\''+b64EncodeUnicode(JSON.stringify(a))+"'>"+b+"</a>"}function hideMenu(){var a=document.querySelector("[data-popover]");a&&(new Popover(a,{}),a.Popover.hide(),a.removeAttribute("data-popover"),a.parentNode.parentNode.classList.contains("selected")&&focusTable(void 0,a.parentNode.parentNode.parentNode.parentNode))}
function showMenu(a,b){b.preventDefault();b.stopPropagation();hideMenu();if(!a.getAttribute("data-init")){b=a.getAttribute("data-type");var c=decodeURI(a.getAttribute("data-uri")),d=a.getAttribute("data-name"),f=0;if(null===b||""===c)b=a.parentNode.parentNode.getAttribute("data-type"),c=decodeURI(a.parentNode.parentNode.getAttribute("data-uri")),d=a.parentNode.parentNode.getAttribute("data-name");lastState&&(f=lastState.nextSongPos);var g="";"Browse"===app.current.app&&"Filesystem"===app.current.tab||
"Search"===app.current.app||"Browse"===app.current.app&&"Database"===app.current.tab?(g+=addMenuItem({cmd:"appendQueue",options:[b,c,d]},t("Append to queue"))+("song"===b?addMenuItem({cmd:"appendAfterQueue",options:[b,c,f,d]},t("Add after current playing song")):"")+addMenuItem({cmd:"replaceQueue",options:[b,c,d]},t("Replace queue"))+("plist"!==b&&"smartpls"!==b&&settings.featPlaylists?addMenuItem({cmd:"showAddToPlaylist",options:[c]},t("Add to playlist")):"")+("song"===b?addMenuItem({cmd:"songDetails",
options:[c]},t("Song details")):"")+("plist"===b||"smartpls"===b?addMenuItem({cmd:"playlistDetails",options:[c]},t("View playlist")):"")+("dir"===b&&settings.featBookmarks?addMenuItem({cmd:"showBookmarkSave",options:[-1,d,c,b]},t("Add bookmark")):""),"Search"===app.current.app&&(c=dirname(c),g+='<div class="dropdown-divider"></div><a class="dropdown-item" id="advancedMenuLink" data-toggle="collapse" href="#advancedMenu"><span class="material-icons material-icons-small-left">keyboard_arrow_right</span>Album actions</a><div class="collapse" id="advancedMenu">'+
addMenuItem({cmd:"appendQueue",options:[b,c,d]},t("Append to queue"))+addMenuItem({cmd:"appendAfterQueue",options:[b,c,f,d]},t("Add after current playing song"))+addMenuItem({cmd:"replaceQueue",options:[b,c,d]},t("Replace queue"))+(settings.featPlaylists?addMenuItem({cmd:"showAddToPlaylist",options:[c]},t("Add to playlist")):"")+"</div>")):"Browse"===app.current.app&&"Playlists"===app.current.tab&&"All"===app.current.view?g+=addMenuItem({cmd:"appendQueue",options:[b,c,d]},t("Append to queue"))+addMenuItem({cmd:"replaceQueue",
options:[b,c,d]},t("Replace queue"))+("smartpls"===b?addMenuItem({cmd:"playlistDetails",options:[c]},t("View playlist")):addMenuItem({cmd:"playlistDetails",options:[c]},t("Edit playlist")))+("smartpls"===b?addMenuItem({cmd:"showSmartPlaylist",options:[c]},t("Edit smart playlist")):"")+(!0===settings.smartpls&&"smartpls"===b?addMenuItem({cmd:"updateSmartPlaylist",options:[c]},t("Update smart playlist")):"")+addMenuItem({cmd:"showRenamePlaylist",options:[c]},t("Rename playlist"))+addMenuItem({cmd:"showDelPlaylist",
options:[c]},t("Delete playlist")):"Browse"===app.current.app&&"Playlists"===app.current.tab&&"Detail"===app.current.view?(f=document.getElementById("BrowsePlaylistsDetailList"),g+=addMenuItem({cmd:"appendQueue",options:[b,c,d]},t("Append to queue"))+addMenuItem({cmd:"replaceQueue",options:[b,c,d]},t("Replace queue"))+("false"===f.getAttribute("data-ro")?addMenuItem({cmd:"removeFromPlaylist",options:[f.getAttribute("data-uri"),a.parentNode.parentNode.getAttribute("data-songpos")]},t("Remove")):"")+
addMenuItem({cmd:"showAddToPlaylist",options:[c]},t("Add to playlist"))+(-1===c.indexOf("http")?addMenuItem({cmd:"songDetails",options:[c]},t("Song details")):"")):"Queue"===app.current.app&&"Current"===app.current.tab?g+=addMenuItem({cmd:"delQueueSong",options:["single",a.parentNode.parentNode.getAttribute("data-trackid")]},t("Remove"))+addMenuItem({cmd:"delQueueSong",options:["range",0,a.parentNode.parentNode.getAttribute("data-songpos")]},t("Remove all upwards"))+addMenuItem({cmd:"delQueueSong",
options:["range",parseInt(a.parentNode.parentNode.getAttribute("data-songpos"))-1,-1]},t("Remove all downwards"))+(-1===c.indexOf("http")?addMenuItem({cmd:"songDetails",options:[c]},t("Song details")):""):"Queue"===app.current.app&&"LastPlayed"===app.current.tab&&(g+=addMenuItem({cmd:"appendQueue",options:[b,c,d]},t("Append to queue"))+addMenuItem({cmd:"replaceQueue",options:[b,c,d]},t("Replace queue"))+addMenuItem({cmd:"showAddToPlaylist",options:[c]},t("Add to playlist"))+(-1===c.indexOf("http")?
addMenuItem({cmd:"songDetails",options:[c]},t("Song details")):""));new Popover(a,{trigger:"click",delay:0,dismissible:!0,template:'<div class="popover" role="tooltip"><div class="arrow"></div><div class="popover-content">'+g+"</div></div>",content:" "});b=a.Popover;a.setAttribute("data-init","true");a.addEventListener("shown.bs.popover",function(a){a.target.setAttribute("data-popover","true");document.getElementsByClassName("popover-content")[0].addEventListener("click",function(a){a.preventDefault();
a.stopPropagation();if("A"===a.target.nodeName){var b=a.target.getAttribute("data-href");b&&(b=JSON.parse(b64DecodeUnicode(b)),parseCmd(a,b),hideMenu())}},!1);document.getElementsByClassName("popover-content")[0].addEventListener("keydown",function(a){a.preventDefault();a.stopPropagation();if("ArrowDown"===a.key||"ArrowUp"===a.key){var b=this.getElementsByTagName("a");b=Array.prototype.slice.call(b);var c=b.indexOf(document.activeElement);do if(c="ArrowUp"===a.key?1<c?c-1:0:"ArrowDown"===a.key?c<
b.length-1?c+1:c:c,0===c||c===b.length-1)break;while(!b[c].offsetHeight);b[c]&&b[c].focus()}else"Enter"===a.key?a.target.click():"Escape"===a.key&&hideMenu()},!1);if(a=document.getElementById("advancedMenuLink"))a.addEventListener("click",function(){var a=this.getElementsByTagName("span")[0];a.innerText="keyboard_arrow_right"===a.innerText?"keyboard_arrow_down":"keyboard_arrow_right"},!1),new Collapse(a);document.getElementsByClassName("popover-content")[0].firstChild.focus()},!1);b.show()}}
function parseUpdateQueue(a){if(1===a.result.state){for(var b=0;b<domCache.btnsPlayLen;b++)domCache.btnsPlay[b].innerText="play_arrow";playstate="stop"}else if(2===a.result.state){for(b=0;b<domCache.btnsPlayLen;b++)domCache.btnsPlay[b].innerText="pause";playstate="play"}else{for(b=0;b<domCache.btnsPlayLen;b++)domCache.btnsPlay[b].innerText="play_arrow";playstate="pause"}if(0===a.result.queueLength)for(b=0;b<domCache.btnsPlayLen;b++)domCache.btnsPlay[b].setAttribute("disabled","disabled");else for(b=
0;b<domCache.btnsPlayLen;b++)domCache.btnsPlay[b].removeAttribute("disabled");domCache.badgeQueueItems.innerText=a.result.queueLength;-1===a.result.nextSongPos&&!1===settings.jukeboxMode?domCache.btnNext.setAttribute("disabled","disabled"):domCache.btnNext.removeAttribute("disabled");0>=a.result.songPos?domCache.btnPrev.setAttribute("disabled","disabled"):domCache.btnPrev.removeAttribute("disabled")}
function getQueue(){2<=app.current.search.length?sendAPI("MPD_API_QUEUE_SEARCH",{filter:app.current.filter,offset:app.current.page,searchstr:app.current.search,cols:settings.colsQueueCurrent},parseQueue):sendAPI("MPD_API_QUEUE_LIST",{offset:app.current.page,cols:settings.colsQueueCurrent},parseQueue)}
function parseQueue(a){a.result.totalTime&&0<a.result.totalTime&&a.result.totalEntities<=settings.maxElementsPerPage?document.getElementById("cardFooterQueue").innerText=t("Num songs",a.result.totalEntities)+" \u2013 "+beautifyDuration(a.result.totalTime):0<a.result.totalEntities?document.getElementById("cardFooterQueue").innerText=t("Num songs",a.result.totalEntities):document.getElementById("cardFooterQueue").innerText="";var b=a.result.returnedEntities,c=document.getElementById("QueueCurrentList"),
d=document.activeElement.parentNode.parentNode===c?!0:!1,f=0;c.setAttribute("data-version",a.result.queueVersion);c=c.getElementsByTagName("tbody")[0];for(var g=c.getElementsByTagName("tr"),h=0;h<b;h++){a.result.data[h].Duration=beautifySongDuration(a.result.data[h].Duration);a.result.data[h].Pos++;var l=document.createElement("tr");l.setAttribute("draggable","true");l.setAttribute("data-trackid",a.result.data[h].id);l.setAttribute("id","queueTrackId"+a.result.data[h].id);l.setAttribute("data-songpos",
a.result.data[h].Pos);l.setAttribute("data-duration",a.result.data[h].Duration);l.setAttribute("data-uri",a.result.data[h].uri);l.setAttribute("tabindex",0);for(var k="",m=0;m<settings.colsQueueCurrent.length;m++)k+='<td data-col="'+settings.colsQueueCurrent[m]+'">'+e(a.result.data[h][settings.colsQueueCurrent[m]])+"</td>";k+='<td data-col="Action"><a href="#" class="material-icons color-darkgrey">'+ligatureMore+"</a></td>";l.innerHTML=k;h<g.length?f=!0===replaceTblRow(g[h],l)?h:f:c.append(l)}for(h=
g.length-1;h>=b;h--)g[h].remove();g=settings.colsQueueCurrent.length;g--;"MPD_API_QUEUE_SEARCH"===a.result.method&&0===b?c.innerHTML='<tr><td><span class="material-icons">error_outline</span></td><td colspan="'+g+'">'+t("No results, please refine your search")+"</td></tr>":"MPD_API_QUEUE_ADD_TRACK"===a.result.method&&0===b&&(c.innerHTML='<tr><td><span class="material-icons">error_outline</span></td><td colspan="'+g+'">'+t("Empty queue")+"</td></tr>");!0===d&&focusTable(f);setPagination(a.result.totalEntities,
a.result.returnedEntities);document.getElementById("QueueCurrentList").classList.remove("opacity05")}
function parseLastPlayed(a){document.getElementById("cardFooterQueue").innerText=t("Num songs",a.result.totalEntities);var b=a.result.returnedEntities,c=document.getElementById("QueueLastPlayedList"),d=document.activeElement.parentNode.parentNode===c?!0:!1,f=0;c=c.getElementsByTagName("tbody")[0];for(var g=c.getElementsByTagName("tr"),h=0;h<b;h++){a.result.data[h].Duration=beautifySongDuration(a.result.data[h].Duration);a.result.data[h].LastPlayed=localeDate(a.result.data[h].LastPlayed);var l=document.createElement("tr");
l.setAttribute("data-uri",a.result.data[h].uri);l.setAttribute("data-name",a.result.data[h].Title);l.setAttribute("data-type","song");l.setAttribute("tabindex",0);for(var k="",m=0;m<settings.colsQueueLastPlayed.length;m++)k+='<td data-col="'+settings.colsQueueLastPlayed[m]+'">'+e(a.result.data[h][settings.colsQueueLastPlayed[m]])+"</td>";k+='<td data-col="Action">';""!==a.result.data[h].uri&&(k+='<a href="#" class="material-icons color-darkgrey">'+ligatureMore+"</a>");k+="</td>";l.innerHTML=k;h<g.length?
f=!0===replaceTblRow(g[h],l)?h:f:c.append(l)}for(h=g.length-1;h>=b;h--)g[h].remove();g=settings.colsQueueLastPlayed.length;g--;0===b&&(c.innerHTML='<tr><td><span class="material-icons">error_outline</span></td><td colspan="'+g+'">'+t("Empty list")+"</td></tr>");!0===d&&focusTable(f);setPagination(a.result.totalEntities,a.result.returnedEntities);document.getElementById("QueueLastPlayedList").classList.remove("opacity05")}
function queueSelectedItem(a){var b=document.activeElement;b&&"QueueCurrentList"!==b.parentNode.parentNode.id&&(!0===a?appendQueue(b.getAttribute("data-type"),b.getAttribute("data-uri"),b.getAttribute("data-name")):replaceQueue(b.getAttribute("data-type"),b.getAttribute("data-uri"),b.getAttribute("data-name")))}function dequeueSelectedItem(){var a=document.activeElement;a&&"QueueCurrentList"===a.parentNode.parentNode.id&&delQueueSong("single",a.getAttribute("data-trackid"))}
function appendQueue(a,b,c){switch(a){case "song":case "dir":sendAPI("MPD_API_QUEUE_ADD_TRACK",{uri:b});showNotification(t("%{name} added to queue",{name:c}),"","","success");break;case "plist":sendAPI("MPD_API_QUEUE_ADD_PLAYLIST",{plist:b}),showNotification(t("%{name} added to queue",{name:c}),"","","success")}}
function appendAfterQueue(a,b,c,d){switch(a){case "song":sendAPI("MPD_API_QUEUE_ADD_TRACK_AFTER",{uri:b,to:c}),c++,showNotification(t("%{name} added to queue position %{to}",{name:d,to:c}),"","","success")}}
function replaceQueue(a,b,c){switch(a){case "song":case "dir":sendAPI("MPD_API_QUEUE_REPLACE_TRACK",{uri:b});showNotification(t("Queue replaced with %{name}",{name:c}),"","","success");break;case "plist":sendAPI("MPD_API_QUEUE_REPLACE_PLAYLIST",{plist:b}),showNotification(t("Queue replaced with %{name}",{name:c}),"","","success")}}
function addToQueue(){var a=!0,b=document.getElementById("inputAddToQueueQuantity");validateInt(b)||(a=!1);!0===a&&(a=document.getElementById("selectAddToQueueMode"),b=document.getElementById("selectAddToQueuePlaylist"),sendAPI("MPD_API_QUEUE_ADD_RANDOM",{mode:a.options[a.selectedIndex].value,playlist:b.options[b.selectedIndex].value,quantity:document.getElementById("inputAddToQueueQuantity").value}),modalAddToQueue.hide())}
function saveQueue(){var a=document.getElementById("saveQueueName").value;!0===validatePlname(a)?(sendAPI("MPD_API_QUEUE_SAVE",{plist:a}),modalSaveQueue.hide()):document.getElementById("saveQueueName").classList.add("is-invalid")}function delQueueSong(a,b,c){"range"===a?sendAPI("MPD_API_QUEUE_RM_RANGE",{start:b,end:c}):"single"===a&&sendAPI("MPD_API_QUEUE_RM_TRACK",{track:b})}
function search(a){if(settings.featAdvsearch){for(var b="(",c=domCache.searchCrumb.children,d=0;d<c.length;d++)b+="("+decodeURI(c[d].getAttribute("data-filter"))+")",""!==a&&(b+=" AND ");""!==a?(c=document.getElementById("searchMatch"),b+="("+app.current.filter+" "+c.options[c.selectedIndex].value+" '"+a+"'))"):b+=")";2>=b.length&&(b="");appGoto("Search",void 0,void 0,"0/"+app.current.filter+"/"+app.current.sort+"/"+encodeURI(b))}else appGoto("Search",void 0,void 0,"0/"+app.current.filter+"/"+app.current.sort+
"/"+a)}
function parseSearch(a){document.getElementById("panel-heading-search").innerText=gtPage("Num songs",a.result.returnedEntities,a.result.totalEntities);document.getElementById("cardFooterSearch").innerText=gtPage("Num songs",a.result.returnedEntities,a.result.totalEntities);0<a.result.returnedEntities?(document.getElementById("searchAddAllSongs").removeAttribute("disabled"),document.getElementById("searchAddAllSongsBtn").removeAttribute("disabled")):(document.getElementById("searchAddAllSongs").setAttribute("disabled","disabled"),
document.getElementById("searchAddAllSongsBtn").setAttribute("disabled","disabled"));parseFilesystem(a)}function saveSearchAsSmartPlaylist(){parseSmartPlaylist({type:"smartpls",data:{playlist:"",type:"search",tag:app.current.filter,searchstr:app.current.search}})}
function addAllFromSearchPlist(a){settings.featAdvsearch?sendAPI("MPD_API_DATABASE_SEARCH_ADV",{plist:a,sort:"",sortdesc:!1,expression:app.current.search,offset:0,cols:settings.colsSearch}):sendAPI("MPD_API_DATABASE_SEARCH",{plist:a,filter:app.current.filter,searchstr:app.current.search,offset:0,cols:settings.colsSearch})}
function saveConnection(){var a=!0,b=document.getElementById("inputMpdHost"),c=document.getElementById("inputMpdPort"),d=document.getElementById("inputMpdPass"),f=document.getElementById("selectMusicDirectory");f=f.options[f.selectedIndex].value;"custom"===f&&(f=document.getElementById("inputMusicDirectory"),validatePath(f)||(a=!1),f=f.value);""===c.value&&(c.value="6600");0!==b.value.indexOf("/")&&(validateInt(c)||(a=!1),validateHost(b)||(a=!1));!0===a&&(sendAPI("MYMPD_API_CONNECTION_SAVE",{mpdHost:b.value,
mpdPort:c.value,mpdPass:d.value,musicDirectory:f},getSettings),modalConnection.hide())}function getSettings(a){!1===settingsLock&&(settingsLock=!0,sendAPI("MYMPD_API_SETTINGS_GET",{},getMpdSettings,a))}
function getMpdSettings(a){if(""!==a&&a.result)settingsNew=a.result,document.getElementById("splashScreenAlert").innerText=t("Fetch MPD settings"),sendAPI("MPD_API_SETTINGS_GET",{},joinSettings,!0);else return settingsParsed="error",!1===appInited&&showAppInitAlert(""===a?t("Can not parse settings"):t(a.error.message)),!1}
function joinSettings(a){if(""!==a&&a.result)for(var b in a.result)settingsNew[b]=a.result[b];else settingsParsed="error",!1===appInited&&showAppInitAlert(""===a?t("Can not parse settings"):t(a.error.message)),settingsNew.mpdConnected=!1;settings=Object.assign({},settingsNew);settingsLock=!1;parseSettings();toggleUI()}
function checkConsume(){var a=document.getElementById("btnConsume").classList.contains("active")?!0:!1;!0===("0"===document.getElementById("selectJukeboxMode").value?!1:!0)&&!1===a?document.getElementById("warnConsume").classList.remove("hide"):document.getElementById("warnConsume").classList.add("hide")}
function parseSettings(){locale="default"===settings.locale?navigator.language||navigator.userLanguage:settings.locale;!0===settings.mpdConnected&&parseMPDSettings();0!==settings.mpdHost.indexOf("/")?document.getElementById("mpdInfo_host").innerText=settings.mpdHost+":"+settings.mpdPort:document.getElementById("mpdInfo_host").innerText=settings.mpdHost;document.getElementById("inputMpdHost").value=settings.mpdHost;document.getElementById("inputMpdPort").value=settings.mpdPort;document.getElementById("inputMpdPass").value=
settings.mpdPass;var a=document.getElementById("btnNotifyWeb");notificationsSupported()?settings.notificationWeb?(toggleBtnChk("btnNotifyWeb",settings.notificationWeb),Notification.requestPermission(function(a){"permission"in Notification||(Notification.permission=a);"granted"===a?toggleBtnChk("btnNotifyWeb",!0):(toggleBtnChk("btnNotifyWeb",!1),settings.notificationWeb=!0)})):toggleBtnChk("btnNotifyWeb",!1):(a.setAttribute("disabled","disabled"),toggleBtnChk("btnNotifyWeb",!1));toggleBtnChk("btnNotifyPage",
settings.notificationPage);toggleBtnChk("btnBgCover",settings.bgCover);toggleBtnChk("btnFeatLocalplayer",settings.featLocalplayer);toggleBtnChk("btnLocalplayerAutoplay",settings.localplayerAutoplay);toggleBtnChk("btnBookmarks",settings.featBookmarks);""===settings.streamUrl?(document.getElementById("selectStreamMode").value="port",document.getElementById("inputStreamUrl").value=settings.streamPort):(document.getElementById("selectStreamMode").value="url",document.getElementById("inputStreamUrl").value=
settings.streamUrl);toggleBtnChk("btnCoverimage",settings.coverimage);document.getElementById("selectLocale").value=settings.locale;document.getElementById("inputCoverimageName").value=settings.coverimageName;document.getElementById("inputCoverimageSize").value=settings.coverimageSize;a=document.querySelectorAll(".albumcover");for(var b=0;b<a.length;b++)a[b].style.width=settings.coverimageSize,a[b].style.height=settings.coverimageSize;document.getElementById("inputBgColor").value=settings.bgColor;
document.getElementsByTagName("body")[0].style.backgroundColor=settings.bgColor;document.getElementById("inputBgCssFilter").value=settings.bgCssFilter;a=document.querySelectorAll(".albumartbg");for(b=0;b<a.length;b++)a[b].style.filter=settings.bgCssFilter;toggleBtnChk("btnLoveEnable",settings.love);document.getElementById("inputLoveChannel").value=settings.loveChannel;document.getElementById("inputLoveMessage").value=settings.loveMessage;document.getElementById("inputMaxElementsPerPage").value=settings.maxElementsPerPage;
toggleBtnChk("btnStickers",settings.stickers);document.getElementById("inputLastPlayedCount").value=settings.lastPlayedCount;toggleBtnChk("btnSmartpls",settings.smartpls);a=["featLocalplayer","featSyscmds","featMixramp","featCacert","featBookmarks"];for(b=0;b<a.length;b++)for(var c=document.getElementsByClassName(a[b]),d=c.length,f=!0===settings[a[b]]?"":"none",g=0;g<d;g++)c[g].style.display=f;a=document.getElementsByClassName("warnReadonly");for(b=0;b<a.length;b++)!1===settings.readonly?a[b].classList.add("hide"):
a[b].classList.remove("hide");1==settings.readonly?document.getElementById("btnBookmarks").setAttribute("disabled","disabled"):document.getElementById("btnBookmarks").removeAttribute("disabled");if(settings.featSyscmds){a="";b=settings.syscmdList.length;if(0<b)for(a=4<b?"":'<div class="dropdown-divider"></div>',c=0;c<b;c++)a="HR"===settings.syscmdList[c]?a+'<div class="dropdown-divider"></div>':a+('<a class="dropdown-item text-light bg-dark alwaysEnabled" href="#" data-href=\'{"cmd": "execSyscmd", "options": ["'+
e(settings.syscmdList[c])+"\"]}'>"+e(settings.syscmdList[c])+"</a>");document.getElementById("syscmds").innerHTML=a;4<b?(document.getElementById("navSyscmds").classList.remove("hide"),document.getElementById("syscmds").classList.add("collapse","menu-indent")):(document.getElementById("navSyscmds").classList.add("hide"),document.getElementById("syscmds").classList.remove("collapse","menu-indent"))}else document.getElementById("syscmds").innerHTML="";dropdownMainMenu=new Dropdown(document.getElementById("mainMenu"));
document.getElementById("selectJukeboxMode").value=settings.jukeboxMode;document.getElementById("inputJukeboxQueueLength").value=settings.jukeboxQueueLength;0===settings.jukeboxMode?(document.getElementById("inputJukeboxQueueLength").setAttribute("disabled","disabled"),document.getElementById("selectJukeboxPlaylist").setAttribute("disabled","disabled")):2===settings.jukeboxMode?(document.getElementById("inputJukeboxQueueLength").setAttribute("disabled","disabled"),document.getElementById("selectJukeboxPlaylist").setAttribute("disabled",
"disabled"),document.getElementById("selectJukeboxPlaylist").value="Database"):1===settings.jukeboxMode&&(document.getElementById("inputJukeboxQueueLength").removeAttribute("disabled"),document.getElementById("selectJukeboxPlaylist").removeAttribute("disabled"));!0===settings.featLocalplayer&&(""===settings.streamUrl?(settings.mpdstream="http://",null!==settings.mpdHost.match(/^127\./)||"localhost"===settings.mpdHost||null!==settings.mpdHost.match(/^\//)?settings.mpdstream+=window.location.hostname:
settings.mpdstream+=settings.mpdHost,settings.mpdstream+=":"+settings.streamPort+"/"):settings.mpdstream=settings.streamUrl,a=document.getElementById("localPlayer"),a.src!==settings.mpdstream&&(a.pause(),document.getElementById("alertLocalPlayback").classList.remove("hide"),a.src=settings.mpdstream,a.load()));"auto"===settings.musicDirectory?(document.getElementById("selectMusicDirectory").value=settings.musicDirectory,document.getElementById("inputMusicDirectory").value=settings.musicDirectoryValue,
document.getElementById("inputMusicDirectory").setAttribute("readonly","readonly")):"none"===settings.musicDirectory?(document.getElementById("selectMusicDirectory").value=settings.musicDirectory,document.getElementById("inputMusicDirectory").value="",document.getElementById("inputMusicDirectory").setAttribute("readonly","readonly")):(document.getElementById("selectMusicDirectory").value="custom",document.getElementById("inputMusicDirectory").value=settings.musicDirectoryValue,document.getElementById("inputMusicDirectory").removeAttribute("readonly"));
"Queue"===app.current.app&&"Current"===app.current.tab?getQueue():"Queue"===app.current.app&&"LastPlayed"===app.current.tab?appRoute():"Search"===app.current.app?appRoute():"Browse"===app.current.app&&"Filesystem"===app.current.tab?appRoute():"Browse"===app.current.app&&"Playlists"===app.current.tab&&"Detail"===app.current.view?appRoute():"Browse"===app.current.app&&"Database"===app.current.tab&&""!==app.current.search&&appRoute();i18nHtml(document.getElementsByTagName("body")[0]);checkConsume();
settingsParsed="true"}
function parseMPDSettings(){toggleBtnChk("btnRandom",settings.random);toggleBtnChk("btnConsume",settings.consume);toggleBtnChk("btnSingle",settings.single);toggleBtnChk("btnRepeat",settings.repeat);toggleBtnChk("btnAutoPlay",settings.autoPlay);void 0!==settings.crossfade?(document.getElementById("inputCrossfade").removeAttribute("disabled"),document.getElementById("inputCrossfade").value=settings.crossfade):document.getElementById("inputCrossfade").setAttribute("disabled","disabled");void 0!==settings.mixrampdb?
(document.getElementById("inputMixrampdb").removeAttribute("disabled"),document.getElementById("inputMixrampdb").value=settings.mixrampdb):document.getElementById("inputMixrampdb").setAttribute("disabled","disabled");void 0!==settings.mixrampdelay?(document.getElementById("inputMixrampdelay").removeAttribute("disabled"),document.getElementById("inputMixrampdelay").value=settings.mixrampdelay):document.getElementById("inputMixrampdelay").setAttribute("disabled","disabled");document.getElementById("selectReplaygain").value=
settings.replaygain;for(var a="featStickers featSmartpls featPlaylists featTags featCoverimage featAdvsearch featLove".split(" "),b=0;b<a.length;b++){var c=document.getElementsByClassName(a[b]),d=c.length,f=!0===settings[a[b]]?"":"none";"featCoverimage"===a[b]&&!1===settings.coverimage&&(f="none");for(var g=0;g<d;g++)c[g].style.display=f}!1===settings.featPlaylists&&!0===settings.smartpls?document.getElementById("warnSmartpls").classList.remove("hide"):document.getElementById("warnSmartpls").classList.add("hide");
!0===settings.featPlaylists&&!1===settings.readonly?document.getElementById("btnSmartpls").removeAttribute("disabled"):document.getElementById("btnSmartpls").setAttribute("disabled","disabled");!1===settings.featStickers&&!0===settings.stickers?document.getElementById("warnStickers").classList.remove("hide"):document.getElementById("warnStickers").classList.add("hide");!1===settings.featLove&&!0===settings.love?document.getElementById("warnScrobbler").classList.remove("hide"):document.getElementById("warnScrobbler").classList.add("hide");
!1===settings.featLibrary&&!0===settings.coverimage?document.getElementById("warnAlbumart").classList.remove("hide"):document.getElementById("warnAlbumart").classList.add("hide");""===settings.musicDirectoryValue&&"none"!==settings.musicDirectory?document.getElementById("warnMusicDirectory").classList.remove("hide"):document.getElementById("warnMusicDirectory").classList.add("hide");!0===settings.bgCover&&!0===settings.featCoverimage&&!0===settings.coverimage?lastSongObj.cover&&-1<lastSongObj.cover.indexOf("coverimage-")?
clearBackgroundImage():lastSongObj.cover?setBackgroundImage(lastSongObj.cover):clearBackgroundImage():clearBackgroundImage();if(!1===settings.featTags)app.apps.Browse.active="Filesystem",app.apps.Search.state="0/filename/-/",app.apps.Queue.state="0/filename/-/",settings.colsQueueCurrent=["Pos","Title","Duration"],settings.colsQueueLastPlayed=["Pos","Title","LastPlayed"],settings.colsSearch=["Title","Duration"],settings.colsBrowseFilesystem=["Type","Title","Duration"],settings.colsBrowseDatabase=["Track",
"Title","Duration"],settings.colsPlayback=[];else{a="";for(b=0;b<settings.colsPlayback.length;b++)a+='<div id="current'+settings.colsPlayback[b]+'" data-tag="'+settings.colsPlayback[b]+'" data-name="'+(lastSongObj[settings.colsPlayback[b]]?encodeURI(lastSongObj[settings.colsPlayback[b]]):"")+'"><small>'+t(settings.colsPlayback[b])+"</small><p",settings.browsetags.includes(settings.colsPlayback[b])&&(a+=' class="clickable"'),a+=">",a="Duration"===settings.colsPlayback[b]?a+(lastSongObj[settings.colsPlayback[b]]?
beautifySongDuration(lastSongObj[settings.colsPlayback[b]]):""):"Fileformat"===settings.colsPlayback[b]?a+(lastState?fileformat(lastState.audioFormat):""):a+(lastSongObj[settings.colsPlayback[b]]?e(lastSongObj[settings.colsPlayback[b]]):""),a+="</p></div>";document.getElementById("cardPlaybackTags").innerHTML=a}!settings.tags.includes("AlbumArtist")&&settings.featTags&&(settings.tags.includes("Artist")?app.apps.Browse.tabs.Database.active="Artist":app.apps.Browse.tabs.Database.active=settings.tags[0]);
settings.tags.includes("Title")&&(app.apps.Search.state="0/any/Title/");settings.featPlaylists?(playlistEl="selectJukeboxPlaylist",sendAPI("MPD_API_PLAYLIST_LIST",{offset:0,filter:"-"},getAllPlaylists)):document.getElementById("selectJukeboxPlaylist").innerHTML='<option value="Database">'+t("Database")+"</option>";settings.tags.sort();settings.searchtags.sort();settings.browsetags.sort();filterCols("colsSearch");filterCols("colsQueueCurrent");filterCols("colsQueueLastPlayed");filterCols("colsBrowsePlaylistsDetail");
filterCols("colsBrowseFilesystem");filterCols("colsBrowseDatabase");filterCols("colsPlayback");setCols("QueueCurrent");setCols("Search");setCols("QueueLastPlayed");setCols("BrowseFilesystem");setCols("BrowsePlaylistsDetail");setCols("BrowseDatabase",".tblAlbumTitles");setCols("Playback");addTagList("BrowseDatabaseByTagDropdown","browsetags");addTagList("searchqueuetags","searchtags");addTagList("searchtags","searchtags");for(a=0;a<settings.tags.length;a++)app.apps.Browse.tabs.Database.views[settings.tags[a]]=
{state:"0/-/-/",scrollPos:0};initTagMultiSelect("inputEnabledTags","listEnabledTags",settings.allmpdtags,settings.tags);initTagMultiSelect("inputSearchTags","listSearchTags",settings.tags,settings.searchtags);initTagMultiSelect("inputBrowseTags","listBrowseTags",settings.tags,settings.browsetags)}function resetSettings(){sendAPI("MYMPD_API_SETTINGS_RESET",{},getSettings)}
function saveSettings(){var a=!0,b=document.getElementById("inputCrossfade");b.getAttribute("disabled")||validateInt(b)||(a=!1);b=document.getElementById("inputJukeboxQueueLength");validateInt(b)||(a=!1);var c=document.getElementById("selectStreamMode"),d=b="",f=document.getElementById("inputStreamUrl");"port"===c.options[c.selectedIndex].value?(d=f.value,validateInt(f)||(a=!1)):(b=f.value,validateStream(f)||(a=!1));c=document.getElementById("inputCoverimageSize");validateInt(c)||(a=!1);c=document.getElementById("inputCoverimageName");
validateFilename(c)||(a=!1);c=document.getElementById("inputMaxElementsPerPage");validateInt(c)||(a=!1);200<parseInt(c.value)&&(a=!1);c=document.getElementById("inputLastPlayedCount");validateInt(c)||(a=!1);document.getElementById("btnLoveEnable").classList.contains("active")&&(c=document.getElementById("inputLoveChannel"),f=document.getElementById("inputLoveMessage"),validateNotBlank(c)&&validateNotBlank(f)||(a=!1));!0===settings.featMixramp&&(c=document.getElementById("inputMixrampdb"),c.getAttribute("disabled")||
validateFloat(c)||(a=!1),c=document.getElementById("inputMixrampdelay"),c.getAttribute("disabled")||("nan"===c.value&&(c.value="-1"),validateFloat(c)||(a=!1)));if(!0===a){a=document.getElementById("selectReplaygain");c=document.getElementById("selectJukeboxPlaylist");f=document.getElementById("selectJukeboxMode");var g=document.getElementById("selectLocale");sendAPI("MYMPD_API_SETTINGS_SET",{consume:document.getElementById("btnConsume").classList.contains("active")?1:0,random:document.getElementById("btnRandom").classList.contains("active")?
1:0,single:document.getElementById("btnSingle").classList.contains("active")?1:0,repeat:document.getElementById("btnRepeat").classList.contains("active")?1:0,replaygain:a.options[a.selectedIndex].value,crossfade:document.getElementById("inputCrossfade").value,mixrampdb:!0===settings.featMixramp?document.getElementById("inputMixrampdb").value:settings.mixrampdb,mixrampdelay:!0===settings.featMixramp?document.getElementById("inputMixrampdelay").value:settings.mixrampdelay,notificationWeb:document.getElementById("btnNotifyWeb").classList.contains("active")?
!0:!1,notificationPage:document.getElementById("btnNotifyPage").classList.contains("active")?!0:!1,jukeboxMode:parseInt(f.options[f.selectedIndex].value),jukeboxPlaylist:c.options[c.selectedIndex].value,jukeboxQueueLength:parseInt(document.getElementById("inputJukeboxQueueLength").value),autoPlay:document.getElementById("btnAutoPlay").classList.contains("active")?!0:!1,bgCover:document.getElementById("btnBgCover").classList.contains("active")?!0:!1,bgColor:document.getElementById("inputBgColor").value,
bgCssFilter:document.getElementById("inputBgCssFilter").value,featLocalplayer:document.getElementById("btnFeatLocalplayer").classList.contains("active")?!0:!1,localplayerAutoplay:document.getElementById("btnLocalplayerAutoplay").classList.contains("active")?!0:!1,streamUrl:b,streamPort:parseInt(d),coverimage:document.getElementById("btnCoverimage").classList.contains("active")?!0:!1,coverimageName:document.getElementById("inputCoverimageName").value,coverimageSize:document.getElementById("inputCoverimageSize").value,
locale:g.options[g.selectedIndex].value,love:document.getElementById("btnLoveEnable").classList.contains("active")?!0:!1,loveChannel:document.getElementById("inputLoveChannel").value,loveMessage:document.getElementById("inputLoveMessage").value,bookmarks:document.getElementById("btnBookmarks").classList.contains("active")?!0:!1,maxElementsPerPage:document.getElementById("inputMaxElementsPerPage").value,stickers:document.getElementById("btnStickers").classList.contains("active")?!0:!1,lastPlayedCount:document.getElementById("inputLastPlayedCount").value,
smartpls:document.getElementById("btnSmartpls").classList.contains("active")?!0:!1,taglist:getTagMultiSelectValues("listEnabledTags"),searchtaglist:getTagMultiSelectValues("listSearchTags"),browsetaglist:getTagMultiSelectValues("listBrowseTags")},getSettings);modalSettings.hide()}}function getTagMultiSelectValues(a){var b=[];a=document.getElementById(a).getElementsByTagName("input");for(var c=0;c<a.length;c++)!0===a[c].checked&&b.push(a[c].name);return b.join(",")}
function initTagMultiSelect(a,b,c,d){for(var f=[],g="",h=0;h<c.length;h++)d.includes(c[h])&&f.push(t(c[h])),g+='<div class="form-check"><input class="form-check-input" type="checkbox" value="1" name="'+c[h]+'" '+(d.includes(c[h])?'checked="checked"':"")+'><label class="form-check-label" for="'+c[h]+'">&nbsp;&nbsp;'+t(c[h])+"</label></div>";document.getElementById(a).value=f.join(", ");document.getElementById(b).innerHTML=g;document.getElementById(b).addEventListener("click",function(a){a.stopPropagation();
if("INPUT"===a.target.nodeName){for(var b=a.target.parentNode.parentNode.getElementsByTagName("input"),c=[],d=0;d<b.length;d++)!0===b[d].checked&&c.push(t(b[d].name));a.target.parentNode.parentNode.parentNode.previousElementSibling.value=c.join(", ")}})}
function filterCols(a){var b=settings.tags.slice();!1===settings.featTags&&b.push("Title");b.push("Duration");"colsQueueCurrent"===a||"colsBrowsePlaylistsDetail"===a||"colsQueueLastPlayed"===a?b.push("Pos"):"colsBrowseFilesystem"===a&&b.push("Type");"colsQueueLastPlayed"===a&&b.push("LastPlayed");"colsPlayback"===a&&(b.push("Filetype"),b.push("Fileformat"));for(var c=[],d=0;d<settings[a].length;d++)b.includes(settings[a][d])&&c.push(settings[a][d]);settings[a]=c}
function songDetails(a){sendAPI("MPD_API_DATABASE_SONGDETAILS",{uri:a},parseSongDetails);modalSongDetails.show()}function parseFingerprint(a){var b=document.createElement("textarea");b.value=a.result.fingerprint;b.classList.add("form-control","text-monospace","small");a=document.getElementById("fingerprint");a.innerHTML="";a.appendChild(b)}
function parseSongDetails(a){var b=document.getElementById("modalSongDetails");b.getElementsByClassName("album-cover")[0].style.backgroundImage='url("'+subdir+a.result.cover+'"), url("'+subdir+'/assets/coverimage-loading.png")';b.getElementsByTagName("h1")[0].innerText=a.result.Title;for(var c="",d=0;d<settings.tags.length;d++)"Title"!==settings.tags[d]&&(c+="<tr><th>"+t(settings.tags[d])+'</th><td data-tag="'+settings.tags[d]+'" data-name="'+encodeURI(a.result[settings.tags[d]])+'">',c=settings.browsetags.includes(settings.tags[d])?
c+('<a class="text-success" href="#">'+e(a.result[settings.tags[d]])+"</a>"):c+a.result[settings.tags[d]],c+="</td></tr>");c+="<tr><th>"+t("Duration")+"</th><td>"+beautifyDuration(a.result.Duration)+"</td></tr>";c=settings.featLibrary?c+("<tr><th>"+t("Filename")+'</th><td><a class="breakAll text-success" href="/library/'+encodeURI(a.result.uri)+'" download title="'+e(a.result.uri)+'">'+e(basename(a.result.uri))+"</a></td></tr>"):c+("<tr><th>"+t("Filename")+'</th><td class="breakAll"><span title="'+
e(a.result.uri)+'">'+e(basename(a.result.uri))+"</span></td></tr>");c+="<tr><th>"+t("Filetype")+"</th><td>"+filetype(a.result.uri)+"</td></tr>";!0===settings.featFingerprint&&(c+="<tr><th>"+t("Fingerprint")+'</th><td class="breakAll" id="fingerprint"><a class="text-success" data-uri="'+encodeURI(a.result.uri)+'" id="calcFingerprint" href="#">'+t("Calculate")+"</a></td></tr>");!0===settings.featStickers&&(c+='<tr><th colspan="2" class="pt-3"><h5>'+t("Statistics")+"</h5></th></tr><tr><th>"+t("Play count")+
"</th><td>"+a.result.playCount+"</td></tr><tr><th>"+t("Skip count")+"</th><td>"+a.result.skipCount+"</td></tr><tr><th>"+t("Last played")+"</th><td>"+(0===a.result.lastPlayed?t("never"):localeDate(a.result.lastPlayed))+"</td></tr><tr><th>"+t("Last skipped")+"</th><td>"+(0===a.result.lastSkipped?t("never"):localeDate(a.result.lastSkipped))+"</td></tr><tr><th>"+t("Like")+'</th><td><div class="btn-group btn-group-sm"><button title="'+t("Dislike song")+'" id="btnVoteDown2" data-href=\'{"cmd": "voteSong", "options": [0]}\' class="btn btn-sm btn-light material-icons">thumb_down</button><button title="'+
t("Like song")+'" id="btnVoteUp2" data-href=\'{"cmd": "voteSong", "options": [2]}\' class="btn btn-sm btn-light material-icons">thumb_up</button></div></td></tr>');b.getElementsByTagName("tbody")[0].innerHTML=c;setVoteSongBtns(a.result.like,a.result.uri)}function loveSong(){sendAPI("MPD_API_LOVE",{})}
function voteSong(a){var b=decodeURI(domCache.currentTitle.getAttribute("data-uri"));""!==b&&(2===a&&domCache.btnVoteUp.classList.contains("active-fg-green")?a=1:0===a&&domCache.btnVoteDown.classList.contains("active-fg-red")&&(a=1),sendAPI("MPD_API_LIKE",{uri:b,like:a}),setVoteSongBtns(a,b))}
function setVoteSongBtns(a,b){domCache.btnVoteUp2=document.getElementById("btnVoteUp2");domCache.btnVoteDown2=document.getElementById("btnVoteDown2");""===b||-1<b.indexOf("://")?(domCache.btnVoteUp.setAttribute("disabled","disabled"),domCache.btnVoteDown.setAttribute("disabled","disabled"),domCache.btnVoteUp2&&(domCache.btnVoteUp2.setAttribute("disabled","disabled"),domCache.btnVoteDown2.setAttribute("disabled","disabled"))):(domCache.btnVoteUp.removeAttribute("disabled"),domCache.btnVoteDown.removeAttribute("disabled"),
domCache.btnVoteUp2&&(domCache.btnVoteUp2.removeAttribute("disabled"),domCache.btnVoteDown2.removeAttribute("disabled")));0===a?(domCache.btnVoteUp.classList.remove("active-fg-green"),domCache.btnVoteDown.classList.add("active-fg-red"),domCache.btnVoteUp2&&(domCache.btnVoteUp2.classList.remove("active-fg-green"),domCache.btnVoteDown2.classList.add("active-fg-red"))):1===a?(domCache.btnVoteUp.classList.remove("active-fg-green"),domCache.btnVoteDown.classList.remove("active-fg-red"),domCache.btnVoteUp2&&
(domCache.btnVoteUp2.classList.remove("active-fg-green"),domCache.btnVoteDown2.classList.remove("active-fg-red"))):2===a&&(domCache.btnVoteUp.classList.add("active-fg-green"),domCache.btnVoteDown.classList.remove("active-fg-red"),domCache.btnVoteUp2&&(domCache.btnVoteUp2.classList.add("active-fg-green"),domCache.btnVoteDown2.classList.remove("active-fg-red")))}
function parseStats(a){document.getElementById("mpdstats_artists").innerText=a.result.artists;document.getElementById("mpdstats_albums").innerText=a.result.albums;document.getElementById("mpdstats_songs").innerText=a.result.songs;document.getElementById("mpdstats_dbPlaytime").innerText=beautifyDuration(a.result.dbPlaytime);document.getElementById("mpdstats_playtime").innerText=beautifyDuration(a.result.playtime);document.getElementById("mpdstats_uptime").innerText=beautifyDuration(a.result.uptime);
document.getElementById("mpdstats_mympd_uptime").innerText=beautifyDuration(a.result.myMPDuptime);document.getElementById("mpdstats_dbUpdated").innerText=localeDate(a.result.dbUpdated);document.getElementById("mympdVersion").innerText=a.result.mympdVersion;document.getElementById("mpdInfo_version").innerText=a.result.mpdVersion;document.getElementById("mpdInfo_libmpdclientVersion").innerText=a.result.libmpdclientVersion}
function parseOutputs(a){for(var b="",c=0;c<a.result.numOutputs;c++)b+='<button id="btnOutput'+a.result.data[c].id+'" data-output-id="'+a.result.data[c].id+'" class="btn btn-secondary btn-block',1===a.result.data[c].state&&(b+=" active"),b+='"><span class="material-icons float-left">volume_up</span> '+e(a.result.data[c].name)+"</button>";domCache.outputs.innerHTML=b}
function setCounter(a,b,c){currentSong.totalTime=b;currentSong.elapsedTime=c;currentSong.currentSongId=a;domCache.progressBar.value=Math.floor(1E3*c/b);b=beautifySongDuration(c)+"&nbsp;/&nbsp;"+beautifySongDuration(b);domCache.counter.innerHTML=b;if(lastState&&lastState.currentSongId!==a&&(c=document.getElementById("queueTrackId"+lastState.currentSongId))){var d=c.querySelector("[data-col=Duration]");d&&(d.innerText=c.getAttribute("data-duration"));if(d=c.querySelector("[data-col=Pos]"))d.classList.remove("material-icons"),
d.innerText=c.getAttribute("data-songpos");c.classList.remove("font-weight-bold")}if(a=document.getElementById("queueTrackId"+a)){if(c=a.querySelector("[data-col=Duration]"))c.innerHTML=b;(b=a.querySelector("[data-col=Pos]"))&&!b.classList.contains("material-icons")&&(b.classList.add("material-icons"),b.innerText="play_arrow");a.classList.add("font-weight-bold")}progressTimer&&clearTimeout(progressTimer);"play"===playstate&&(progressTimer=setTimeout(function(){currentSong.elapsedTime++;requestAnimationFrame(function(){setCounter(currentSong.currentSongId,
currentSong.totalTime,currentSong.elapsedTime)})},1E3))}
function parseState(a){if(JSON.stringify(a.result)===JSON.stringify(lastState))toggleUI();else{parseUpdateQueue(a);parseVolume(a);setCounter(a.result.currentSongId,a.result.totalTime,a.result.elapsedTime);lastState&&lastState.currentSongId===a.result.currentSongId&&lastState.queueVersion===a.result.queueVersion||sendAPI("MPD_API_PLAYER_CURRENT_SONG",{},songChange);if("-1"===a.result.songPos){domCache.currentTitle.innerText="Not playing";document.title="myMPD";document.getElementById("headerTitle").innerText=
"";document.getElementById("headerTitle").removeAttribute("title");clearCurrentCover();!0===settings.bgCover&&clearBackgroundImage();for(var b=document.getElementById("cardPlaybackTags").getElementsByTagName("p"),c=0;c<b.length;c++)b[c].innerText=""}else if(b=document.getElementById("currentFileformat"))b.getElementsByTagName("p")[0].innerText=fileformat(a.result.audioFormat);lastState=a.result;!1!==settings.mpdConnected&&!1!==uiEnabled||getSettings(!0)}}
function parseVolume(a){-1===a.result.volume?(domCache.volumePrct.innerText=t("Volumecontrol disabled"),domCache.volumeControl.classList.add("hide")):(domCache.volumeControl.classList.remove("hide"),domCache.volumePrct.innerText=a.result.volume+" %",domCache.volumeMenu.innerText=0===a.result.volume?"volume_off":50>a.result.volume?"volume_down":"volume_up");domCache.volumeBar.value=a.result.volume}
function setBackgroundImage(a){for(var b=document.querySelectorAll(".albumartbg"),c=0;c<b.length;c++)"-10"===b[c].style.zIndex?b[c].remove():b[c].style.zIndex="-10";b=document.createElement("div");b.classList.add("albumartbg");b.style.filter=settings.bgCssFilter;b.style.backgroundImage='url("'+subdir+a+'")';b.style.opacity=0;c=document.getElementsByTagName("body")[0];c.insertBefore(b,c.firstChild);b=new Image;b.onload=function(){document.querySelector(".albumartbg").style.opacity=1};b.src=a}
function clearBackgroundImage(){for(var a=document.querySelectorAll(".albumartbg"),b=0;b<a.length;b++)"-10"===a[b].style.zIndex?a[b].remove():(a[b].style.zIndex="-10",a[b].style.opacity="0")}
function setCurrentCover(a){for(var b=domCache.currentCover.querySelectorAll(".coverbg"),c=0;c<b.length;c++)"2"===b[c].style.zIndex?b[c].remove():b[c].style.zIndex="2";b=document.createElement("div");b.classList.add("coverbg");b.style.backgroundImage='url("'+subdir+a+'")';b.style.opacity=0;domCache.currentCover.insertBefore(b,domCache.currentCover.firstChild);b=new Image;b.onload=function(){domCache.currentCover.querySelector(".coverbg").style.opacity=1};b.src=a}
function clearCurrentCover(){for(var a=domCache.currentCover.querySelectorAll(".coverbg"),b=0;b<a.length;b++)"2"===a[b].style.zIndex?a[b].remove():(a[b].style.zIndex="2",a[b].style.opacity="0")}
function songChange(a){var b=a.result.Title+":"+a.result.Artist+":"+a.result.Album+":"+a.result.uri+":"+a.result.currentSongId;if(lastSong!==b){var c="",d="",f="";void 0!==a.result.cover?setCurrentCover(a.result.cover):setCurrentCover("/assets/coverimage-notavailable.svg");!0===settings.bgCover&&!0===settings.featCoverimage&&(void 0===a.result.cover||-1<a.result.cover.indexOf("coverimage-")?clearBackgroundImage():setBackgroundImage(a.result.cover));void 0!==a.result.Artist&&0<a.result.Artist.length&&
"-"!==a.result.Artist&&(c+=a.result.Artist,d+=a.result.Artist,f+=a.result.Artist+" - ");void 0!==a.result.Album&&0<a.result.Album.length&&"-"!==a.result.Album&&(c+=" - "+a.result.Album,d+="<br/>"+a.result.Album);void 0!==a.result.Title&&0<a.result.Title.length?(f+=a.result.Title,domCache.currentTitle.innerText=a.result.Title,domCache.currentTitle.setAttribute("data-uri",encodeURI(a.result.uri))):(domCache.currentTitle.innerText="",domCache.currentTitle.setAttribute("data-uri",""));document.title=
"myMPD: "+f;document.getElementById("headerTitle").innerText=f;document.getElementById("headerTitle").title=f;void 0!==a.result.uri&&!0===settings.featStickers&&setVoteSongBtns(a.result.like,a.result.uri);a.result.Filetype=filetype(a.result.uri);a.result.Fileformat=lastState?fileformat(lastState.audioFormat):"";for(f=0;f<settings.colsPlayback.length;f++){var g=document.getElementById("current"+settings.colsPlayback[f]);if(g){var h=a.result[settings.colsPlayback[f]];void 0===h&&(h="");"Duration"==
settings.colsPlayback[f]&&(h=beautifySongDuration(h));g.getElementsByTagName("p")[0].innerText=h;g.setAttribute("data-name",encodeURI(h))}}if(f=document.getElementById("queueTrackId"+a.result.currentSongId))f.getElementsByTagName("td")[1].innerText=a.result.Title;"play"===playstate&&showNotification(a.result.Title,c,d,"success");lastSong=b;lastSongObj=a.result}}function gotoTagList(){appGoto(app.current.app,app.current.tab,app.current.view,"0/-/-/")}
function chVolume(a){a=parseInt(domCache.volumeBar.value)+a;0>a?a=0:100<a&&(a=100);domCache.volumeBar.value=a;sendAPI("MPD_API_PLAYER_VOLUME_SET",{volume:a})}function clickTitle(){var a=decodeURI(domCache.currentTitle.getAttribute("data-uri"));""!==a&&songDetails(a)}
function focusTable(a,b){void 0===b&&(b=document.getElementById(app.current.app+(void 0!==app.current.tab?app.current.tab:"")+(void 0!==app.current.view?app.current.view:"")+"List"),void 0===b&&(b=document.getElementById(app.current.app+app.current.tab+"TagList")),"Browse"!==app.current.app||"Database"!==app.current.tab||document.getElementById("BrowseDatabaseAlbumList").classList.contains("hide")||(b=document.getElementById("BrowseDatabaseAlbumList").getElementsByTagName("table")[0]));if(void 0!==
b){var c=b.getElementsByClassName("selected");if(void 0===a)0===c.length?(a=b.getElementsByTagName("tbody")[0].rows[0],a.focus(),a.classList.add("selected")):c[0].focus();else{c&&0<c.length&&c[0].classList.remove("selected");c=b.getElementsByTagName("tbody")[0].rows;var d=c.length;d<a&&(a=0);d>a&&(c[a].focus(),c[a].classList.add("selected"))}"BrowseFilesystemList"===b.id&&(a=b.getElementsByTagName("tbody")[0],"parentDir"!==a.rows[0].getAttribute("data-type")&&""!==app.current.search&&(b=b.getElementsByTagName("thead")[0].rows[0].cells.length,
c=app.current.search.replace(/\/?([^/]+)$/,""),a=a.insertRow(0),a.setAttribute("data-type","parentDir"),a.setAttribute("tabindex",0),a.setAttribute("data-uri",encodeURI(c)),a.innerHTML='<td colspan="'+b+'">..</td>'));scrollFocusIntoView()}}function scrollFocusIntoView(){var a=document.activeElement,b=a.getBoundingClientRect().top;a=a.offsetHeight;74>b?window.scrollBy(0,-74):b+a>window.innerHeight-74&&window.scrollBy(0,74)}
function navigateTable(a,b){if(a=document.activeElement){var c=null,d=!1;"ArrowDown"===b?(c=a.nextElementSibling,d=!0):"ArrowUp"===b?(c=a.previousElementSibling,d=!0):" "===b?(b=a.lastChild.firstChild,"A"===b.nodeName&&b.click(),d=!0):"Enter"===b?(a.firstChild.click(),d=!0):"Escape"===b?(a.blur(),a.classList.remove("selected"),d=!0):"Browse"!==app.current.app||"Database"!==app.current.tab||document.getElementById("BrowseDatabaseAlbumList").classList.contains("hide")||"n"!==b&&"p"!==b||(b=document.getElementById("BrowseDatabaseAlbumList").getElementsByTagName("table"),
b=Array.prototype.slice.call(b),d="TR"===document.activeElement.nodeName?b.indexOf(document.activeElement.parentNode.parentNode):b.indexOf(document.activeElement),d="p"===event.key?1<d?d-1:0:"n"===event.key?d<b.length-1?"TR"===document.activeElement.nodeName?d+1:d:d:d,0<b[d].getElementsByTagName("tbody")[0].rows.length?c=b[d].getElementsByTagName("tbody")[0].rows[0]:(b[d].focus(),scrollFocusIntoView()),d=!0);!0===d&&(event.preventDefault(),event.stopPropagation());c&&(a.classList.remove("selected"),
c.classList.add("selected"),c.focus(),scrollFocusIntoView())}}
function dragAndDropTable(a){var b=document.getElementById(a).getElementsByTagName("tbody")[0];b.addEventListener("dragstart",function(a){"TR"===a.target.nodeName&&(a.target.classList.add("opacity05"),a.dataTransfer.setDragImage(a.target,0,0),a.dataTransfer.effectAllowed="move",a.dataTransfer.setData("Text",a.target.getAttribute("id")),dragEl=a.target.cloneNode(!0))},!1);b.addEventListener("dragleave",function(a){a.preventDefault();if("TR"===dragEl.nodeName){var b=a.target;"TD"===a.target.nodeName&&
(b=a.target.parentNode);"TR"===b.nodeName&&b.classList.remove("dragover")}},!1);b.addEventListener("dragover",function(a){a.preventDefault();if("TR"===dragEl.nodeName){for(var c=b.getElementsByClassName("dragover"),f=c.length,g=0;g<f;g++)c[g].classList.remove("dragover");c=a.target;"TD"===a.target.nodeName&&(c=a.target.parentNode);"TR"===c.nodeName&&c.classList.add("dragover");a.dataTransfer.dropEffect="move"}},!1);b.addEventListener("dragend",function(a){a.preventDefault();if("TR"===dragEl.nodeName){for(var c=
b.getElementsByClassName("dragover"),f=c.length,g=0;g<f;g++)c[g].classList.remove("dragover");document.getElementById(a.dataTransfer.getData("Text"))&&document.getElementById(a.dataTransfer.getData("Text")).classList.remove("opacity05")}},!1);b.addEventListener("drop",function(c){c.stopPropagation();c.preventDefault();if("TR"===dragEl.nodeName){var d=c.target;"TD"===c.target.nodeName&&(d=c.target.parentNode);var f=document.getElementById(c.dataTransfer.getData("Text")).getAttribute("data-songpos"),
g=d.getAttribute("data-songpos");document.getElementById(c.dataTransfer.getData("Text")).remove();dragEl.classList.remove("opacity05");b.insertBefore(dragEl,d);c=b.getElementsByClassName("dragover");d=c.length;for(var h=0;h<d;h++)c[h].classList.remove("dragover");document.getElementById(a).classList.add("opacity05");"Queue"===app.current.app&&"Current"===app.current.tab?sendAPI("MPD_API_QUEUE_MOVE_TRACK",{from:f,to:g}):"Browse"===app.current.app&&"Playlists"===app.current.tab&&"Detail"===app.current.view&&
playlistMoveTrack(f,g)}},!1)}
function dragAndDropTableHeader(a){if(document.getElementById(a+"List"))var b=document.getElementById(a+"List").getElementsByTagName("tr")[0];else b=a.getElementsByTagName("tr")[0],a="BrowseDatabase";b.addEventListener("dragstart",function(a){"TH"===a.target.nodeName&&(a.target.classList.add("opacity05"),a.dataTransfer.setDragImage(a.target,0,0),a.dataTransfer.effectAllowed="move",a.dataTransfer.setData("Text",a.target.getAttribute("data-col")),dragEl=a.target.cloneNode(!0))},!1);b.addEventListener("dragleave",
function(a){a.preventDefault();"TH"===dragEl.nodeName&&"TH"===a.target.nodeName&&a.target.classList.remove("dragover-th")},!1);b.addEventListener("dragover",function(a){a.preventDefault();if("TH"===dragEl.nodeName){for(var c=b.getElementsByClassName("dragover-th"),f=c.length,g=0;g<f;g++)c[g].classList.remove("dragover-th");"TH"===a.target.nodeName&&a.target.classList.add("dragover-th");a.dataTransfer.dropEffect="move"}},!1);b.addEventListener("dragend",function(a){a.preventDefault();if("TH"===dragEl.nodeName){for(var c=
b.getElementsByClassName("dragover-th"),f=c.length,g=0;g<f;g++)c[g].classList.remove("dragover-th");this.querySelector("[data-col="+a.dataTransfer.getData("Text")+"]")&&this.querySelector("[data-col="+a.dataTransfer.getData("Text")+"]").classList.remove("opacity05")}},!1);b.addEventListener("drop",function(c){c.stopPropagation();c.preventDefault();if("TH"===dragEl.nodeName){this.querySelector("[data-col="+c.dataTransfer.getData("Text")+"]").remove();dragEl.classList.remove("opacity05");b.insertBefore(dragEl,
c.target);c=b.getElementsByClassName("dragover-th");for(var d=c.length,f=0;f<d;f++)c[f].classList.remove("dragover-th");document.getElementById(a+"List")?(document.getElementById(a+"List").classList.add("opacity05"),saveCols(a)):saveCols(a,this.parentNode.parentNode)}},!1)}
function setCols(a,b){var c="",d=settings.tags.slice();!1===settings.featTags&&d.push("Title");d.push("Duration");"QueueCurrent"!==a&&"BrowsePlaylistsDetail"!==a&&"QueueLastPlayed"!==a||d.push("Pos");"BrowseFilesystem"===a&&d.push("Type");"QueueLastPlayed"===a&&d.push("LastPlayed");"Playback"===a&&(d.push("Filetype"),d.push("Fileformat"));d.sort();for(var f=0;f<d.length;f++)if("Playback"!==a||"Title"!==d[f])c+='<div class="form-check"><input class="form-check-input" type="checkbox" value="1" name="'+
d[f]+'"',settings["cols"+a].includes(d[f])&&(c+="checked"),c+='><label class="form-check-label text-light" for="'+d[f]+'">&nbsp;&nbsp;'+t(d[f])+"</label></div>";document.getElementById(a+"ColsDropdown").firstChild.innerHTML=c;d=app.current.sort;"Search"===a&&"0/any/Title/"===app.apps.Search.state&&(d=settings.tags.includes("Title")?"Title":!1===settings.featTags?"Filename":"-");if("Playback"!==a){c="";for(f=0;f<settings["cols"+a].length;f++){var g=settings["cols"+a][f];c+='<th draggable="true" data-col="'+
g+'">';if("Track"===g||"Pos"===g)g="#";c+=t(g);"Search"!==a||g!==d&&"-"+g!==d||(g=!1,0===app.current.sort.indexOf("-")&&(g=!0),c+='<span class="sort-dir material-icons pull-right">'+(!0===g?"arrow_drop_up":"arrow_drop_down")+"</span>");c+="</th>"}c+="<th></th>";if(void 0===b)document.getElementById(a+"List").getElementsByTagName("tr")[0].innerHTML=c;else for(a=document.querySelectorAll(b),b=0;b<a.length;b++)a[b].getElementsByTagName("tr")[0].innerHTML=c}}
function saveCols(a,b){var c=document.getElementById(a+"ColsDropdown").firstChild.getElementsByTagName("input");b=void 0===b?document.getElementById(a+"List").getElementsByTagName("tr")[0]:"string"===typeof b?document.querySelector(b).getElementsByTagName("tr")[0]:b.getElementsByTagName("tr")[0];for(var d=0;d<c.length;d++){var f=b.querySelector("[data-col="+c[d].name+"]");!1===c[d].checked?f&&f.remove():f||(f=document.createElement("th"),f.innerText=c[d].name,f.setAttribute("data-col",c[d].name),
b.appendChild(f))}a={table:"cols"+a,cols:[]};c=b.getElementsByTagName("th");for(b=0;b<c.length;b++)(d=c[b].getAttribute("data-col"))&&a.cols.push(d);sendAPI("MYMPD_API_COLS_SAVE",a,getSettings)}
function saveColsPlayback(a){for(var b=document.getElementById(a+"ColsDropdown").firstChild.getElementsByTagName("input"),c=document.getElementById("cardPlaybackTags"),d=0;d<b.length;d++){var f=document.getElementById("current"+b[d].name);!1===b[d].checked?f&&f.remove():f||(f=document.createElement("div"),f.innerHTML="<small>"+t(b[d].name)+"</small><p></p>",f.setAttribute("id","current"+b[d].name),f.setAttribute("data-tag",b[d].name),c.appendChild(f))}a={table:"cols"+a,cols:[]};c=c.getElementsByTagName("div");
for(b=0;b<c.length;b++)(d=c[b].getAttribute("data-tag"))&&a.cols.push(d);sendAPI("MYMPD_API_COLS_SAVE",a,getSettings)}function replaceTblRow(a,b){var c=!1;a.querySelector("[data-popover]")&&hideMenu();a.classList.contains("selected")&&(b.classList.add("selected"),b.focus(),c=!0);a.replaceWith(b);return c}function dirname(a){return a.replace(/\/[^/]*$/,"")}function basename(a){return a.split("/").reverse()[0]}
function filetype(a){a=a.split(".").pop();switch(a){case "mp3":return"MP3 - MPEG-1 Audio Layer III";case "flac":return"FLAC - Free Lossless Audio Codec";case "ogg":return"OGG - Ogg Vorbis";default:a.toUpperCase()}}function fileformat(a){return a.bits+t("bits")+" - "+a.sampleRate/1E3+t("kHz")}function scrollToPosY(a){document.body.scrollTop=a;document.documentElement.scrollTop=a}
function doSetFilterLetter(a){var b=document.getElementById(a+"Letters").getElementsByClassName("active")[0];b&&b.classList.remove("active");b=app.current.filter;"0"===b&&(b="#");document.getElementById(a).innerHTML='<span class="material-icons">filter_list</span>'+("-"!==b?" "+b:"");if("-"!==b){a=document.getElementById(a+"Letters").getElementsByTagName("button");for(var c=a.length,d=0;d<c;d++)if(a[d].innerText===b){a[d].classList.add("active");break}}}
function addFilterLetter(a){for(var b='<button class="mr-1 mb-1 btn btn-sm btn-secondary material-icons material-icons-small">delete</button><button class="mr-1 mb-1 btn btn-sm btn-secondary">#</button>',c=65;90>=c;c++)b+='<button class="mr-1 mb-1 btn-sm btn btn-secondary">'+String.fromCharCode(c)+"</button>";a=document.getElementById(a);a.innerHTML=b;a.addEventListener("click",function(a){switch(a.target.innerText){case "delete":b="-";break;case "#":b="0";break;default:b=a.target.innerText}appGoto(app.current.app,
app.current.tab,app.current.view,"0/"+b+"/"+app.current.sort+"/"+app.current.search)},!1)}function selectTag(a,b,c){a=document.getElementById(a);var d=a.querySelector(".active");d&&d.classList.remove("active");if(d=a.querySelector("[data-tag="+c+"]"))d.classList.add("active"),document.getElementById(b).innerText=d.innerText}
function addTagList(a,b){var c="";"searchtags"===b&&(!0===settings.featTags&&(c+='<button type="button" class="btn btn-secondary btn-sm btn-block" data-tag="any">'+t("Any Tag")+"</button>"),c+='<button type="button" class="btn btn-secondary btn-sm btn-block" data-tag="filename">'+t("Filename")+"</button>");for(var d=0;d<settings[b].length;d++)c+='<button type="button" class="btn btn-secondary btn-sm btn-block" data-tag="'+settings[b][d]+'">'+t(settings[b][d])+"</button>";document.getElementById(a).innerHTML=
c}function openModal(a){window[a].show()}function openDropdown(a){window[a].toggle()}function focusSearch(){"Queue"===app.current.app?document.getElementById("searchqueuestr").focus():"Search"===app.current.app?domCache.searchstr.focus():appGoto("Search")}function toggleBtn(a,b){if(a=document.getElementById(a)){if(void 0===b)b=a.classList.contains("active")?!1:!0;else if(0===b||1===b)b=1===b?!0:!1;!0===b?a.classList.add("active"):a.classList.remove("active")}}
function toggleBtnChk(a,b){if(a=document.getElementById(a)){if(void 0===b)b=a.classList.contains("active")?!1:!0;else if(0===b||1===b)b=1===b?!0:!1;!0===b?(a.classList.add("active"),a.innerText="check"):(a.classList.remove("active"),a.innerText="radio_button_unchecked")}}
function setPagination(a,b){var c=app.current.app+(void 0===app.current.tab?"":app.current.tab),d=Math.ceil(a/settings.maxElementsPerPage);0===d&&(d=1);for(var f=["PaginationTop","PaginationBottom"],g=0;2>g;g++){document.getElementById(c+f[g]+"Page").innerText=app.current.page/settings.maxElementsPerPage+1+" / "+d;if(1<d){document.getElementById(c+f[g]+"Page").removeAttribute("disabled");for(var h="",l=0;l<d;l++)h+='<button data-page="'+l*settings.maxElementsPerPage+'" type="button" class="mr-1 mb-1 btn-sm btn btn-secondary">'+
(l+1)+"</button>";document.getElementById(c+f[g]+"Pages").innerHTML=h;document.getElementById(c+f[g]+"Page").classList.remove("nodropdown")}else-1===a?(document.getElementById(c+f[g]+"Page").setAttribute("disabled","disabled"),document.getElementById(c+f[g]+"Page").innerText=app.current.page/settings.maxElementsPerPage+1):document.getElementById(c+f[g]+"Page").setAttribute("disabled","disabled"),document.getElementById(c+f[g]+"Page").classList.add("nodropdown");a>app.current.page+settings.maxElementsPerPage||
-1===a&&b>=settings.maxElementsPerPage?(document.getElementById(c+f[g]+"Next").removeAttribute("disabled"),document.getElementById(c+f[g]).classList.remove("hide"),document.getElementById(c+"ButtonsBottom").classList.remove("hide")):(document.getElementById(c+f[g]+"Next").setAttribute("disabled","disabled"),document.getElementById(c+f[g]).classList.add("hide"),document.getElementById(c+"ButtonsBottom").classList.add("hide"));0<app.current.page?(document.getElementById(c+f[g]+"Prev").removeAttribute("disabled"),
document.getElementById(c+f[g]).classList.remove("hide"),document.getElementById(c+"ButtonsBottom").classList.remove("hide")):document.getElementById(c+f[g]+"Prev").setAttribute("disabled","disabled")}}function genId(a){return"id"+a.replace(/[^\w-]/g,"")}
function parseCmd(a,b){a.preventDefault();a=b;"string"===typeof b&&(a=JSON.parse(b));if("function"===typeof window[a.cmd])switch(a.cmd){case "sendAPI":sendAPI(a.options[0].cmd,{});break;default:window[a.cmd].apply(null,$jscomp.arrayFromIterable(a.options))}else logError("Can not execute cmd: "+a)}
function gotoPage(a){switch(a){case "next":app.current.page+=settings.maxElementsPerPage;break;case "prev":app.current.page-=settings.maxElementsPerPage;0>app.current.page&&(app.current.page=0);break;default:app.current.page=a}appGoto(app.current.app,app.current.tab,app.current.view,app.current.page+"/"+app.current.filter+"/"+app.current.sort+"/"+app.current.search)}
function validateFilename(a){if(""==a.value)return a.classList.add("is-invalid"),!1;if(null!==a.value.match(/^[\w-]+\.\w+$/))return a.classList.remove("is-invalid"),!0;a.classList.add("is-invalid");return!1}function validatePath(a){if(""===a.value)return a.classList.add("is-invalid"),!1;if(null!==a.value.match(/^\/[/.\w-]+$/))return a.classList.remove("is-invalid"),!0;a.classList.add("is-invalid");return!1}function validatePlname(a){return""===a?!1:null==a.match(/\/|\r|\n|"|'/)?!0:!1}
function validateNotBlank(a){if(""===a.value.replace(/\s/g,""))return a.classList.add("is-invalid"),!1;a.classList.remove("is-invalid");return!0}function validateInt(a){if(""!==a.value.replace(/\d/g,""))return a.classList.add("is-invalid"),!1;a.classList.remove("is-invalid");return!0}function validateFloat(a){if(""!==a.value.replace(/[\d-.]/g,""))return a.classList.add("is-invalid"),!1;a.classList.remove("is-invalid");return!0}
function validateStream(a){if(-1<a.value.indexOf("://"))return a.classList.remove("is-invalid"),!0;a.classList.add("is-invalid");return!1}function validateHost(a){if(null!=a.value.match(/^([\w-.]+)$/))return a.classList.remove("is-invalid"),!0;a.classList.add("is-invalid");return!1};
