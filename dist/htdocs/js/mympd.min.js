var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.arrayIteratorImpl=function(a){var b=0;return function(){return b<a.length?{done:!1,value:a[b++]}:{done:!0}}};$jscomp.arrayIterator=function(a){return{next:$jscomp.arrayIteratorImpl(a)}};$jscomp.makeIterator=function(a){var b="undefined"!=typeof Symbol&&Symbol.iterator&&a[Symbol.iterator];return b?b.call(a):$jscomp.arrayIterator(a)};$jscomp.arrayFromIterator=function(a){for(var b,c=[];!(b=a.next()).done;)c.push(b.value);return c};
$jscomp.arrayFromIterable=function(a){return a instanceof Array?a:$jscomp.arrayFromIterator($jscomp.makeIterator(a))};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.SIMPLE_FROUND_POLYFILL=!1;$jscomp.ISOLATE_POLYFILLS=!1;$jscomp.FORCE_POLYFILL_PROMISE=!1;$jscomp.FORCE_POLYFILL_PROMISE_WHEN_NO_UNHANDLED_REJECTION=!1;
$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(a,b,c){if(a==Array.prototype||a==Object.prototype)return a;a[b]=c.value;return a};$jscomp.getGlobal=function(a){a=["object"==typeof globalThis&&globalThis,a,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof global&&global];for(var b=0;b<a.length;++b){var c=a[b];if(c&&c.Math==Math)return c}throw Error("Cannot find global object");};$jscomp.global=$jscomp.getGlobal(this);
$jscomp.IS_SYMBOL_NATIVE="function"===typeof Symbol&&"symbol"===typeof Symbol("x");$jscomp.TRUST_ES6_POLYFILLS=!$jscomp.ISOLATE_POLYFILLS||$jscomp.IS_SYMBOL_NATIVE;$jscomp.polyfills={};$jscomp.propertyToPolyfillSymbol={};$jscomp.POLYFILL_PREFIX="$jscp$";var $jscomp$lookupPolyfilledValue=function(a,b){var c=$jscomp.propertyToPolyfillSymbol[b];if(null==c)return a[b];c=a[c];return void 0!==c?c:a[b]};
$jscomp.polyfill=function(a,b,c,f){b&&($jscomp.ISOLATE_POLYFILLS?$jscomp.polyfillIsolated(a,b,c,f):$jscomp.polyfillUnisolated(a,b,c,f))};$jscomp.polyfillUnisolated=function(a,b,c,f){c=$jscomp.global;a=a.split(".");for(f=0;f<a.length-1;f++){var h=a[f];if(!(h in c))return;c=c[h]}a=a[a.length-1];f=c[a];b=b(f);b!=f&&null!=b&&$jscomp.defineProperty(c,a,{configurable:!0,writable:!0,value:b})};
$jscomp.polyfillIsolated=function(a,b,c,f){var h=a.split(".");a=1===h.length;f=h[0];f=!a&&f in $jscomp.polyfills?$jscomp.polyfills:$jscomp.global;for(var d=0;d<h.length-1;d++){var g=h[d];if(!(g in f))return;f=f[g]}h=h[h.length-1];c=$jscomp.IS_SYMBOL_NATIVE&&"es6"===c?f[h]:null;b=b(c);null!=b&&(a?$jscomp.defineProperty($jscomp.polyfills,h,{configurable:!0,writable:!0,value:b}):b!==c&&($jscomp.propertyToPolyfillSymbol[h]=$jscomp.IS_SYMBOL_NATIVE?$jscomp.global.Symbol(h):$jscomp.POLYFILL_PREFIX+h,h=
$jscomp.propertyToPolyfillSymbol[h],$jscomp.defineProperty(f,h,{configurable:!0,writable:!0,value:b})))};$jscomp.polyfill("Object.is",function(a){return a?a:function(b,c){return b===c?0!==b||1/b===1/c:b!==b&&c!==c}},"es6","es3");$jscomp.polyfill("Array.prototype.includes",function(a){return a?a:function(b,c){var f=this;f instanceof String&&(f=String(f));var h=f.length;c=c||0;for(0>c&&(c=Math.max(c+h,0));c<h;c++){var d=f[c];if(d===b||Object.is(d,b))return!0}return!1}},"es7","es3");
$jscomp.checkStringArgs=function(a,b,c){if(null==a)throw new TypeError("The 'this' value for String.prototype."+c+" must not be null or undefined");if(b instanceof RegExp)throw new TypeError("First argument to String.prototype."+c+" must not be a regular expression");return a+""};$jscomp.polyfill("String.prototype.includes",function(a){return a?a:function(b,c){return-1!==$jscomp.checkStringArgs(this,b,"includes").indexOf(b,c||0)}},"es6","es3");$jscomp.initSymbol=function(){};
$jscomp.polyfill("Symbol",function(a){if(a)return a;var b=function(h,d){this.$jscomp$symbol$id_=h;$jscomp.defineProperty(this,"description",{configurable:!0,writable:!0,value:d})};b.prototype.toString=function(){return this.$jscomp$symbol$id_};var c=0,f=function(h){if(this instanceof f)throw new TypeError("Symbol is not a constructor");return new b("jscomp_symbol_"+(h||"")+"_"+c++,h)};return f},"es6","es3");
$jscomp.polyfill("Symbol.iterator",function(a){if(a)return a;a=Symbol("Symbol.iterator");for(var b="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),c=0;c<b.length;c++){var f=$jscomp.global[b[c]];"function"===typeof f&&"function"!=typeof f.prototype[a]&&$jscomp.defineProperty(f.prototype,a,{configurable:!0,writable:!0,value:function(){return $jscomp.iteratorPrototype($jscomp.arrayIteratorImpl(this))}})}return a},"es6",
"es3");$jscomp.iteratorPrototype=function(a){a={next:a};a[Symbol.iterator]=function(){return this};return a};$jscomp.iteratorFromArray=function(a,b){a instanceof String&&(a+="");var c=0,f=!1,h={next:function(){if(!f&&c<a.length){var d=c++;return{value:b(d,a[d]),done:!1}}f=!0;return{done:!0,value:void 0}}};h[Symbol.iterator]=function(){return h};return h};$jscomp.polyfill("Array.prototype.keys",function(a){return a?a:function(){return $jscomp.iteratorFromArray(this,function(b){return b})}},"es6","es3");
$jscomp.owns=function(a,b){return Object.prototype.hasOwnProperty.call(a,b)};$jscomp.assign=$jscomp.TRUST_ES6_POLYFILLS&&"function"==typeof Object.assign?Object.assign:function(a,b){for(var c=1;c<arguments.length;c++){var f=arguments[c];if(f)for(var h in f)$jscomp.owns(f,h)&&(a[h]=f[h])}return a};$jscomp.polyfill("Object.assign",function(a){return a||$jscomp.assign},"es6","es3");
$jscomp.polyfill("String.prototype.repeat",function(a){return a?a:function(b){var c=$jscomp.checkStringArgs(this,null,"repeat");if(0>b||1342177279<b)throw new RangeError("Invalid count value");b|=0;for(var f="";b;)if(b&1&&(f+=c),b>>>=1)c+=c;return f}},"es6","es3");
function sendAPI(a,b,c,f){var h={jsonrpc:"2.0",id:0,method:a,params:b},d=new XMLHttpRequest;d.open("POST",subdir+"/api",!0);d.setRequestHeader("Content-type","application/json");d.onreadystatechange=function(){if(4===d.readyState)if(""!==d.responseText){var g=JSON.parse(d.responseText);if(g.error)showNotification(t(g.error.message,g.error.data),"","","danger"),logError(JSON.stringify(g.error));else if(g.result&&g.result.message&&"ok"!==g.result.message)logDebug("Got API response: "+JSON.stringify(g.result)),
showNotification(t(g.result.message,g.result.data),"","","success");else if(g.result&&g.result.message&&"ok"===g.result.message)logDebug("Got API response: "+JSON.stringify(g.result));else if(g.result&&g.result.method)logDebug("Got API response of type: "+g.result.method);else if(logError("Got invalid API response: "+JSON.stringify(g)),!0!==f)return;void 0!==c&&"function"===typeof c&&(void 0!==g.result||!0===f?(logDebug("Calling "+c.name),c(g)):logDebug("Undefined resultset, skip calling "+c.name))}else logError("Empty response for request: "+
JSON.stringify(h)),!0===f&&void 0!==c&&"function"===typeof c&&(logDebug("Got empty API response calling "+c.name),c(""))};d.send(JSON.stringify(h));logDebug("Send API request: "+a)}
function webSocketConnect(){if(null!==socket&&socket.readyState===WebSocket.OPEN)logInfo("Socket already connected"),websocketConnected=!0,socketRetry=0;else if(null!==socket&&socket.readyState===WebSocket.CONNECTING)logInfo("Socket connection in progress"),websocketConnected=!1,socketRetry++,20<socketRetry&&(logError("Socket connection timed out"),webSocketClose(),setTimeout(function(){webSocketConnect()},1E3),socketRetry=0);else{websocketConnected=!1;var a=getWsUrl();socket=new WebSocket(a);socketRetry=
0;logInfo("Connecting to "+a);try{socket.onopen=function(){logInfo("Websocket is connected");websocketConnected=!0;null!==websocketTimer&&(clearTimeout(websocketTimer),websocketTimer=null)},socket.onmessage=function(b){try{var c=JSON.parse(b.data);logDebug("Websocket notification: "+JSON.stringify(c))}catch(f){logError("Invalid JSON data received: "+b.data);return}if(c.error)showNotification(t(c.error.message,c.error.data),"","","danger");else if(c.result)showNotification(t(c.result.message,c.result.data),
"","","success");else switch(c.method){case "welcome":websocketConnected=!0;showNotification(t("Connected to myMPD"),a,"","success");appRoute();sendAPI("MPD_API_PLAYER_STATE",{},parseState,!0);break;case "update_state":c.result=c.params;parseState(c);break;case "mpd_disconnected":progressTimer&&clearTimeout(progressTimer);getSettings(!0);break;case "mpd_connected":showNotification(t("Connected to MPD"),"","","success");sendAPI("MPD_API_PLAYER_STATE",{},parseState);getSettings(!0);break;case "update_queue":"Queue"===
app.current.app&&getQueue();c.result=c.params;parseUpdateQueue(c);break;case "update_options":getSettings();break;case "update_outputs":sendAPI("MPD_API_PLAYER_OUTPUT_LIST",{},parseOutputs);break;case "update_started":updateDBstarted(!1);break;case "update_database":case "update_finished":updateDBfinished(c.method);break;case "update_volume":c.result=c.params;parseVolume(c);break;case "update_stored_playlist":"Browse"===app.current.app&&"Playlists"===app.current.tab&&"All"===app.current.view?sendAPI("MPD_API_PLAYLIST_LIST",
{offset:app.current.offset,limit:app.current.limit,searchstr:app.current.search},parsePlaylists):"Browse"===app.current.app&&"Playlists"===app.current.tab&&"Detail"===app.current.view&&sendAPI("MPD_API_PLAYLIST_CONTENT_LIST",{offset:app.current.offset,limit:app.current.limit,searchstr:app.current.search,uri:app.current.filter,cols:settings.colsBrowsePlaylistsDetail},parsePlaylists);break;case "update_lastplayed":"Queue"===app.current.app&&"LastPlayed"===app.current.tab&&sendAPI("MPD_API_QUEUE_LAST_PLAYED",
{offset:app.current.offset,limit:app.current.limit,cols:settings.colsQueueLastPlayed},parseLastPlayed);break;case "update_jukebox":"Queue"===app.current.app&&"Jukebox"===app.current.tab&&sendAPI("MPD_API_JUKEBOX_LIST",{offset:app.current.offset,limit:app.current.limit,cols:settings.colsQueueJukebox},parseJukeboxList);break;case "error":document.getElementById("alertMpdState").classList.contains("hide")&&showNotification(t(c.params.message),"","","danger");break;case "warn":document.getElementById("alertMpdState").classList.contains("hide")&&
showNotification(t(c.params.message),"","","warning");break;case "info":document.getElementById("alertMpdState").classList.contains("hide")&&showNotification(t(c.params.message),"","","success")}},socket.onclose=function(){logError("Websocket is disconnected");websocketConnected=!1;!0===appInited?(toggleUI(),progressTimer&&clearTimeout(progressTimer)):(showAppInitAlert(t("Websocket connection failed")),logError("Websocket connection failed."));null!==websocketTimer&&(clearTimeout(websocketTimer),
websocketTimer=null);websocketTimer=setTimeout(function(){logInfo("Reconnecting websocket");toggleAlert("alertMympdState",!0,t("Websocket connection failed, trying to reconnect")+'&nbsp;&nbsp;<div class="spinner-border spinner-border-sm"></div>');webSocketConnect()},3E3);socket=null}}catch(b){logError(b)}}}
function webSocketClose(){null!==websocketTimer&&(clearTimeout(websocketTimer),websocketTimer=null);null!==socket&&(socket.onclose=function(){},socket.close(),socket=null);websocketConnected=!1}function getWsUrl(){var a=window.location.hostname,b=window.location.protocol,c=window.location.port;return("https:"===b?"wss://":"ws://")+a+(""!==c?":"+c:"")+subdir+"/ws/"}
function navBrowseHandler(a){"BUTTON"===a.target.nodeName&&(a=a.target.getAttribute("data-tag"),"Playlists"===a||"Filesystem"===a?appGoto("Browse",a,void 0):"Browse"===app.current.app&&"Database"!==app.current.tab?appGoto("Browse","Database",app.apps.Browse.tabs.Database.active):("Album"!==a&&(app.current.filter=a,app.current.sort=a),app.current.search="",document.getElementById("searchDatabaseMatch").value="contains",appGoto(app.current.app,app.current.tab,app.current.view,"0",app.current.limit,
app.current.filter,app.current.sort,a,app.current.search)))}
function gotoBrowse(){if(!1!==settings.featAdvsearch){var a=event.target,b=a.getAttribute("data-tag"),c=decodeURI(a.getAttribute("data-name"));null===b&&(b=a.parentNode.getAttribute("data-tag"),c=decodeURI(a.parentNode.getAttribute("data-name")));if(""!==b&&""!==c&&"-"!==c&&settings.browsetags.includes(b))if("Album"===b){var f=a.getAttribute("data-albumartist");null===f&&(f=a.parentNode.getAttribute("data-albumartist"));null!==f?appGoto("Browse","Database","Detail","0",void 0,b,tagAlbumArtist,c,decodeURI(f)):
appGoto("Browse","Database","List","0",void 0,b,tagAlbumArtist,"Album","("+b+" == '"+c+"')")}else appGoto("Browse","Database","List","0",void 0,b,tagAlbumArtist,"Album","("+b+" == '"+c+"')")}}
function parseFilesystem(a){var b=app.current.app+("Filesystem"===app.current.tab?app.current.tab:""),c=document.getElementById(app.current.app+(void 0===app.current.tab?"":app.current.tab)+"List"),f=c.getElementsByTagName("tbody")[0],h=settings["cols"+b].length;h--;if(a.error)f.innerHTML='<tr><td><span class="material-icons">error_outline</span></td><td colspan="'+h+'">'+t(a.error.message)+"</td></tr>";else{if("Browse"===app.current.app&&"Filesystem"===app.current.tab){var d=document.getElementById("BrowseFilesystemImages");
d.innerHTML="";0===a.result.images.length&&""===a.result.bookletPath||!1===settings.publish?d.classList.add("hide"):d.classList.remove("hide");if(""!==a.result.bookletPath&&!0===settings.publish){var g=document.createElement("div");g.style.backgroundImage='url("'+subdir+'/assets/coverimage-booklet.svg")';g.classList.add("booklet");g.setAttribute("data-href",subdir+"/browse/music/"+a.result.bookletPath);g.title=t("Booklet");d.appendChild(g)}for(g=0;g<a.result.images.length;g++){var k=document.createElement("div");
k.style.backgroundImage='url("'+subdir+"/browse/music/"+a.result.images[g]+'"),url("assets/coverimage-loading.svg")';d.appendChild(k)}}d=a.result.returnedEntities;g=f.getElementsByTagName("tr");c=document.activeElement.parentNode.parentNode===c?!0:!1;for(var l=k=0;l<d;l++){var m=encodeURI(a.result.data[l].uri),n=document.createElement("tr"),p="";n.setAttribute("data-type",a.result.data[l].Type);n.setAttribute("data-uri",m);n.setAttribute("tabindex",0);"Search"===app.current.app&&!0===settings.featTags&&
!0===settings.featAdvsearch&&(void 0!==a.result.data[l].Album&&n.setAttribute("data-album",encodeURI(a.result.data[l].Album)),void 0!==a.result.data[l][tagAlbumArtist]&&n.setAttribute("data-albumartist",encodeURI(a.result.data[l][tagAlbumArtist])));"song"===a.result.data[l].Type?n.setAttribute("data-name",a.result.data[l].Title):n.setAttribute("data-name",a.result.data[l].name);switch(a.result.data[l].Type){case "dir":case "smartpls":case "plist":for(m=0;m<settings["cols"+b].length;m++)p+='<td data-col="'+
settings["cols"+b][m]+'">',"Type"===settings["cols"+b][m]?p="dir"===a.result.data[l].Type?p+'<span class="material-icons">folder_open</span>':p+('<span class="material-icons">'+("smartpls"===a.result.data[l].Type?"queue_music":"list")+"</span>"):"Title"===settings["cols"+b][m]&&(p+=e(a.result.data[l].name)),p+="</td>";p+='<td data-col="Action"><a href="#" class="material-icons color-darkgrey">'+ligatureMore+"</a></td>";n.innerHTML=p;break;case "song":void 0!==a.result.data[l].Duration&&(a.result.data[l].Duration=
beautifySongDuration(a.result.data[l].Duration));void 0!==a.result.data[l].LastModified&&(a.result.data[l].LastModified=localeDate(a.result.data[l].LastModified));for(m=0;m<settings["cols"+b].length;m++)p+='<td data-col="'+settings["cols"+b][m]+'">',p="Type"===settings["cols"+b][m]?p+'<span class="material-icons">music_note</span>':p+e(a.result.data[l][settings["cols"+b][m]]),p+="</td>";p+='<td data-col="Action"><a href="#" class="material-icons color-darkgrey">'+ligatureMore+"</a></td>";n.innerHTML=
p}l<g.length?k=!0===replaceTblRow(g[l],n)?l:k:f.append(n)}for(b=g.length-1;b>=d;b--)g[b].remove();!0===c&&focusTable(0);setPagination(a.result.totalEntities,a.result.returnedEntities);0===d&&(f.innerHTML='<tr><td><span class="material-icons">error_outline</span></td><td colspan="'+h+'">'+t("Empty list")+"</td></tr>")}document.getElementById(app.current.app+(void 0===app.current.tab?"":app.current.tab)+"List").classList.remove("opacity05")}
function addAllFromBrowseFilesystem(a){!0===a?(sendAPI("MPD_API_QUEUE_REPLACE_TRACK",{uri:app.current.search}),showNotification(t("Replaced queue"),"","","success")):(sendAPI("MPD_API_QUEUE_ADD_TRACK",{uri:app.current.search}),showNotification(t("Added all songs"),"","","success"))}
function addAllFromBrowseDatabasePlist(a){2<=app.current.search.length&&sendAPI("MPD_API_DATABASE_SEARCH",{plist:a,filter:app.current.view,searchstr:app.current.search,offset:0,limit:0,cols:settings.colsSearch,replace:!1})}
function parseBookmarks(a){for(var b='<table class="table table-sm table-dark table-borderless mb-0">',c=0;c<a.result.returnedEntities;c++)b+='<tr data-id="'+a.result.data[c].id+'" data-type="'+a.result.data[c].type+'" data-uri="'+encodeURI(a.result.data[c].uri)+'"><td class="nowrap"><a class="text-light" href="#" data-href="goto">'+e(a.result.data[c].name)+'</a></td><td><a class="text-light material-icons material-icons-small" href="#" data-href="edit">edit</a></td><td><a class="text-light material-icons material-icons-small" href="#" data-href="delete">delete</a></td></tr>';
0===a.result.returnedEntities&&(b+='<tr><td class="text-light nowrap">'+t("No bookmarks found")+"</td></tr>");b+="</table>";document.getElementById("BrowseFilesystemBookmarks").innerHTML=b}
function showBookmarkSave(a,b,c,f){document.getElementById("saveBookmarkName").classList.remove("is-invalid");document.getElementById("saveBookmarkId").value=a;document.getElementById("saveBookmarkName").value=b;document.getElementById("saveBookmarkUri").value=c;document.getElementById("saveBookmarkType").value=f;modalSaveBookmark.show()}
function saveBookmark(){var a=parseInt(document.getElementById("saveBookmarkId").value),b=document.getElementById("saveBookmarkName").value,c=document.getElementById("saveBookmarkUri").value,f=document.getElementById("saveBookmarkType").value;""!==b?(sendAPI("MYMPD_API_BOOKMARK_SAVE",{id:a,name:b,uri:c,type:f}),modalSaveBookmark.hide()):document.getElementById("saveBookmarkName").classList.add("is-invalid")}
function parseDatabase(a){var b=a.result.returnedEntities,c=document.getElementById("BrowseDatabaseCards"),f=c.getElementsByClassName("col"),h="IntersectionObserver"in window?!0:!1;0===f.length&&(c.innerHTML="");for(var d=0;d<b;d++){var g=document.createElement("div");g.classList.add("col","px-0","flex-grow-0");""===a.result.data[d].AlbumArtist&&(a.result.data[d].AlbumArtist=t("Unknown artist"));""===a.result.data[d].Album&&(a.result.data[d].Album=t("Unknown album"));if("Album"===a.result.tag){var k=
genId("database"+a.result.data[d].Album+a.result.data[d].AlbumArtist);var l=subdir+"/albumart/"+encodeURI(a.result.data[d].FirstSongUri);var m='<div class="card card-grid clickable" data-picture="'+l+'" data-uri="'+encodeURI(a.result.data[d].FirstSongUri.replace(/\/[^/]+$/,""))+'" data-type="dir" data-name="'+encodeURI(a.result.data[d].Album)+'" data-album="'+encodeURI(a.result.data[d].Album)+'" data-albumartist="'+encodeURI(a.result.data[d].AlbumArtist)+'" tabindex="0"><div class="card-body album-cover-loading album-cover-grid bg-white d-flex" id="'+
k+'"></div><div class="card-footer card-footer-grid p-2" title="'+e(a.result.data[d].AlbumArtist)+": "+e(a.result.data[d].Album)+'">'+e(a.result.data[d].Album)+"<br/><small>"+e(a.result.data[d].AlbumArtist)+"</small></div></div>"}else k=genId("database"+a.result.data[d].value),l=subdir+"/tagpics/"+a.result.tag+"/"+encodeURI(a.result.data[d].value),m='<div class="card card-grid clickable" data-picture="'+l+'" data-tag="'+encodeURI(a.result.data[d].value)+'" tabindex="0">'+(!0===a.result.pics?'<div class="card-body album-cover-loading album-cover-grid bg-white" id="'+
k+'"></div>':"")+'<div class="card-footer card-footer-grid p-2" title="'+e(a.result.data[d].value)+'">'+e(a.result.data[d].value)+"<br/></div></div>";g.innerHTML=m;m=!1;d<f.length?f[d].firstChild.getAttribute("data-picture")!==g.firstChild.getAttribute("data-picture")&&(f[d].replaceWith(g),m=!0):(c.append(g),m=!0);!0===m&&(!0===h?(new IntersectionObserver(setGridImage,{root:null,rootMargin:"0px"})).observe(g):g.firstChild.firstChild.style.backgroundImage=l,"Album"===a.result.tag&&!0===isMobile&&addPlayButton(document.getElementById(k)))}for(h=
f.length-1;h>=b;h--)f[h].remove();setPagination(a.result.totalEntities,a.result.returnedEntities);0===b&&(c.innerHTML='<div class="ml-3 mb-3"><span class="material-icons">error_outline</span>&nbsp;'+t("Empty list")+"</div>")}
function setGridImage(a,b){a.forEach(function(c){if(0<c.intersectionRatio){b.unobserve(c.target);var f=decodeURI(c.target.firstChild.getAttribute("data-picture"));if(c=c.target.firstChild.getElementsByClassName("card-body")[0])c.style.backgroundImage='url("'+f+'"), url("'+subdir+'/assets/coverimage-loading.svg")'}})}
function addPlayButton(a){var b=document.createElement("div");b.classList.add("align-self-end","album-grid-mouseover","material-icons","rounded-circle","clickable");b.innerText="play_arrow";a.appendChild(b);b.addEventListener("click",function(c){c.preventDefault();c.stopPropagation();replaceQueue("dir",decodeURI(c.target.parentNode.parentNode.getAttribute("data-uri")),decodeURI(c.target.parentNode.parentNode.getAttribute("data-name")))},!1)}
function parseAlbumDetails(a){var b=document.getElementById("viewDetailDatabaseCover");b.style.backgroundImage='url("'+subdir+"/albumart/"+a.result.data[0].uri+'"), url("'+subdir+'/assets/coverimage-loading.svg")';b.setAttribute("data-images",a.result.images.join(";;"));b.setAttribute("data-uri",a.result.data[0].uri);document.getElementById("viewDetailDatabaseInfo").innerHTML="<h1>"+e(a.result.Album)+"</h1><small> "+t("AlbumArtist")+"</small><p>"+e(a.result.AlbumArtist)+"</p>"+(""===a.result.bookletPath||
!1===settings.featBrowse?"":'<span class="text-light material-icons">description</span>&nbsp;<a class="text-light" target="_blank" href="'+subdir+"/browse/music/"+e(a.result.bookletPath)+'">'+t("Download booklet")+"</a>")+"</p>";b=document.getElementById("BrowseDatabaseDetailList").getElementsByTagName("tbody")[0];var c=settings.colsBrowseDatabaseDetail.length,f="";1<a.result.Discs&&(f='<tr class="not-clickable"><td><span class="material-icons">album</span></td><td colspan="'+c+'">'+t("Disc 1")+"</td></tr>");
for(var h=a.result.returnedEntities,d=parseInt(a.result.data[0].Disc),g=0;g<h;g++){d<parseInt(a.result.data[g].Disc)&&(f+='<tr class="not-clickable"><td><span class="material-icons">album</span></td><td colspan="'+c+'">'+t("Disc")+" "+e(a.result.data[g].Disc)+"</td></tr>");a.result.data[g].Duration&&(a.result.data[g].Duration=beautifySongDuration(a.result.data[g].Duration));f+='<tr tabindex="0" data-type="song" data-name="'+a.result.data[g].Title+'" data-uri="'+encodeURI(a.result.data[g].uri)+'">';
for(d=0;d<settings.colsBrowseDatabaseDetail.length;d++)f+='<td data-col="'+settings.colsBrowseDatabaseDetail[d]+'">'+e(a.result.data[g][settings.colsBrowseDatabaseDetail[d]])+"</td>";f+='<td data-col="Action"><a href="#" class="material-icons color-darkgrey">'+ligatureMore+"</a></td></tr>";d=a.result.data[g].Disc}b.innerHTML=f;document.getElementById("BrowseDatabaseDetailList").classList.remove("opacity05")}function backToAlbumGrid(){appGoto("Browse","Database","List")}
function addAlbum(a){var b=decodeURI(app.current.tag),c=decodeURI(app.current.search);_addAlbum(a,c,b)}function _addAlbum(a,b,c){b="((Album == '"+escapeMPD(c)+"') AND ("+tagAlbumArtist+" == '"+escapeMPD(b)+"'))";"appendQueue"===a?addAllFromSearchPlist("queue",b,!1):"replaceQueue"===a?addAllFromSearchPlist("queue",b,!0):"addPlaylist"===a&&showAddToPlaylist("ALBUM",b)}
function searchAlbumgrid(a){for(var b="",c=document.getElementById("searchDatabaseCrumb").children,f=0;f<c.length;f++)0<f&&(b+=" AND "),b+="("+decodeURI(c[f].getAttribute("data-filter-tag"))+" "+decodeURI(c[f].getAttribute("data-filter-op"))+" '"+escapeMPD(decodeURI(c[f].getAttribute("data-filter-value")))+"')";""!==a&&(""!==b&&(b+=" AND "),c=document.getElementById("searchDatabaseMatch"),b+="("+app.current.filter+" "+c.options[c.selectedIndex].value+" '"+escapeMPD(a)+"')");2>=b.length&&(b="");appGoto(app.current.app,
app.current.tab,app.current.view,"0",app.current.limit,app.current.filter,app.current.sort,app.current.tag,b)}
function navigateGrid(a,b){var c=!1;"Enter"===b?"Browse"===app.current.app&&"Database"===app.current.tab&&"List"===app.current.view?("Album"===app.current.tag?appGoto("Browse","Database","Detail","0",void 0,"Album","AlbumArtist",decodeURI(a.getAttribute("data-album")),decodeURI(a.getAttribute("data-albumartist"))):(app.current.search="",document.getElementById("searchDatabaseStr").value="",appGoto(app.current.app,app.current.card,void 0,"0",void 0,"Album","AlbumArtist","Album","("+app.current.tag+
" == '"+decodeURI(a.getAttribute("data-tag"))+"')")),c=!0):"Home"===app.current.app&&(a=event.target.getAttribute("data-href"),null!==a&&parseCmd(event,a)):" "===b?"Browse"===app.current.app&&"Database"===app.current.tab&&"List"===app.current.view?("Album"===app.current.tag&&showMenu(a.getElementsByClassName("card-footer")[0],event),c=!0):"Home"===app.current.app&&showMenu(a.getElementsByClassName("card-footer")[0],event):"ArrowDown"===b||"ArrowUp"===b?(b="ArrowDown"===b?null!==a.parentNode.nextElementSibling?
a.parentNode.nextElementSibling.firstChild:null:null!==a.parentNode.previousElementSibling?a.parentNode.previousElementSibling.firstChild:null,null!==b&&(b.focus(),a.classList.remove("selected"),b.classList.add("selected"),c=!0,scrollFocusIntoView())):"Escape"===b&&(a.blur(),a.classList.remove("selected"),c=!0);!0===c&&(event.stopPropagation(),event.preventDefault())}
function parseHome(a){var b=a.result.returnedEntities,c=document.getElementById("HomeCards"),f=c.getElementsByClassName("col");0===f.length&&(c.innerHTML="");for(var h=0;h<b;h++){var d=document.createElement("div");d.classList.add("col","px-0","flex-grow-0");""===a.result.data[h].AlbumArtist&&(a.result.data[h].AlbumArtist=t("Unknown artist"));""===a.result.data[h].Album&&(a.result.data[h].Album=t("Unknown album"));"appGoto"===a.result.data[h].cmd&&8===a.result.data[h].options.length&&a.result.data[h].options.splice(4,
0,settings.maxElementsPerPage);var g=JSON.stringify({cmd:a.result.data[h].cmd,options:a.result.data[h].options});g='<div class="card home-icons clickable" draggable="true" tabindex="0" data-pos="'+h+"\" data-href='"+e(g)+"'  title=\""+e(a.result.data[h].name)+'"><div class="card-body material-icons">'+e(a.result.data[h].ligature)+'</div><div class="card-footer card-footer-grid p-2">'+e(a.result.data[h].name)+"</div></div>";d.innerHTML=g;h<f.length?f[h].replaceWith(d):c.append(d);""!==a.result.data[h].image&&
(d.getElementsByClassName("card-body")[0].style.backgroundImage='url("'+subdir+"/browse/pics/"+a.result.data[h].image+'")');""!==a.result.data[h].bgcolor&&(d.getElementsByClassName("card-body")[0].style.backgroundColor=a.result.data[h].bgcolor)}for(a=f.length-1;a>=b;a--)f[a].remove();0===b&&(c.innerHTML='<div class="ml-3">'+t("Homescreen welcome")+"</div>")}
function dragAndDropHome(){var a=document.getElementById("HomeCards");a.addEventListener("dragstart",function(b){b.target.classList.contains("home-icons")&&(b.target.classList.add("opacity05"),b.dataTransfer.setDragImage(b.target,0,0),b.dataTransfer.effectAllowed="move",dragSrc=b.target,dragEl=b.target.cloneNode(!0))},!1);a.addEventListener("dragleave",function(b){b.preventDefault();!1!==dragEl.classList.contains("home-icons")&&"DIV"===b.target.nodeName&&b.target.classList.contains("home-icons")&&
b.target.classList.remove("dragover-icon")},!1);a.addEventListener("dragover",function(b){b.preventDefault();if(!1!==dragEl.classList.contains("home-icons")){for(var c=a.getElementsByClassName("dragover-icon"),f=c.length,h=0;h<f;h++)c[h].classList.remove("dragover-icon");"DIV"===b.target.nodeName&&b.target.classList.contains("home-icons")?b.target.classList.add("dragover-icon"):"DIV"===b.target.nodeName&&b.target.parentNode.classList.contains("home-icons")&&b.target.parentNode.classList.add("dragover-icon");
b.dataTransfer.dropEffect="move"}},!1);a.addEventListener("dragend",function(b){b.preventDefault();if(!1!==dragEl.classList.contains("home-icons")){b=a.getElementsByClassName("dragover-icon");for(var c=b.length,f=0;f<c;f++)b[f].classList.remove("dragover-icon");dragSrc.classList.remove("opacity05")}},!1);a.addEventListener("drop",function(b){b.preventDefault();b.stopPropagation();if(!1!==dragEl.classList.contains("home-icons")){b=b.target;if("DIV"===b.nodeName&&(b.classList.contains("card-body")&&
(b=b.parentNode),b.classList.contains("home-icons"))){dragEl.classList.remove("opacity05");b=parseInt(b.getAttribute("data-pos"));var c=parseInt(dragSrc.getAttribute("data-pos"));!1===isNaN(b)&&!1===isNaN(c)&&c!==b&&sendAPI("MYMPD_API_HOME_ICON_MOVE",{from:c,to:b},function(h){parseHome(h)})}b=a.getElementsByClassName("dragover-icon");c=b.length;for(var f=0;f<c;f++)b[f].classList.remove("dragover-icon")}},!1)}
function executeHomeIcon(a){a=document.getElementById("HomeCards").children[a].firstChild;parseCmd(null,a.getAttribute("data-href"))}function addViewToHome(){_addHomeIcon("appGoto","","preview",[app.current.app,app.current.tab,app.current.view,app.current.offset,app.current.limit,app.current.filter,app.current.sort,app.current.tag,app.current.search])}function addScriptToHome(a,b){b=JSON.parse(b);b=[b.script,b.arguments.join(",")];_addHomeIcon("execScriptFromOptions",a,"description",b)}
function addPlistToHome(a,b){_addHomeIcon("replaceQueue",b,"list",["plist",a,b])}
function _addHomeIcon(a,b,c,f){document.getElementById("modalEditHomeIconTitle").innerHTML=t("Add to homescreen");document.getElementById("inputHomeIconReplace").value="false";document.getElementById("inputHomeIconOldpos").value="0";document.getElementById("inputHomeIconName").value=b;document.getElementById("inputHomeIconLigature").value=c;document.getElementById("inputHomeIconBgcolor").value="#28a745";document.getElementById("selectHomeIconCmd").value=a;showHomeIconCmdOptions(f);getHomeIconPictureList("");
document.getElementById("homeIconPreview").innerText=c;document.getElementById("homeIconPreview").style.backgroundColor="#28a745";document.getElementById("homeIconPreview").style.backgroundImage="";document.getElementById("divHomeIconLigature").classList.remove("hide");modalEditHomeIcon.show()}function duplicateHomeIcon(a){_editHomeIcon(a,!1,"Duplicate home icon")}function editHomeIcon(a){_editHomeIcon(a,!0,"Edit home icon")}
function _editHomeIcon(a,b,c){document.getElementById("modalEditHomeIconTitle").innerHTML=t(c);sendAPI("MYMPD_API_HOME_ICON_GET",{pos:a},function(f){document.getElementById("inputHomeIconReplace").value=b;document.getElementById("inputHomeIconOldpos").value=a;document.getElementById("inputHomeIconName").value=f.result.data.name;document.getElementById("inputHomeIconLigature").value=f.result.data.ligature;document.getElementById("inputHomeIconBgcolor").value=f.result.data.bgcolor;document.getElementById("selectHomeIconCmd").value=
f.result.data.cmd;"appGoto"===f.result.data.cmd&&8===f.result.data.options.length&&f.result.data.options.splice(4,0,settings.maxElementsPerPage);showHomeIconCmdOptions(f.result.data.options);getHomeIconPictureList(f.result.data.image);document.getElementById("homeIconPreview").innerText=f.result.data.ligature;document.getElementById("homeIconPreview").style.backgroundColor=f.result.data.bgcolor;""===f.result.data.image?(document.getElementById("divHomeIconLigature").classList.remove("hide"),document.getElementById("homeIconPreview").style.backgroundImage=
""):(document.getElementById("divHomeIconLigature").classList.add("hide"),document.getElementById("homeIconPreview").style.backgroundImage="url("+subdir+'"/browse/pics/'+f.result.data.image+'")');modalEditHomeIcon.show()})}
function saveHomeIcon(){var a=!0,b=document.getElementById("inputHomeIconName");validateNotBlank(b)||(a=!1);if(!0===a){a=[];for(var c=document.getElementById("divHomeIconOptions").getElementsByTagName("input"),f=0;f<c.length;f++)a.push(""!==c[f].value?c[f].value:"!undefined!");c=getSelectValue("selectHomeIconImage");sendAPI("MYMPD_API_HOME_ICON_SAVE",{replace:"true"===document.getElementById("inputHomeIconReplace").value?!0:!1,oldpos:parseInt(document.getElementById("inputHomeIconOldpos").value),
name:b.value,ligature:""===c?document.getElementById("inputHomeIconLigature").value:"",bgcolor:document.getElementById("inputHomeIconBgcolor").value,image:c,cmd:document.getElementById("selectHomeIconCmd").value,options:a},function(){modalEditHomeIcon.hide();sendAPI("MYMPD_API_HOME_LIST",{},function(h){parseHome(h)})})}}function deleteHomeIcon(a){sendAPI("MYMPD_API_HOME_ICON_DELETE",{pos:a},function(b){parseHome(b)})}
function showHomeIconCmdOptions(a){var b="",c=getSelectedOptionAttribute("selectHomeIconCmd","data-options");if(void 0!==c){c=JSON.parse(c);for(var f=0;f<c.options.length;f++){var h=void 0!==a?void 0!==a[f]?a[f]:"":"";b+='<div class="form-group row"><label class="col-sm-4 col-form-label">'+t(c.options[f])+'</label><div class="col-sm-8"><input class="form-control border-secondary" value="'+e(h)+'"></div></div>'}}document.getElementById("divHomeIconOptions").innerHTML=b}
function getHomeIconPictureList(a){sendAPI("MYMPD_API_HOME_ICON_PICTURE_LIST",{},function(b){for(var c='<option value="">'+t("Use ligature")+"</option>",f=0;f<b.result.returnedEntities;f++)c+='<option value="'+e(b.result.data[f])+'">'+e(b.result.data[f])+"</option>";b=document.getElementById("selectHomeIconImage");b.innerHTML=c;b.value=a})}
function delQueueJukeboxSong(a){sendAPI("MPD_API_JUKEBOX_RM",{pos:a},function(){sendAPI("MPD_API_JUKEBOX_LIST",{offset:app.current.offset,cols:settings.colsQueueJukebox},parseJukeboxList)})}
function parseJukeboxList(a){var b=a.result.returnedEntities,c=document.getElementById("QueueJukeboxList"),f=document.activeElement.parentNode.parentNode===c?!0:!1,h=0;c=c.getElementsByTagName("tbody")[0];for(var d=c.getElementsByTagName("tr"),g=0;g<b;g++){a.result.data[g].Duration=beautifySongDuration(a.result.data[g].Duration);a.result.data[g].LastPlayed=localeDate(a.result.data[g].LastPlayed);var k=document.createElement("tr");k.setAttribute("data-uri",a.result.data[g].uri);k.setAttribute("data-name",
a.result.data[g].Title);k.setAttribute("data-type","song");k.setAttribute("data-pos",g);k.setAttribute("tabindex",0);for(var l="",m=0;m<settings.colsQueueJukebox.length;m++)l+='<td data-col="'+settings.colsQueueJukebox[m]+'">'+e(a.result.data[g][settings.colsQueueJukebox[m]])+"</td>";l+='<td data-col="Action">';""!==a.result.data[g].uri&&(l+='<a href="#" class="material-icons color-darkgrey">'+ligatureMore+"</a>");l+="</td>";k.innerHTML=l;g<d.length?h=!0===replaceTblRow(d[g],k)?g:h:c.append(k)}for(g=
d.length-1;g>=b;g--)d[g].remove();d=settings.colsQueueJukebox.length;d--;0===b&&(c.innerHTML='<tr><td><span class="material-icons">error_outline</span></td><td colspan="'+d+'">'+t("Empty list")+"</td></tr>");!0===f&&focusTable(h);setPagination(a.result.totalEntities,a.result.returnedEntities);document.getElementById("QueueJukeboxList").classList.remove("opacity05")}
var keymap={ArrowLeft:{cmd:"clickPrev",options:[],desc:"Previous song",key:"keyboard_arrow_left"},ArrowRight:{cmd:"clickNext",options:[],desc:"Next song",key:"keyboard_arrow_right"}," ":{cmd:"clickPlay",options:[],desc:"Toggle play / pause",key:"space_bar"},s:{cmd:"clickStop",options:[],desc:"Stop playing"},"-":{cmd:"volumeStep",options:["down"],desc:"Volume down"},"+":{cmd:"volumeStep",options:["up"],desc:"Volume up"},c:{cmd:"sendAPI",options:[{cmd:"MPD_API_QUEUE_CLEAR"}],desc:"Clear queue"},u:{cmd:"updateDB",
options:["",!0],desc:"Update database"},r:{cmd:"rescanDB",options:["",!0],desc:"Rescan database"},p:{cmd:"updateSmartPlaylists",options:[!1],desc:"Update smart playlists",req:"featSmartpls"},a:{cmd:"showAddToPlaylist",options:["stream",""],desc:"Add stream"},t:{cmd:"openModal",options:["modalSettings"],desc:"Open settings"},i:{cmd:"clickTitle",options:[],desc:"Open song details"},l:{cmd:"openDropdown",options:["dropdownLocalPlayer"],desc:"Open local player"},0:{cmd:"appGoto",options:["Playback"],
desc:"Goto playback"},1:{cmd:"appGoto",options:["Queue","Current"],desc:"Goto queue"},2:{cmd:"appGoto",options:["Queue","LastPlayed"],desc:"Goto last played"},3:{cmd:"appGoto",options:["Browse","Database"],desc:"Goto browse database",req:"featTags"},4:{cmd:"appGoto",options:["Browse","Playlists"],desc:"Goto browse playlists",req:"featPlaylists"},5:{cmd:"appGoto",options:["Browse","Filesystem"],desc:"Goto browse filesystem"},6:{cmd:"appGoto",options:["Search"],desc:"Goto search"},m:{cmd:"openDropdown",
options:["dropdownMainMenu"],desc:"Open main menu"},v:{cmd:"openDropdown",options:["dropdownVolumeMenu"],desc:"Open volume menu"},S:{cmd:"sendAPI",options:[{cmd:"MPD_API_QUEUE_SHUFFLE"}],desc:"Shuffle queue"},C:{cmd:"sendAPI",options:[{cmd:"MPD_API_QUEUE_CROP"}],desc:"Crop queue"},"?":{cmd:"openModal",options:["modalAbout"],desc:"Open about"},"/":{cmd:"focusSearch",options:[],desc:"Focus search"},n:{cmd:"focusTable",options:[],desc:"Focus table"},q:{cmd:"queueSelectedItem",options:[!0],desc:"Append item to queue"},
Q:{cmd:"queueSelectedItem",options:[!1],desc:"Replace queue with item"},d:{cmd:"dequeueSelectedItem",options:[],desc:"Remove item from queue"},x:{cmd:"addSelectedItemToPlaylist",options:[],desc:"Append item to playlist"},F:{cmd:"openFullscreen",options:[],desc:"Open fullscreen"}};
function e(a){return isNaN(a)?a.replace(/([<>"'])/g,function(b,c){if("<"===c)return"&lt;";if(">"===c)return"&gt;";if('"'===c)return"&quot;";if("'"===c)return"&apos;"}).replace(/\\u(003C|003E|0022|0027)/gi,function(b,c){if("003C"===c)return"&lt;";if("003E"===c)return"&gt;";if("0022"===c)return"&quot;";if("0027"===c)return"&apos;"}):a}
function t(a,b,c){var f=void 0;isNaN(b)&&(c=b);phrases[a]&&(f=phrases[a][locale],void 0===f&&("en-US"!==locale&&logWarn('Phrase "'+a+'" for locale '+locale+" not found"),f=phrases[a]["en-US"]));void 0===f&&(f=a);!1===isNaN(b)&&(a=f.split(" |||| "),1<a.length&&(f=a[smartCount(b)]),f=f.replace("%{smart_count}",b));null!==c&&(f=f.replace(/%\{(\w+)\}/g,function(h,d){return c[d]}));return e(f)}function smartCount(a){return 0===a?1:1===a?0:1}
function localeDate(a){return(void 0===a?new Date:new Date(1E3*a)).toLocaleString(locale)}function beautifyDuration(a){var b=Math.floor(a/86400),c=Math.floor(a/3600)-24*b,f=Math.floor(a/60)-60*c-1440*b;a=a-86400*b-3600*c-60*f;return(0<b?b+"\u2009"+t("Days")+" ":"")+(0<c?c+"\u2009"+t("Hours")+" "+(10>f?"0":""):"")+f+"\u2009"+t("Minutes")+" "+(10>a?"0":"")+a+"\u2009"+t("Seconds")}
function beautifySongDuration(a){var b=Math.floor(a/3600),c=Math.floor(a/60)-60*b;a=a-3600*b-60*c;return(0<b?b+":"+(10>c?"0":""):"")+c+":"+(10>a?"0":"")+a}function gtPage(a,b,c){return-1<c?t(a,c):b+app.current.offset<settings.maxElementsPerPage?t(a,b):"> "+t(a,settings.maxElementsPerPage)}
function i18nHtml(a){for(var b=[["data-phrase","innerText"],["data-title-phrase","title"],["data-placeholder-phrase","placeholder"]],c=0;c<b.length;c++)for(var f=a.querySelectorAll("["+b[c][0]+"]"),h=f.length,d=0;d<h;d++)f[d][b[c][1]]=t(f[d].getAttribute(b[c][0]))}
function setLocalPlayerUrl(){"https:"===window.location.protocol?(document.getElementById("infoLocalplayer").classList.remove("hide"),document.getElementById("selectStreamMode").options[0].setAttribute("data-phrase","HTTPS Port")):(document.getElementById("infoLocalplayer").classList.add("hide"),document.getElementById("selectStreamMode").options[0].setAttribute("data-phrase","HTTP Port"));""===settings.streamUrl?(settings.mpdstream=window.location.protocol+"//",null!==settings.mpdHost.match(/^127\./)||
"localhost"===settings.mpdHost||null!==settings.mpdHost.match(/^\//)?settings.mpdstream+=window.location.hostname:settings.mpdstream+=settings.mpdHost,settings.mpdstream+=":"+settings.streamPort+"/"):settings.mpdstream=settings.streamUrl;var a=document.getElementById("localPlayer");a.src!==settings.mpdstream&&(a.pause(),a.src=settings.mpdstream,a.load(),setTimeout(function(){checkLocalPlayerState()},500))}
function clickCheckLocalPlayerState(a){var b=a.target;b.classList.add("disabled");a=document.getElementById("localPlayer").parentNode;document.getElementById("localPlayer").remove();var c=document.createElement("audio");c.setAttribute("preload","none");c.setAttribute("controls","");c.setAttribute("id","localPlayer");c.classList.add("mx-4");a.appendChild(c);setLocalPlayerUrl();setTimeout(function(){b.classList.remove("disabled");c.play()},500)}
function checkLocalPlayerState(){var a=document.getElementById("localPlayer");document.getElementById("errorLocalPlayback").classList.add("hide");document.getElementById("alertLocalPlayback").classList.add("hide");0===a.networkState?(logDebug("localPlayer networkState: "+a.networkState),document.getElementById("alertLocalPlayback").classList.remove("hide")):1<=a.networkState&&logDebug("localPlayer networkState: "+a.networkState);3===a.networkState&&(logError("localPlayer networkState: "+a.networkState),
document.getElementById("errorLocalPlayback").classList.remove("hide"))}function logError(a){logLog(0,"ERROR: "+a)}function logWarn(a){logLog(1,"WARN: "+a)}function logInfo(a){logLog(2,"INFO: "+a)}function logVerbose(a){logLog(3,"VERBOSE: "+a)}function logDebug(a){logLog(4,"DEBUG: "+a)}function logLog(a,b){settings.loglevel>=a&&(0===a?console.error(b):1===a?console.warn(b):4===a?console.debug(b):console.log(b))}
function openFullscreen(){var a=document.documentElement;a.requestFullscreen?a.requestFullscreen():a.mozRequestFullScreen?a.mozRequestFullScreen():a.webkitRequestFullscreen?a.webkitRequestFullscreen():a.msRequestFullscreen&&a.msRequestFullscreen()}
function setViewport(a){document.querySelector("meta[name=viewport]").setAttribute("content","width=device-width, initial-scale="+scale+", maximum-scale="+scale);if(!0===a)try{localStorage.setItem("scale-ratio",scale)}catch(b){logError("Can not save scale-ratio in localStorage: "+b.message)}}
function addStream(){var a=document.getElementById("streamUrl");!0===validateStream(a)&&(sendAPI("MPD_API_QUEUE_ADD_TRACK",{uri:a.value}),modalAddToPlaylist.hide(),showNotification(t("Added stream %{streamUri} to queue",{streamUri:a.value}),"","","success"))}function seekRelativeForward(){seekRelative(5)}function seekRelativeBackward(){seekRelative(-5)}function seekRelative(a){sendAPI("MPD_API_SEEK_CURRENT",{seek:a,relative:!0})}
function clickPlay(){"play"!==playstate?sendAPI("MPD_API_PLAYER_PLAY",{}):"stop"===settings.footerStop?sendAPI("MPD_API_PLAYER_STOP",{}):sendAPI("MPD_API_PLAYER_PAUSE",{})}function clickStop(){sendAPI("MPD_API_PLAYER_STOP",{})}function clickPrev(){sendAPI("MPD_API_PLAYER_PREV",{})}function clickNext(){sendAPI("MPD_API_PLAYER_NEXT",{})}function execSyscmd(a){sendAPI("MYMPD_API_SYSCMD",{cmd:a})}function clearCovercache(){sendAPI("MYMPD_API_COVERCACHE_CLEAR",{})}
function cropCovercache(){sendAPI("MYMPD_API_COVERCACHE_CROP",{})}function updateDB(a,b){sendAPI("MPD_API_DATABASE_UPDATE",{uri:a});updateDBstarted(b)}function rescanDB(a,b){sendAPI("MPD_API_DATABASE_RESCAN",{uri:a});updateDBstarted(b)}
function updateDBstarted(a){!0===a&&(document.getElementById("updateDBfinished").innerText="",document.getElementById("updateDBfooter").classList.add("hide"),a=document.getElementById("updateDBprogress"),a.style.width="20px",a.style.marginLeft="-20px",modalUpdateDB.show(),a.classList.add("updateDBprogressAnimate"));showNotification(t("Database update started"),"","","success")}
function updateDBfinished(a){document.getElementById("modalUpdateDB").classList.contains("show")?_updateDBfinished(a):setTimeout(function(){_updateDBfinished(a)},100)}
function _updateDBfinished(a){var b=document.getElementById("spinnerUpdateProgress");if(b){var c=b.parentNode;b.remove();for(b=0;b<c.children.length;b++)c.children[b].classList.remove("hide")}document.getElementById("modalUpdateDB").classList.contains("show")&&("update_database"===a?document.getElementById("updateDBfinished").innerText=t("Database successfully updated"):"update_finished"===a&&(document.getElementById("updateDBfinished").innerText=t("Database update finished")),c=document.getElementById("updateDBprogress"),
c.classList.remove("updateDBprogressAnimate"),c.style.width="100%",c.style.marginLeft="0px",document.getElementById("updateDBfooter").classList.remove("hide"));"update_database"===a?showNotification(t("Database successfully updated"),"","","success"):"update_finished"===a&&showNotification(t("Database update finished"),"","","success")}
function zoomPicture(a){if(a.classList.contains("booklet"))window.open(a.getAttribute("data-href"));else if(a.classList.contains("carousel")){if(null!==a.getAttribute("data-images"))var b=a.getAttribute("data-images").split(";;");else if(lastSongObj.images)b=lastSongObj.images.slice();else return;var c=[];a.getAttribute("data-uri")&&(c=[subdir+"/albumart/"+a.getAttribute("data-uri")]);if(!0===settings.publish)for(a=0;a<b.length;a++)!1===isCoverfile(b[a])&&c.push(subdir+"/browse/music/"+b[a]);a=document.getElementById("modalPictureImg");
a.style.paddingTop=0;createImgCarousel(a,"picsCarousel",c);document.getElementById("modalPictureZoom").classList.add("hide");modalPicture.show()}else""!==a.style.backgroundImage&&(c=document.getElementById("modalPictureImg"),c.innerHTML="",c.style.paddingTop="100%",c.style.backgroundImage=a.style.backgroundImage,document.getElementById("modalPictureZoom").classList.remove("hide"),modalPicture.show())}
function zoomZoomPicture(){window.open(document.getElementById("modalPictureImg").style.backgroundImage.match(/^url\(["']?([^"']*)["']?\)/)[1])}
function createImgCarousel(a,b,c){for(var f='<div id="'+b+'" class="carousel slide" data-ride="carousel"><ol class="carousel-indicators">',h=0;h<c.length;h++)f+='<li data-target="#'+b+'" data-slide-to="'+h+'"'+(0===h?' class="active"':"")+"></li>";f+='</ol><div class="carousel-inner" role="listbox">';for(h=0;h<c.length;h++)f+='<div class="carousel-item'+(0===h?" active":"")+'"><div></div></div>';a.innerHTML=f+('</div><a class="carousel-control-prev" href="#'+b+'" data-slide="prev"><span class="carousel-control-prev-icon"></span></a><a class="carousel-control-next" href="#'+
b+'" data-slide="next"><span class="carousel-control-next-icon"></span></a></div>');a=a.getElementsByClassName("carousel-item");for(f=0;f<a.length;f++)a[f].children[0].style.backgroundImage='url("'+encodeURI(c[f])+'")';b=document.getElementById(b);new BSN.Carousel(b,{interval:!1,pause:!1})}function unmountMount(a){sendAPI("MPD_API_MOUNT_UNMOUNT",{mountPoint:a},showListMounts)}
function mountMount(){document.getElementById("errorMount").classList.add("hide");sendAPI("MPD_API_MOUNT_MOUNT",{mountUrl:getSelectValue("selectMountUrlhandler")+document.getElementById("inputMountUrl").value,mountPoint:document.getElementById("inputMountPoint").value},showListMounts,!0)}
function updateMount(a,b){for(var c=a.parentNode,f=0;f<c.children.length;f++)c.children[f].classList.add("hide");c=document.createElement("div");c.setAttribute("id","spinnerUpdateProgress");c.classList.add("spinner-border","spinner-border-sm");a.parentNode.insertBefore(c,a);updateDB(b,!1)}
function showEditMount(a,b){document.getElementById("listMounts").classList.remove("active");document.getElementById("editMount").classList.add("active");document.getElementById("listMountsFooter").classList.add("hide");document.getElementById("editMountFooter").classList.remove("hide");document.getElementById("errorMount").classList.add("hide");a=a.match(/^(\w+:\/\/)(.+)$/);null!==a&&2<a.length?(document.getElementById("selectMountUrlhandler").value=a[1],document.getElementById("inputMountUrl").value=
a[2],document.getElementById("inputMountPoint").value=b):(document.getElementById("inputMountUrl").value="",document.getElementById("inputMountPoint").value="");document.getElementById("inputMountUrl").focus();document.getElementById("inputMountUrl").classList.remove("is-invalid");document.getElementById("inputMountPoint").classList.remove("is-invalid")}
function showListMounts(a){if(a&&a.error&&a.error.message){var b=document.getElementById("errorMount");b.innerText=a.error.message;b.classList.remove("hide")}else document.getElementById("listMounts").classList.add("active"),document.getElementById("editMount").classList.remove("active"),document.getElementById("listMountsFooter").classList.remove("hide"),document.getElementById("editMountFooter").classList.add("hide"),sendAPI("MPD_API_MOUNT_LIST",{},parseListMounts)}
function parseListMounts(a){for(var b=document.getElementById("listMounts").getElementsByTagName("tbody")[0],c=b.getElementsByTagName("tr"),f=0,h=0;h<a.result.returnedEntities;h++){var d=document.createElement("tr");d.setAttribute("data-url",encodeURI(a.result.data[h].mountUrl));d.setAttribute("data-point",encodeURI(a.result.data[h].mountPoint));""===a.result.data[h].mountPoint&&d.classList.add("not-clickable");var g="<td>"+(""===a.result.data[h].mountPoint?'<span class="material-icons">home</span>':
e(a.result.data[h].mountPoint))+"</td><td>"+e(a.result.data[h].mountUrl)+"</td>";g=""!==a.result.data[h].mountPoint?g+('<td data-col="Action"><a href="#" title="'+t("Unmount")+'" data-action="unmount" class="material-icons color-darkgrey">delete</a><a href="#" title="'+t("Update")+'" data-action="update"class="material-icons color-darkgrey">refresh</a></td>'):g+"<td>&nbsp;</td>";d.innerHTML=g;h<c.length?f=!0===replaceTblRow(c[h],d)?h:f:b.append(d)}for(f=c.length-1;f>=a.result.returnedEntities;f--)c[f].remove();
0===a.result.returnedEntities&&(b.innerHTML='<tr><td><span class="material-icons">error_outline</span></td><td colspan="4">'+t("Empty list")+"</td></tr>")}
function parseNeighbors(a){var b="";if(a.error)b='<div class="list-group-item"><span class="material-icons">error_outline</span> '+t(a.error.message)+"</div>";else{for(var c=0;c<a.result.returnedEntities;c++)b+='<a href="#" class="list-group-item list-group-item-action" data-value="'+a.result.data[c].uri+'">'+a.result.data[c].uri+"<br/><small>"+a.result.data[c].displayName+"</small></a>";0===a.result.returnedEntities&&(b='<div class="list-group-item"><span class="material-icons">error_outline</span>&nbsp;'+
t("Empty list")+"</div>")}document.getElementById("dropdownNeighbors").children[0].innerHTML=b}
var socket=null,websocketConnected=!1,websocketTimer=null,socketRetry=0,lastSong="",lastSongObj={},lastState,currentSong={},playstate="",settingsLock=!1,settingsParsed=!1,settingsNew={},settings={loglevel:2},alertTimeout=null,progressTimer=null,deferredA2HSprompt,dragSrc,dragEl,showSyncedLyrics=!1,appInited=!1,subdir="",uiEnabled=!0,locale=navigator.language||navigator.userLanguage,scale="1.0",isMobile=/iPhone|iPad|iPod|Android/i.test(navigator.userAgent),ligatureMore="menu",progressBarTransition=
"width 1s linear",tagAlbumArtist="AlbumArtist",app={apps:{Home:{offset:0,limit:100,filter:"-",sort:"-",tag:"-",search:"",scrollPos:0},Playback:{offset:0,limit:100,filter:"-",sort:"-",tag:"-",search:"",scrollPos:0},Queue:{active:"Current",tabs:{Current:{offset:0,limit:100,filter:"any",sort:"-",tag:"-",search:"",scrollPos:0},LastPlayed:{offset:0,limit:100,filter:"any",sort:"-",tag:"-",search:"",scrollPos:0},Jukebox:{offset:0,limit:100,filter:"any",sort:"-",tag:"-",search:"",scrollPos:0}}},Browse:{active:"Database",
tabs:{Filesystem:{offset:0,limit:100,filter:"-",sort:"-",tag:"-",search:"",scrollPos:0},Playlists:{active:"All",views:{All:{offset:0,limit:100,filter:"-",sort:"-",tag:"-",search:"",scrollPos:0},Detail:{offset:0,limit:100,filter:"-",sort:"-",tag:"-",search:"",scrollPos:0}}},Database:{active:"List",views:{List:{offset:0,limit:100,filter:"AlbumArtist",sort:"AlbumArtist",tag:"Album",search:"",scrollPos:0},Detail:{offset:0,limit:100,filter:"-",sort:"-",tag:"-",search:"",scrollPos:0}}}}},Search:{offset:0,
limit:100,filter:"any",sort:"-",tag:"-",search:"",scrollPos:0}},current:{app:"Home",tab:void 0,view:void 0,offset:0,limit:100,filter:"",search:"",sort:"",tag:"",scrollPos:0},last:{app:void 0,tab:void 0,view:void 0,offset:0,limit:100,filter:"",search:"",sort:"",tag:"",scrollPos:0}},domCache={};domCache.counter=document.getElementById("counter");domCache.volumePrct=document.getElementById("volumePrct");domCache.volumeControl=document.getElementById("volumeControl");domCache.volumeMenu=document.getElementById("volumeMenu");
domCache.btnsPlay=document.getElementsByClassName("btnPlay");domCache.btnsPlayLen=domCache.btnsPlay.length;domCache.btnPrev=document.getElementById("btnPrev");domCache.btnNext=document.getElementById("btnNext");domCache.progress=document.getElementById("footerProgress");domCache.progressBar=document.getElementById("footerProgressBar");domCache.progressPos=document.getElementById("footerProgressPos");domCache.volumeBar=document.getElementById("volumeBar");domCache.outputs=document.getElementById("outputs");
domCache.btnA2HS=document.getElementById("nav-add2homescreen");domCache.currentCover=document.getElementById("currentCover");domCache.currentTitle=document.getElementById("currentTitle");domCache.footerTitle=document.getElementById("footerTitle");domCache.footerArtist=document.getElementById("footerArtist");domCache.footerAlbum=document.getElementById("footerAlbum");domCache.footerCover=document.getElementById("footerCover");domCache.btnVoteUp=document.getElementById("btnVoteUp");
domCache.btnVoteDown=document.getElementById("btnVoteDown");domCache.badgeQueueItems=null;domCache.searchstr=document.getElementById("searchstr");domCache.searchCrumb=document.getElementById("searchCrumb");domCache.body=document.getElementsByTagName("body")[0];domCache.footer=document.getElementsByTagName("footer")[0];domCache.header=document.getElementById("header");domCache.mainMenu=document.getElementById("mainMenu");
var modalConnection=new BSN.Modal(document.getElementById("modalConnection")),modalSettings=new BSN.Modal(document.getElementById("modalSettings")),modalAbout=new BSN.Modal(document.getElementById("modalAbout")),modalSaveQueue=new BSN.Modal(document.getElementById("modalSaveQueue")),modalAddToQueue=new BSN.Modal(document.getElementById("modalAddToQueue")),modalSongDetails=new BSN.Modal(document.getElementById("modalSongDetails")),modalAddToPlaylist=new BSN.Modal(document.getElementById("modalAddToPlaylist")),
modalRenamePlaylist=new BSN.Modal(document.getElementById("modalRenamePlaylist")),modalUpdateDB=new BSN.Modal(document.getElementById("modalUpdateDB")),modalSaveSmartPlaylist=new BSN.Modal(document.getElementById("modalSaveSmartPlaylist")),modalDeletePlaylist=new BSN.Modal(document.getElementById("modalDeletePlaylist")),modalSaveBookmark=new BSN.Modal(document.getElementById("modalSaveBookmark")),modalTimer=new BSN.Modal(document.getElementById("modalTimer")),modalMounts=new BSN.Modal(document.getElementById("modalMounts")),
modalExecScript=new BSN.Modal(document.getElementById("modalExecScript")),modalScripts=new BSN.Modal(document.getElementById("modalScripts")),modalPartitions=new BSN.Modal(document.getElementById("modalPartitions")),modalPartitionOutputs=new BSN.Modal(document.getElementById("modalPartitionOutputs")),modalTrigger=new BSN.Modal(document.getElementById("modalTrigger")),modalOutputAttributes=new BSN.Modal(document.getElementById("modalOutputAttributes")),modalPicture=new BSN.Modal(document.getElementById("modalPicture")),
modalEditHomeIcon=new BSN.Modal(document.getElementById("modalEditHomeIcon")),dropdownMainMenu=new BSN.Dropdown(document.getElementById("mainMenu")),dropdownVolumeMenu=new BSN.Dropdown(document.getElementById("volumeMenu")),dropdownBookmarks=new BSN.Dropdown(document.getElementById("BrowseFilesystemBookmark")),dropdownLocalPlayer=new BSN.Dropdown(document.getElementById("localPlaybackMenu")),dropdownPlay=new BSN.Dropdown(document.getElementById("btnPlayDropdown")),dropdownDatabaseSort=new BSN.Dropdown(document.getElementById("btnDatabaseSortDropdown")),
dropdownNeighbors=new BSN.Dropdown(document.getElementById("btnDropdownNeighbors")),collapseDBupdate=new BSN.Collapse(document.getElementById("navDBupdate")),collapseSettings=new BSN.Collapse(document.getElementById("navSettings")),collapseSyscmds=new BSN.Collapse(document.getElementById("navSyscmds")),collapseScripting=new BSN.Collapse(document.getElementById("navScripting")),collapseJukeboxMode=new BSN.Collapse(document.getElementById("labelJukeboxMode"));
function appPrepare(a){if(app.current.app!==app.last.app||app.current.tab!==app.last.tab||app.current.view!==app.last.view){for(var b=0;b<domCache.navbarBtnsLen;b++)domCache.navbarBtns[b].classList.remove("active");document.getElementById("cardHome").classList.add("hide");document.getElementById("cardPlayback").classList.add("hide");document.getElementById("cardQueue").classList.add("hide");document.getElementById("cardBrowse").classList.add("hide");document.getElementById("cardSearch").classList.add("hide");
document.getElementById("cardQueueCurrent").classList.add("hide");document.getElementById("cardQueueLastPlayed").classList.add("hide");document.getElementById("cardQueueJukebox").classList.add("hide");document.getElementById("cardBrowsePlaylists").classList.add("hide");document.getElementById("cardBrowseFilesystem").classList.add("hide");document.getElementById("cardBrowseDatabase").classList.add("hide");document.getElementById("card"+app.current.app).classList.remove("hide");document.getElementById("nav"+
app.current.app)&&document.getElementById("nav"+app.current.app).classList.add("active");void 0!==app.current.tab&&document.getElementById("card"+app.current.app+app.current.tab).classList.remove("hide")}scrollToPosY(a);(a=document.getElementById(app.current.app+(void 0===app.current.tab?"":app.current.tab)+(void 0===app.current.view?"":app.current.view)+"List"))&&a.classList.add("opacity05")}
function appGoto(a,b,c,f,h,d,g,k,l,m){var n=document.body.scrollTop?document.body.scrollTop:document.documentElement.scrollTop;void 0!==app.apps[app.current.app].scrollPos?app.apps[app.current.app].scrollPos=n:void 0!==app.apps[app.current.app].tabs[app.current.tab].scrollPos?app.apps[app.current.app].tabs[app.current.tab].scrollPos=n:void 0!==app.apps[app.current.app].tabs[app.current.tab].views[app.current.view].scrollPos&&(app.apps[app.current.app].tabs[app.current.tab].views[app.current.view].scrollPos=
n);app.apps[a].tabs?(void 0===b&&(b=app.apps[a].active),app.apps[a].tabs[b].views?(void 0===c&&(c=app.apps[a].tabs[b].active),f="/"+encodeURIComponent(a)+"/"+encodeURIComponent(b)+"/"+encodeURIComponent(c)+"!"+encodeURIComponent(void 0===f?app.apps[a].tabs[b].views[c].offset:f)+"/"+encodeURIComponent(void 0===h?app.apps[a].tabs[b].views[c].limit:h)+"/"+encodeURIComponent(void 0===d?app.apps[a].tabs[b].views[c].filter:d)+"/"+encodeURIComponent(void 0===g?app.apps[a].tabs[b].views[c].sort:g)+"/"+encodeURIComponent(void 0===
k?app.apps[a].tabs[b].views[c].tag:k)+"/"+encodeURIComponent(void 0===l?app.apps[a].tabs[b].views[c].search:l),void 0!==m&&(app.apps[a].tabs[b].views[c].scrollPos=m)):(f="/"+encodeURIComponent(a)+"/"+encodeURIComponent(b)+"!"+encodeURIComponent(void 0===f?app.apps[a].tabs[b].offset:f)+"/"+encodeURIComponent(void 0===h?app.apps[a].tabs[b].limit:h)+"/"+encodeURIComponent(void 0===d?app.apps[a].tabs[b].filter:d)+"/"+encodeURIComponent(void 0===g?app.apps[a].tabs[b].sort:g)+"/"+encodeURIComponent(void 0===
k?app.apps[a].tabs[b].tag:k)+"/"+encodeURIComponent(void 0===l?app.apps[a].tabs[b].search:l),void 0!==m&&(app.apps[a].tabs[b].scrollPos=m))):(f="/"+encodeURIComponent(a)+"!"+encodeURIComponent(void 0===f?app.apps[a].offset:f)+"/"+encodeURIComponent(void 0===h?app.apps[a].limit:h)+"/"+encodeURIComponent(void 0===d?app.apps[a].filter:d)+"/"+encodeURIComponent(void 0===g?app.apps[a].sort:g)+"/"+encodeURIComponent(void 0===k?app.apps[a].tag:k)+"/"+encodeURIComponent(void 0===l?app.apps[a].search:l),void 0!==
m&&(app.apps[a].scrollPos=m));location.hash=f}
function appRoute(){if(!1===settingsParsed)appInitStart();else{var a=location.hash.match(/^#\/(\w+)\/?(\w+)?\/?(\w+)?!(\d+)\/(\d+)\/([^/]+)\/([^/]+)\/([^/]+)\/(.*)$/);if(a){app.current.app=decodeURIComponent(a[1]);app.current.tab=void 0!==a[2]?decodeURIComponent(a[2]):void 0;app.current.view=void 0!==a[3]?decodeURIComponent(a[3]):void 0;app.current.offset=parseInt(decodeURIComponent(a[4]));app.current.limit=parseInt(decodeURIComponent(a[5]));app.current.filter=decodeURIComponent(a[6]);app.current.sort=
decodeURIComponent(a[7]);app.current.tag=decodeURIComponent(a[8]);app.current.search=decodeURIComponent(a[9]);void 0!==app.apps[app.current.app].offset?(app.apps[app.current.app].offset=app.current.offset,app.apps[app.current.app].limit=app.current.limit,app.apps[app.current.app].filter=app.current.filter,app.apps[app.current.app].sort=app.current.sort,app.apps[app.current.app].tag=app.current.tag,app.apps[app.current.app].search=app.current.search,app.current.scrollPos=app.apps[app.current.app].scrollPos):
void 0!==app.apps[app.current.app].tabs[app.current.tab].offset?(app.apps[app.current.app].tabs[app.current.tab].offset=app.current.offset,app.apps[app.current.app].tabs[app.current.tab].limit=app.current.limit,app.apps[app.current.app].tabs[app.current.tab].filter=app.current.filter,app.apps[app.current.app].tabs[app.current.tab].sort=app.current.sort,app.apps[app.current.app].tabs[app.current.tab].tag=app.current.tag,app.apps[app.current.app].tabs[app.current.tab].search=app.current.search,app.apps[app.current.app].active=
app.current.tab,app.current.scrollPos=app.apps[app.current.app].tabs[app.current.tab].scrollPos):void 0!==app.apps[app.current.app].tabs[app.current.tab].views[app.current.view].offset&&(app.apps[app.current.app].tabs[app.current.tab].views[app.current.view].offset=app.current.offset,app.apps[app.current.app].tabs[app.current.tab].views[app.current.view].limit=app.current.limit,app.apps[app.current.app].tabs[app.current.tab].views[app.current.view].filter=app.current.filter,app.apps[app.current.app].tabs[app.current.tab].views[app.current.view].sort=
app.current.sort,app.apps[app.current.app].tabs[app.current.tab].views[app.current.view].tag=app.current.tag,app.apps[app.current.app].tabs[app.current.tab].views[app.current.view].search=app.current.search,app.apps[app.current.app].active=app.current.tab,app.apps[app.current.app].tabs[app.current.tab].active=app.current.view,app.current.scrollPos=app.apps[app.current.app].tabs[app.current.tab].views[app.current.view].scrollPos);appPrepare(app.current.scrollPos);if("Home"===app.current.app)sendAPI("MYMPD_API_HOME_LIST",
{},parseHome);else if("Playback"===app.current.app)sendAPI("MPD_API_PLAYER_CURRENT_SONG",{},songChange);else if("Queue"===app.current.app&&"Current"===app.current.tab)selectTag("searchqueuetags","searchqueuetagsdesc",app.current.filter),getQueue();else if("Queue"===app.current.app&&"LastPlayed"===app.current.tab)sendAPI("MPD_API_QUEUE_LAST_PLAYED",{offset:app.current.offset,limit:app.current.limit,cols:settings.colsQueueLastPlayed},parseLastPlayed);else if("Queue"===app.current.app&&"Jukebox"===app.current.tab)sendAPI("MPD_API_JUKEBOX_LIST",
{offset:app.current.offset,limit:app.current.limit,cols:settings.colsQueueJukebox},parseJukeboxList);else if("Browse"===app.current.app&&"Playlists"===app.current.tab&&"All"===app.current.view)sendAPI("MPD_API_PLAYLIST_LIST",{offset:app.current.offset,limit:app.current.limit,searchstr:app.current.search},parsePlaylists),a=document.getElementById("searchPlaylistsStr"),""===a.value&&""!==app.current.search&&(a.value=app.current.search);else if("Browse"===app.current.app&&"Playlists"===app.current.tab&&
"Detail"===app.current.view)sendAPI("MPD_API_PLAYLIST_CONTENT_LIST",{offset:app.current.offset,limit:app.current.limit,searchstr:app.current.search,uri:app.current.filter,cols:settings.colsBrowsePlaylistsDetail},parsePlaylists),a=document.getElementById("searchPlaylistsStr"),""===a.value&&""!==app.current.search&&(a.value=app.current.search);else if("Browse"===app.current.app&&"Filesystem"===app.current.tab){sendAPI("MPD_API_DATABASE_FILESYSTEM_LIST",{offset:app.current.offset,limit:app.current.limit,
path:app.current.search?app.current.search:"/",searchstr:"-"!==app.current.filter?app.current.filter:"",cols:settings.colsBrowseFilesystem},parseFilesystem,!0);app.current.search?(document.getElementById("BrowseFilesystemAddAllSongs").removeAttribute("disabled"),document.getElementById("BrowseFilesystemAddAllSongsBtn").removeAttribute("disabled")):(document.getElementById("BrowseFilesystemAddAllSongs").setAttribute("disabled","disabled"),document.getElementById("BrowseFilesystemAddAllSongsBtn").setAttribute("disabled",
"disabled"));a='<li class="breadcrumb-item"><a data-uri="" class="text-body material-icons">home</a></li>';for(var b=app.current.search.split("/"),c=b.length,f="",h=0;h<c;h++){if(c-1===h){a+='<li class="breadcrumb-item active">'+e(b[h])+"</li>";break}f+=b[h];a+='<li class="breadcrumb-item"><a class="text-body" href="#" data-uri="'+encodeURI(f)+'">'+e(b[h])+"</a></li>";f+="/"}document.getElementById("BrowseBreadcrumb").innerHTML=a;document.getElementById("searchFilesystemStr").value="-"===app.current.filter?
"":app.current.filter}else if("Browse"===app.current.app&&"Database"===app.current.tab&&"List"===app.current.view)if(document.getElementById("viewListDatabase").classList.remove("hide"),document.getElementById("viewDetailDatabase").classList.add("hide"),selectTag("searchDatabaseTags","searchDatabaseTagsDesc",app.current.filter),selectTag("BrowseDatabaseByTagDropdown","btnBrowseDatabaseByTagDesc",app.current.tag),a=app.current.sort,b=!1,"-"===app.current.sort.charAt(0)?(b=!0,a=app.current.sort.substr(1),
toggleBtnChk("databaseSortDesc",!0)):toggleBtnChk("databaseSortDesc",!1),selectTag("databaseSortTags",void 0,a),"Album"===app.current.tag){c=document.getElementById("searchDatabaseCrumb");f=document.getElementById("searchDatabaseStr");h="";for(var d=app.current.search.split(" AND "),g=0;g<d.length-1;g++){var k=d[g].substring(1,d[g].length-1),l=k.match(/^(\w+)\s+(\S+)\s+'(.*)'$/);h+='<button data-filter-tag="'+encodeURI(l[1])+'" data-filter-op="'+encodeURI(l[2])+'" data-filter-value="'+encodeURI(unescapeMPD(l[3]))+
'" class="btn btn-light mr-2">'+e(k)+'<span class="badge badge-secondary">&times</span></button>'}c.innerHTML=h;""===f.value&&1<=d.length&&(h=d[d.length-1].substring(1,d[d.length-1].length-1),d=h.substring(h.indexOf("'")+1,h.length-1),f.value!==d&&(f=h.match(/^(\w+)\s+(\S+)\s+'(.*)'$/),c.innerHTML+='<button data-filter-tag="'+encodeURI(f[1])+'" data-filter-op="'+encodeURI(f[2])+'" data-filter-value="'+encodeURI(unescapeMPD(f[3]))+'" class="btn btn-light mr-2">'+e(h)+'<span class="badge badge-secondary">&times</span></button>'),
document.getElementById("searchDatabaseMatch").value="contains");c.classList.remove("hide");document.getElementById("searchDatabaseMatch").classList.remove("hide");document.getElementById("btnDatabaseSortDropdown").removeAttribute("disabled");document.getElementById("btnDatabaseSearchDropdown").removeAttribute("disabled");sendAPI("MPD_API_DATABASE_GET_ALBUMS",{offset:app.current.offset,limit:app.current.limit,searchstr:app.current.search,filter:app.current.filter,sort:a,sortdesc:b},parseDatabase)}else document.getElementById("searchDatabaseCrumb").classList.add("hide"),
document.getElementById("searchDatabaseMatch").classList.add("hide"),document.getElementById("btnDatabaseSortDropdown").setAttribute("disabled","disabled"),document.getElementById("btnDatabaseSearchDropdown").setAttribute("disabled","disabled"),document.getElementById("searchDatabaseStr").value=app.current.search,sendAPI("MPD_API_DATABASE_TAG_LIST",{offset:app.current.offset,limit:app.current.limit,searchstr:app.current.search,filter:app.current.filter,sort:a,sortdesc:b,tag:app.current.tag},parseDatabase);
else if("Browse"===app.current.app&&"Database"===app.current.tab&&"Detail"===app.current.view)document.getElementById("viewListDatabase").classList.add("hide"),document.getElementById("viewDetailDatabase").classList.remove("hide"),"Album"===app.current.filter&&(a=settings.colsBrowseDatabaseDetail.slice(),!1===a.includes("Disc")&&a.push("Disc"),sendAPI("MPD_API_DATABASE_TAG_ALBUM_TITLE_LIST",{album:app.current.tag,searchstr:app.current.search,tag:app.current.sort,cols:a},parseAlbumDetails));else if("Search"===
app.current.app){domCache.searchstr.focus();if(settings.featAdvsearch){a="";b=app.current.search.substring(1,app.current.search.length-1).split(" AND ");for(c=0;c<b.length-1;c++)f=b[c].substring(1,b[c].length-1),h=f.match(/^(\w+)\s+(\S+)\s+'(.*)'$/),a+='<button data-filter-tag="'+encodeURI(h[1])+'" data-filter-op="'+encodeURI(h[2])+'" data-filter-value="'+encodeURI(unescapeMPD(h[3]))+'" class="btn btn-light mr-2">'+e(f)+'<span class="badge badge-secondary">&times</span></button>';domCache.searchCrumb.innerHTML=
a;""===domCache.searchstr.value&&1<=b.length&&(a=b[b.length-1].substring(1,b[b.length-1].length-1),b=a.substring(a.indexOf("'")+1,a.length-1),domCache.searchstr.value!==b&&(b=a.match(/^(\w+)\s+(\S+)\s+'(.*)'$/),domCache.searchCrumb.innerHTML+='<button data-filter-tag="'+encodeURI(b[1])+'" data-filter-op="'+encodeURI(b[2])+'" data-filter-value="'+encodeURI(unescapeMPD(b[3]))+'" class="btn btn-light mr-2">'+e(a)+'<span class="badge badge-secondary">&times</span></button>'),a=a.substring(a.indexOf(" ")+
1),a=a.substring(0,a.indexOf(" ")),""===a&&(a="contains"),document.getElementById("searchMatch").value=a)}else""===domCache.searchstr.value&&""!==app.current.search&&(domCache.searchstr.value=app.current.search);app.last.app!==app.current.app&&""!==app.current.search&&(a=settings["cols"+app.current.app].length,a--,document.getElementById("SearchList").getElementsByTagName("tbody")[0].innerHTML='<tr><td><span class="material-icons">search</span></td><td colspan="'+a+'">'+t("Searching...")+"</td></tr>");
2<=domCache.searchstr.value.length||0<domCache.searchCrumb.children.length?settings.featAdvsearch?(a=app.current.sort,b=!1,"-"===a?(a=settings.tags.includes("Title")?"Title":"-",document.getElementById("SearchList").setAttribute("data-sort",a)):0===a.indexOf("-")&&(b=!0,a=a.substring(1)),sendAPI("MPD_API_DATABASE_SEARCH_ADV",{plist:"",offset:app.current.offset,limit:app.current.limit,sort:a,sortdesc:b,expression:app.current.search,cols:settings.colsSearch,replace:!1},parseSearch)):sendAPI("MPD_API_DATABASE_SEARCH",
{plist:"",offset:app.current.offset,limit:app.current.limit,filter:app.current.filter,searchstr:app.current.search,cols:settings.colsSearch,replace:!1},parseSearch):(document.getElementById("SearchList").getElementsByTagName("tbody")[0].innerHTML="",document.getElementById("searchAddAllSongs").setAttribute("disabled","disabled"),document.getElementById("searchAddAllSongsBtn").setAttribute("disabled","disabled"),document.getElementById("SearchList").classList.remove("opacity05"),setPagination(0,0));
selectTag("searchtags","searchtagsdesc",app.current.filter)}else appGoto("Home");app.last.app=app.current.app;app.last.tab=app.current.tab;app.last.view=app.current.view}else appPrepare(0),!0===settings.featHome?appGoto("Home"):appGoto("Playback")}}
function showAppInitAlert(a){document.getElementById("splashScreenAlert").innerHTML='<p class="text-danger">'+t(a)+'</p><p><a id="appReloadBtn" class="btn btn-danger text-light clickable">'+t("Reload")+"</a></p>";document.getElementById("appReloadBtn").addEventListener("click",function(){clearAndReload()},!1)}function clearAndReload(){"serviceWorker"in navigator&&caches.keys().then(function(a){a.forEach(function(b){caches.delete(b)})});location.reload()}
function a2hsInit(){window.addEventListener("beforeinstallprompt",function(a){logDebug("Event: beforeinstallprompt");a.preventDefault();deferredA2HSprompt=a;domCache.btnA2HS.classList.remove("hide")});domCache.btnA2HS.addEventListener("click",function(){domCache.btnA2HS.classList.add("hide");deferredA2HSprompt.prompt();deferredA2HSprompt.userChoice.then(function(a){"accepted"===a.outcome?logDebug("User accepted the A2HS prompt"):logDebug("User dismissed the A2HS prompt");deferredA2HSprompt=null})});
window.addEventListener("appinstalled",function(){logInfo("myMPD installed as app");showNotification(t("myMPD installed as app"),"","","success")})}
function appInitStart(){window.addEventListener("hashchange",appRoute,!1);if(!0===isMobile)scale=localStorage.getItem("scale-ratio"),null===scale&&(scale="1.0"),setViewport(!1);else for(var a=document.getElementsByClassName("featMobile"),b=0;b<a.length;b++)a[b].classList.add("hide");subdir=window.location.pathname.replace("/index.html","").replace(/\/$/,"");a='<option value="default" data-phrase="Browser default"></option>';for(b=0;b<locales.length;b++)a+='<option value="'+e(locales[b].code)+'">'+
e(locales[b].desc)+" ("+e(locales[b].code)+")</option>";document.getElementById("selectLocale").innerHTML=a;i18nHtml(document.getElementById("splashScreenAlert"));a=document.getElementsByTagName("script")[0].src.replace(/^.*[/]/,"");"combined.js"!==a&&(settings.loglevel=4);"serviceWorker"in navigator&&"https:"===window.location.protocol&&"localhost"!==window.location.hostname&&"combined.js"===a&&window.addEventListener("load",function(){navigator.serviceWorker.register("/sw.js",{scope:"/"}).then(function(c){logInfo("ServiceWorker registration successful.");
c.update()},function(c){logError("ServiceWorker registration failed: "+c)})});appInited=!1;document.getElementById("splashScreen").classList.remove("hide");document.getElementsByTagName("body")[0].classList.add("overflow-hidden");document.getElementById("splashScreenAlert").innerText=t("Fetch myMPD settings");a2hsInit();getSettings(!0);appInitWait()}
function appInitWait(){setTimeout(function(){if("true"===settingsParsed&&!0===websocketConnected)document.getElementById("splashScreenAlert").innerText=t("Applying settings"),document.getElementById("splashScreen").classList.add("hide-fade"),setTimeout(function(){document.getElementById("splashScreen").classList.add("hide");document.getElementById("splashScreen").classList.remove("hide-fade");document.getElementsByTagName("body")[0].classList.remove("overflow-hidden")},500),appInit(),appInited=!0;
else{if("true"===settingsParsed)document.getElementById("splashScreenAlert").innerText=t("Connect to websocket"),webSocketConnect();else if("error"===settingsParsed)return;appInitWait()}},500)}
function appInit(){document.getElementById("mainMenu").addEventListener("click",function(d){d.preventDefault()},!1);document.getElementById("btnChVolumeDown").addEventListener("click",function(d){d.stopPropagation()},!1);document.getElementById("btnChVolumeUp").addEventListener("click",function(d){d.stopPropagation()},!1);domCache.volumeBar.addEventListener("click",function(d){d.stopPropagation()},!1);domCache.volumeBar.addEventListener("change",function(){sendAPI("MPD_API_PLAYER_VOLUME_SET",{volume:domCache.volumeBar.value})},
!1);domCache.progress.addEventListener("click",function(d){currentSong&&0<=currentSong.currentSongId&&0<currentSong.totalTime&&(domCache.progressBar.style.transition="none",domCache.progressBar.style.width=d.clientX+"px",setTimeout(function(){domCache.progressBar.style.transition=progressBarTransition},10),sendAPI("MPD_API_PLAYER_SEEK",{songid:currentSong.currentSongId,seek:Math.ceil(currentSong.totalTime*d.clientX/d.target.offsetWidth)}))},!1);domCache.progress.addEventListener("mousemove",function(d){if(("pause"===
playstate||"play"===playstate)&&0<currentSong.totalTime){domCache.progressPos.innerText=beautifySongDuration(Math.ceil(currentSong.totalTime/d.target.offsetWidth*d.clientX));domCache.progressPos.style.display="block";var g=domCache.progressPos.offsetWidth/2;domCache.progressPos.style.left=(d.clientX<g?d.clientX:d.clientX<window.innerWidth-g?d.clientX-g:d.clientX-2*g)+"px"}},!1);domCache.progress.addEventListener("mouseout",function(){domCache.progressPos.style.display="none"},!1);for(var a=document.querySelectorAll(".subMenu"),
b=a.length,c=0;c<b;c++)a[c].addEventListener("click",function(d){d.stopPropagation();d.preventDefault();d=this.getElementsByTagName("span")[0];d.innerText="keyboard_arrow_right"===d.innerText?"keyboard_arrow_down":"keyboard_arrow_right"},!1);document.getElementById("navbar-main").addEventListener("click",function(d){d.preventDefault();var g=d.target.getAttribute("data-href");null===g&&(g=d.target.parentNode.getAttribute("data-href"));null!==g&&parseCmd(d,g)},!1);document.getElementById("volumeMenu").parentNode.addEventListener("show.bs.dropdown",
function(){sendAPI("MPD_API_PLAYER_OUTPUT_LIST",{},parseOutputs)});document.getElementById("btnDropdownNeighbors").parentNode.addEventListener("show.bs.dropdown",function(){!0===settings.featNeighbors?sendAPI("MPD_API_MOUNT_NEIGHBOR_LIST",{},parseNeighbors,!0):document.getElementById("dropdownNeighbors").children[0].innerHTML='<div class="list-group-item"><span class="material-icons">warning</span> '+t("Neighbors are disabled")+"</div>"});document.getElementById("dropdownNeighbors").children[0].addEventListener("click",
function(d){d.preventDefault();"A"===d.target.nodeName&&(d=d.target.getAttribute("data-value").match(/^(\w+:\/\/)(.+)$/),document.getElementById("selectMountUrlhandler").value=d[1],document.getElementById("inputMountUrl").value=d[2])});document.getElementById("BrowseFilesystemBookmark").parentNode.addEventListener("show.bs.dropdown",function(){sendAPI("MYMPD_API_BOOKMARK_LIST",{offset:0,limit:0},parseBookmarks)});document.getElementById("playDropdown").parentNode.addEventListener("show.bs.dropdown",
function(){showPlayDropdown()});document.getElementById("playDropdown").addEventListener("click",function(d){d.preventDefault();d.stopPropagation()});a=document.querySelectorAll(".dropdown-toggle");for(b=0;b<a.length;b++)a[b].parentNode.addEventListener("show.bs.dropdown",function(){alignDropdown(this)});document.getElementById("modalTimer").addEventListener("shown.bs.modal",function(){showListTimer()});document.getElementById("modalMounts").addEventListener("shown.bs.modal",function(){showListMounts()});
document.getElementById("modalScripts").addEventListener("shown.bs.modal",function(){showListScripts()});document.getElementById("modalTrigger").addEventListener("shown.bs.modal",function(){showListTrigger()});document.getElementById("modalPartitions").addEventListener("shown.bs.modal",function(){showListPartitions()});document.getElementById("modalPartitionOutputs").addEventListener("shown.bs.modal",function(){sendAPI("MPD_API_PLAYER_OUTPUT_LIST",{partition:"default"},parsePartitionOutputsList,!1)});
document.getElementById("modalAbout").addEventListener("shown.bs.modal",function(){sendAPI("MPD_API_DATABASE_STATS",{},parseStats);getServerinfo();var d="",g;for(g in keymap)if(void 0===keymap[g].req||!0===settings[keymap[g].req])d+='<tr><td><div class="key'+(keymap[g].key&&1<keymap[g].key.length?" material-icons material-icons-small":"")+'">'+(void 0!==keymap[g].key?keymap[g].key:g)+"</div></td><td>"+t(keymap[g].desc)+"</td></tr>";document.getElementById("tbodyShortcuts").innerHTML=d});document.getElementById("modalAddToPlaylist").addEventListener("shown.bs.modal",
function(){document.getElementById("addStreamFrm").classList.contains("hide")?document.getElementById("addToPlaylistPlaylist").focus():(document.getElementById("streamUrl").focus(),document.getElementById("streamUrl").value="")});document.getElementById("inputTimerVolume").addEventListener("change",function(){document.getElementById("textTimerVolume").innerHTML=this.value+"&nbsp;%"},!1);document.getElementById("selectTimerAction").addEventListener("change",function(){selectTimerActionChange()},!1);
document.getElementById("selectTriggerScript").addEventListener("change",function(){selectTriggerActionChange()},!1);a="";for(b=0;24>b;b++)a+='<option value="'+b+'">'+zeroPad(b,2)+"</option>";document.getElementById("selectTimerHour").innerHTML=a;a="";for(b=0;60>b;b+=5)a+='<option value="'+b+'">'+zeroPad(b,2)+"</option>";document.getElementById("selectTimerMinute").innerHTML=a;document.getElementById("inputHighlightColor").addEventListener("change",function(){document.getElementById("highlightColorPreview").style.backgroundColor=
this.value},!1);document.getElementById("inputBgColor").addEventListener("change",function(){document.getElementById("bgColorPreview").style.backgroundColor=this.value},!1);document.getElementById("selectTheme").addEventListener("change",function(){var d=getSelectValue(this);"theme-default"===d?document.getElementById("inputBgColor").value="#ccc":"theme-light"===d?document.getElementById("inputBgColor").value="#fff":"theme-dark"===d&&(document.getElementById("inputBgColor").value="#000");document.getElementById("bgColorPreview").style.backgroundColor=
document.getElementById("inputBgColor").value},!1);document.getElementById("modalAddToQueue").addEventListener("shown.bs.modal",function(){document.getElementById("inputAddToQueueQuantity").classList.remove("is-invalid");document.getElementById("warnJukeboxPlaylist2").classList.add("hide");!0===settings.featPlaylists&&sendAPI("MPD_API_PLAYLIST_LIST",{searchstr:"",offset:0,limit:0},function(d){getAllPlaylists(d,"selectAddToQueuePlaylist")})});document.getElementById("modalUpdateDB").addEventListener("hidden.bs.modal",
function(){document.getElementById("updateDBprogress").classList.remove("updateDBprogressAnimate")});document.getElementById("modalSaveQueue").addEventListener("shown.bs.modal",function(){var d=document.getElementById("saveQueueName");d.focus();d.value="";d.classList.remove("is-invalid")});document.getElementById("modalSettings").addEventListener("shown.bs.modal",function(){getSettings();document.getElementById("inputCrossfade").classList.remove("is-invalid");document.getElementById("inputMixrampdb").classList.remove("is-invalid");
document.getElementById("inputMixrampdelay").classList.remove("is-invalid");document.getElementById("inputScaleRatio").classList.remove("is-invalid")});document.getElementById("modalConnection").addEventListener("shown.bs.modal",function(){getSettings();document.getElementById("inputMpdHost").classList.remove("is-invalid");document.getElementById("inputMpdPort").classList.remove("is-invalid");document.getElementById("inputMpdPass").classList.remove("is-invalid")});document.getElementById("btnJukeboxModeGroup").addEventListener("mouseup",
function(){setTimeout(function(){var d=document.getElementById("btnJukeboxModeGroup").getElementsByClassName("active")[0].getAttribute("data-value");"0"===d?(document.getElementById("inputJukeboxQueueLength").setAttribute("disabled","disabled"),document.getElementById("selectJukeboxPlaylist").setAttribute("disabled","disabled")):"2"===d?(document.getElementById("inputJukeboxQueueLength").setAttribute("disabled","disabled"),document.getElementById("selectJukeboxPlaylist").setAttribute("disabled","disabled"),
document.getElementById("selectJukeboxPlaylist").value="Database"):"1"===d&&(document.getElementById("inputJukeboxQueueLength").removeAttribute("disabled"),document.getElementById("selectJukeboxPlaylist").removeAttribute("disabled"));"0"!==d&&toggleBtnChk("btnConsume",!0);checkConsume()},100)});document.getElementById("btnConsume").addEventListener("mouseup",function(){setTimeout(function(){checkConsume()},100)});document.getElementById("btnStickers").addEventListener("mouseup",function(){setTimeout(function(){document.getElementById("btnStickers").classList.contains("active")?
(document.getElementById("warnPlaybackStatistics").classList.add("hide"),document.getElementById("inputJukeboxLastPlayed").removeAttribute("disabled")):(document.getElementById("warnPlaybackStatistics").classList.remove("hide"),document.getElementById("inputJukeboxLastPlayed").setAttribute("disabled","disabled"))},100)});document.getElementById("selectAddToQueueMode").addEventListener("change",function(){var d=this.options[this.selectedIndex].value;"2"===d?(document.getElementById("inputAddToQueueQuantity").setAttribute("disabled",
"disabled"),document.getElementById("inputAddToQueueQuantity").value="1",document.getElementById("selectAddToQueuePlaylist").setAttribute("disabled","disabled"),document.getElementById("selectAddToQueuePlaylist").value="Database"):"1"===d&&(document.getElementById("inputAddToQueueQuantity").removeAttribute("disabled"),document.getElementById("selectAddToQueuePlaylist").removeAttribute("disabled"))});document.getElementById("addToPlaylistPlaylist").addEventListener("change",function(){"new"===this.options[this.selectedIndex].value?
(document.getElementById("addToPlaylistNewPlaylistDiv").classList.remove("hide"),document.getElementById("addToPlaylistNewPlaylist").focus()):document.getElementById("addToPlaylistNewPlaylistDiv").classList.add("hide")},!1);document.getElementById("selectMusicDirectory").addEventListener("change",function(){"auto"===this.options[this.selectedIndex].value?(document.getElementById("inputMusicDirectory").value=settings.musicDirectoryValue,document.getElementById("inputMusicDirectory").setAttribute("readonly",
"readonly")):"none"===this.options[this.selectedIndex].value?(document.getElementById("inputMusicDirectory").value="",document.getElementById("inputMusicDirectory").setAttribute("readonly","readonly")):(document.getElementById("inputMusicDirectory").value="",document.getElementById("inputMusicDirectory").removeAttribute("readonly"))},!1);document.getElementById("syscmds").addEventListener("click",function(d){"A"===d.target.nodeName&&parseCmd(d,d.target.getAttribute("data-href"))},!1);document.getElementById("scripts").addEventListener("click",
function(d){"A"===d.target.nodeName&&execScript(d.target.getAttribute("data-href"))},!1);a=document.querySelectorAll("[data-href]");b=a.length;for(c=0;c<b;c++){!1===a[c].classList.contains("notclickable")&&a[c].classList.add("clickable");var f=a[c].parentNode.classList.contains("noInitChilds")?!0:!1;!1===f&&(f=a[c].parentNode.parentNode.classList.contains("noInitChilds")?!0:!1);!0!==f&&a[c].addEventListener("click",function(d){parseCmd(d,this.getAttribute("data-href"))},!1)}document.getElementById("HomeCards").addEventListener("click",
function(d){if(d.target.classList.contains("card-body")){var g=d.target.parentNode.getAttribute("data-href");null!==g&&parseCmd(d,g)}else if(d.target.classList.contains("card-footer")){g=document.getElementById("HomeCards").getElementsByClassName("selected");for(var k=0;k<g.length;k++)g[k].classList.remove("selected");d.target.parentNode.classList.add("selected");showMenu(d.target,d);d.stopPropagation()}},!1);document.getElementById("HomeCards").addEventListener("keydown",function(d){navigateGrid(d.target,
d.key)},!1);dragAndDropHome();document.getElementById("selectHomeIconCmd").addEventListener("change",function(){showHomeIconCmdOptions()},!1);document.getElementById("inputHomeIconLigature").addEventListener("change",function(d){document.getElementById("homeIconPreview").innerText=d.target.value;""!==d.target.value&&(document.getElementById("selectHomeIconImage").value="",document.getElementById("homeIconPreview").style.backgroundImage="")},!1);document.getElementById("inputHomeIconBgcolor").addEventListener("change",
function(d){document.getElementById("homeIconPreview").style.backgroundColor=d.target.value},!1);document.getElementById("selectHomeIconImage").addEventListener("change",function(d){d=getSelectValue(d.target);document.getElementById("homeIconPreview").style.backgroundImage='url("'+subdir+"/browse/pics/"+d+'")';""!==d?(document.getElementById("divHomeIconLigature").classList.add("hide"),document.getElementById("homeIconPreview").innerHTML=""):(document.getElementById("divHomeIconLigature").classList.remove("hide"),
document.getElementById("homeIconPreview").innerText=document.getElementById("inputHomeIconLigature").value)},!1);document.getElementById("cardPlaybackTags").addEventListener("click",function(d){"P"===d.target.nodeName&&gotoBrowse()},!1);document.getElementById("BrowseBreadcrumb").addEventListener("click",function(d){"A"===d.target.nodeName&&(d.preventDefault(),appGoto("Browse","Filesystem",void 0,"0",app.current.limit,app.current.filter,app.current.sort,"-",decodeURI(d.target.getAttribute("data-uri"))))},
!1);document.getElementById("tbodySongDetails").addEventListener("click",function(d){if("A"===d.target.nodeName)if("calcFingerprint"===d.target.id){sendAPI("MPD_API_DATABASE_FINGERPRINT",{uri:decodeURI(d.target.getAttribute("data-uri"))},parseFingerprint);d.preventDefault();var g=d.target.parentNode,k=document.createElement("div");k.classList.add("spinner-border","spinner-border-sm");d.target.classList.add("hide");g.appendChild(k)}else d.target.classList.contains("external")||null===d.target.parentNode.getAttribute("data-tag")||
(modalSongDetails.hide(),d.preventDefault(),gotoBrowse());else"BUTTON"===d.target.nodeName&&d.target.getAttribute("data-href")&&parseCmd(d,d.target.getAttribute("data-href"))},!1);document.getElementById("outputs").addEventListener("click",function(d){"BUTTON"===d.target.nodeName?(d.stopPropagation(),d.preventDefault(),sendAPI("MPD_API_PLAYER_TOGGLE_OUTPUT",{output:d.target.getAttribute("data-output-id"),state:d.target.classList.contains("active")?0:1}),toggleBtn(d.target.id)):"A"===d.target.nodeName&&
(d.preventDefault(),showListOutputAttributes(decodeURI(d.target.parentNode.getAttribute("data-output-name"))))},!1);document.getElementById("listTimerList").addEventListener("click",function(d){d.stopPropagation();d.preventDefault();"TD"===d.target.nodeName?d.target.parentNode.classList.contains("not-clickable")||showEditTimer(d.target.parentNode.getAttribute("data-id")):"A"===d.target.nodeName?deleteTimer(d.target.parentNode.parentNode.getAttribute("data-id")):"BUTTON"===d.target.nodeName&&toggleTimer(d.target,
d.target.parentNode.parentNode.getAttribute("data-id"))},!1);document.getElementById("listMountsList").addEventListener("click",function(d){d.stopPropagation();d.preventDefault();if("TD"===d.target.nodeName){if(""===d.target.parentNode.getAttribute("data-point"))return!1;showEditMount(decodeURI(d.target.parentNode.getAttribute("data-url")),decodeURI(d.target.parentNode.getAttribute("data-point")))}else if("A"===d.target.nodeName){var g=d.target.getAttribute("data-action"),k=decodeURI(d.target.parentNode.parentNode.getAttribute("data-point"));
"unmount"===g?unmountMount(k):"update"===g&&updateMount(d.target,k)}},!1);document.getElementById("listScriptsList").addEventListener("click",function(d){d.stopPropagation();d.preventDefault();if("TD"===d.target.nodeName){if(!1===settings.featScripteditor||""===d.target.parentNode.getAttribute("data-script"))return!1;showEditScript(decodeURI(d.target.parentNode.getAttribute("data-script")))}else if("A"===d.target.nodeName){var g=d.target.getAttribute("data-action"),k=decodeURI(d.target.parentNode.parentNode.getAttribute("data-script"));
"delete"===g?deleteScript(k):"execute"===g?execScript(d.target.getAttribute("data-href")):"add2home"===g&&addScriptToHome(k,d.target.getAttribute("data-href"))}},!1);document.getElementById("listTriggerList").addEventListener("click",function(d){d.stopPropagation();d.preventDefault();if("TD"===d.target.nodeName){var g=decodeURI(d.target.parentNode.getAttribute("data-trigger-id"));showEditTrigger(g)}else"A"===d.target.nodeName&&(g=d.target.getAttribute("data-action"),d=decodeURI(d.target.parentNode.parentNode.getAttribute("data-trigger-id")),
"delete"===g&&deleteTrigger(d))},!1);document.getElementById("listPartitionsList").addEventListener("click",function(d){d.stopPropagation();d.preventDefault();if("A"===d.target.nodeName){var g=d.target.getAttribute("data-action");d=decodeURI(d.target.parentNode.parentNode.getAttribute("data-partition"));"delete"===g?deletePartition(d):"switch"===g&&switchPartition(d)}},!1);document.getElementById("partitionOutputsList").addEventListener("click",function(d){d.stopPropagation();d.preventDefault();"TD"===
d.target.nodeName&&(d=decodeURI(d.target.parentNode.getAttribute("data-output")),moveOutput(d),modalPartitionOutputs.hide())},!1);document.getElementById("QueueCurrentList").addEventListener("click",function(d){"TD"===d.target.nodeName?sendAPI("MPD_API_PLAYER_PLAY_TRACK",{track:d.target.parentNode.getAttribute("data-trackid")}):"A"===d.target.nodeName&&showMenu(d.target,d)},!1);document.getElementById("QueueLastPlayedList").addEventListener("click",function(d){"A"===d.target.nodeName&&showMenu(d.target,
d)},!1);document.getElementById("QueueJukeboxList").addEventListener("click",function(d){"A"===d.target.nodeName&&showMenu(d.target,d)},!1);document.getElementById("BrowseFilesystemList").addEventListener("click",function(d){if("TD"===d.target.nodeName)switch(d.target.parentNode.getAttribute("data-type")){case "parentDir":case "dir":app.current.filter="-";appGoto("Browse","Filesystem",void 0,"0",app.current.limit,app.current.filter,app.current.sort,"-",decodeURI(d.target.parentNode.getAttribute("data-uri")));
break;case "song":appendQueue("song",decodeURI(d.target.parentNode.getAttribute("data-uri")),d.target.parentNode.getAttribute("data-name"));break;case "plist":appendQueue("plist",decodeURI(d.target.parentNode.getAttribute("data-uri")),d.target.parentNode.getAttribute("data-name"))}else"A"===d.target.nodeName&&showMenu(d.target,d)},!1);document.getElementById("BrowseFilesystemBookmarks").addEventListener("click",function(d){if("A"===d.target.nodeName){var g=d.target.parentNode.parentNode.getAttribute("data-id"),
k=d.target.parentNode.parentNode.getAttribute("data-type"),l=decodeURI(d.target.parentNode.parentNode.getAttribute("data-uri")),m=d.target.parentNode.parentNode.firstChild.innerText,n=d.target.getAttribute("data-href");"delete"===n?(sendAPI("MYMPD_API_BOOKMARK_RM",{id:g},function(){sendAPI("MYMPD_API_BOOKMARK_LIST",{offset:0,limit:0},parseBookmarks)}),d.preventDefault(),d.stopPropagation()):"edit"===n?showBookmarkSave(g,m,l,k):"goto"===n&&appGoto("Browse","Filesystem",void 0,"0",void 0,"-","-","-",
l)}},!1);document.getElementById("BrowsePlaylistsAllList").addEventListener("click",function(d){"TD"===d.target.nodeName?appendQueue("plist",decodeURI(d.target.parentNode.getAttribute("data-uri")),d.target.parentNode.getAttribute("data-name")):"A"===d.target.nodeName&&showMenu(d.target,d)},!1);document.getElementById("BrowsePlaylistsDetailList").addEventListener("click",function(d){"TD"===d.target.nodeName?appendQueue("plist",decodeURI(d.target.parentNode.getAttribute("data-uri")),d.target.parentNode.getAttribute("data-name")):
"A"===d.target.nodeName&&showMenu(d.target,d)},!1);document.getElementById("SearchList").addEventListener("click",function(d){"TD"===d.target.nodeName?appendQueue("song",decodeURI(d.target.parentNode.getAttribute("data-uri")),d.target.parentNode.getAttribute("data-name")):"A"===d.target.nodeName&&showMenu(d.target,d)},!1);document.getElementById("BrowseDatabaseCards").addEventListener("click",function(d){if("Album"===app.current.tag)if(d.target.classList.contains("card-body"))appGoto("Browse","Database",
"Detail","0",void 0,"Album","AlbumArtist",decodeURI(d.target.parentNode.getAttribute("data-album")),decodeURI(d.target.parentNode.getAttribute("data-albumartist")));else{if(d.target.classList.contains("card-footer")){showMenu(d.target,d);for(var g=document.getElementById("BrowseDatabaseCards").getElementsByClassName("selected"),k=0;k<g.length;k++)g[k].classList.remove("selected");d.target.parentNode.classList.add("selected")}}else app.current.search="",document.getElementById("searchDatabaseStr").value=
"",appGoto(app.current.app,app.current.card,void 0,"0",void 0,"Album","AlbumArtist","Album","("+app.current.tag+" == '"+decodeURI(d.target.parentNode.getAttribute("data-tag"))+"')")},!1);document.getElementById("BrowseDatabaseCards").addEventListener("keydown",function(d){navigateGrid(d.target,d.key)},!1);!1===isMobile&&(document.getElementById("BrowseDatabaseCards").addEventListener("mouseover",function(d){if(d.target.classList.contains("card-body")&&0===d.target.childNodes.length){var g=document.getElementById("BrowseDatabaseCards").getElementsByClassName("album-grid-mouseover");
if(1<g.length)for(var k=0;k<g.length;k++)g[k].remove();addPlayButton(d.target)}},!1),document.getElementById("BrowseDatabaseCards").addEventListener("mouseout",function(d){!d.target.classList.contains("card-body")||null!==d.relatedTarget&&d.relatedTarget.classList.contains("album-grid-mouseover")||(d.target.innerHTML="")},!1));document.getElementById("BrowseDatabaseDetailList").addEventListener("click",function(d){"TD"===d.target.nodeName?appendQueue("song",decodeURI(d.target.parentNode.getAttribute("data-uri")),
d.target.parentNode.getAttribute("data-name")):"A"===d.target.nodeName&&showMenu(d.target,d)},!1);document.getElementById("searchtags").addEventListener("click",function(d){"BUTTON"===d.target.nodeName&&(app.current.filter=d.target.getAttribute("data-tag"),doSearch(domCache.searchstr.value))},!1);document.getElementById("searchDatabaseTags").addEventListener("click",function(d){"BUTTON"===d.target.nodeName&&(app.current.filter=d.target.getAttribute("data-tag"),appGoto(app.current.app,app.current.tab,
app.current.view,"0",app.current.limit,app.current.filter,app.current.sort,app.current.tag,app.current.search))},!1);document.getElementById("databaseSortDesc").addEventListener("click",function(d){toggleBtnChk(this);d.stopPropagation();d.preventDefault();"-"===app.current.sort.charAt(0)?app.current.sort=app.current.sort.substr(1):app.current.sort="-"+app.current.sort;appGoto(app.current.app,app.current.tab,app.current.view,"0",app.current.limit,app.current.filter,app.current.sort,app.current.tag,
app.current.search)},!1);document.getElementById("databaseSortTags").addEventListener("click",function(d){"BUTTON"===d.target.nodeName&&(d.preventDefault(),d.stopPropagation(),app.current.sort=d.target.getAttribute("data-tag"),appGoto(app.current.app,app.current.tab,app.current.view,"0",app.current.limit,app.current.filter,app.current.sort,app.current.tag,app.current.search))},!1);document.getElementById("BrowseDatabaseByTagDropdown").addEventListener("click",function(d){navBrowseHandler(d)},!1);
document.getElementById("BrowseNavPlaylistsDropdown").addEventListener("click",function(d){navBrowseHandler(d)},!1);document.getElementById("BrowseNavFilesystemDropdown").addEventListener("click",function(d){navBrowseHandler(d)},!1);document.getElementById("dropdownSortPlaylistTags").addEventListener("click",function(d){"BUTTON"===d.target.nodeName&&(d.preventDefault(),playlistSort(d.target.getAttribute("data-tag")))},!1);document.getElementById("searchqueuestr").addEventListener("keyup",function(d){"Escape"===
d.key?this.blur():appGoto(app.current.app,app.current.tab,app.current.view,"0",app.current.limit,app.current.filter,app.current.sort,"-",this.value)},!1);document.getElementById("searchqueuetags").addEventListener("click",function(d){"BUTTON"===d.target.nodeName&&appGoto(app.current.app,app.current.tab,app.current.view,app.current.offset,app.current.limit,d.target.getAttribute("data-tag"),app.current.sort,"-",app.current.search)},!1);document.getElementById("searchFilesystemStr").addEventListener("keyup",
function(d){"Escape"===d.key?this.blur():appGoto(app.current.app,app.current.tab,app.current.view,"0",app.current.limit,""!==this.value?this.value:"-",app.current.sort,"-",app.current.search)},!1);document.getElementById("searchPlaylistsStr").addEventListener("keyup",function(d){"Escape"===d.key?this.blur():appGoto(app.current.app,app.current.tab,app.current.view,"0",app.current.limit,app.current.filter,app.current.sort,"-",this.value)},!1);a=["PlaybackColsDropdown"];for(b=0;b<a.length;b++)document.getElementById(a[b]).addEventListener("click",
function(d){"BUTTON"===d.target.nodeName&&d.target.classList.contains("material-icons")&&(d.stopPropagation(),d.preventDefault(),toggleBtnChk(d.target))},!1);a=["search","searchqueue","searchdatabase"];for(b=0;b<a.length;b++)document.getElementById(a[b]).addEventListener("submit",function(d){d.preventDefault()},!1);document.getElementById("searchDatabaseStr").addEventListener("keyup",function(d){if("Escape"===d.key)this.blur();else if("Enter"===d.key&&"Album"===app.current.tag)if(""!==this.value){d=
document.getElementById("searchDatabaseMatch");var g=document.createElement("button");g.classList.add("btn","btn-light","mr-2");g.setAttribute("data-filter-tag",encodeURI(app.current.filter));g.setAttribute("data-filter-op",encodeURI(d.options[d.selectedIndex].value));g.setAttribute("data-filter-value",encodeURI(this.value));g.innerHTML=e(app.current.filter)+" "+e(d.options[d.selectedIndex].value)+" '"+e(this.value)+'\'<span class="ml-2 badge badge-secondary">&times;</span>';this.value="";document.getElementById("searchDatabaseCrumb").appendChild(g)}else searchAlbumgrid(this.value);
else"Album"===app.current.tag?searchAlbumgrid(this.value):appGoto(app.current.app,app.current.tab,app.current.view,"0",app.current.limit,app.current.filter,app.current.sort,app.current.tag,this.value)},!1);document.getElementById("searchDatabaseCrumb").addEventListener("click",function(d){"SPAN"===d.target.nodeName?(d.preventDefault(),d.stopPropagation(),d.target.parentNode.remove(),searchAlbumgrid("")):"BUTTON"===d.target.nodeName&&(d.preventDefault(),d.stopPropagation(),selectTag("searchDatabaseTags",
"searchDatabaseTagsDesc",decodeURI(d.target.getAttribute("data-filter-tag"))),document.getElementById("searchDatabaseStr").value=unescapeMPD(decodeURI(d.target.getAttribute("data-filter-value"))),document.getElementById("searchDatabaseMatch").value=decodeURI(d.target.getAttribute("data-filter-op")),d.target.remove(),searchAlbumgrid(document.getElementById("searchDatabaseStr").value))},!1);domCache.searchstr.addEventListener("keyup",function(d){if("Escape"===d.key)this.blur();else if("Enter"===d.key&&
settings.featAdvsearch)if(""!==this.value){d=document.getElementById("searchMatch");var g=document.createElement("button");g.classList.add("btn","btn-light","mr-2");g.setAttribute("data-filter-tag",encodeURI(app.current.filter));g.setAttribute("data-filter-op",encodeURI(d.options[d.selectedIndex].value));g.setAttribute("data-filter-value",encodeURI(this.value));g.innerHTML=e(app.current.filter)+" "+e(d.options[d.selectedIndex].value)+" '"+e(this.value)+'\'<span class="ml-2 badge badge-secondary">&times;</span>';
this.value="";domCache.searchCrumb.appendChild(g)}else doSearch(this.value);else doSearch(this.value)},!1);domCache.searchCrumb.addEventListener("click",function(d){"SPAN"===d.target.nodeName?(d.preventDefault(),d.stopPropagation(),d.target.parentNode.remove(),doSearch("")):"BUTTON"===d.target.nodeName&&(d.preventDefault(),d.stopPropagation(),domCache.searchstr.value=unescapeMPD(decodeURI(d.target.getAttribute("data-filter-value"))),selectTag("searchtags","searchtagsdesc",decodeURI(d.target.getAttribute("data-filter-tag"))),
document.getElementById("searchMatch").value=decodeURI(d.target.getAttribute("data-filter-op")),d.target.remove(),doSearch(domCache.searchstr.value))},!1);document.getElementById("searchMatch").addEventListener("change",function(){doSearch(domCache.searchstr.value)},!1);document.getElementById("SearchList").getElementsByTagName("tr")[0].addEventListener("click",function(d){if(settings.featAdvsearch&&"TH"===d.target.nodeName&&""!==d.target.innerHTML){var g=d.target.getAttribute("data-col");if("Duration"!==
g){var k=app.current.sort,l=!0;if(k===g||k==="-"+g)0===k.indexOf("-")?(l=!0,g=k.substring(1)):l=!1;!1===l?(k="-"+g,l=!0):(l=!1,k=g);for(var m=document.getElementById("SearchList").getElementsByClassName("sort-dir"),n=0;n<m.length;n++)m[n].remove();app.current.sort=k;d.target.innerHTML=t(g)+'<span class="sort-dir material-icons pull-right">'+(!0===l?"arrow_drop_up":"arrow_drop_down")+"</span>";appGoto(app.current.app,app.current.tab,app.current.view,app.current.offset,app.current.limit,app.current.filter,
app.current.sort,"-",app.current.search)}}},!1);document.getElementById("inputScriptArgument").addEventListener("keyup",function(d){"Enter"===d.key&&(d.preventDefault(),d.stopPropagation(),addScriptArgument())},!1);document.getElementById("selectScriptArguments").addEventListener("click",function(d){"OPTION"===d.target.nodeName&&removeScriptArgument(d)},!1);document.getElementsByTagName("body")[0].addEventListener("click",function(){hideMenu()},!1);dragAndDropTable("QueueCurrentList");dragAndDropTable("BrowsePlaylistsDetailList");
dragAndDropTableHeader("QueueCurrent");dragAndDropTableHeader("QueueLastPlayed");dragAndDropTableHeader("QueueJukebox");dragAndDropTableHeader("Search");dragAndDropTableHeader("BrowseFilesystem");dragAndDropTableHeader("BrowsePlaylistsDetail");dragAndDropTableHeader("BrowseDatabaseDetail");window.addEventListener("focus",function(){sendAPI("MPD_API_PLAYER_STATE",{},parseState)},!1);document.addEventListener("keydown",function(d){if("INPUT"!==d.target.tagName&&"SELECT"!==d.target.tagName&&"TEXTAREA"!==
d.target.tagName&&!d.ctrlKey&&!d.altKey){var g=keymap[d.key];g&&"function"===typeof window[g.cmd]&&(void 0===keymap[d.key].req||!0===settings[keymap[d.key].req])&&parseCmd(d,g)}},!1);a=document.getElementsByTagName("table");for(b=0;b<a.length;b++)a[b].setAttribute("tabindex",0),a[b].addEventListener("keydown",function(d){navigateTable(this,d.key)},!1);var h="";Object.keys(themes).forEach(function(d){h+='<option value="'+e(d)+'">'+t(themes[d])+"</option>"});document.getElementById("selectTheme").innerHTML=
h;window.addEventListener("beforeunload",function(){webSocketClose()});document.getElementById("alertLocalPlayback").getElementsByTagName("a")[0].addEventListener("click",function(d){d.stopPropagation();d.preventDefault();clickCheckLocalPlayerState(d)},!1);document.getElementById("errorLocalPlayback").getElementsByTagName("a")[0].addEventListener("click",function(d){d.stopPropagation();d.preventDefault();clickCheckLocalPlayerState(d)},!1);document.getElementById("localPlayer").addEventListener("click",
function(d){d.stopPropagation()});document.getElementById("localPlayer").addEventListener("canplay",function(){logDebug("localPlayer event: canplay");document.getElementById("alertLocalPlayback").classList.add("hide");document.getElementById("errorLocalPlayback").classList.add("hide")});document.getElementById("localPlayer").addEventListener("error",function(){logError("localPlayer event: error");document.getElementById("errorLocalPlayback").classList.remove("hide")})}
window.onerror=function(a,b,c){logError("JavaScript error: "+a+" ("+b+": "+c+")");4<=settings.loglevel&&(!0===appInited?showNotification(t("JavaScript error"),a+" ("+b+": "+c+")","","danger"):showAppInitAlert(t("JavaScript error")+": "+a+" ("+b+": "+c+")"));return!0};appInitStart();
function setStateIcon(){!1===websocketConnected||!1===settings.mpdConnected?document.getElementById("logoBg").setAttribute("fill","#6c757d"):document.getElementById("logoBg").setAttribute("fill",settings.highlightColor)}function toggleAlert(a,b,c){a=document.getElementById(a);!1===b?(a.innerHTML="",a.classList.add("hide")):(a.innerHTML=c,a.classList.remove("hide"))}
function showNotification(a,b,c,f){if("No current song"!==a&&"No lyrics found"!==a){if(!0===settings.notificationWeb){var h=new Notification(a,{icon:"assets/favicon.ico",body:b});setTimeout(h.close.bind(h),3E3)}if(!0===settings.notificationPage||"danger"===f||"warning"===f){alertTimeout&&clearTimeout(alertTimeout);document.getElementById("alertBox")?h=document.getElementById("alertBox"):(h=document.createElement("div"),h.setAttribute("id","alertBox"),h.classList.add("toast"));var d='<div class="toast-header">';
d=("success"===f?d+'<span class="material-icons text-success mr-2">info</span>':"warning"===f?d+'<span class="material-icons text-warning mr-2">warning</span>':d+'<span class="material-icons text-danger mr-2">error</span>')+('<strong class="mr-auto">'+e(a)+'</strong><button type="button" class="ml-2 mb-1 close">&times;</button></div>');if(""!==c||""!==b)d+='<div class="toast-body">'+(""===c?e(b):c)+"</div>";h.innerHTML=d+"</div>";document.getElementById("alertBox")||(document.getElementsByTagName("main")[0].append(h),
requestAnimationFrame(function(){var g=document.getElementById("alertBox");g&&g.classList.add("alertBoxActive")}));h.getElementsByTagName("button")[0].addEventListener("click",function(){hideNotification()},!1);alertTimeout=setTimeout(function(){hideNotification()},3E3)}setStateIcon();logMessage(a,b,c,f)}}
function logMessage(a,b,c,f){"success"===f?f="Info":"warning"===f?f="Warning":"danger"===f&&(f="Error");var h=document.getElementById("logOverview"),d=!0,g=h.firstElementChild;g&&g.getAttribute("data-title")===a&&(d=!1);var k=document.createElement("div");k.classList.add("text-light");k.setAttribute("data-title",a);var l=1;!1===d&&(l+=parseInt(g.getAttribute("data-occurence")));k.setAttribute("data-occurence",l);k.innerHTML="<small>"+localeDate()+"&nbsp;&ndash;&nbsp;"+t(f)+(1<l?"&nbsp;("+l+")":"")+
"</small><p>"+e(a)+(""===c&&""===b?"":"<br/>"+(""===c?e(b):c))+"</p>";!0===d?h.insertBefore(k,h.firstElementChild):h.replaceChild(k,g);a=h.getElementsByTagName("div");10<a.length&&a[10].remove()}function clearLogOverview(){for(var a=document.getElementById("logOverview").getElementsByTagName("div"),b=a.length-1;0<=b;b--)a[b].remove();setStateIcon()}
function hideNotification(){alertTimeout&&clearTimeout(alertTimeout);document.getElementById("alertBox")&&(document.getElementById("alertBox").classList.remove("alertBoxActive"),setTimeout(function(){var a=document.getElementById("alertBox");a&&a.remove()},750))}function notificationsSupported(){return"Notification"in window}
function setElsState(a,b,c){a="tag"===c?document.getElementsByTagName(a):document.getElementsByClassName(a);c=a.length;for(var f=0;f<c;f++)a[f].classList.contains("close")||("disabled"===b?!1===a[f].classList.contains("alwaysEnabled")&&null===a[f].getAttribute("disabled")&&(a[f].setAttribute("disabled","disabled"),a[f].classList.add("disabled")):a[f].classList.contains("disabled")&&(a[f].removeAttribute("disabled"),a[f].classList.remove("disabled")))}
function toggleUI(){var a="disabled",b=document.getElementById("top-alerts");if(!0===websocketConnected&&!0===settings.mpdConnected)b.classList.add("hide"),a="enabled";else{var c=0;window.innerWidth<window.innerHeight&&(c=domCache.header.offsetHeight);b.style.paddingTop=c+"px";b.classList.remove("hide")}b="disabled"===a?!1:!0;b!==uiEnabled&&(logDebug("Setting ui state to "+a),setElsState("a",a,"tag"),setElsState("input",a,"tag"),setElsState("button",a,"tag"),setElsState("clickable",a,"class"),uiEnabled=
b);!0===settings.mpdConnected?toggleAlert("alertMpdState",!1,""):(toggleAlert("alertMpdState",!0,t("MPD disconnected")),logMessage(t("MPD disconnected"),"","","danger"));!0===websocketConnected?toggleAlert("alertMympdState",!1,""):!0===appInited&&(toggleAlert("alertMympdState",!0,t("Websocket is disconnected")),logMessage(t("Websocket is disconnected"),"","","danger"));setStateIcon()}function moveOutput(a){sendAPI("MPD_API_PARTITION_OUTPUT_MOVE",{name:a})}
function parsePartitionOutputsList(a){for(var b=document.getElementById("outputs").getElementsByTagName("button"),c=[],f=0;f<b.length;f++)c.push(parseInt(b[f].getAttribute("data-output-id")));b="";for(var h=f=0;h<a.result.data.length;h++)!1===c.includes(a.result.data[h].id)&&(b+='<tr data-output="'+encodeURI(a.result.data[h].name)+'"><td>'+e(a.result.data[h].name)+"</td></tr>",f++);0===f&&(b='<tr class="not-clickable"><td><span class="material-icons">error_outline</span>&nbsp;'+t("Empty list")+"</td></tr>");
document.getElementById("partitionOutputsList").innerHTML=b}function savePartition(){var a=!0,b=document.getElementById("inputPartitionName");validatePlnameEl(b)||(a=!1);!0===a&&sendAPI("MPD_API_PARTITION_NEW",{name:b.value},showListPartitions,!1)}
function showNewPartition(){document.getElementById("listPartitions").classList.remove("active");document.getElementById("newPartition").classList.add("active");document.getElementById("listPartitionsFooter").classList.add("hide");document.getElementById("newPartitionFooter").classList.remove("hide");var a=document.getElementById("inputPartitionName");a.classList.remove("is-invalid");a.value="";a.focus()}
function showListPartitions(){document.getElementById("listPartitions").classList.add("active");document.getElementById("newPartition").classList.remove("active");document.getElementById("listPartitionsFooter").classList.remove("hide");document.getElementById("newPartitionFooter").classList.add("hide");document.getElementById("errorPartition").classList.add("hide");sendAPI("MPD_API_PARTITION_LIST",{},parsePartitionList,!1)}
function deletePartition(a){sendAPI("MPD_API_PARTITION_RM",{name:a},function(b){if(b.error){var c=document.getElementById("errorPartition");c.innerText=t(b.error.message);c.classList.remove("hide")}sendAPI("MPD_API_PARTITION_LIST",{},parsePartitionList,!1)},!0)}
function switchPartition(a){sendAPI("MPD_API_PARTITION_SWITCH",{name:a},function(b){if(b.error){var c=document.getElementById("errorPartition");c.innerText=t(b.error.message);c.classList.remove("hide")}sendAPI("MPD_API_PARTITION_LIST",{},parsePartitionList,!1);sendAPI("MPD_API_PLAYER_STATE",{},parseState)},!0)}
function parsePartitionList(a){if(0<a.result.data.length){for(var b="",c=0;c<a.result.data.length;c++)b+='<tr data-partition="'+encodeURI(a.result.data[c].name)+'"><td class="'+(a.result.data[c].name===settings.partition?"font-weight-bold":"")+'">'+e(a.result.data[c].name)+(a.result.data[c].name===settings.partition?"&nbsp;("+t("current")+")":"")+'</td><td data-col="Action">'+("default"===a.result.data[c].name||a.result.data[c].name===settings.partition?"":'<a href="#" title="'+t("Delete")+'" data-action="delete" class="material-icons color-darkgrey">delete</a>')+
(a.result.data[c].name!==settings.partition?'<a href="#" title="'+t("Switch to")+'" data-action="switch" class="material-icons color-darkgrey">check_circle</a>':"")+"</td></tr>";document.getElementById("listPartitionsList").innerHTML=b}else document.getElementById("listPartitionsList").innerHTML='<tr class="not-clickable"><td><span class="material-icons">error_outline</span></td><td colspan="2">'+t("Empty list")+"</td></tr>"}
function parsePlaylists(a){"All"===app.current.view?(document.getElementById("BrowsePlaylistsAllList").classList.remove("hide"),document.getElementById("BrowsePlaylistsDetailList").classList.add("hide"),document.getElementById("btnBrowsePlaylistsAll").parentNode.classList.add("hide"),document.getElementById("playlistContentBtns").classList.add("hide"),document.getElementById("smartPlaylistContentBtns").classList.add("hide"),document.getElementById("btnAddSmartpls").parentNode.classList.remove("hide"),
document.getElementById("BrowseNavPlaylists").parentNode.classList.remove("hide")):(-1<a.result.uri.indexOf(".")||!0===a.result.smartpls?(document.getElementById("BrowsePlaylistsDetailList").setAttribute("data-ro","true"),document.getElementById("playlistContentBtns").classList.add("hide"),document.getElementById("smartPlaylistContentBtns").classList.remove("hide")):(document.getElementById("BrowsePlaylistsDetailList").setAttribute("data-ro","false"),document.getElementById("playlistContentBtns").classList.remove("hide"),
document.getElementById("smartPlaylistContentBtns").classList.add("hide")),document.getElementById("BrowsePlaylistsDetailList").setAttribute("data-uri",a.result.uri),document.getElementById("BrowsePlaylistsDetailList").getElementsByTagName("caption")[0].innerHTML=(!0===a.result.smartpls?t("Smart playlist"):t("Playlist"))+": "+a.result.uri,document.getElementById("BrowsePlaylistsDetailList").classList.remove("hide"),document.getElementById("BrowsePlaylistsAllList").classList.add("hide"),document.getElementById("btnBrowsePlaylistsAll").parentNode.classList.remove("hide"),
document.getElementById("btnAddSmartpls").parentNode.classList.add("hide"),document.getElementById("BrowseNavPlaylists").parentNode.classList.add("hide"));var b=a.result.returnedEntities,c=document.getElementById(app.current.app+app.current.tab+app.current.view+"List"),f=c.getElementsByTagName("tbody")[0],h=f.getElementsByTagName("tr");c=document.activeElement.parentNode.parentNode===c?!0:!1;var d=0;if("All"===app.current.view)for(var g=0;g<b;g++){var k=encodeURI(a.result.data[g].uri),l=document.createElement("tr");
l.setAttribute("data-uri",k);l.setAttribute("data-type",a.result.data[g].Type);l.setAttribute("data-name",a.result.data[g].name);l.setAttribute("tabindex",0);l.innerHTML='<td data-col="Type"><span class="material-icons">'+("smartpls"===a.result.data[g].Type?"queue_music":"list")+"</span></td><td>"+e(a.result.data[g].name)+"</td><td>"+localeDate(a.result.data[g].last_modified)+'</td><td data-col="Action"><a href="#" class="material-icons color-darkgrey">'+ligatureMore+"</a></td>";g<h.length?d=!0===
replaceTblRow(h[g],l)?g:d:f.append(l)}else if("Detail"===app.current.view)for(g=0;g<b;g++){l=encodeURI(a.result.data[g].uri);k=document.createElement("tr");!1===a.result.smartpls&&k.setAttribute("draggable","true");k.setAttribute("id","playlistTrackId"+a.result.data[g].Pos);k.setAttribute("data-type",a.result.data[g].Type);k.setAttribute("data-uri",l);k.setAttribute("data-name",a.result.data[g].Title);k.setAttribute("data-songpos",a.result.data[g].Pos);k.setAttribute("tabindex",0);a.result.data[g].Duration=
beautifySongDuration(a.result.data[g].Duration);l="";for(var m=0;m<settings.colsBrowsePlaylistsDetail.length;m++)l+='<td data-col="'+settings.colsBrowsePlaylistsDetail[m]+'">'+e(a.result.data[g][settings.colsBrowsePlaylistsDetail[m]])+"</td>";l+='<td data-col="Action"><a href="#" class="material-icons color-darkgrey">'+ligatureMore+"</a></td>";k.innerHTML=l;g<h.length?d=!0===replaceTblRow(h[g],k)?g:d:f.append(k)}for(d=h.length-1;d>=b;d--)h[d].remove();!0===c&&focusTable(0);setPagination(a.result.totalEntities,
a.result.returnedEntities);0===b&&(f.innerHTML="All"===app.current.view?'<tr class="not-clickable"><td><span class="material-icons">error_outline</span></td><td colspan="3">'+t("No playlists found")+"</td></tr>":'<tr class="not-clickable"><td><span class="material-icons">error_outline</span></td><td colspan="'+settings.colsBrowsePlaylistsDetail.length+'">'+t("Empty playlist")+"</td></tr>");document.getElementById(app.current.app+app.current.tab+app.current.view+"List").classList.remove("opacity05")}
function playlistDetails(a){document.getElementById("BrowsePlaylistsAllList").classList.add("opacity05");appGoto("Browse","Playlists","Detail","0",void 0,a,"-","-","")}function playlistClear(){var a=document.getElementById("BrowsePlaylistsDetailList").getAttribute("data-uri");sendAPI("MPD_API_PLAYLIST_CLEAR",{uri:a});document.getElementById("BrowsePlaylistsDetailList").classList.add("opacity05")}
function playlistShuffle(){var a=document.getElementById("BrowsePlaylistsDetailList").getAttribute("data-uri");sendAPI("MPD_API_PLAYLIST_SHUFFLE",{uri:a});document.getElementById("BrowsePlaylistsDetailList").classList.add("opacity05")}function playlistSort(a){var b=document.getElementById("BrowsePlaylistsDetailList").getAttribute("data-uri");sendAPI("MPD_API_PLAYLIST_SORT",{uri:b,tag:a});document.getElementById("BrowsePlaylistsDetailList").classList.add("opacity05")}
function getAllPlaylists(a,b,c){var f=a.result.returnedEntities,h="";if("addToPlaylistPlaylist"===b)h='<option value=""></option><option value="new">'+t("New playlist")+"</option>";else if("selectJukeboxPlaylist"===b||"selectAddToQueuePlaylist"===b||"selectTimerPlaylist"===b)h='<option value="Database">'+t("Database")+"</option>";for(var d=0;d<f;d++)if("addToPlaylistPlaylist"!==b||"smartpls"!==a.result.data[d].Type)h+='<option value="'+e(a.result.data[d].uri)+'"',null!==c&&a.result.data[d].uri===
c&&(h+=" selected"),h+=">"+e(a.result.data[d].uri)+"</option>";document.getElementById(b).innerHTML=h}function updateSmartPlaylists(a){sendAPI("MPDWORKER_API_SMARTPLS_UPDATE_ALL",{force:a})}function removeFromPlaylist(a,b){b--;sendAPI("MPD_API_PLAYLIST_RM_TRACK",{uri:a,track:b});document.getElementById("BrowsePlaylistsDetailList").classList.add("opacity05")}
function toggleAddToPlaylistFrm(){var a=document.getElementById("toggleAddToPlaylistBtn");toggleBtn("toggleAddToPlaylistBtn");a.classList.contains("active")?(document.getElementById("addToPlaylistFrm").classList.remove("hide"),document.getElementById("addStreamFooter").classList.add("hide"),document.getElementById("addToPlaylistFooter").classList.remove("hide")):(document.getElementById("addToPlaylistFrm").classList.add("hide"),document.getElementById("addStreamFooter").classList.remove("hide"),document.getElementById("addToPlaylistFooter").classList.add("hide"))}
function parseSmartPlaylist(a){var b=document.getElementById("saveSmartPlaylistName");b.value=a.result.playlist;b.classList.remove("is-invalid");document.getElementById("saveSmartPlaylistType").value=t(a.result.type);document.getElementById("saveSmartPlaylistType").setAttribute("data-value",a.result.type);document.getElementById("saveSmartPlaylistSearch").classList.add("hide");document.getElementById("saveSmartPlaylistSticker").classList.add("hide");document.getElementById("saveSmartPlaylistNewest").classList.add("hide");
var c;settings.featTags&&(c='<option value="any">'+t("Any Tag")+"</option>");c+='<option value="filename">'+t("Filename")+"</option>";for(var f=0;f<settings.searchtags.length;f++)c+='<option value="'+settings.searchtags[f]+'">'+t(settings.searchtags[f])+"</option>";f=document.getElementById("selectSaveSmartPlaylistTag");f.innerHTML=c;"search"===a.result.type?(document.getElementById("saveSmartPlaylistSearch").classList.remove("hide"),document.getElementById("selectSaveSmartPlaylistTag").value=a.result.tag,
document.getElementById("inputSaveSmartPlaylistSearchstr").value=a.result.searchstr,!0===settings.featAdvsearch&&"expression"===a.result.tag?(f.parentNode.parentNode.classList.add("hide"),f.innerHTML='<option value="expression">expression</option>',f.value="expression"):document.getElementById("selectSaveSmartPlaylistTag").parentNode.parentNode.classList.remove("hide")):"sticker"===a.result.type?(document.getElementById("saveSmartPlaylistSticker").classList.remove("hide"),document.getElementById("selectSaveSmartPlaylistSticker").value=
a.result.sticker,document.getElementById("inputSaveSmartPlaylistStickerMaxentries").value=a.result.maxentries,document.getElementById("inputSaveSmartPlaylistStickerMinvalue").value=a.result.minvalue):"newest"===a.result.type&&(document.getElementById("saveSmartPlaylistNewest").classList.remove("hide"),a=a.result.timerange/24/60/60,document.getElementById("inputSaveSmartPlaylistNewestTimerange").value=a);modalSaveSmartPlaylist.show();b.focus()}
function saveSmartPlaylist(){var a=document.getElementById("saveSmartPlaylistName").value,b=document.getElementById("saveSmartPlaylistType").getAttribute("data-value"),c=document.getElementById("saveSmartPlaylistSort");c=c.options[c.selectedIndex].value;if(!0===validatePlname(a)){if("search"===b){var f=document.getElementById("selectSaveSmartPlaylistTag");f=f.options[f.selectedIndex].value;var h=document.getElementById("inputSaveSmartPlaylistSearchstr").value;sendAPI("MPD_API_SMARTPLS_SAVE",{type:b,
playlist:a,tag:f,searchstr:h,sort:c})}else if("sticker"===b){f=document.getElementById("selectSaveSmartPlaylistSticker");f=f.options[f.selectedIndex].value;h=document.getElementById("inputSaveSmartPlaylistStickerMaxentries");if(!validateInt(h))return;var d=document.getElementById("inputSaveSmartPlaylistStickerMinvalue");if(!validateInt(d))return;sendAPI("MPD_API_SMARTPLS_SAVE",{type:b,playlist:a,sticker:f,maxentries:parseInt(h.value),minvalue:parseInt(d.value),sort:c})}else if("newest"===b){f=document.getElementById("inputSaveSmartPlaylistNewestTimerange");
if(!validateInt(f))return;f=86400*parseInt(f.value);sendAPI("MPD_API_SMARTPLS_SAVE",{type:b,playlist:a,timerange:f,sort:c})}else{document.getElementById("saveSmartPlaylistType").classList.add("is-invalid");return}modalSaveSmartPlaylist.hide();showNotification(t("Saved smart playlist %{name}",{name:a}),"","","success")}else document.getElementById("saveSmartPlaylistName").classList.add("is-invalid")}
function addSmartpls(a){var b={jsonrpc:"2.0",id:0,result:{method:"MPD_API_SMARTPLS_GET"}};"mostPlayed"===a?(b.result.playlist=settings.smartplsPrefix+(""!==settings.smartplsPrefix?"-":"")+"mostPlayed",b.result.type="sticker",b.result.sticker="playCount",b.result.maxentries=200,b.result.minvalue=10):"newest"===a?(b.result.playlist=settings.smartplsPrefix+(""!==settings.smartplsPrefix?"-":"")+"newestSongs",b.result.type="newest",b.result.timerange=1209600):"bestRated"===a&&(b.result.playlist=settings.smartplsPrefix+
(""!==settings.smartplsPrefix?"-":"")+"bestRated",b.result.type="sticker",b.result.sticker="like",b.result.maxentries=200,b.result.minvalue=2);parseSmartPlaylist(b)}function deletePlaylists(){var a=document.getElementById("selectDeletePlaylists"),b=document.getElementById("btnDeletePlaylists");btnWaiting(b,!0);sendAPI("MPD_API_PLAYLIST_RM_ALL",{type:a.options[a.selectedIndex].value},function(){btnWaiting(b,!1)})}
function showAddToPlaylistCurrentSong(){var a=document.getElementById("currentTitle").getAttribute("data-uri");""!==a&&showAddToPlaylist(a,"")}function showAddToPlaylistCurrentSearch(){showAddToPlaylist(app.current.search,"")}
function showAddToPlaylist(a,b){document.getElementById("addToPlaylistUri").value=a;document.getElementById("addToPlaylistSearch").value=b;document.getElementById("addToPlaylistPlaylist").innerHTML="";document.getElementById("addToPlaylistNewPlaylist").value="";document.getElementById("addToPlaylistNewPlaylistDiv").classList.add("hide");document.getElementById("addToPlaylistNewPlaylist").classList.remove("is-invalid");toggleBtn("toggleAddToPlaylistBtn",0);b=document.getElementById("streamUrl");b.focus();
b.value="";b.classList.remove("is-invalid");"stream"!==a?(document.getElementById("addStreamFooter").classList.add("hide"),document.getElementById("addStreamFrm").classList.add("hide"),document.getElementById("addToPlaylistFooter").classList.remove("hide"),document.getElementById("addToPlaylistFrm").classList.remove("hide"),document.getElementById("addToPlaylistCaption").innerText=t("Add to playlist")):(document.getElementById("addStreamFooter").classList.remove("hide"),document.getElementById("addStreamFrm").classList.remove("hide"),
document.getElementById("addToPlaylistFooter").classList.add("hide"),document.getElementById("addToPlaylistFrm").classList.add("hide"),document.getElementById("addToPlaylistCaption").innerText=t("Add stream"));modalAddToPlaylist.show();settings.featPlaylists&&sendAPI("MPD_API_PLAYLIST_LIST",{searchstr:"",offset:0,limit:0},function(c){getAllPlaylists(c,"addToPlaylistPlaylist")})}
function addToPlaylist(){var a=decodeURI(document.getElementById("addToPlaylistUri").value);if("stream"===a&&(a=document.getElementById("streamUrl").value,""===a||-1===a.indexOf("http"))){document.getElementById("streamUrl").classList.add("is-invalid");return}var b=document.getElementById("addToPlaylistPlaylist");b=b.options[b.selectedIndex].value;if("new"===b&&(b=document.getElementById("addToPlaylistNewPlaylist").value,!0!==validatePlname(b))){document.getElementById("addToPlaylistNewPlaylist").classList.add("is-invalid");
return}""!==b?("SEARCH"===a?addAllFromSearchPlist(b,null,!1):"ALBUM"===a?(a=document.getElementById("addToPlaylistSearch").value,addAllFromSearchPlist(b,a,!1)):"DATABASE"===a?addAllFromBrowseDatabasePlist(b):sendAPI("MPD_API_PLAYLIST_ADD_TRACK",{uri:a,plist:b}),modalAddToPlaylist.hide()):document.getElementById("addToPlaylistPlaylist").classList.add("is-invalid")}
function showRenamePlaylist(a){document.getElementById("renamePlaylistTo").classList.remove("is-invalid");modalRenamePlaylist.show();document.getElementById("renamePlaylistFrom").value=a;document.getElementById("renamePlaylistTo").value=""}
function renamePlaylist(){var a=document.getElementById("renamePlaylistFrom").value,b=document.getElementById("renamePlaylistTo").value;b!==a&&!0===validatePlname(b)?(sendAPI("MPD_API_PLAYLIST_RENAME",{from:a,to:b}),modalRenamePlaylist.hide()):document.getElementById("renamePlaylistTo").classList.add("is-invalid")}function showSmartPlaylist(a){sendAPI("MPD_API_SMARTPLS_GET",{playlist:a},parseSmartPlaylist)}function updateSmartPlaylist(a){sendAPI("MPDWORKER_API_SMARTPLS_UPDATE",{playlist:a})}
function updateSmartPlaylistClick(){var a=document.getElementById("BrowsePlaylistsDetailList").getAttribute("data-uri");sendAPI("MPDWORKER_API_SMARTPLS_UPDATE",{playlist:a});document.getElementById("BrowsePlaylistsDetailList").classList.add("opacity05")}function showDelPlaylist(a){document.getElementById("deletePlaylist").value=a;modalDeletePlaylist.show()}
function delPlaylist(){var a=document.getElementById("deletePlaylist").value;sendAPI("MPD_API_PLAYLIST_RM",{uri:a});modalDeletePlaylist.hide()}function playlistMoveTrack(a,b){sendAPI("MPD_API_PLAYLIST_MOVE_TRACK",{plist:app.current.search,from:a,to:b})}function addSelectedItemToPlaylist(){var a=document.activeElement;a&&"BrowsePlaylistsAllList"!==a.parentNode.parentNode.id&&showAddToPlaylist(a.getAttribute("data-uri"),"")}
function b64EncodeUnicode(a){return btoa(encodeURIComponent(a).replace(/%([0-9A-F]{2})/g,function(b,c){return String.fromCharCode("0x"+c)}))}function b64DecodeUnicode(a){return decodeURIComponent(atob(a).split("").map(function(b){return"%"+("00"+b.charCodeAt(0).toString(16)).slice(-2)}).join(""))}function addMenuItem(a,b){return'<a class="dropdown-item" href="#" data-href=\''+b64EncodeUnicode(JSON.stringify(a))+"'>"+b+"</a>"}
function hideMenu(){var a=document.querySelector("[data-popover]");a&&((new BSN.Popover(a,{})).hide(),a.removeAttribute("data-popover"),a.parentNode.parentNode.classList.contains("selected")?focusTable(void 0,a.parentNode.parentNode.parentNode.parentNode):"Browse"===app.current.app&&"Database"===app.current.tab?focusTable(void 0,a.parentNode.parentNode.parentNode.parentNode):"Home"===app.current.app&&focusTable(void 0,a.parentNode.parentNode.parentNode.parentNode))}
function showMenu(a,b){b.preventDefault();b.stopPropagation();hideMenu();"TH"===a.parentNode.nodeName?showMenuTh(a):showMenuTd(a)}
function showMenuTh(a){var b=app.current.app+(void 0!==app.current.tab?app.current.tab:"")+(void 0!==app.current.view?app.current.view:"");var c='<form class="p-2" id="colChecklist'+b+'">'+setColsChecklist(b);c+='<button class="btn btn-success btn-block btn-sm mt-2">'+t("Apply")+"</button>";new BSN.Popover(a,{trigger:"click",delay:0,dismissible:!0,template:'<div class="popover" role="tooltip"><div class="arrow"></div><div class="popover-content" id="'+b+'ColsDropdown">'+(c+"</form></div></div>"),
content:" "});c=a.Popover;null===a.getAttribute("data-init")&&(a.setAttribute("data-init","true"),a.addEventListener("shown.bs.popover",function(f){f.target.setAttribute("data-popover","true");document.getElementById("colChecklist"+b).addEventListener("click",function(h){"BUTTON"===h.target.nodeName&&h.target.classList.contains("material-icons")?(toggleBtnChk(h.target),h.preventDefault(),h.stopPropagation()):"BUTTON"===h.target.nodeName&&(h.preventDefault(),saveCols(b))},!1)},!1));c.show()}
function showMenuTd(a){var b=a.getAttribute("data-type"),c=decodeURI(a.getAttribute("data-uri")),f=decodeURI(a.getAttribute("data-name")),h=0;if(null===b||""===c)b=a.parentNode.getAttribute("data-type"),c=decodeURI(a.parentNode.getAttribute("data-uri")),f=a.parentNode.getAttribute("data-name");if(null===b||""===c)b=a.parentNode.parentNode.getAttribute("data-type"),c=decodeURI(a.parentNode.parentNode.getAttribute("data-uri")),f=a.parentNode.parentNode.getAttribute("data-name");lastState&&(h=lastState.nextSongPos);
var d="";if("Browse"===app.current.app&&"Filesystem"===app.current.tab||"Search"===app.current.app||"Browse"===app.current.app&&"Database"===app.current.tab&&"Detail"===app.current.view){if(d+=addMenuItem({cmd:"appendQueue",options:[b,c,f]},t("Append to queue"))+("song"===b?addMenuItem({cmd:"appendAfterQueue",options:[b,c,h,f]},t("Add after current playing song")):"")+addMenuItem({cmd:"replaceQueue",options:[b,c,f]},t("Replace queue"))+("plist"!==b&&"smartpls"!==b&&!0===settings.featPlaylists?addMenuItem({cmd:"showAddToPlaylist",
options:[c,""]},t("Add to playlist")):"")+("song"===b?addMenuItem({cmd:"songDetails",options:[c]},t("Song details")):"")+("plist"===b||"smartpls"===b?addMenuItem({cmd:"playlistDetails",options:[c]},t("View playlist")):"")+("plist"!==b&&"smartpls"!==b||!0!==settings.featHome?"":addMenuItem({cmd:"addPlistToHome",options:[c,f]},t("Add to homescreen"))),"Filesystem"===app.current.tab&&(d+=("dir"===b&&settings.featBookmarks?addMenuItem({cmd:"showBookmarkSave",options:[-1,f,c,b]},t("Add bookmark")):"")+
("dir"===b?addMenuItem({cmd:"updateDB",options:[dirname(c),!0]},t("Update directory")):"")+("dir"===b?addMenuItem({cmd:"rescanDB",options:[dirname(c),!0]},t("Rescan directory")):"")),"Search"===app.current.app){var g=a.parentNode.parentNode;g.hasAttribute("data-album")&&g.hasAttribute("data-albumartist")?(b=decodeURI(g.getAttribute("data-album")),c=decodeURI(g.getAttribute("data-albumartist")),d+='<div class="dropdown-divider"></div><a class="dropdown-item" id="advancedMenuLink" data-toggle="collapse" href="#advancedMenu"><span class="material-icons material-icons-left">keyboard_arrow_right</span>Album actions</a><div class="collapse" id="advancedMenu">'+
addMenuItem({cmd:"_addAlbum",options:["appendQueue",c,b]},t("Append to queue"))+addMenuItem({cmd:"_addAlbum",options:["replaceQueue",c,b]},t("Replace queue"))+(!0===settings.featPlaylists?addMenuItem({cmd:"_addAlbum",options:["addPlaylist",c,b]},t("Add to playlist")):"")+"</div>"):(c=dirname(c),d+='<div class="dropdown-divider"></div><a class="dropdown-item" id="advancedMenuLink" data-toggle="collapse" href="#advancedMenu"><span class="material-icons material-icons-left">keyboard_arrow_right</span>Folder actions</a><div class="collapse" id="advancedMenu">'+
addMenuItem({cmd:"appendQueue",options:[b,c,f]},t("Append to queue"))+addMenuItem({cmd:"appendAfterQueue",options:[b,c,h,f]},t("Add after current playing song"))+addMenuItem({cmd:"replaceQueue",options:[b,c,f]},t("Replace queue"))+(!0===settings.featPlaylists?addMenuItem({cmd:"showAddToPlaylist",options:[c,""]},t("Add to playlist")):"")+"</div>")}}else if("Browse"===app.current.app&&"Database"===app.current.tab&&"List"===app.current.view)b=decodeURI(a.parentNode.getAttribute("data-albumartist")),
c=decodeURI(a.parentNode.getAttribute("data-album")),d+=addMenuItem({cmd:"_addAlbum",options:["appendQueue",b,c]},t("Append to queue"))+addMenuItem({cmd:"_addAlbum",options:["replaceQueue",b,c]},t("Replace queue"))+(!0===settings.featPlaylists?addMenuItem({cmd:"_addAlbum",options:["addPlaylist",b,c]},t("Add to playlist")):"");else if("Browse"===app.current.app&&"Playlists"===app.current.tab&&"All"===app.current.view)d+=addMenuItem({cmd:"appendQueue",options:[b,c,f]},t("Append to queue"))+addMenuItem({cmd:"replaceQueue",
options:[b,c,f]},t("Replace queue"))+(!0===settings.smartpls&&"smartpls"===b?addMenuItem({cmd:"playlistDetails",options:[c]},t("View playlist")):addMenuItem({cmd:"playlistDetails",options:[c]},t("Edit playlist")))+(!0===settings.smartpls&&"smartpls"===b?addMenuItem({cmd:"showSmartPlaylist",options:[c]},t("Edit smart playlist")):"")+(!0===settings.smartpls&&"smartpls"===b?addMenuItem({cmd:"updateSmartPlaylist",options:[c]},t("Update smart playlist")):"")+addMenuItem({cmd:"showRenamePlaylist",options:[c]},
t("Rename playlist"))+addMenuItem({cmd:"showDelPlaylist",options:[c]},t("Delete playlist"))+(!0===settings.featHome?addMenuItem({cmd:"addPlistToHome",options:[c,f]},t("Add to homescreen")):"");else if("Browse"===app.current.app&&"Playlists"===app.current.tab&&"Detail"===app.current.view)h=document.getElementById("BrowsePlaylistsDetailList"),d+=addMenuItem({cmd:"appendQueue",options:[b,c,f]},t("Append to queue"))+addMenuItem({cmd:"replaceQueue",options:[b,c,f]},t("Replace queue"))+("false"===h.getAttribute("data-ro")?
addMenuItem({cmd:"removeFromPlaylist",options:[h.getAttribute("data-uri"),a.parentNode.parentNode.getAttribute("data-songpos")]},t("Remove")):"")+(settings.featPlaylists?addMenuItem({cmd:"showAddToPlaylist",options:[c,""]},t("Add to playlist")):"")+(-1===c.indexOf("http")?addMenuItem({cmd:"songDetails",options:[c]},t("Song details")):"");else if("Queue"===app.current.app&&"Current"===app.current.tab)b=parseInt(a.parentNode.parentNode.getAttribute("data-trackid")),d+=(b!==lastState.currentSongId?addMenuItem({cmd:"playAfterCurrent",
options:[b,a.parentNode.parentNode.getAttribute("data-songpos")]},t("Play after current playing song")):"")+addMenuItem({cmd:"delQueueSong",options:["single",b]},t("Remove"))+addMenuItem({cmd:"delQueueSong",options:["range",0,a.parentNode.parentNode.getAttribute("data-songpos")]},t("Remove all upwards"))+addMenuItem({cmd:"delQueueSong",options:["range",parseInt(a.parentNode.parentNode.getAttribute("data-songpos"))-1,-1]},t("Remove all downwards"))+(-1===c.indexOf("http")?addMenuItem({cmd:"songDetails",
options:[c]},t("Song details")):"");else if("Queue"===app.current.app&&"LastPlayed"===app.current.tab)d+=addMenuItem({cmd:"appendQueue",options:[b,c,f]},t("Append to queue"))+addMenuItem({cmd:"replaceQueue",options:[b,c,f]},t("Replace queue"))+(settings.featPlaylists?addMenuItem({cmd:"showAddToPlaylist",options:[c,""]},t("Add to playlist")):"")+(-1===c.indexOf("http")?addMenuItem({cmd:"songDetails",options:[c]},t("Song details")):"");else if("Queue"===app.current.app&&"Jukebox"===app.current.tab)d+=
addMenuItem({cmd:"songDetails",options:[c]},t("Song details"))+addMenuItem({cmd:"delQueueJukeboxSong",options:[a.parentNode.parentNode.getAttribute("data-pos")]},t("Remove"));else if("Home"===app.current.app){h=parseInt(a.parentNode.getAttribute("data-pos"));g=JSON.parse(a.parentNode.getAttribute("data-href"));var k="";"replaceQueue"===g.cmd&&"plist"===g.options[0]?(b="plist",c=g.options[1],k=t("Add and play playlist"),f=t("Playlist")):"appGoto"===g.cmd?(b="view",k=t("Goto view"),f=t("View")):"execScriptFromOptions"===
g.cmd&&(b="script",k=t("Execute script"),f=t("Script"));d+='<h6 class="dropdown-header">'+f+"</h6>"+addMenuItem({cmd:"executeHomeIcon",options:[h]},k)+("plist"===b?addMenuItem({cmd:"playlistDetails",options:[c]},t("View playlist")):"")+addMenuItem({cmd:"editHomeIcon",options:[h]},t("Edit home icon"))+addMenuItem({cmd:"duplicateHomeIcon",options:[h]},t("Duplicate home icon"))+addMenuItem({cmd:"deleteHomeIcon",options:[h]},t("Delete home icon"))}new BSN.Popover(a,{trigger:"click",delay:0,dismissible:!0,
template:'<div class="popover" role="tooltip"><div class="arrow"></div><div class="popover-content">'+d+"</div></div>",content:" "});d=a.Popover;null===a.getAttribute("data-init")&&(a.setAttribute("data-init","true"),a.addEventListener("shown.bs.popover",function(l){l.target.setAttribute("data-popover","true");document.getElementsByClassName("popover-content")[0].addEventListener("click",function(n){n.preventDefault();n.stopPropagation();"A"===n.target.nodeName&&(n=n.target.getAttribute("data-href"))&&
(n=JSON.parse(b64DecodeUnicode(n)),parseCmd(l,n),hideMenu())},!1);document.getElementsByClassName("popover-content")[0].addEventListener("keydown",function(n){n.preventDefault();n.stopPropagation();if("ArrowDown"===n.key||"ArrowUp"===n.key){var p=this.getElementsByTagName("a");p=Array.prototype.slice.call(p);var q=p.indexOf(document.activeElement);do if(q="ArrowUp"===n.key?1<q?q-1:0:"ArrowDown"===n.key?q<p.length-1?q+1:q:q,0===q||q===p.length-1)break;while(!p[q].offsetHeight);p[q]&&p[q].focus()}else"Enter"===
n.key?n.target.click():"Escape"===n.key&&hideMenu()},!1);var m=document.getElementById("advancedMenuLink");m&&(m.addEventListener("click",function(){var n=this.getElementsByTagName("span")[0];n.innerText="keyboard_arrow_right"===n.innerText?"keyboard_arrow_down":"keyboard_arrow_right"},!1),new BSN.Collapse(m));document.getElementsByClassName("popover-content")[0].firstChild.focus()},!1));d.show()}
function parseUpdateQueue(a){if(1===a.result.state){for(var b=0;b<domCache.btnsPlayLen;b++)domCache.btnsPlay[b].innerText="play_arrow";playstate="stop";domCache.progressBar.style.transition="none";domCache.progressBar.style.width="0px";setTimeout(function(){domCache.progressBar.style.transition=progressBarTransition},10)}else if(2===a.result.state){for(b=0;b<domCache.btnsPlayLen;b++)domCache.btnsPlay[b].innerText="stop"===settings.footerStop?"stop":"pause";playstate="play"}else{for(b=0;b<domCache.btnsPlayLen;b++)domCache.btnsPlay[b].innerText=
"play_arrow";playstate="pause"}if(0===a.result.queueLength)for(b=0;b<domCache.btnsPlayLen;b++)domCache.btnsPlay[b].setAttribute("disabled","disabled");else for(b=0;b<domCache.btnsPlayLen;b++)domCache.btnsPlay[b].removeAttribute("disabled");mediaSessionSetState();mediaSessionSetPositionState(a.result.totalTime,a.result.elapsedTime);domCache.badgeQueueItems.innerText=a.result.queueLength;-1===a.result.nextSongPos&&!1===settings.jukeboxMode?domCache.btnNext.setAttribute("disabled","disabled"):domCache.btnNext.removeAttribute("disabled");
0>a.result.songPos?domCache.btnPrev.setAttribute("disabled","disabled"):domCache.btnPrev.removeAttribute("disabled")}function getQueue(){2<=app.current.search.length?sendAPI("MPD_API_QUEUE_SEARCH",{filter:app.current.filter,offset:app.current.offset,limit:app.current.limit,searchstr:app.current.search,cols:settings.colsQueueCurrent},parseQueue,!1):sendAPI("MPD_API_QUEUE_LIST",{offset:app.current.offset,limit:app.current.limit,cols:settings.colsQueueCurrent},parseQueue,!1)}
function parseQueue(a){if(a.result.offset<app.current.offset)gotoPage(a.result.offset);else{a.result.totalEntities>settings.maxElementsPerPage?document.getElementById("btnQueueGotoPlayingSong").parentNode.classList.remove("hide"):document.getElementById("btnQueueGotoPlayingSong").parentNode.classList.add("hide");var b=a.result.returnedEntities,c=document.getElementById("QueueCurrentList"),f=document.activeElement.parentNode.parentNode===c?!0:!1,h=0;c.setAttribute("data-version",a.result.queueVersion);
c=c.getElementsByTagName("tbody")[0];for(var d=c.getElementsByTagName("tr"),g=0;g<b;g++){a.result.data[g].Duration=beautifySongDuration(a.result.data[g].Duration);a.result.data[g].Pos++;var k=document.createElement("tr");k.setAttribute("draggable","true");k.setAttribute("data-trackid",a.result.data[g].id);k.setAttribute("id","queueTrackId"+a.result.data[g].id);k.setAttribute("data-songpos",a.result.data[g].Pos);k.setAttribute("data-duration",a.result.data[g].Duration);k.setAttribute("data-uri",a.result.data[g].uri);
k.setAttribute("tabindex",0);for(var l="",m=0;m<settings.colsQueueCurrent.length;m++)l+='<td data-col="'+settings.colsQueueCurrent[m]+'">'+e(a.result.data[g][settings.colsQueueCurrent[m]])+"</td>";l+='<td data-col="Action"><a href="#" class="material-icons color-darkgrey">'+ligatureMore+"</a></td>";k.innerHTML=l;g<d.length?h=!0===replaceTblRow(d[g],k)?g:h:c.append(k)}for(g=d.length-1;g>=b;g--)d[g].remove();d=settings.colsQueueCurrent.length;d--;"MPD_API_QUEUE_SEARCH"===a.result.method&&0===b?c.innerHTML=
'<tr><td><span class="material-icons">error_outline</span></td><td colspan="'+d+'">'+t("No results, please refine your search")+"</td></tr>":"MPD_API_QUEUE_ADD_TRACK"===a.result.method&&0===b&&(c.innerHTML='<tr><td><span class="material-icons">error_outline</span></td><td colspan="'+d+'">'+t("Empty queue")+"</td></tr>");!0===f&&focusTable(h);setPagination(a.result.totalEntities,a.result.returnedEntities);document.getElementById("QueueCurrentList").classList.remove("opacity05")}}
function parseLastPlayed(a){var b=a.result.returnedEntities,c=document.getElementById("QueueLastPlayedList"),f=document.activeElement.parentNode.parentNode===c?!0:!1,h=0;c=c.getElementsByTagName("tbody")[0];for(var d=c.getElementsByTagName("tr"),g=0;g<b;g++){a.result.data[g].Duration=beautifySongDuration(a.result.data[g].Duration);a.result.data[g].LastPlayed=localeDate(a.result.data[g].LastPlayed);var k=document.createElement("tr");k.setAttribute("data-uri",a.result.data[g].uri);k.setAttribute("data-name",
a.result.data[g].Title);k.setAttribute("data-type","song");k.setAttribute("tabindex",0);for(var l="",m=0;m<settings.colsQueueLastPlayed.length;m++)l+='<td data-col="'+settings.colsQueueLastPlayed[m]+'">'+e(a.result.data[g][settings.colsQueueLastPlayed[m]])+"</td>";l+='<td data-col="Action">';""!==a.result.data[g].uri&&(l+='<a href="#" class="material-icons color-darkgrey">'+ligatureMore+"</a>");l+="</td>";k.innerHTML=l;g<d.length?h=!0===replaceTblRow(d[g],k)?g:h:c.append(k)}for(g=d.length-1;g>=b;g--)d[g].remove();
d=settings.colsQueueLastPlayed.length;d--;0===b&&(c.innerHTML='<tr><td><span class="material-icons">error_outline</span></td><td colspan="'+d+'">'+t("Empty list")+"</td></tr>");!0===f&&focusTable(h);setPagination(a.result.totalEntities,a.result.returnedEntities);document.getElementById("QueueLastPlayedList").classList.remove("opacity05")}
function queueSelectedItem(a){var b=document.activeElement;b&&"QueueCurrentList"!==b.parentNode.parentNode.id&&(!0===a?appendQueue(b.getAttribute("data-type"),b.getAttribute("data-uri"),b.getAttribute("data-name")):replaceQueue(b.getAttribute("data-type"),b.getAttribute("data-uri"),b.getAttribute("data-name")))}function dequeueSelectedItem(){var a=document.activeElement;a&&"QueueCurrentList"===a.parentNode.parentNode.id&&delQueueSong("single",a.getAttribute("data-trackid"))}
function appendQueue(a,b,c){switch(a){case "song":case "dir":sendAPI("MPD_API_QUEUE_ADD_TRACK",{uri:b});showNotification(t("%{name} added to queue",{name:c}),"","","success");break;case "plist":sendAPI("MPD_API_QUEUE_ADD_PLAYLIST",{plist:b}),showNotification(t("%{name} added to queue",{name:c}),"","","success")}}
function appendAfterQueue(a,b,c,f){switch(a){case "song":sendAPI("MPD_API_QUEUE_ADD_TRACK_AFTER",{uri:b,to:c}),c++,showNotification(t("%{name} added to queue position %{to}",{name:f,to:c}),"","","success")}}
function replaceQueue(a,b,c){switch(a){case "song":case "dir":sendAPI("MPD_API_QUEUE_REPLACE_TRACK",{uri:b});showNotification(t("Queue replaced with %{name}",{name:c}),"","","success");break;case "plist":sendAPI("MPD_API_QUEUE_REPLACE_PLAYLIST",{plist:b}),showNotification(t("Queue replaced with %{name}",{name:c}),"","","success")}}
function addToQueue(){var a=!0,b=document.getElementById("inputAddToQueueQuantity");validateInt(b)||(a=!1);b=document.getElementById("selectAddToQueueMode");b=b.options[b.selectedIndex].value;var c=document.getElementById("selectAddToQueuePlaylist");c=c.options[c.selectedIndex].value;"1"===b&&!1===settings.featSearchwindow&&"Database"===c&&(document.getElementById("warnJukeboxPlaylist2").classList.remove("hide"),a=!1);!0===a&&(sendAPI("MPD_API_QUEUE_ADD_RANDOM",{mode:b,playlist:c,quantity:document.getElementById("inputAddToQueueQuantity").value}),
modalAddToQueue.hide())}function saveQueue(){var a=document.getElementById("saveQueueName").value;!0===validatePlname(a)?(sendAPI("MPD_API_QUEUE_SAVE",{plist:a}),modalSaveQueue.hide()):document.getElementById("saveQueueName").classList.add("is-invalid")}function delQueueSong(a,b,c){"range"===a?sendAPI("MPD_API_QUEUE_RM_RANGE",{start:b,end:c}):"single"===a&&sendAPI("MPD_API_QUEUE_RM_TRACK",{track:b})}
function gotoPlayingSong(){gotoPage(lastState.songPos<settings.maxElementsPerPage?0:Math.floor(lastState.songPos/settings.maxElementsPerPage)*settings.maxElementsPerPage)}function playAfterCurrent(a,b){0===settings.random?sendAPI("MPD_API_QUEUE_MOVE_TRACK",{from:b,to:void 0!==lastState.songPos?lastState.songPos+2:0}):sendAPI("MPD_API_QUEUE_PRIO_SET_HIGHEST",{trackid:a})}
function saveScript(){var a=!0,b=document.getElementById("inputScriptName");validatePlnameEl(b)||(a=!1);var c=document.getElementById("inputScriptOrder");validateInt(c)||(a=!1);if(!0===a){a=[];for(var f=document.getElementById("selectScriptArguments"),h=0;h<f.options.length;h++)a.push(f.options[h].text);sendAPI("MYMPD_API_SCRIPT_SAVE",{oldscript:document.getElementById("inputOldScriptName").value,script:b.value,order:parseInt(c.value),content:document.getElementById("textareaScriptContent").value,
arguments:a},showListScripts,!1)}}function addScriptArgument(){var a=document.getElementById("inputScriptArgument");if(validatePlnameEl(a)){var b=document.createElement("option");b.text=a.value;document.getElementById("selectScriptArguments").appendChild(b);a.value=""}}function removeScriptArgument(a){var b=document.getElementById("inputScriptArgument");b.value=a.target.text;a.target.remove();b.focus()}
function showEditScript(a){document.getElementById("listScripts").classList.remove("active");document.getElementById("editScript").classList.add("active");document.getElementById("listScriptsFooter").classList.add("hide");document.getElementById("editScriptFooter").classList.remove("hide");document.getElementById("inputScriptName").classList.remove("is-invalid");document.getElementById("inputScriptOrder").classList.remove("is-invalid");document.getElementById("inputScriptArgument").classList.remove("is-invalid");
""!==a?sendAPI("MYMPD_API_SCRIPT_GET",{script:a},parseEditScript,!1):(document.getElementById("inputOldScriptName").value="",document.getElementById("inputScriptName").value="",document.getElementById("inputScriptOrder").value="1",document.getElementById("inputScriptArgument").value="",document.getElementById("selectScriptArguments").innerText="",document.getElementById("textareaScriptContent").value="")}
function parseEditScript(a){document.getElementById("inputOldScriptName").value=a.result.script;document.getElementById("inputScriptName").value=a.result.script;document.getElementById("inputScriptOrder").value=a.result.metadata.order;document.getElementById("inputScriptArgument").value="";var b=document.getElementById("selectScriptArguments");b.innerText="";for(var c=0;c<a.result.metadata.arguments.length;c++){var f=document.createElement("option");f.innerText=a.result.metadata.arguments[c];b.appendChild(f)}document.getElementById("textareaScriptContent").value=
a.result.content}function showListScripts(){document.getElementById("listScripts").classList.add("active");document.getElementById("editScript").classList.remove("active");document.getElementById("listScriptsFooter").classList.remove("hide");document.getElementById("editScriptFooter").classList.add("hide");sendAPI("MYMPD_API_SCRIPT_LIST",{all:!0},parseScriptList)}function deleteScript(a){sendAPI("MYMPD_API_SCRIPT_DELETE",{script:a},function(){getScriptList(!0)},!1)}
function getScriptList(a){sendAPI("MYMPD_API_SCRIPT_LIST",{all:a},parseScriptList,!1)}
function parseScriptList(a){var b=document.createElement("optgroup");b.setAttribute("data-value","script");b.setAttribute("label",t("Script"));var c="",f="",h=a.result.data.length,d=0;if(0<h){a.result.data.sort(function(l,m){return l.metadata.order-m.metadata.order});for(var g=0;g<h;g++){var k="";if(0<a.result.data[g].metadata.arguments.length){for(k=0;k<a.result.data[g].metadata.arguments.length;k++)a.result.data[g].metadata.arguments[k]=e(a.result.data[g].metadata.arguments[k]);k='"'+a.result.data[g].metadata.arguments.join('","')+
'"'}0<a.result.data[g].metadata.order&&(d++,c+='<a class="dropdown-item text-light alwaysEnabled" href="#" data-href=\'{"script": "'+e(a.result.data[g].name)+'", "arguments": ['+k+"]}'>"+e(a.result.data[g].name)+"</a>");f+='<tr data-script="'+encodeURI(a.result.data[g].name)+'"><td>'+e(a.result.data[g].name)+'</td><td data-col="Action">'+(!0===settings.featScripteditor?'<a href="#" title="'+t("Delete")+'" data-action="delete" class="material-icons color-darkgrey">delete</a>':"")+'<a href="#" title="'+
t("Execute")+'" data-action="execute" class="material-icons color-darkgrey"  data-href=\'{"script": "'+e(a.result.data[g].name)+'", "arguments": ['+k+']}\'>play_arrow</a><a href="#" title="'+t("Add to homescreen")+'" data-action="add2home" class="material-icons color-darkgrey"  data-href=\'{"script": "'+e(a.result.data[g].name)+'", "arguments": ['+k+"]}'>add_to_home_screen</a></td></tr>";b.innerHTML+='<option data-arguments=\'{"arguments":['+k+"]}' value=\""+e(a.result.data[g].name)+'">'+e(a.result.data[g].name)+
"</option>"}document.getElementById("listScriptsList").innerHTML=f}else document.getElementById("listScriptsList").innerHTML='<tr class="not-clickable"><td><span class="material-icons">error_outline</span></td><td colspan="2">'+t("Empty list")+"</td></tr>";document.getElementById("scripts").innerHTML=(4<d||0===d?"":'<div class="dropdown-divider"></div>')+c;4<d?(document.getElementById("navScripting").classList.remove("hide"),document.getElementById("scripts").classList.add("collapse","menu-indent")):
(document.getElementById("navScripting").classList.add("hide"),document.getElementById("scripts").classList.remove("collapse","menu-indent"));document.getElementById("selectTriggerScript").innerHTML=b.innerHTML;(a=document.getElementById("selectTimerAction").querySelector('optgroup[data-value="script"]'))?a.replaceWith(b):document.getElementById("selectTimerAction").appendChild(b)}
function execScriptFromOptions(a,b){b=void 0!==b&&""!==b?b.split(","):[];execScript(JSON.stringify({script:a,arguments:b}))}
function execScript(a){a=JSON.parse(a);if(0===a.arguments.length)sendAPI("MYMPD_API_SCRIPT_EXECUTE",{script:a.script,arguments:{}});else{for(var b="",c=0;c<a.arguments.length;c++)b+='<div class="form-group row"><label class="col-sm-4 col-form-label" for="inputScriptArg'+c+'">'+e(a.arguments[c])+'</label><div class="col-sm-8"><input name="'+e(a.arguments[c])+'" id="inputScriptArg'+c+'" type="text" class="form-control border-secondary" value=""></div></div>';document.getElementById("execScriptArguments").innerHTML=
b;document.getElementById("modalExecScriptScriptname").value=a.script;modalExecScript.show()}}function execScriptArgs(){for(var a=document.getElementById("modalExecScriptScriptname").value,b={},c=document.getElementById("execScriptArguments").getElementsByTagName("input"),f=0;f<c.length;f++)b[c[f].name]=c[f].value;sendAPI("MYMPD_API_SCRIPT_EXECUTE",{script:a,arguments:b});modalExecScript.hide()}
function doSearch(a){if(settings.featAdvsearch){for(var b="(",c=domCache.searchCrumb.children,f=0;f<c.length;f++)b+="("+decodeURI(c[f].getAttribute("data-filter-tag"))+" "+decodeURI(c[f].getAttribute("data-filter-op"))+" '"+escapeMPD(decodeURI(c[f].getAttribute("data-filter-value")))+"')",""!==a&&(b+=" AND ");""!==a?(c=document.getElementById("searchMatch"),b+="("+app.current.filter+" "+c.options[c.selectedIndex].value+" '"+escapeMPD(a)+"'))"):b+=")";2>=b.length&&(b="");appGoto("Search",void 0,void 0,
"0",app.current.limit,app.current.filter,app.current.sort,"-",b)}else appGoto("Search",void 0,void 0,"0",app.current.limit,app.current.filter,app.current.sort,"-",a)}
function parseSearch(a){0<a.result.returnedEntities?(document.getElementById("searchAddAllSongs").removeAttribute("disabled"),document.getElementById("searchAddAllSongsBtn").removeAttribute("disabled")):(document.getElementById("searchAddAllSongs").setAttribute("disabled","disabled"),document.getElementById("searchAddAllSongsBtn").setAttribute("disabled","disabled"));parseFilesystem(a)}
function saveSearchAsSmartPlaylist(){parseSmartPlaylist({jsonrpc:"2.0",id:0,result:{method:"MPD_API_SMARTPLS_GET",playlist:"",type:"search",tag:!0===settings.featAdvsearch?"expression":app.current.filter,searchstr:app.current.search}})}
function addAllFromSearchPlist(a,b,c){null===b&&(b=app.current.search);settings.featAdvsearch?sendAPI("MPD_API_DATABASE_SEARCH_ADV",{plist:a,sort:"",sortdesc:!1,expression:b,offset:0,limit:0,cols:settings.colsSearch,replace:c}):sendAPI("MPD_API_DATABASE_SEARCH",{plist:a,filter:app.current.filter,searchstr:b,offset:0,limit:0,cols:settings.colsSearch,replace:c})}
function saveConnection(){var a=!0,b=document.getElementById("inputMpdHost"),c=document.getElementById("inputMpdPort"),f=document.getElementById("inputMpdPass"),h=document.getElementById("selectMusicDirectory");h=h.options[h.selectedIndex].value;"custom"===h&&(h=document.getElementById("inputMusicDirectory"),validatePath(h)||(a=!1),h=h.value);""===c.value&&(c.value="6600");0!==b.value.indexOf("/")&&(validateInt(c)||(a=!1),validateHost(b)||(a=!1));!0===a&&(sendAPI("MYMPD_API_CONNECTION_SAVE",{mpdHost:b.value,
mpdPort:c.value,mpdPass:f.value,musicDirectory:h},getSettings),modalConnection.hide())}function getSettings(a){!1===settingsLock&&(settingsLock=!0,sendAPI("MYMPD_API_SETTINGS_GET",{},getMpdSettings,a))}
function getMpdSettings(a){if(""!==a&&a.result)settingsNew=a.result,document.getElementById("splashScreenAlert").innerText=t("Fetch MPD settings"),sendAPI("MPD_API_SETTINGS_GET",{},joinSettings,!0);else return settingsParsed="error",!1===appInited&&showAppInitAlert(""===a?t("Can not parse settings"):t(a.error.message)),!1}
function joinSettings(a){if(""!==a&&a.result)for(var b in a.result)settingsNew[b]=a.result[b];else settingsParsed="error",!1===appInited&&showAppInitAlert(""===a?t("Can not parse settings"):t(a.error.message)),settingsNew.mpdConnected=!1;settings=Object.assign({},settingsNew);settingsLock=!1;parseSettings();toggleUI();!0===settings.mpdConnected&&sendAPI("MPD_API_URLHANDLERS",{},parseUrlhandlers,!1);btnWaiting(document.getElementById("btnApplySettings"),!1)}
function parseUrlhandlers(a){for(var b="",c=0;c<a.result.data.length;c++)switch(a.result.data[c]){case "http://":case "https://":case "nfs://":case "smb://":b+='<option value="'+a.result.data[c]+'">'+a.result.data[c]+"</option>"}document.getElementById("selectMountUrlhandler").innerHTML=b}
function checkConsume(){var a=document.getElementById("btnConsume").classList.contains("active")?!0:!1;0<getBtnGroupValue("btnJukeboxModeGroup")&&!1===a?document.getElementById("warnConsume").classList.remove("hide"):document.getElementById("warnConsume").classList.add("hide")}
function parseSettings(){locale="default"===settings.locale?navigator.language||navigator.userLanguage:settings.locale;!0===isMobile&&(document.getElementById("inputScaleRatio").value=scale);var a=settings.theme;"theme-autodetect"===settings.theme&&(a=window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?"theme-dark":"theme-default");Object.keys(themes).forEach(function(k){k===a?domCache.body.classList.add(k):domCache.body.classList.remove(k)});setNavbarIcons();"both"===settings.footerStop?
document.getElementById("btnStop").classList.remove("hide"):document.getElementById("btnStop").classList.add("hide");document.getElementById("selectTheme").value=settings.theme;!0===settings.mpdConnected&&parseMPDSettings();0!==settings.mpdHost.indexOf("/")?document.getElementById("mpdInfo_host").innerText=settings.mpdHost+":"+settings.mpdPort:document.getElementById("mpdInfo_host").innerText=settings.mpdHost;document.getElementById("inputMpdHost").value=settings.mpdHost;document.getElementById("inputMpdPort").value=
settings.mpdPort;document.getElementById("inputMpdPass").value=settings.mpdPass;var b=document.getElementById("btnNotifyWeb");document.getElementById("warnNotifyWeb").classList.add("hide");notificationsSupported()?("granted"!==Notification.permission&&(!0===settings.notificationWeb&&document.getElementById("warnNotifyWeb").classList.remove("hide"),settings.notificationWeb=!1),"denied"===Notification.permission&&document.getElementById("warnNotifyWeb").classList.remove("hide"),toggleBtnChk("btnNotifyWeb",
settings.notificationWeb),b.removeAttribute("disabled")):(b.setAttribute("disabled","disabled"),toggleBtnChk("btnNotifyWeb",!1));toggleBtnChk("btnNotifyPage",settings.notificationPage);toggleBtnChk("btnMediaSession",settings.mediaSession);toggleBtnChkCollapse("btnFeatLocalplayer","collapseLocalplayer",settings.featLocalplayer);toggleBtnChk("btnFeatTimer",settings.featTimer);toggleBtnChk("btnBookmarks",settings.featBookmarks);toggleBtnChk("btnFeatLyrics",settings.featLyrics);""===settings.streamUrl?
(document.getElementById("selectStreamMode").value="port",document.getElementById("inputStreamUrl").value=settings.streamPort):(document.getElementById("selectStreamMode").value="url",document.getElementById("inputStreamUrl").value=settings.streamUrl);toggleBtnChkCollapse("btnCoverimage","collapseAlbumart",settings.coverimage);document.getElementById("inputBookletName").value=settings.bookletName;document.getElementById("selectLocale").value=settings.locale;document.getElementById("inputCoverimageName").value=
settings.coverimageName;document.getElementById("inputCoverimageSize").value=settings.coverimageSize;document.getElementById("inputCoverimageSizeSmall").value=settings.coverimageSizeSmall;document.documentElement.style.setProperty("--mympd-coverimagesize",settings.coverimageSize+"px");document.documentElement.style.setProperty("--mympd-coverimagesizesmall",settings.coverimageSizeSmall+"px");document.documentElement.style.setProperty("--mympd-highlightcolor",settings.highlightColor);document.getElementById("inputHighlightColor").value=
settings.highlightColor;document.getElementById("inputBgColor").value=settings.bgColor;document.getElementsByTagName("body")[0].style.backgroundColor=settings.bgColor;document.getElementById("highlightColorPreview").style.backgroundColor=settings.highlightColor;document.getElementById("bgColorPreview").style.backgroundColor=settings.bgColor;toggleBtnChkCollapse("btnBgCover","collapseBackground",settings.bgCover);document.getElementById("inputBgCssFilter").value=settings.bgCssFilter;b=document.querySelectorAll(".albumartbg");
for(var c=0;c<b.length;c++)b[c].style.filter=settings.bgCssFilter;toggleBtnChkCollapse("btnLoveEnable","collapseLove",settings.love);document.getElementById("inputLoveChannel").value=settings.loveChannel;document.getElementById("inputLoveMessage").value=settings.loveMessage;document.getElementById("selectMaxElementsPerPage").value=settings.maxElementsPerPage;app.apps.Home.limit=settings.maxElementsPerPage;app.apps.Playback.limit=settings.maxElementsPerPage;app.apps.Queue.tabs.Current.limit=settings.maxElementsPerPage;
app.apps.Queue.tabs.LastPlayed.limit=settings.maxElementsPerPage;app.apps.Queue.tabs.Jukebox.limit=settings.maxElementsPerPage;app.apps.Browse.tabs.Filesystem.limit=settings.maxElementsPerPage;app.apps.Browse.tabs.Playlists.views.All.limit=settings.maxElementsPerPage;app.apps.Browse.tabs.Playlists.views.Detail.limit=settings.maxElementsPerPage;app.apps.Browse.tabs.Database.views.List.limit=settings.maxElementsPerPage;app.apps.Browse.tabs.Database.views.Detail.limit=settings.maxElementsPerPage;app.apps.Search.limit=
settings.maxElementsPerPage;toggleBtnChk("btnStickers",settings.stickers);document.getElementById("inputLastPlayedCount").value=settings.lastPlayedCount;toggleBtnChkCollapse("btnSmartpls","collapseSmartpls",settings.smartpls);b="featLocalplayer featSyscmds featMixramp featCacert featBookmarks featRegex featTimer featLyrics featScripting featScripteditor featHome".split(" ");for(c=0;c<b.length;c++)for(var f=document.getElementsByClassName(b[c]),h=f.length,d=!0===settings[b[c]]?"":"none",g=0;g<h;g++)f[g].style.display=
d;b=document.getElementsByClassName("warnReadonly");for(c=0;c<b.length;c++)!1===settings.readonly?b[c].classList.add("hide"):b[c].classList.remove("hide");!0===settings.readonly?(document.getElementById("btnBookmarks").setAttribute("disabled","disabled"),document.getElementsByClassName("groupClearCovercache")[0].classList.add("hide")):(document.getElementById("btnBookmarks").removeAttribute("disabled"),document.getElementsByClassName("groupClearCovercache")[0].classList.remove("hide"));b='<optgroup data-value="player" label="'+
t("Playback")+'"><option value="startplay">'+t("Start playback")+'</option><option value="stopplay">'+t("Stop playback")+"</option></optgroup>";if(!0===settings.featSyscmds){c="";f=settings.syscmdList.length;if(0<f)for(b+='<optgroup data-value="syscmd" label="'+t("System command")+'">',c=4<f?"":'<div class="dropdown-divider"></div>',h=0;h<f;h++)"HR"===settings.syscmdList[h]?c+='<div class="dropdown-divider"></div>':(c+='<a class="dropdown-item text-light alwaysEnabled" href="#" data-href=\'{"cmd": "execSyscmd", "options": ["'+
e(settings.syscmdList[h])+"\"]}'>"+e(settings.syscmdList[h])+"</a>",b+='<option value="'+e(settings.syscmdList[h])+'">'+e(settings.syscmdList[h])+"</option>");document.getElementById("syscmds").innerHTML=c;b+="</optgroup>";4<f?(document.getElementById("navSyscmds").classList.remove("hide"),document.getElementById("syscmds").classList.add("collapse","menu-indent")):(document.getElementById("navSyscmds").classList.add("hide"),document.getElementById("syscmds").classList.remove("collapse","menu-indent"))}else document.getElementById("syscmds").innerHTML=
"";!0===settings.featScripting?getScriptList(!0):document.getElementById("scripts").innerHTML="";document.getElementById("selectTimerAction").innerHTML=b;toggleBtnGroupValueCollapse(document.getElementById("btnJukeboxModeGroup"),"collapseJukeboxMode",settings.jukeboxMode);document.getElementById("selectJukeboxUniqueTag").value=settings.jukeboxUniqueTag;document.getElementById("inputJukeboxQueueLength").value=settings.jukeboxQueueLength;document.getElementById("inputJukeboxLastPlayed").value=settings.jukeboxLastPlayed;
0===settings.jukeboxMode?(document.getElementById("inputJukeboxQueueLength").setAttribute("disabled","disabled"),document.getElementById("selectJukeboxPlaylist").setAttribute("disabled","disabled")):2===settings.jukeboxMode?(document.getElementById("inputJukeboxQueueLength").setAttribute("disabled","disabled"),document.getElementById("selectJukeboxPlaylist").setAttribute("disabled","disabled"),document.getElementById("selectJukeboxPlaylist").value="Database"):1===settings.jukeboxMode&&(document.getElementById("inputJukeboxQueueLength").removeAttribute("disabled"),
document.getElementById("selectJukeboxPlaylist").removeAttribute("disabled"));document.getElementById("inputSmartplsPrefix").value=settings.smartplsPrefix;document.getElementById("inputSmartplsInterval").value=settings.smartplsInterval/60/60;document.getElementById("selectSmartplsSort").value=settings.smartplsSort;domCache.volumeBar.setAttribute("min",settings.volumeMin);domCache.volumeBar.setAttribute("max",settings.volumeMax);!0===settings.featLocalplayer&&setLocalPlayerUrl();"auto"===settings.musicDirectory?
(document.getElementById("selectMusicDirectory").value=settings.musicDirectory,document.getElementById("inputMusicDirectory").value=void 0!==settings.musicDirectoryValue?settings.musicDirectoryValue:"",document.getElementById("inputMusicDirectory").setAttribute("readonly","readonly")):"none"===settings.musicDirectory?(document.getElementById("selectMusicDirectory").value=settings.musicDirectory,document.getElementById("inputMusicDirectory").value="",document.getElementById("inputMusicDirectory").setAttribute("readonly",
"readonly")):(document.getElementById("selectMusicDirectory").value="custom",document.getElementById("inputMusicDirectory").value=settings.musicDirectoryValue,document.getElementById("inputMusicDirectory").removeAttribute("readonly"));"Queue"===app.current.app&&"Current"===app.current.tab?getQueue():"Queue"===app.current.app&&"LastPlayed"===app.current.tab?appRoute():"Queue"===app.current.app&&"Jukebox"===app.current.tab?appRoute():"Search"===app.current.app?appRoute():"Browse"===app.current.app&&
"Filesystem"===app.current.tab?appRoute():"Browse"===app.current.app&&"Playlists"===app.current.tab&&"Detail"===app.current.view?appRoute():"Browse"===app.current.app&&"Database"===app.current.tab&&""!==app.current.search&&appRoute();i18nHtml(document.getElementsByTagName("body")[0]);checkConsume();!0===settings.mediaSession&&"mediaSession"in navigator?(navigator.mediaSession.setActionHandler("play",clickPlay),navigator.mediaSession.setActionHandler("pause",clickPlay),navigator.mediaSession.setActionHandler("stop",
clickStop),navigator.mediaSession.setActionHandler("seekbackward",seekRelativeBackward),navigator.mediaSession.setActionHandler("seekforward",seekRelativeForward),navigator.mediaSession.setActionHandler("previoustrack",clickPrev),navigator.mediaSession.setActionHandler("nexttrack",clickNext),navigator.mediaSession.setPositionState||logDebug("mediaSession.setPositionState not supported by browser")):logDebug("mediaSession not supported by browser");settingsParsed="true"}
function parseMPDSettings(){toggleBtnChk("btnRandom",settings.random);toggleBtnChk("btnConsume",settings.consume);toggleBtnChk("btnRepeat",settings.repeat);toggleBtnChk("btnAutoPlay",settings.autoPlay);toggleBtnGroupValue(document.getElementById("btnSingleGroup"),settings.single);toggleBtnGroupValue(document.getElementById("btnReplaygainGroup"),settings.replaygain);document.getElementById("partitionName").innerText=settings.partition;document.getElementById("inputCrossfade").value=settings.crossfade;
document.getElementById("inputMixrampdb").value=settings.mixrampdb;document.getElementById("inputMixrampdelay").value=settings.mixrampdelay;settings.featBrowse=!0===settings.featLibrary&&!0===settings.publish?!0:!1;for(var a="featStickers featSmartpls featPlaylists featTags featCoverimage featAdvsearch featLove featSingleOneshot featBrowse featMounts featNeighbors featPartitions".split(" "),b=0;b<a.length;b++){var c=document.getElementsByClassName(a[b]),f=c.length,h=!0===settings[a[b]]?"":"none";
"featCoverimage"===a[b]&&!1===settings.coverimage&&(h="none");for(var d=0;d<f;d++)c[d].style.display=h}!1===settings.featPlaylists&&!0===settings.smartpls?document.getElementById("warnSmartpls").classList.remove("hide"):document.getElementById("warnSmartpls").classList.add("hide");!0===settings.featPlaylists&&!1===settings.readonly?document.getElementById("btnSmartpls").removeAttribute("disabled"):document.getElementById("btnSmartpls").setAttribute("disabled","disabled");!1===settings.featStickers&&
!0===settings.stickers?document.getElementById("warnStickers").classList.remove("hide"):document.getElementById("warnStickers").classList.add("hide");!1===settings.featStickers||!1===settings.stickers||!1===settings.featStickerCache?(document.getElementById("warnPlaybackStatistics").classList.remove("hide"),document.getElementById("inputJukeboxLastPlayed").setAttribute("disabled","disabled")):(document.getElementById("warnPlaybackStatistics").classList.add("hide"),document.getElementById("inputJukeboxLastPlayed").removeAttribute("disabled"));
!1===settings.featLove&&!0===settings.love?document.getElementById("warnScrobbler").classList.remove("hide"):document.getElementById("warnScrobbler").classList.add("hide");!1===settings.featLibrary&&!0===settings.coverimage?document.getElementById("warnAlbumart").classList.remove("hide"):document.getElementById("warnAlbumart").classList.add("hide");""===settings.musicDirectoryValue&&"none"!==settings.musicDirectory?document.getElementById("warnMusicDirectory").classList.remove("hide"):document.getElementById("warnMusicDirectory").classList.add("hide");
document.getElementById("warnJukeboxPlaylist").classList.add("hide");!0===settings.bgCover&&!0===settings.featCoverimage&&!0===settings.coverimage?setBackgroundImage(lastSongObj.uri):clearBackgroundImage();var g="";Object.keys(settings.triggers).forEach(function(k){g+='<option value="'+e(settings.triggers[k])+'">'+t(k)+"</option>"});document.getElementById("selectTriggerEvent").innerHTML=g;settings.tags.sort();settings.searchtags.sort();settings.browsetags.sort();filterCols("colsSearch");filterCols("colsQueueCurrent");
filterCols("colsQueueLastPlayed");filterCols("colsQueueJukebox");filterCols("colsBrowsePlaylistsDetail");filterCols("colsBrowseFilesystem");filterCols("colsBrowseDatabaseDetail");filterCols("colsPlayback");if(!1===settings.featTags)app.apps.Browse.active="Filesystem",app.apps.Search.sort="filename",app.apps.Search.filter="filename",app.apps.Queue.tabs.Current.filter="filename",settings.colsQueueCurrent=["Pos","Title","Duration"],settings.colsQueueLastPlayed=["Pos","Title","LastPlayed"],settings.colsQueueJukebox=
["Pos","Title"],settings.colsSearch=["Title","Duration"],settings.colsBrowseFilesystem=["Type","Title","Duration"],settings.colsBrowseDatabase=["Track","Title","Duration"],settings.colsPlayback=[];else{a="";for(b=0;b<settings.colsPlayback.length;b++)a+='<div id="current'+settings.colsPlayback[b]+'" data-tag="'+settings.colsPlayback[b]+'" '+("Lyrics"===settings.colsPlayback[b]?"":'data-name="'+(lastSongObj[settings.colsPlayback[b]]?encodeURI(lastSongObj[settings.colsPlayback[b]]):"")+'"'),"Album"===
settings.colsPlayback[b]&&null!==lastSongObj[tagAlbumArtist]&&(a+='data-albumartist="'+encodeURI(lastSongObj[tagAlbumArtist])+'"'),a+="><small>"+t(settings.colsPlayback[b])+"</small><p",settings.browsetags.includes(settings.colsPlayback[b])&&(a+=' class="clickable"'),a+=">",a="Duration"===settings.colsPlayback[b]?a+(lastSongObj[settings.colsPlayback[b]]?beautifySongDuration(lastSongObj[settings.colsPlayback[b]]):""):"LastModified"===settings.colsPlayback[b]?a+(lastSongObj[settings.colsPlayback[b]]?
localeDate(lastSongObj[settings.colsPlayback[b]]):""):"Fileformat"===settings.colsPlayback[b]?a+(lastState?fileformat(lastState.audioFormat):""):0===settings.colsPlayback[b].indexOf("MUSICBRAINZ")?a+(lastSongObj[settings.colsPlayback[b]]?getMBtagLink(settings.colsPlayback[b],lastSongObj[settings.colsPlayback[b]]):""):a+(lastSongObj[settings.colsPlayback[b]]?e(lastSongObj[settings.colsPlayback[b]]):""),a+="</p></div>";document.getElementById("cardPlaybackTags").innerHTML=a;(a=document.getElementById("currentLyrics"))&&
lastSongObj.uri&&(b=a.getElementsByTagName("small")[0],b.classList.add("clickable"),b.addEventListener("click",function(k){k.target.parentNode.children[1].classList.toggle("expanded")},!1),getLyrics(lastSongObj.uri,a.getElementsByTagName("p")[0]))}settings.tags.includes("Title")&&(app.apps.Search.sort="Title");settings.tags.includes("AlbumArtist")?tagAlbumArtist="AlbumArtist":settings.tags.includes("Artist")&&(tagAlbumArtist="Artist");settings.tags.includes("AlbumArtist")||"AlbumArtist"!==app.apps.Browse.tabs.Database.views.List.filter||
(app.apps.Browse.tabs.Database.views.List.filter="Artist",app.apps.Browse.tabs.Database.views.List.sort="Artist");!1===settings.featAdvsearch&&"Database"===app.apps.Browse.active&&(app.apps.Browse.active="Filesystem");if(!1===settings.featAdvsearch)for(a=document.getElementById("cardPlaybackTags").getElementsByTagName("p"),b=0;b<a.length;b++)a[b].classList.remove("clickable");!0===settings.featPlaylists?sendAPI("MPD_API_PLAYLIST_LIST",{searchstr:"",offset:0,limit:0},function(k){getAllPlaylists(k,
"selectJukeboxPlaylist",settings.jukeboxPlaylist)}):document.getElementById("selectJukeboxPlaylist").innerHTML='<option value="Database">'+t("Database")+"</option>";setCols("QueueCurrent");setCols("Search");setCols("QueueLastPlayed");setCols("QueueJukebox");setCols("BrowseFilesystem");setCols("BrowsePlaylistsDetail");setCols("BrowseDatabaseDetail");setCols("Playback");addTagList("BrowseDatabaseByTagDropdown","browsetags");addTagList("BrowseNavPlaylistsDropdown","browsetags");addTagList("BrowseNavFilesystemDropdown",
"browsetags");addTagList("searchqueuetags","searchtags");addTagList("searchtags","searchtags");addTagList("searchDatabaseTags","browsetags");addTagList("databaseSortTagsList","browsetags");addTagList("dropdownSortPlaylistTags","tags");addTagList("saveSmartPlaylistSort","tags");addTagListSelect("selectSmartplsSort","tags");addTagListSelect("saveSmartPlaylistSort","tags");addTagListSelect("selectJukeboxUniqueTag","browsetags");initTagMultiSelect("inputEnabledTags","listEnabledTags",settings.allmpdtags,
settings.tags);initTagMultiSelect("inputSearchTags","listSearchTags",settings.tags,settings.searchtags);initTagMultiSelect("inputBrowseTags","listBrowseTags",settings.tags,settings.browsetags);initTagMultiSelect("inputGeneratePlsTags","listGeneratePlsTags",settings.browsetags,settings.generatePlsTags)}function resetSettings(){sendAPI("MYMPD_API_SETTINGS_RESET",{},getSettings)}
function saveSettings(a){var b=!0,c=document.getElementById("inputCrossfade");c.getAttribute("disabled")||validateInt(c)||(b=!1);c=document.getElementById("inputJukeboxQueueLength");validateInt(c)||(b=!1);c=document.getElementById("inputJukeboxLastPlayed");validateInt(c)||(b=!1);var f=document.getElementById("selectStreamMode"),h=c="",d=document.getElementById("inputStreamUrl");"port"===f.options[f.selectedIndex].value?(h=d.value,validateInt(d)||(b=!1)):(c=d.value,validateStream(d)||(b=!1));f=document.getElementById("inputCoverimageSizeSmall");
validateInt(f)||(b=!1);f=document.getElementById("inputCoverimageSize");validateInt(f)||(b=!1);f=document.getElementById("inputCoverimageName");validateFilenameList(f)||(b=!1);f=document.getElementById("inputBookletName");validateFilename(f)||(b=!1);!0===isMobile&&(f=document.getElementById("inputScaleRatio"),validateFloat(f)?(scale=parseFloat(f.value),setViewport(!0)):b=!1);f=document.getElementById("inputLastPlayedCount");validateInt(f)||(b=!1);document.getElementById("btnLoveEnable").classList.contains("active")&&
(f=document.getElementById("inputLoveChannel"),d=document.getElementById("inputLoveMessage"),validateNotBlank(f)&&validateNotBlank(d)||(b=!1));!0===settings.featMixramp&&(f=document.getElementById("inputMixrampdb"),f.getAttribute("disabled")||validateFloat(f)||(b=!1),f=document.getElementById("inputMixrampdelay"),f.getAttribute("disabled")||("nan"===f.value&&(f.value="-1"),validateFloat(f)||(b=!1)));f=document.getElementById("inputSmartplsInterval");validateInt(f)||(b=!1);f=3600*document.getElementById("inputSmartplsInterval").value;
d=getBtnGroupValue("btnSingleGroup");var g=getBtnGroupValue("btnJukeboxModeGroup"),k=getBtnGroupValue("btnReplaygainGroup"),l=document.getElementById("selectJukeboxUniqueTag");l=l.options[l.selectedIndex].value;var m=document.getElementById("selectJukeboxPlaylist");m=m.options[m.selectedIndex].value;"2"===g&&(l="Album");"1"===g&&!1===settings.featSearchwindow&&"Database"===m&&(b=!1,document.getElementById("warnJukeboxPlaylist").classList.remove("hide"));if(!0===b){b=document.getElementById("selectLocale");
var n=document.getElementById("selectTheme");sendAPI("MYMPD_API_SETTINGS_SET",{consume:document.getElementById("btnConsume").classList.contains("active")?1:0,random:document.getElementById("btnRandom").classList.contains("active")?1:0,single:parseInt(d),repeat:document.getElementById("btnRepeat").classList.contains("active")?1:0,replaygain:k,crossfade:document.getElementById("inputCrossfade").value,mixrampdb:!0===settings.featMixramp?document.getElementById("inputMixrampdb").value:settings.mixrampdb,
mixrampdelay:!0===settings.featMixramp?document.getElementById("inputMixrampdelay").value:settings.mixrampdelay,notificationWeb:document.getElementById("btnNotifyWeb").classList.contains("active")?!0:!1,notificationPage:document.getElementById("btnNotifyPage").classList.contains("active")?!0:!1,mediaSession:document.getElementById("btnMediaSession").classList.contains("active")?!0:!1,jukeboxMode:parseInt(g),jukeboxPlaylist:m,jukeboxQueueLength:parseInt(document.getElementById("inputJukeboxQueueLength").value),
jukeboxLastPlayed:parseInt(document.getElementById("inputJukeboxLastPlayed").value),jukeboxUniqueTag:l,autoPlay:document.getElementById("btnAutoPlay").classList.contains("active")?!0:!1,bgCover:document.getElementById("btnBgCover").classList.contains("active")?!0:!1,bgColor:document.getElementById("inputBgColor").value,bgCssFilter:document.getElementById("inputBgCssFilter").value,featLocalplayer:document.getElementById("btnFeatLocalplayer").classList.contains("active")?!0:!1,streamUrl:c,streamPort:parseInt(h),
coverimage:document.getElementById("btnCoverimage").classList.contains("active")?!0:!1,coverimageName:document.getElementById("inputCoverimageName").value,coverimageSize:document.getElementById("inputCoverimageSize").value,coverimageSizeSmall:document.getElementById("inputCoverimageSizeSmall").value,locale:b.options[b.selectedIndex].value,love:document.getElementById("btnLoveEnable").classList.contains("active")?!0:!1,loveChannel:document.getElementById("inputLoveChannel").value,loveMessage:document.getElementById("inputLoveMessage").value,
bookmarks:document.getElementById("btnBookmarks").classList.contains("active")?!0:!1,maxElementsPerPage:parseInt(getSelectValue("selectMaxElementsPerPage")),stickers:document.getElementById("btnStickers").classList.contains("active")?!0:!1,lastPlayedCount:document.getElementById("inputLastPlayedCount").value,smartpls:document.getElementById("btnSmartpls").classList.contains("active")?!0:!1,smartplsPrefix:document.getElementById("inputSmartplsPrefix").value,smartplsInterval:f,smartplsSort:document.getElementById("selectSmartplsSort").value,
taglist:getTagMultiSelectValues(document.getElementById("listEnabledTags"),!1),searchtaglist:getTagMultiSelectValues(document.getElementById("listSearchTags"),!1),browsetaglist:getTagMultiSelectValues(document.getElementById("listBrowseTags"),!1),generatePlsTags:getTagMultiSelectValues(document.getElementById("listGeneratePlsTags"),!1),theme:n.options[n.selectedIndex].value,highlightColor:document.getElementById("inputHighlightColor").value,timer:document.getElementById("btnFeatTimer").classList.contains("active")?
!0:!1,bookletName:document.getElementById("inputBookletName").value,lyrics:document.getElementById("btnFeatLyrics").classList.contains("active")?!0:!1},getSettings);!0===a?modalSettings.hide():btnWaiting(document.getElementById("btnApplySettings"),!0)}}function getTagMultiSelectValues(a,b){var c=[];a=a.getElementsByTagName("button");for(var f=0;f<a.length;f++)a[f].classList.contains("active")&&(!0===b?c.push(t(a[f].name)):c.push(a[f].name));return!0===b?c.join(", "):c.join(",")}
function initTagMultiSelect(a,b,c,f){for(var h=[],d="",g=0;g<c.length;g++)f.includes(c[g])&&h.push(t(c[g])),d+='<div class="form-check"><button class="btn btn-secondary btn-xs clickable material-icons material-icons-small'+(f.includes(c[g])?" active":"")+'" name="'+c[g]+'">'+(f.includes(c[g])?"check":"radio_button_unchecked")+'</button><label class="form-check-label" for="'+c[g]+'">&nbsp;&nbsp;'+t(c[g])+"</label></div>";document.getElementById(b).innerHTML=d;a=document.getElementById(a);a.value=h.join(", ");
"true"!==a.getAttribute("data-init")&&(a.setAttribute("data-init","true"),document.getElementById(b).addEventListener("click",function(k){k.stopPropagation();k.preventDefault();"BUTTON"===k.target.nodeName&&(toggleBtnChk(k.target),k.target.parentNode.parentNode.parentNode.previousElementSibling.value=getTagMultiSelectValues(k.target.parentNode.parentNode,!0))}))}
function filterCols(a){var b=settings.tags.slice();!1===settings.featTags&&b.push("Title");b.push("Duration");"colsQueueCurrent"===a||"colsBrowsePlaylistsDetail"===a||"colsQueueLastPlayed"===a||"colsQueueJukebox"===a?b.push("Pos"):"colsBrowseFilesystem"===a&&b.push("Type");"colsQueueLastPlayed"===a&&b.push("LastPlayed");"colsSearch"===a&&b.push("LastModified");"colsPlayback"===a&&(b.push("Filetype"),b.push("Fileformat"),b.push("LastModified"),!0===settings.featLyrics&&b.push("Lyrics"));for(var c=
[],f=0;f<settings[a].length;f++)b.includes(settings[a][f])&&c.push(settings[a][f]);"colsSearch"===a&&(!1===c.includes("Album")&&b.includes("Album")&&c.push("Album"),!1===c.includes(tagAlbumArtist)&&b.includes(tagAlbumArtist)&&c.push(tagAlbumArtist));settings[a]=c;logDebug("Columns for "+a+": "+c)}
function toggleBtnNotifyWeb(){var a=document.getElementById("btnNotifyWeb").classList.contains("active")?!0:!1;notificationsSupported()?!1===a?Notification.requestPermission(function(b){"permission"in Notification||(Notification.permission=b);"granted"===b?(toggleBtnChk("btnNotifyWeb",!0),settings.notificationWeb=!0,document.getElementById("warnNotifyWeb").classList.add("hide")):(toggleBtnChk("btnNotifyWeb",!1),settings.notificationWeb=!1,document.getElementById("warnNotifyWeb").classList.remove("hide"))}):
(toggleBtnChk("btnNotifyWeb",!1),settings.notificationWeb=!1,document.getElementById("warnNotifyWeb").classList.add("hide")):(toggleBtnChk("btnNotifyWeb",!1),settings.notificationWeb=!1)}
function setPlaySettings(a){a.parentNode.classList.contains("btn-group")?toggleBtnGroup(a):toggleBtnChk(a);"playDropdownBtnJukeboxModeGroup"===a.parentNode.id?"0"!==a.parentNode.getElementsByClassName("active")[0].getAttribute("data-value")&&toggleBtnChk("playDropdownBtnConsume",!0):"playDropdownBtnConsume"===a.id&&!1===a.classList.contains("active")&&toggleBtnGroupValue(document.getElementById("playDropdownBtnJukeboxModeGroup"),0);savePlaySettings()}
function showPlayDropdown(){toggleBtnChk(document.getElementById("playDropdownBtnRandom"),settings.random);toggleBtnChk(document.getElementById("playDropdownBtnConsume"),settings.consume);toggleBtnChk(document.getElementById("playDropdownBtnRepeat"),settings.repeat);toggleBtnChk(document.getElementById("playDropdownBtnRandom"),settings.random);toggleBtnGroupValue(document.getElementById("playDropdownBtnSingleGroup"),settings.single);toggleBtnGroupValue(document.getElementById("playDropdownBtnJukeboxModeGroup"),
settings.jukeboxMode)}
function savePlaySettings(){var a=document.getElementById("playDropdownBtnSingleGroup").getElementsByClassName("active")[0].getAttribute("data-value"),b=document.getElementById("playDropdownBtnJukeboxModeGroup").getElementsByClassName("active")[0].getAttribute("data-value");sendAPI("MYMPD_API_SETTINGS_SET",{consume:document.getElementById("playDropdownBtnConsume").classList.contains("active")?1:0,random:document.getElementById("playDropdownBtnRandom").classList.contains("active")?1:0,single:parseInt(a),
repeat:document.getElementById("playDropdownBtnRepeat").classList.contains("active")?1:0,jukeboxMode:parseInt(b)},getSettings)}
function setNavbarIcons(){var a=document.getElementById("badgeQueueItems"),b=0;a&&(b=a.innerText);a="";for(var c=0;c<settings.navbarIcons.length;c++){var f="";!1===settings.featHome&&"Home"===settings.navbarIcons[c].title&&(f="hide");a+='<div id="nav'+settings.navbarIcons[c].options.join("")+'" class="nav-item flex-fill text-center '+f+'"><a data-title-phrase="'+t(settings.navbarIcons[c].title)+'" data-href="" class="nav-link text-light" href="#"><span class="material-icons">'+settings.navbarIcons[c].ligature+
'</span><span class="navText" data-phrase="'+t(settings.navbarIcons[c].title)+'"></span>'+(""!==settings.navbarIcons[c].badge?settings.navbarIcons[c].badge:"")+"</a></div>"}c=document.getElementById("navbar-main");c.innerHTML=a;domCache.navbarBtns=c.getElementsByTagName("div");domCache.navbarBtnsLen=domCache.navbarBtns.length;domCache.badgeQueueItems=document.getElementById("badgeQueueItems");domCache.badgeQueueItems.innerText=b;document.getElementById("nav"+app.current.app)&&document.getElementById("nav"+
app.current.app).classList.add("active");for(b=0;b<domCache.navbarBtnsLen;b++)domCache.navbarBtns[b].firstChild.setAttribute("data-href",JSON.stringify({cmd:"appGoto",options:settings.navbarIcons[b].options}))}function resetValue(a){a=document.getElementById(a);a.value=null!==a.getAttribute("data-default")?a.getAttribute("data-default"):null!==a.getAttribute("placeholder")?a.getAttribute("placeholder"):""}
function songDetails(a){sendAPI("MPD_API_DATABASE_SONGDETAILS",{uri:a},parseSongDetails);modalSongDetails.show()}function parseFingerprint(a){var b=document.createElement("textarea");b.value=a.result.fingerprint;b.classList.add("form-control","text-monospace","small");a=document.getElementById("fingerprint");a.innerHTML="";a.appendChild(b)}
function getMBtagLink(a,b){var c="";switch(a){case "MUSICBRAINZ_ALBUMARTISTID":case "MUSICBRAINZ_ARTISTID":c="artist";break;case "MUSICBRAINZ_ALBUMID":c="release";break;case "MUSICBRAINZ_RELEASETRACKID":c="track";break;case "MUSICBRAINZ_TRACKID":c="recording"}return""===c?e(b):'<a title="'+t("Lookup at musicbrainz")+'" class="text-success external" target="_musicbrainz" href="https://musicbrainz.org/'+c+"/"+encodeURI(b)+'"><span class="material-icons">open_in_browser</span>&nbsp;'+b+"</a>"}
function parseSongDetails(a){var b=document.getElementById("modalSongDetails");b.getElementsByClassName("album-cover")[0].style.backgroundImage='url("'+subdir+"/albumart/"+a.result.uri+'"), url("'+subdir+'/assets/coverimage-loading.svg")';b=b.getElementsByTagName("h1");for(var c=0;c<b.length;c++)b[c].innerText=a.result.Title;b="";for(c=0;c<settings.tags.length;c++)"Title"!==settings.tags[c]&&"-"!==a.result[settings.tags[c]]&&(b+="<tr><th>"+t(settings.tags[c])+'</th><td data-tag="'+settings.tags[c]+
'" data-name="'+encodeURI(a.result[settings.tags[c]])+'"',"Album"===settings.tags[c]&&null!==a.result[tagAlbumArtist]&&(b+=' data-albumartist="'+encodeURI(a.result[tagAlbumArtist])+'"'),b+=">",b=settings.browsetags.includes(settings.tags[c])&&"-"!==a.result[settings.tags[c]]?b+('<a class="text-success" href="#">'+e(a.result[settings.tags[c]])+"</a>"):0===settings.tags[c].indexOf("MUSICBRAINZ")?b+getMBtagLink(settings.tags[c],a.result[settings.tags[c]]):b+a.result[settings.tags[c]],b+="</td></tr>");
b+="<tr><th>"+t("Duration")+"</th><td>"+beautifyDuration(a.result.Duration)+"</td></tr>";b=!0===settings.featLibrary&&!0===settings.publish?b+("<tr><th>"+t("Filename")+'</th><td><a class="breakAll text-success" href="/browse/music/'+encodeURI(a.result.uri)+'" target="_blank" title="'+e(a.result.uri)+'">'+e(basename(a.result.uri,!0))+"</a></td></tr>"):b+("<tr><th>"+t("Filename")+'</th><td class="breakAll"><span title="'+e(a.result.uri)+'">'+e(basename(a.result.uri,!0))+"</span></td></tr>");b+="<tr><th>"+
t("Filetype")+"</th><td>"+filetype(a.result.uri)+"</td></tr>";b+="<tr><th>"+t("LastModified")+"</th><td>"+localeDate(a.result.LastModified)+"</td></tr>";!0===settings.featFingerprint&&(b+="<tr><th>"+t("Fingerprint")+'</th><td class="breakAll" id="fingerprint"><a class="text-success" data-uri="'+encodeURI(a.result.uri)+'" id="calcFingerprint" href="#">'+t("Calculate")+"</a></td></tr>");""!==a.result.bookletPath&&!0===settings.publish&&(b+="<tr><th>"+t("Booklet")+'</th><td><a class="text-success" href="'+
subdir+"/browse/music/"+dirname(a.result.uri)+"/"+settings.bookletName+'" target="_blank">'+t("Download")+"</a></td></tr>");!0===settings.featStickers&&(b+='<tr><th colspan="2" class="pt-3"><h5>'+t("Statistics")+"</h5></th></tr><tr><th>"+t("Play count")+"</th><td>"+a.result.playCount+"</td></tr><tr><th>"+t("Skip count")+"</th><td>"+a.result.skipCount+"</td></tr><tr><th>"+t("Last played")+"</th><td>"+(0===a.result.lastPlayed?t("never"):localeDate(a.result.lastPlayed))+"</td></tr><tr><th>"+t("Last skipped")+
"</th><td>"+(0===a.result.lastSkipped?t("never"):localeDate(a.result.lastSkipped))+"</td></tr><tr><th>"+t("Like")+'</th><td><div class="btn-group btn-group-sm"><button title="'+t("Dislike song")+'" id="btnVoteDown2" data-href=\'{"cmd": "voteSong", "options": [0]}\' class="btn btn-sm btn-light material-icons">thumb_down</button><button title="'+t("Like song")+'" id="btnVoteUp2" data-href=\'{"cmd": "voteSong", "options": [2]}\' class="btn btn-sm btn-light material-icons">thumb_up</button></div></td></tr>');
document.getElementById("tbodySongDetails").innerHTML=b;setVoteSongBtns(a.result.like,a.result.uri);!0===settings.featLyrics&&getLyrics(a.result.uri,document.getElementById("lyricsText"));b=!1;0<a.result.images.length&&!0===settings.featLibrary&&!0===settings.publish?b=!0:!0===settings.coverimage&&(b=!0);c=document.getElementsByClassName("featPictures");for(var f=0;f<c.length;f++)!0===b?c[f].classList.remove("hide"):c[f].classList.add("hide");if(!0===b){b=[subdir+"/albumart/"+a.result.uri];if(!0===
settings.publish)for(c=0;c<a.result.images.length;c++)!1===isCoverfile(a.result.images[c])&&b.push(subdir+"/browse/music/"+a.result.images[c]);a=document.getElementById("tabSongPics");createImgCarousel(a,"songPicsCarousel",b)}else document.getElementById("tabSongPics").innerText=""}
function isCoverfile(a){a=basename(a).toLowerCase();for(var b=a.split("."),c="png jpg jpeg svg webp tiff bmp".split(" "),f=settings.coverimageName.split(","),h=0;h<f.length;h++){var d=f[h].trim();if(a===d||b[1]&&d===b[0]&&c.includes(b[1]))return!0}return!1}
function getLyrics(a,b){void 0===a?b.innerHTML=t("No lyrics found"):(b.classList.add("opacity05"),sendAPI("MPD_API_LYRICS_GET",{uri:a},function(c){if(c.error)b.innerText=t(c.error.message);else if(c.result.message)b.innerText=t(c.result.message);else{for(var f='<span class="lyricsHeader" class="btn-group-toggle" data-toggle="buttons">',h='<div class="lyricsTextContainer">',d=0;d<c.result.returnedEntities;d++){var g=c.result.data[d].desc;g=""!==g&&""!==c.result.data[d].lang?g+(" ("+c.result.data[d].lang+
")"):""!==c.result.data[d].lang?c.result.data[d].lang:d;f+='<label data-num="'+d+'" class="btn btn-sm btn-outline-secondary mr-2'+(0===d?" active":"")+'">'+g+"</label>";h+='<div class="lyricsText'+(0<d?" hide":"")+'">'+(!0===c.result.synced?parseSyncedLyrics(c.result.data[d].text):e(c.result.data[d].text).replace(/\n/g,"<br/>"))+"</div>"}f+="</span>";h+="</div>";showSyncedLyrics=c.result.synced;1<c.result.returnedEntities?(b.innerHTML=f+h,b.getElementsByClassName("lyricsHeader")[0].addEventListener("click",
function(k){if("LABEL"===k.target.nodeName){k.target.parentNode.getElementsByClassName("active")[0].classList.remove("active");k.target.classList.add("active");k=parseInt(k.target.getAttribute("data-num"));for(var l=b.getElementsByClassName("lyricsText"),m=0;m<l.length;m++)m===k?l[m].classList.remove("hide"):l[m].classList.add("hide")}},!1)):b.innerHTML=h}b.classList.remove("opacity05")},!0))}
function parseSyncedLyrics(a){var b="";a=a.split("\r\n");for(var c=0;c<a.length;c++){var f=a[c].match(/^\[(\d+):(\d+)\.(\d+)\](.*)$/);if(f){var h=60*parseInt(f[1])+parseInt(f[2]);b+='<p><span data-sec="'+h+'">';b+=f[4].replace(/<(\d+):(\d+)\.\d+>/g,function(d,g,k){return'</span><span data-sec="'+(60*parseInt(g)+parseInt(k))+'">'});b+="</span></p>"}}return b+""}function loveSong(){sendAPI("MPD_API_LOVE",{})}
function voteSong(a){var b=decodeURI(domCache.currentTitle.getAttribute("data-uri"));""!==b&&(2===a&&domCache.btnVoteUp.classList.contains("highlight")?a=1:0===a&&domCache.btnVoteDown.classList.contains("highlight")&&(a=1),sendAPI("MPD_API_LIKE",{uri:b,like:a}),setVoteSongBtns(a,b))}
function setVoteSongBtns(a,b){void 0===b&&(b="");domCache.btnVoteUp2=document.getElementById("btnVoteUp2");domCache.btnVoteDown2=document.getElementById("btnVoteDown2");""===b||-1<b.indexOf("://")?(domCache.btnVoteUp.setAttribute("disabled","disabled"),domCache.btnVoteDown.setAttribute("disabled","disabled"),domCache.btnVoteUp2&&(domCache.btnVoteUp2.setAttribute("disabled","disabled"),domCache.btnVoteDown2.setAttribute("disabled","disabled")),domCache.btnVoteUp.classList.remove("highlight"),domCache.btnVoteDown.classList.remove("highlight")):
(domCache.btnVoteUp.removeAttribute("disabled"),domCache.btnVoteDown.removeAttribute("disabled"),domCache.btnVoteUp2&&(domCache.btnVoteUp2.removeAttribute("disabled"),domCache.btnVoteDown2.removeAttribute("disabled")));0===a?(domCache.btnVoteUp.classList.remove("highlight"),domCache.btnVoteDown.classList.add("highlight"),domCache.btnVoteUp2&&(domCache.btnVoteUp2.classList.remove("highlight"),domCache.btnVoteDown2.classList.add("highlight"))):1===a?(domCache.btnVoteUp.classList.remove("highlight"),
domCache.btnVoteDown.classList.remove("highlight"),domCache.btnVoteUp2&&(domCache.btnVoteUp2.classList.remove("highlight"),domCache.btnVoteDown2.classList.remove("highlight"))):2===a&&(domCache.btnVoteUp.classList.add("highlight"),domCache.btnVoteDown.classList.remove("highlight"),domCache.btnVoteUp2&&(domCache.btnVoteUp2.classList.add("highlight"),domCache.btnVoteDown2.classList.remove("highlight")))}
function parseStats(a){document.getElementById("mpdstats_artists").innerText=a.result.artists;document.getElementById("mpdstats_albums").innerText=a.result.albums;document.getElementById("mpdstats_songs").innerText=a.result.songs;document.getElementById("mpdstats_dbPlaytime").innerText=beautifyDuration(a.result.dbPlaytime);document.getElementById("mpdstats_playtime").innerText=beautifyDuration(a.result.playtime);document.getElementById("mpdstats_uptime").innerText=beautifyDuration(a.result.uptime);
document.getElementById("mpdstats_mympd_uptime").innerText=beautifyDuration(a.result.myMPDuptime);document.getElementById("mpdstats_dbUpdated").innerText=localeDate(a.result.dbUpdated);document.getElementById("mympdVersion").innerText=a.result.mympdVersion;document.getElementById("mpdInfo_version").innerText=a.result.mpdVersion;document.getElementById("mpdInfo_libmpdclientVersion").innerText=a.result.libmpdclientVersion;document.getElementById("mpdInfo_libmympdclientVersion").innerText=a.result.libmympdclientVersion}
function getServerinfo(){var a=new XMLHttpRequest;a.open("GET",subdir+"/api/serverinfo",!0);a.onreadystatechange=function(){if(4===a.readyState){var b=JSON.parse(a.responseText);document.getElementById("wsIP").innerText=b.result.ip;document.getElementById("wsMongooseVersion").innerText=b.result.version}};a.send()}
function parseOutputs(a){for(var b="",c=0,f=0;f<a.result.numOutputs;f++)"dummy"!==a.result.data[f].plugin&&(c++,b+='<button id="btnOutput'+a.result.data[f].id+'" data-output-name="'+encodeURI(a.result.data[f].name)+'" data-output-id="'+a.result.data[f].id+'" class="btn btn-secondary btn-block',1===a.result.data[f].state&&(b+=" active"),b+='"><span class="material-icons float-left">volume_up</span> '+e(a.result.data[f].name),b=0<Object.keys(a.result.data[f].attributes).length?b+('<a class="material-icons float-right text-white" title="'+
t("Edit attributes")+'">settings</a>'):b+('<a class="material-icons float-right text-white" title="'+t("Show attributes")+'">settings</a>'),b+="</button>");0===c&&(b='<span class="material-icons">error_outline</span> '+t("No outputs"));domCache.outputs.innerHTML=b}
function showListOutputAttributes(a){sendAPI("MPD_API_PLAYER_OUTPUT_LIST",{},function(b){modalOutputAttributes.show();for(var c,f=0;f<b.result.data.length;f++)if(b.result.data[f].name===a){c=b.result.data[f];break}document.getElementById("modalOutputAttributesId").value=e(c.id);var h="<tr><td>"+t("Name")+"</td><td>"+e(c.name)+"</td></tr><tr><td>"+t("State")+"</td><td>"+(1===c.state?t("enabled"):t("disabled"))+"</td></tr><tr><td>"+t("Plugin")+"</td><td>"+e(c.plugin)+"</td></tr>",d=0;Object.keys(c.attributes).forEach(function(g){d++;
h+="<tr><td>"+e(g)+'</td><td><input name="'+e(g)+'" class="form-control border-secondary" type="text" value="'+e(c.attributes[g])+'"/></td></tr>'});0<d?document.getElementById("btnOutputAttributesSave").removeAttribute("disabled"):document.getElementById("btnOutputAttributesSave").setAttribute("disabled","disabled");document.getElementById("outputAttributesList").innerHTML=h})}
function saveOutputAttributes(){var a={};a.outputId=parseInt(document.getElementById("modalOutputAttributesId").value);a.attributes={};for(var b=document.getElementById("outputAttributesList").getElementsByTagName("input"),c=0;c<b.length;c++)a.attributes[b[c].name]=b[c].value;sendAPI("MPD_API_PLAYER_OUTPUT_ATTRIBUTS_SET",a);modalOutputAttributes.hide()}
function setCounter(a,b,c){currentSong.totalTime=b;currentSong.elapsedTime=c;currentSong.currentSongId=a;var f=0<b?Math.ceil(domCache.progress.offsetWidth*c/b):0;0===f&&(domCache.progressBar.style.transition="none");domCache.progressBar.style.width=f+"px";0===f&&setTimeout(function(){domCache.progressBar.style.transition=progressBarTransition},10);domCache.progress.style.cursor=0>=b?"default":"pointer";b=beautifySongDuration(c)+"&nbsp;/&nbsp;"+beautifySongDuration(b);domCache.counter.innerHTML=b;
if(lastState&&lastState.currentSongId!==a&&(f=document.getElementById("queueTrackId"+lastState.currentSongId))){var h=f.querySelector("[data-col=Duration]");h&&(h.innerText=f.getAttribute("data-duration"));if(h=f.querySelector("[data-col=Pos]"))h.classList.remove("material-icons"),h.innerText=f.getAttribute("data-songpos");f.classList.remove("font-weight-bold")}if(a=document.getElementById("queueTrackId"+a)){if(f=a.querySelector("[data-col=Duration]"))f.innerHTML=b;(b=a.querySelector("[data-col=Pos]"))&&
!b.classList.contains("material-icons")&&(b.classList.add("material-icons"),b.innerText="play_arrow");a.classList.add("font-weight-bold")}!0===showSyncedLyrics&&settings.colsPlayback.includes("Lyrics")&&(a=document.getElementById("currentLyrics"),c=a.querySelector('[data-sec="'+c+'"]'),a=a.getElementsByClassName("highlight")[0],a!==c&&null!==c&&(c.classList.add("highlight"),void 0!==a&&a.classList.remove("highlight")));progressTimer&&clearTimeout(progressTimer);"play"===playstate&&(progressTimer=
setTimeout(function(){currentSong.elapsedTime++;requestAnimationFrame(function(){setCounter(currentSong.currentSongId,currentSong.totalTime,currentSong.elapsedTime)})},1E3))}
function parseState(a){if(JSON.stringify(a.result)===JSON.stringify(lastState))toggleUI();else{parseUpdateQueue(a);parseVolume(a);setCounter(a.result.currentSongId,a.result.totalTime,a.result.elapsedTime);lastState&&lastState.currentSongId===a.result.currentSongId&&lastState.queueVersion===a.result.queueVersion||sendAPI("MPD_API_PLAYER_CURRENT_SONG",{},songChange);if("-1"===a.result.songPos){domCache.currentTitle.innerText="Not playing";document.title="myMPD";domCache.footerTitle.innerText="";domCache.footerTitle.removeAttribute("title");
domCache.footerTitle.classList.remove("clickable");domCache.footerCover.classList.remove("clickable");clearCurrentCover();!0===settings.bgCover&&clearBackgroundImage();for(var b=document.getElementById("cardPlaybackTags").getElementsByTagName("p"),c=0;c<b.length;c++)b[c].innerText=""}else if(b=document.getElementById("currentFileformat"))b.getElementsByTagName("p")[0].innerText=fileformat(a.result.audioFormat);lastState=a.result;!1!==settings.mpdConnected&&!1!==uiEnabled||getSettings(!0)}}
function parseVolume(a){-1===a.result.volume?(domCache.volumePrct.innerText=t("Volumecontrol disabled"),domCache.volumeControl.classList.add("hide")):(domCache.volumeControl.classList.remove("hide"),domCache.volumePrct.innerText=a.result.volume+" %",domCache.volumeMenu.firstChild.innerText=0===a.result.volume?"volume_off":50>a.result.volume?"volume_down":"volume_up");domCache.volumeBar.value=a.result.volume}
function setBackgroundImage(a){if(void 0===a)clearBackgroundImage();else{for(var b=document.querySelectorAll(".albumartbg"),c=0;c<b.length;c++)"-10"===b[c].style.zIndex?b[c].remove():(b[c].style.zIndex="-10",b[c].style.opacity="0");b=document.createElement("div");b.classList.add("albumartbg");b.style.filter=settings.bgCssFilter;b.style.backgroundImage='url("'+subdir+"/albumart/"+a+'")';b.style.opacity=0;c=document.getElementsByTagName("body")[0];c.insertBefore(b,c.firstChild);b=new Image;b.onload=
function(){document.querySelector(".albumartbg").style.opacity=1};b.src=subdir+"/albumart/"+a}}function clearBackgroundImage(){for(var a=document.querySelectorAll(".albumartbg"),b=0;b<a.length;b++)"-10"===a[b].style.zIndex?a[b].remove():(a[b].style.zIndex="-10",a[b].style.opacity="0")}function setCurrentCover(a){_setCurrentCover(a,domCache.currentCover);_setCurrentCover(a,domCache.footerCover)}
function _setCurrentCover(a,b){if(void 0===a)clearCurrentCover();else{for(var c=b.querySelectorAll(".coverbg"),f=0;f<c.length;f++)"2"===c[f].style.zIndex?c[f].remove():c[f].style.zIndex="2";c=document.createElement("div");c.classList.add("coverbg","carousel");c.style.backgroundImage='url("'+subdir+"/albumart/"+a+'")';c.style.opacity=0;c.setAttribute("data-uri",a);b.insertBefore(c,b.firstChild);c=new Image;c.onload=function(){b.querySelector(".coverbg").style.opacity=1};c.src=subdir+"/albumart/"+a}}
function clearCurrentCover(){_clearCurrentCover(domCache.currentCover);_clearCurrentCover(domCache.footerCover)}function _clearCurrentCover(a){a=a.querySelectorAll(".coverbg");for(var b=0;b<a.length;b++)"2"===a[b].style.zIndex?a[b].remove():(a[b].style.zIndex="2",a[b].style.opacity="0")}
function songChange(a){var b=a.result.Title+":"+a.result.Artist+":"+a.result.Album+":"+a.result.uri+":"+a.result.currentSongId;if(lastSong!==b){var c="",f="",h="";mediaSessionSetMetadata(a.result.Title,a.result.Artist,a.result.Album,a.result.uri);setCurrentCover(a.result.uri);!0===settings.bgCover&&!0===settings.featCoverimage&&setBackgroundImage(a.result.uri);domCache.footerArtist.classList.remove("clickable");domCache.footerAlbum.classList.remove("clickable");domCache.footerCover.classList.remove("clickable");
void 0!==a.result.Artist&&0<a.result.Artist.length&&"-"!==a.result.Artist?(c+=a.result.Artist,f+=a.result.Artist,h+=a.result.Artist+" - ",domCache.footerArtist.innerText=a.result.Artist,domCache.footerArtist.setAttribute("data-name",encodeURI(a.result.Artist)),!0===settings.featAdvsearch&&domCache.footerArtist.classList.add("clickable")):(domCache.footerArtist.innerText="",domCache.footerArtist.setAttribute("data-name",""));void 0!==a.result.Album&&0<a.result.Album.length&&"-"!==a.result.Album?(c+=
" - "+a.result.Album,f+="<br/>"+a.result.Album,domCache.footerAlbum.innerText=a.result.Album,domCache.footerAlbum.setAttribute("data-name",encodeURI(a.result.Album)),domCache.footerAlbum.setAttribute("data-albumartist",encodeURI(a.result[tagAlbumArtist])),!0===settings.featAdvsearch&&domCache.footerAlbum.classList.add("clickable")):(domCache.footerAlbum.innerText="",domCache.footerAlbum.setAttribute("data-name",""));void 0!==a.result.Title&&0<a.result.Title.length?(h+=a.result.Title,domCache.currentTitle.innerText=
a.result.Title,domCache.currentTitle.setAttribute("data-uri",encodeURI(a.result.uri)),domCache.footerTitle.innerText=a.result.Title,domCache.footerTitle.classList.add("clickable"),domCache.footerCover.classList.add("clickable")):(domCache.currentTitle.innerText="",domCache.currentTitle.setAttribute("data-uri",""),domCache.footerTitle.innerText="",domCache.footerTitle.setAttribute("data-name",""),domCache.footerTitle.classList.remove("clickable"),domCache.footerCover.classList.remove("clickable"));
document.title="myMPD: "+h;domCache.footerCover.title=h;void 0!==a.result.uri&&""!==a.result.uri&&-1===a.result.uri.indexOf("://")?domCache.footerTitle.classList.add("clickable"):domCache.footerTitle.classList.remove("clickable");void 0!==a.result.uri?(a.result.Filetype=filetype(a.result.uri),document.getElementById("addCurrentSongToPlaylist").removeAttribute("disabled")):(a.result.Filetype="",document.getElementById("addCurrentSongToPlaylist").setAttribute("disabled","disabled"));!0===settings.featStickers&&
setVoteSongBtns(a.result.like,a.result.uri);a.result.Fileformat=lastState?fileformat(lastState.audioFormat):"";for(h=0;h<settings.colsPlayback.length;h++){var d=document.getElementById("current"+settings.colsPlayback[h]);if(d&&"Lyrics"===settings.colsPlayback[h])getLyrics(a.result.uri,d.getElementsByTagName("p")[0]);else if(d){var g=a.result[settings.colsPlayback[h]];void 0===g&&(g="");g="Duration"===settings.colsPlayback[h]?beautifySongDuration(g):"LastModified"===settings.colsPlayback[h]?localeDate(g):
0===settings.colsPlayback[h].indexOf("MUSICBRAINZ")?getMBtagLink(settings.colsPlayback[h],a.result[settings.colsPlayback[h]]):e(g);d.getElementsByTagName("p")[0].innerHTML=g;d.setAttribute("data-name",encodeURI(g));"Album"===settings.colsPlayback[h]&&null!==a.result[tagAlbumArtist]&&d.setAttribute("data-albumartist",encodeURI(a.result[tagAlbumArtist]))}}document.getElementById("currentBooklet").innerHTML=""===a.result.bookletPath||void 0===a.result.bookletPath||!1===settings.featBrowse?"":'<span class="text-light material-icons">description</span>&nbsp;<a class="text-light" target="_blank" href="'+
subdir+"/browse/music/"+e(a.result.bookletPath)+'">'+t("Download booklet")+"</a>";if(h=document.getElementById("queueTrackId"+a.result.currentSongId))h.getElementsByTagName("td")[1].innerText=a.result.Title;"play"===playstate&&showNotification(a.result.Title,c,f,"success");lastSong=b;lastSongObj=a.result}}function gotoTagList(){appGoto(app.current.app,app.current.tab,app.current.view,"0",void 0,"-","-","-","")}function volumeStep(a){chVolume("up"===a?settings.volumeStep:0-settings.volumeStep)}
function chVolume(a){a=parseInt(domCache.volumeBar.value)+a;a<settings.volumeMin?a=settings.volumeMin:a>settings.volumeMax&&(a=settings.volumeMax);domCache.volumeBar.value=a;sendAPI("MPD_API_PLAYER_VOLUME_SET",{volume:a})}function clickTitle(){var a=decodeURI(domCache.currentTitle.getAttribute("data-uri"));""!==a&&-1===a.indexOf("://")&&songDetails(a)}
function mediaSessionSetPositionState(a,b){!0===settings.mediaSession&&"mediaSession"in navigator&&navigator.mediaSession.setPositionState&&b<a&&navigator.mediaSession.setPositionState({duration:a,position:b})}function mediaSessionSetState(){!0===settings.mediaSession&&"mediaSession"in navigator&&(navigator.mediaSession.playbackState="play"===playstate?"playing":"paused")}
function mediaSessionSetMetadata(a,b,c,f){if(!0===settings.mediaSession&&"mediaSession"in navigator){var h=window.location.port;f=window.location.protocol+"//"+window.location.hostname+(""!==h?":"+h:"")+subdir+"/albumart/"+f;navigator.mediaSession.metadata=!0===settings.coverimage?new MediaMetadata({title:a,artist:b,album:c,artwork:[{src:f}]}):new MediaMetadata({title:a,artist:b,album:c})}}
function focusTable(a,b){void 0===b&&(b=document.getElementById(app.current.app+(void 0!==app.current.tab?app.current.tab:"")+(void 0!==app.current.view?app.current.view:"")+"List"));if("Browse"===app.current.app&&"Database"===app.current.tab&&"List"===app.current.view){if(a=document.getElementsByClassName("card-grid"),0!==a.length){b=a[0];for(var c=0;c<a.length;c++)if(a[c].classList.contains("selected")){b=a[c];break}b.focus()}}else if("Home"===app.current.app){if(a=document.getElementsByClassName("home-icons"),
0!==a.length){b=a[0];for(c=0;c<a.length;c++)if(a[c].classList.contains("selected")){b=a[c];break}b.focus()}}else if(null!==b){c=b.getElementsByClassName("selected");if(void 0===a)0===c.length?(a=b.getElementsByTagName("tbody")[0].rows[0],a.classList.contains("not-clickable")&&(a=b.getElementsByTagName("tbody")[0].rows[1]),a.focus(),a.classList.add("selected")):c[0].focus();else{c&&0<c.length&&c[0].classList.remove("selected");c=b.getElementsByTagName("tbody")[0].rows;var f=c.length;f<a&&(a=0);f>a&&
(c[a].focus(),c[a].classList.add("selected"))}"BrowseFilesystemList"===b.id&&(a=b.getElementsByTagName("tbody")[0],0<a.rows.length&&"parentDir"!==a.rows[0].getAttribute("data-type")&&""!==app.current.search&&(b=b.getElementsByTagName("thead")[0].rows[0].cells.length,c=app.current.search.replace(/\/?([^/]+)$/,""),a=a.insertRow(0),a.setAttribute("data-type","parentDir"),a.setAttribute("tabindex",0),a.setAttribute("data-uri",encodeURI(c)),a.innerHTML='<td colspan="'+b+'">..</td>'));scrollFocusIntoView()}}
function scrollFocusIntoView(){var a=document.activeElement,b=a.getBoundingClientRect().top,c=a.offsetHeight;a=a.parentNode.parentNode.offsetTop;window.innerHeight>window.innerWidth&&(a+=domCache.header.offsetHeight);var f=window.innerHeight-a-domCache.footer.offsetHeight,h=c/2;b<=a+h?window.scrollBy(0,-c):b+c>f-h&&window.scrollBy(0,c)}
function navigateTable(a,b){if(a=document.activeElement){var c=null,f=!1;"ArrowDown"===b?(c=a.nextElementSibling,c.classList.contains("not-clickable")&&(c=c.nextElementSibling),f=!0):"ArrowUp"===b?(c=a.previousElementSibling,c.classList.contains("not-clickable")&&(c=c.previousElementSibling),f=!0):" "===b?(b=a.lastChild.firstChild,"A"===b.nodeName&&b.click(),f=!0):"Enter"===b?(a.firstChild.click(),f=!0):"Escape"===b&&(a.blur(),a.classList.remove("selected"),f=!0);!0===f&&(event.preventDefault(),event.stopPropagation());
c&&(a.classList.remove("selected"),c.classList.add("selected"),c.focus(),scrollFocusIntoView())}}
function dragAndDropTable(a){var b=document.getElementById(a).getElementsByTagName("tbody")[0];b.addEventListener("dragstart",function(c){"TR"===c.target.nodeName&&(c.target.classList.add("opacity05"),c.dataTransfer.setDragImage(c.target,0,0),c.dataTransfer.effectAllowed="move",c.dataTransfer.setData("Text",c.target.getAttribute("id")),dragEl=c.target.cloneNode(!0))},!1);b.addEventListener("dragleave",function(c){c.preventDefault();if("TR"===dragEl.nodeName){var f=c.target;"TD"===c.target.nodeName&&
(f=c.target.parentNode);"TR"===f.nodeName&&f.classList.remove("dragover")}},!1);b.addEventListener("dragover",function(c){c.preventDefault();if("TR"===dragEl.nodeName){for(var f=b.getElementsByClassName("dragover"),h=f.length,d=0;d<h;d++)f[d].classList.remove("dragover");f=c.target;"TD"===c.target.nodeName&&(f=c.target.parentNode);"TR"===f.nodeName&&f.classList.add("dragover");c.dataTransfer.dropEffect="move"}},!1);b.addEventListener("dragend",function(c){c.preventDefault();if("TR"===dragEl.nodeName){for(var f=
b.getElementsByClassName("dragover"),h=f.length,d=0;d<h;d++)f[d].classList.remove("dragover");document.getElementById(c.dataTransfer.getData("Text"))&&document.getElementById(c.dataTransfer.getData("Text")).classList.remove("opacity05")}},!1);b.addEventListener("drop",function(c){c.stopPropagation();c.preventDefault();if("TR"===dragEl.nodeName){var f=c.target;"TD"===c.target.nodeName&&(f=c.target.parentNode);var h=document.getElementById(c.dataTransfer.getData("Text")).getAttribute("data-songpos"),
d=f.getAttribute("data-songpos");document.getElementById(c.dataTransfer.getData("Text")).remove();dragEl.classList.remove("opacity05");b.insertBefore(dragEl,f);c=b.getElementsByClassName("dragover");f=c.length;for(var g=0;g<f;g++)c[g].classList.remove("dragover");document.getElementById(a).classList.add("opacity05");"Queue"===app.current.app&&"Current"===app.current.tab?sendAPI("MPD_API_QUEUE_MOVE_TRACK",{from:h,to:d}):"Browse"===app.current.app&&"Playlists"===app.current.tab&&"Detail"===app.current.view&&
playlistMoveTrack(h,d)}},!1)}
function dragAndDropTableHeader(a){if(document.getElementById(a+"List"))var b=document.getElementById(a+"List").getElementsByTagName("tr")[0];else b=a.getElementsByTagName("tr")[0],a="BrowseDatabase";b.addEventListener("dragstart",function(c){"TH"===c.target.nodeName&&(c.target.classList.add("opacity05"),c.dataTransfer.setDragImage(c.target,0,0),c.dataTransfer.effectAllowed="move",c.dataTransfer.setData("Text",c.target.getAttribute("data-col")),dragEl=c.target.cloneNode(!0))},!1);b.addEventListener("dragleave",
function(c){c.preventDefault();"TH"===dragEl.nodeName&&"TH"===c.target.nodeName&&c.target.classList.remove("dragover-th")},!1);b.addEventListener("dragover",function(c){c.preventDefault();if("TH"===dragEl.nodeName){for(var f=b.getElementsByClassName("dragover-th"),h=f.length,d=0;d<h;d++)f[d].classList.remove("dragover-th");"TH"===c.target.nodeName&&c.target.classList.add("dragover-th");c.dataTransfer.dropEffect="move"}},!1);b.addEventListener("dragend",function(c){c.preventDefault();if("TH"===dragEl.nodeName){for(var f=
b.getElementsByClassName("dragover-th"),h=f.length,d=0;d<h;d++)f[d].classList.remove("dragover-th");this.querySelector("[data-col="+c.dataTransfer.getData("Text")+"]")&&this.querySelector("[data-col="+c.dataTransfer.getData("Text")+"]").classList.remove("opacity05")}},!1);b.addEventListener("drop",function(c){c.stopPropagation();c.preventDefault();if("TH"===dragEl.nodeName){this.querySelector("[data-col="+c.dataTransfer.getData("Text")+"]").remove();dragEl.classList.remove("opacity05");b.insertBefore(dragEl,
c.target);c=b.getElementsByClassName("dragover-th");for(var f=c.length,h=0;h<f;h++)c[h].classList.remove("dragover-th");document.getElementById(a+"List")?(document.getElementById(a+"List").classList.add("opacity05"),saveCols(a)):saveCols(a,this.parentNode.parentNode)}},!1)}
function setColTags(a){var b=settings.tags.slice();!1===settings.featTags&&b.push("Title");b.push("Duration");"QueueCurrent"!==a&&"BrowsePlaylistsDetail"!==a&&"QueueLastPlayed"!==a&&"QueueJukebox"!==a||b.push("Pos");"BrowseFilesystem"===a&&b.push("Type");"QueueLastPlayed"===a&&b.push("LastPlayed");"Search"===a&&b.push("LastModified");"Playback"===a&&(b.push("Filetype"),b.push("Fileformat"),b.push("LastModified"),!0===settings.featLyrics&&b.push("Lyrics"));b.sort();return b}
function setColsChecklist(a){for(var b="",c=setColTags(a),f=0;f<c.length;f++)if("Playback"!==a||"Title"!==c[f])b+='<div><button class="btn btn-secondary btn-xs clickable material-icons material-icons-small'+(settings["cols"+a].includes(c[f])?" active":"")+'" name="'+c[f]+'">'+(settings["cols"+a].includes(c[f])?"check":"radio_button_unchecked")+'</button><label class="form-check-label" for="'+c[f]+'">&nbsp;&nbsp;'+t(c[f])+"</label></div>";return b}
function setCols(a){var b=document.getElementById(a+"ColsDropdown");b&&(b.firstChild.innerHTML=setColsChecklist(a));b=app.current.sort;"Search"===a&&"Title"===app.apps.Search.sort&&(b=settings.tags.includes("Title")?"Title":!1===settings.featTags?"Filename":"-");if("Playback"!==a){for(var c="",f=0;f<settings["cols"+a].length;f++){var h=settings["cols"+a][f];c+='<th draggable="true" data-col="'+h+'">';if("Track"===h||"Pos"===h)h="#";c+=t(h);"Search"!==a||h!==b&&"-"+h!==b||(h=!1,0===app.current.sort.indexOf("-")&&
(h=!0),c+='<span class="sort-dir material-icons pull-right">'+(!0===h?"arrow_drop_up":"arrow_drop_down")+"</span>");c+="</th>"}c=!0===settings.featTags?c+('<th data-col="Action"><a data-title-phrase="'+t("Columns")+'" href="#" class="text-secondary align-middle material-icons material-icons-small">settings</a></th>'):c+"<th></th>";document.getElementById(a+"List").getElementsByTagName("tr")[0].innerHTML=c}}
function saveCols(a,b){var c=document.getElementById(a+"ColsDropdown");b=void 0===b?document.getElementById(a+"List").getElementsByTagName("tr")[0]:"string"===typeof b?document.querySelector(b).getElementsByTagName("tr")[0]:b.getElementsByTagName("tr")[0];if(c){c=c.firstChild.getElementsByTagName("button");for(var f=0;f<c.length;f++)if(null!==c[f].getAttribute("name")){var h=b.querySelector("[data-col="+c[f].name+"]");!1===c[f].classList.contains("active")?h&&h.remove():h||(h=document.createElement("th"),
h.innerText=c[f].name,h.setAttribute("data-col",c[f].name),b.insertBefore(h,b.lastChild))}}a={table:"cols"+a,cols:[]};b=b.getElementsByTagName("th");for(c=0;c<b.length;c++)f=b[c].getAttribute("data-col"),"Action"!==f&&null!==f&&a.cols.push(f);sendAPI("MYMPD_API_COLS_SAVE",a,getSettings)}
function saveColsPlayback(a){for(var b=document.getElementById(a+"ColsDropdown").firstChild.getElementsByTagName("button"),c=document.getElementById("cardPlaybackTags"),f=0;f<b.length-1;f++){var h=document.getElementById("current"+b[f].name);!1===b[f].classList.contains("active")?h&&h.remove():h||(h=document.createElement("div"),h.innerHTML="<small>"+t(b[f].name)+"</small><p></p>",h.setAttribute("id","current"+b[f].name),h.setAttribute("data-tag",b[f].name),c.appendChild(h))}a={table:"cols"+a,cols:[]};
c=c.getElementsByTagName("div");for(b=0;b<c.length;b++)(f=c[b].getAttribute("data-tag"))&&a.cols.push(f);sendAPI("MYMPD_API_COLS_SAVE",a,getSettings)}function replaceTblRow(a,b){var c=!1;a.querySelector("[data-popover]")&&hideMenu();a.classList.contains("selected")&&(b.classList.add("selected"),b.focus(),c=!0);a.replaceWith(b);return c}var themes={"theme-autodetect":"Autodetect","theme-default":"Default","theme-dark":"Dark","theme-light":"Light"};
function deleteTimer(a){sendAPI("MYMPD_API_TIMER_RM",{timerid:a},showListTimer)}function toggleTimer(a,b){a.classList.contains("active")?(a.classList.remove("active"),sendAPI("MYMPD_API_TIMER_TOGGLE",{timerid:b,enabled:!1},showListTimer)):(a.classList.add("active"),sendAPI("MYMPD_API_TIMER_TOGGLE",{timerid:b,enabled:!0},showListTimer))}
function saveTimer(){var a=!0,b=document.getElementById("inputTimerName");validateNotBlank(b)||(a=!1);for(var c=!1,f="btnTimerMon btnTimerTue btnTimerWed btnTimerThu btnTimerFri btnTimerSat btnTimerSun".split(" "),h=[],d=0;d<f.length;d++){var g=document.getElementById(f[d]).classList.contains("active")?!0:!1;h.push(g);!0===g&&(c=!0)}!1===c?(a=!1,document.getElementById("invalidTimerWeekdays").style.display="block"):document.getElementById("invalidTimerWeekdays").style.display="none";c=document.getElementById("selectTimerAction");
f=document.getElementById("selectTimerPlaylist");d=document.getElementById("selectTimerHour");g=document.getElementById("selectTimerMinute");var k=document.getElementById("btnTimerJukeboxModeGroup").getElementsByClassName("active")[0].getAttribute("data-value");-1===c.selectedIndex&&(a=!1,c.classList.add("is-invalid"));"0"===k&&"Database"===f.options[f.selectedIndex].value&&"startplay"===c.options[c.selectedIndex].value&&(a=!1,document.getElementById("btnTimerJukeboxModeGroup").classList.add("is-invalid"));
if(!0===a){a={};for(var l=document.getElementById("timerActionScriptArguments").getElementsByTagName("input"),m=0;m<l.length;m++)a[l[m].getAttribute("data-name")]=l[m].value;sendAPI("MYMPD_API_TIMER_SAVE",{timerid:parseInt(document.getElementById("inputTimerId").value),name:b.value,enabled:document.getElementById("btnTimerEnabled").classList.contains("active")?!0:!1,startHour:parseInt(d.options[d.selectedIndex].value),startMinute:parseInt(g.options[g.selectedIndex].value),weekdays:h,action:c.options[c.selectedIndex].parentNode.getAttribute("data-value"),
subaction:c.options[c.selectedIndex].value,volume:parseInt(document.getElementById("inputTimerVolume").value),playlist:f.options[f.selectedIndex].value,jukeboxMode:parseInt(k),arguments:a},showListTimer)}}
function showEditTimer(a){document.getElementById("timerActionPlay").classList.add("hide");document.getElementById("timerActionScript").classList.add("hide");document.getElementById("listTimer").classList.remove("active");document.getElementById("editTimer").classList.add("active");document.getElementById("listTimerFooter").classList.add("hide");document.getElementById("editTimerFooter").classList.remove("hide");if(0!==a)sendAPI("MYMPD_API_TIMER_GET",{timerid:a},parseEditTimer);else{sendAPI("MPD_API_PLAYLIST_LIST",
{searchstr:"",offset:0,limit:0},function(c){getAllPlaylists(c,"selectTimerPlaylist","Database")});document.getElementById("inputTimerId").value="0";document.getElementById("inputTimerName").value="";toggleBtnChk("btnTimerEnabled",!0);document.getElementById("selectTimerHour").value="12";document.getElementById("selectTimerMinute").value="0";document.getElementById("selectTimerAction").value="startplay";document.getElementById("inputTimerVolume").value="50";document.getElementById("selectTimerPlaylist").value=
"Database";toggleBtnGroupValue(document.getElementById("btnTimerJukeboxModeGroup"),1);a="btnTimerMon btnTimerTue btnTimerWed btnTimerThu btnTimerFri btnTimerSat btnTimerSun".split(" ");for(var b=0;b<a.length;b++)toggleBtnChk(a[b],!1);document.getElementById("timerActionPlay").classList.remove("hide")}document.getElementById("inputTimerName").focus();removeIsInvalid(document.getElementById("editTimerForm"));document.getElementById("invalidTimerWeekdays").style.display="none"}
function parseEditTimer(a){var b=a.result.playlist;sendAPI("MPD_API_PLAYLIST_LIST",{searchstr:"",offset:0,limit:0},function(h){getAllPlaylists(h,"selectTimerPlaylist",b)});document.getElementById("inputTimerId").value=a.result.timerid;document.getElementById("inputTimerName").value=a.result.name;toggleBtnChk("btnTimerEnabled",a.result.enabled);document.getElementById("selectTimerHour").value=a.result.startHour;document.getElementById("selectTimerMinute").value=a.result.startMinute;document.getElementById("selectTimerAction").value=
a.result.subaction;selectTimerActionChange(a.result.arguments);document.getElementById("inputTimerVolume").value=a.result.volume;toggleBtnGroupValue(document.getElementById("btnTimerJukeboxModeGroup"),a.result.jukeboxMode);for(var c="btnTimerMon btnTimerTue btnTimerWed btnTimerThu btnTimerFri btnTimerSat btnTimerSun".split(" "),f=0;f<c.length;f++)toggleBtnChk(c[f],a.result.weekdays[f])}
function selectTimerActionChange(a){var b=document.getElementById("selectTimerAction");"startplay"===b.options[b.selectedIndex].value?(document.getElementById("timerActionPlay").classList.remove("hide"),document.getElementById("timerActionScript").classList.add("hide")):"script"===b.options[b.selectedIndex].parentNode.getAttribute("data-value")?(document.getElementById("timerActionScript").classList.remove("hide"),document.getElementById("timerActionPlay").classList.add("hide"),showTimerScriptArgs(b.options[b.selectedIndex],
a)):(document.getElementById("timerActionPlay").classList.add("hide"),document.getElementById("timerActionScript").classList.add("hide"))}
function showTimerScriptArgs(a,b){void 0===b&&(b={});a=JSON.parse(a.getAttribute("data-arguments"));for(var c="",f=0;f<a.arguments.length;f++)c+='<div class="form-group row"><label class="col-sm-4 col-form-label" for="timerActionScriptArguments'+f+'">'+e(a.arguments[f])+'</label><div class="col-sm-8"><input name="timerActionScriptArguments'+f+'" class="form-control border-secondary" type="text" value="'+(b[a.arguments[f]]?e(b[a.arguments[f]]):"")+'"data-name="'+a.arguments[f]+'"></div></div>';0===
a.arguments.length&&(c="No arguments");document.getElementById("timerActionScriptArguments").innerHTML=c}function showListTimer(){document.getElementById("listTimer").classList.add("active");document.getElementById("editTimer").classList.remove("active");document.getElementById("listTimerFooter").classList.remove("hide");document.getElementById("editTimerFooter").classList.add("hide");sendAPI("MYMPD_API_TIMER_LIST",{},parseListTimer)}
function parseListTimer(a){for(var b=document.getElementById("listTimer").getElementsByTagName("tbody")[0],c=b.getElementsByTagName("tr"),f=0,h="Mon Tue Wed Thu Fri Sat Sun".split(" "),d=0;d<a.result.returnedEntities;d++){var g=document.createElement("tr");g.setAttribute("data-id",a.result.data[d].timerid);for(var k="<td>"+e(a.result.data[d].name)+'</td><td><button name="enabled" class="btn btn-secondary btn-xs clickable material-icons material-icons-small'+(!0===a.result.data[d].enabled?" active":
"")+'">'+(!0===a.result.data[d].enabled?"check":"radio_button_unchecked")+"</button></td><td>"+zeroPad(a.result.data[d].startHour,2)+":"+zeroPad(a.result.data[d].startMinute,2)+" "+t("on")+" ",l=[],m=0;7>m;m++)!0===a.result.data[d].weekdays[m]&&l.push(t(h[m]));k+=l.join(", ")+"</td><td>"+prettyTimerAction(a.result.data[d].action,a.result.data[d].subaction)+'</td><td data-col="Action"><a href="#" class="material-icons color-darkgrey">delete</a></td>';g.innerHTML=k;d<c.length?f=!0===replaceTblRow(c[d],
g)?d:f:b.append(g)}for(f=c.length-1;f>=a.result.returnedEntities;f--)c[f].remove();0===a.result.returnedEntities&&(b.innerHTML='<tr class="not-clickable"><td><span class="material-icons">error_outline</span></td><td colspan="4">'+t("Empty list")+"</td></tr>")}function prettyTimerAction(a,b){return"player"===a&&"startplay"===b?t("Start playback"):"player"===a&&"stopplay"===b?t("Stop playback"):"syscmd"===a?t("System command")+": "+e(b):"script"===a?t("Script")+": "+e(b):e(a)+": "+e(b)}
function saveTrigger(){var a=!0,b=document.getElementById("inputTriggerName");validatePlnameEl(b)||(a=!1);if(!0===a){a={};for(var c=document.getElementById("triggerActionScriptArguments").getElementsByTagName("input"),f=0;f<c.length;f++)a[c[f].getAttribute("data-name")]=c[f].value;sendAPI("MPD_API_TRIGGER_SAVE",{id:parseInt(document.getElementById("inputTriggerId").value),name:b.value,event:getSelectValue("selectTriggerEvent"),script:getSelectValue("selectTriggerScript"),arguments:a},showListTrigger,
!1)}}
function showEditTrigger(a){document.getElementById("listTrigger").classList.remove("active");document.getElementById("newTrigger").classList.add("active");document.getElementById("listTriggerFooter").classList.add("hide");document.getElementById("newTriggerFooter").classList.remove("hide");var b=document.getElementById("inputTriggerName");b.classList.remove("is-invalid");b.value="";b.focus();document.getElementById("inputTriggerId").value="-1";document.getElementById("selectTriggerEvent").selectedIndex=0;
document.getElementById("selectTriggerScript").selectedIndex=0;-1<a?sendAPI("MPD_API_TRIGGER_GET",{id:a},parseTriggerEdit,!1):selectTriggerActionChange()}function parseTriggerEdit(a){document.getElementById("inputTriggerId").value=a.result.id;document.getElementById("inputTriggerName").value=a.result.name;document.getElementById("selectTriggerEvent").value=a.result.event;document.getElementById("selectTriggerScript").value=a.result.script;selectTriggerActionChange(a.result.arguments)}
function selectTriggerActionChange(a){var b=document.getElementById("selectTriggerScript");showTriggerScriptArgs(b.options[b.selectedIndex],a)}
function showTriggerScriptArgs(a,b){void 0===b&&(b={});a=JSON.parse(a.getAttribute("data-arguments"));for(var c="",f=0;f<a.arguments.length;f++)c+='<div class="form-group row"><label class="col-sm-4 col-form-label" for="triggerActionScriptArguments'+f+'">'+e(a.arguments[f])+'</label><div class="col-sm-8"><input name="triggerActionScriptArguments'+f+'" class="form-control border-secondary" type="text" value="'+(b[a.arguments[f]]?e(b[a.arguments[f]]):"")+'"data-name="'+a.arguments[f]+'"></div></div>';
0===a.arguments.length&&(c="No arguments");document.getElementById("triggerActionScriptArguments").innerHTML=c}function showListTrigger(){document.getElementById("listTrigger").classList.add("active");document.getElementById("newTrigger").classList.remove("active");document.getElementById("listTriggerFooter").classList.remove("hide");document.getElementById("newTriggerFooter").classList.add("hide");sendAPI("MPD_API_TRIGGER_LIST",{},parseTriggerList,!1)}
function deleteTrigger(a){sendAPI("MPD_API_TRIGGER_DELETE",{id:a},function(){sendAPI("MPD_API_TRIGGER_LIST",{},parseTriggerList,!1)},!0)}
function parseTriggerList(a){if(0<a.result.data.length){for(var b="",c=0;c<a.result.data.length;c++)b+='<tr data-trigger-id="'+encodeURI(a.result.data[c].id)+'"><td class="'+(a.result.data[c].name===settings.trigger?"font-weight-bold":"")+'">'+e(a.result.data[c].name)+"</td><td>"+t(a.result.data[c].eventName)+"</td><td>"+e(a.result.data[c].script)+'</td><td data-col="Action">'+("default"===a.result.data[c].name||a.result.data[c].name===settings.trigger?"":'<a href="#" title="'+t("Delete")+'" data-action="delete" class="material-icons color-darkgrey">delete</a>')+
"</td></tr>";document.getElementById("listTriggerList").innerHTML=b}else document.getElementById("listTriggerList").innerHTML='<tr class="not-clickable"><td><span class="material-icons">error_outline</span></td><td colspan="2">'+t("Empty list")+"</td></tr>"}function escapeMPD(a){return a.replace(/(["'])/g,function(b,c){if('"'===c)return'\\"';if("'"===c)return"\\'";if("\\"===c)return"\\\\"})}
function unescapeMPD(a){return a.replace(/(\\'|\\"|\\\\)/g,function(b,c){if('\\"'===c)return'"';if("\\'"===c)return"'";if("\\\\"===c)return"\\"})}function removeIsInvalid(a){a=a.querySelectorAll(".is-invalid");for(var b=0;b<a.length;b++)a[b].classList.remove("is-invalid")}function getSelectValue(a){"string"===typeof a&&(a=document.getElementById(a));if(a&&0<=a.selectedIndex)return a.options[a.selectedIndex].value}
function getSelectedOptionAttribute(a,b){if((a=document.getElementById(a))&&0<=a.selectedIndex)return a.options[a.selectedIndex].getAttribute(b)}
function alignDropdown(a){getXpos(a.children[0])<.66*domCache.body.offsetWidth?"navState"===a.id?(a.classList.remove("dropdown"),a.classList.add("dropright")):a.getElementsByClassName("dropdown-menu")[0].classList.remove("dropdown-menu-right"):(a.getElementsByClassName("dropdown-menu")[0].classList.add("dropdown-menu-right"),a.classList.add("dropdown"),a.classList.remove("dropright"))}function getXpos(a){for(var b=0;a;)b+=a.offsetLeft-a.scrollLeft+a.clientLeft,a=a.offsetParent;return b}
function zeroPad(a,b){b=b-a.toString().length+1;return Array(+(0<b&&b)).join("0")+a}function dirname(a){return a.replace(/\/[^/]*$/,"")}function basename(a,b){return!0===b?a.split("/").reverse()[0].split(/[?#]/)[0]:a.split("/").reverse()[0]}
function filetype(a){if(void 0===a)return"";a=a.split(".").pop().toUpperCase();switch(a){case "MP3":return a+" - MPEG-1 Audio Layer III";case "FLAC":return a+" - Free Lossless Audio Codec";case "OGG":return a+" - Ogg Vorbis";case "OPUS":return a+" - Opus Audio";case "WAV":return a+" - WAVE Audio File";case "WV":return a+" - WavPack";case "AAC":return a+" - Advancded Audio Coding";case "MPC":return a+" - Musepack";case "MP4":return a+" - MPEG-4";case "APE":return a+" - Monkey Audio ";case "WMA":return a+
" - Windows Media Audio";default:return a}}function fileformat(a){return a.bits+t("bits")+" - "+a.sampleRate/1E3+t("kHz")}function scrollToPosY(a){document.body.scrollTop=a;document.documentElement.scrollTop=a}
function selectTag(a,b,c){a=document.getElementById(a);var f=a.querySelector(".active");f&&f.classList.remove("active");if(f=a.querySelector("[data-tag="+c+"]"))f.classList.add("active"),void 0!==b&&(document.getElementById(b).innerText=f.innerText,document.getElementById(b).setAttribute("data-phrase",f.innerText))}
function addTagList(a,b){var c="";"searchtags"===b&&(!0===settings.featTags&&(c+='<button type="button" class="btn btn-secondary btn-sm btn-block" data-tag="any">'+t("Any Tag")+"</button>"),c+='<button type="button" class="btn btn-secondary btn-sm btn-block" data-tag="filename">'+t("Filename")+"</button>");for(var f=0;f<settings[b].length;f++)c+='<button type="button" class="btn btn-secondary btn-sm btn-block" data-tag="'+settings[b][f]+'">'+t(settings[b][f])+"</button>";if("BrowseNavFilesystemDropdown"===
a||"BrowseNavPlaylistsDropdown"===a)c=!0===settings.featTags&&!0===settings.featAdvsearch?'<button type="button" class="btn btn-secondary btn-sm btn-block" data-tag="Database">'+t("Database")+"</button>":"";"BrowseDatabaseByTagDropdown"===a||"BrowseNavFilesystemDropdown"===a||"BrowseNavPlaylistsDropdown"===a?("BrowseDatabaseByTagDropdown"===a&&(c+='<div class="dropdown-divider"></div>'),c+='<button type="button" class="btn btn-secondary btn-sm btn-block'+("BrowseNavPlaylistsDropdown"===a?" active":
"")+'" data-tag="Playlists">'+t("Playlists")+'</button><button type="button" class="btn btn-secondary btn-sm btn-block'+("BrowseNavFilesystemDropdown"===a?" active":"")+'" data-tag="Filesystem">'+t("Filesystem")+"</button>"):"databaseSortTagsList"===a&&(settings.tags.includes("Date")&&(c+='<button type="button" class="btn btn-secondary btn-sm btn-block" data-tag="Date">'+t("Date")+"</button>"),c+='<button type="button" class="btn btn-secondary btn-sm btn-block" data-tag="Last-Modified">'+t("Last modified")+
"</button>");document.getElementById(a).innerHTML=c}
function addTagListSelect(a,b){var c="";"saveSmartPlaylistSort"===a||"selectSmartplsSort"===a?(c+='<option value="">'+t("Disabled")+"</option>",c+='<option value="shuffle">'+t("Shuffle")+"</option>",c+='<optgroup label="'+t("Sort by tag")+'">',c+='<option value="filename">'+t("Filename")+"</option>"):"selectJukeboxUniqueTag"===a&&!1===settings.browsetags.includes("Title")&&(c='<option value="Title">'+t("Song")+"</option>");for(var f=0;f<settings[b].length;f++)c+='<option value="'+settings[b][f]+'">'+
t(settings[b][f])+"</option>";if("saveSmartPlaylistSort"===a||"selectSmartplsSort"===a)c+="</optgroup>";document.getElementById(a).innerHTML=c}function openModal(a){window[a].show()}function openDropdown(a){window[a].toggle()}function focusSearch(){"Queue"===app.current.app?document.getElementById("searchqueuestr").focus():"Search"===app.current.app?domCache.searchstr.focus():appGoto("Search")}
function btnWaiting(a,b){!0===b?(b=document.createElement("span"),b.classList.add("spinner-border","spinner-border-sm","mr-2"),a.insertBefore(b,a.firstChild),a.setAttribute("disabled","disabled")):(a.removeAttribute("disabled"),"SPAN"===a.firstChild.nodeName&&a.firstChild.remove())}
function toggleBtnGroupValue(a,b){a=a.getElementsByTagName("button");var c=a[0],f=b;!1===isNaN(b)&&(f=b.toString());for(b=0;b<a.length;b++)a[b].getAttribute("data-value")===f?(a[b].classList.add("active"),c=a[b]):a[b].classList.remove("active");return c}function toggleBtnGroupValueCollapse(a,b,c){"show"===toggleBtnGroupValue(a,c).getAttribute("data-collapse")?document.getElementById(b).classList.add("show"):document.getElementById(b).classList.remove("show")}
function toggleBtnGroup(a){var b=a;"string"===typeof a&&(b=document.getElementById(a));a=b.parentNode.getElementsByTagName("button");for(var c=0;c<a.length;c++)a[c]===b?a[c].classList.add("active"):a[c].classList.remove("active");return b}function getBtnGroupValue(a){var b=document.getElementById(a).getElementsByClassName("active");0===b.length&&(b=document.getElementById(a).getElementsByTagName("button"));return b[0].getAttribute("data-value")}
function toggleBtnGroupCollapse(a,b){"show"===toggleBtnGroup(a).getAttribute("data-collapse")?!1===document.getElementById(b).classList.contains("show")&&window[b].show():window[b].hide()}function toggleBtn(a,b){var c=a;"string"===typeof a&&(c=document.getElementById(a));c&&(void 0===b&&(b=c.classList.contains("active")?!1:!0),!0===b||1===b?c.classList.add("active"):c.classList.remove("active"))}
function toggleBtnChk(a,b){var c=a;"string"===typeof a&&(c=document.getElementById(a));if(c){void 0===b&&(b=c.classList.contains("active")?!1:!0);if(!0===b||1===b)return c.classList.add("active"),c.innerText="check",!0;c.classList.remove("active");c.innerText="radio_button_unchecked";return!1}}function toggleBtnChkCollapse(a,b,c){!0===toggleBtnChk(a,c)?document.getElementById(b).classList.add("show"):document.getElementById(b).classList.remove("show")}
function setPagination(a,b){var c=app.current.app+(void 0===app.current.tab?"":app.current.tab),f=0<app.current.limit?Math.ceil(a/app.current.limit):1;0===f&&(f=1);for(var h=0<app.current.limit?app.current.offset/app.current.limit+1:1,d='   <button title="'+t("Previous page")+'" type="button" class="btn btn-group-prepend btn-secondary">&laquo;</button>   <div class="btn-group">     <button class="btn btn-secondary dropdown-toggle" type="button" data-toggle="dropdown"></button>     <div class="dropdown-menu bg-lite-dark px-2 pages dropdown-menu-right"></div>   </div>   <button title="'+
t("Next page")+'" type="button" class="btn btn-secondary btn-group-append">&raquo;</button>',g='<button type="button" class="btn btn-secondary material-icons" title="'+t("To top")+'">keyboard_arrow_up</button> <div>  <select class="form-control custom-select border-secondary" title="'+t("Elements per page")+'">',k=$jscomp.makeIterator([25,50,100,200,0]),l=k.next();!l.done;l=k.next())l=l.value,g+='<option value="'+l+'"'+(app.current.limit===l?" selected":"")+">"+(0<l?l:t("All"))+"</option>";g+='  </select> </div> <div id="'+
c+'PaginationBottom" class="btn-group dropup">'+d+" </div></div>";k=document.getElementById(c+"ButtonsBottom");k.innerHTML=g;k.getElementsByTagName("button")[0].addEventListener("click",function(){event.preventDefault();scrollToPosY(0)},!1);k.getElementsByTagName("select")[0].addEventListener("change",function(r){r=parseInt(getSelectValue(r.target));app.current.limit!==r&&gotoPage(app.current.offset,r)},!1);document.getElementById(c+"PaginationTop").innerHTML=d;d=app.current.offset+app.current.limit;
g=[document.getElementById(c+"PaginationTop"),document.getElementById(c+"PaginationBottom")];for(k=0;k<g.length;k++){l=g[k].children[0];var m=g[k].children[1].children[0],n=g[k].children[1].children[1],p=g[k].children[2];m.innerText=h+" / "+f;if(1<f){m.removeAttribute("disabled");for(var q="",u=0;u<f;u++){var v=u*app.current.limit;q+='<button data-offset="'+v+'" type="button" class="mr-1 mb-1 btn-sm btn btn-secondary'+(v===app.current.offset?" active":"")+'">'+(u+1)+"</button>"}n.innerHTML=q;m.classList.remove("nodropdown");
n.addEventListener("click",function(r){"BUTTON"===r.target.nodeName&&gotoPage(r.target.getAttribute("data-offset"))},!1);new BSN.Dropdown(m)}else-1===a?(m.setAttribute("disabled","disabled"),m.innerText=h):m.setAttribute("disabled","disabled"),m.classList.add("nodropdown");a>d&&0<d||-1===a&&b>=app.current.limit?(p.removeAttribute("disabled"),g[k].classList.remove("hide"),p.addEventListener("click",function(){event.preventDefault();gotoPage("next")},!1)):(p.setAttribute("disabled","disabled"),0===
k&&g[k].classList.add("hide"));0<app.current.offset?(l.removeAttribute("disabled"),g[k].classList.remove("hide"),l.addEventListener("click",function(){event.preventDefault();gotoPage("prev")},!1)):l.setAttribute("disabled","disabled")}0!==a?document.getElementById(c+"ButtonsBottom").classList.remove("hide"):document.getElementById(c+"ButtonsBottom").classList.add("hide")}function genId(a){return"id"+a.replace(/[^\w-]/g,"")}
function parseCmd(a,b){null!==a&&a.preventDefault();var c=b;"string"===typeof b&&(c=JSON.parse(b));if("function"===typeof window[c.cmd])switch(c.cmd){case "sendAPI":sendAPI(c.options[0].cmd,{});break;case "toggleBtn":case "toggleBtnChk":case "toggleBtnGroup":case "toggleBtnGroupCollapse":case "zoomPicture":case "setPlaySettings":window[c.cmd].apply(window,[a.target].concat($jscomp.arrayFromIterable(c.options)));break;case "toggleBtnChkCollapse":window[c.cmd].apply(window,[a.target,void 0].concat($jscomp.arrayFromIterable(c.options)));
break;default:window[c.cmd].apply(window,$jscomp.arrayFromIterable(c.options))}else logError("Can not execute cmd: "+c)}
function gotoPage(a,b){switch(a){case "next":app.current.offset+=app.current.limit;break;case "prev":app.current.offset-=app.current.limit;0>app.current.offset&&(app.current.offset=0);break;default:app.current.offset=a}void 0!==b&&(app.current.limit=b,0===app.current.limit?app.current.offset=0:0<app.current.offset%app.current.limit&&(app.current.offset=Math.floor(app.current.offset/app.current.limit)));appGoto(app.current.app,app.current.tab,app.current.view,app.current.offset,app.current.limit,app.current.filter,
app.current.sort,app.current.tag,app.current.search,0)}function validateFilenameString(a){return""===a?!1:null!==a.match(/^[\w-.]+$/)?!0:!1}function validateFilename(a){if(!1===validateFilenameString(a.value))return a.classList.add("is-invalid"),!1;a.classList.remove("is-invalid");return!0}function validateFilenameList(a){a.classList.remove("is-invalid");for(var b=a.value.split(","),c=0;c<b.length;c++)if(!1===validateFilenameString(b[c].trim()))return a.classList.add("is-invalid"),!1;return!0}
function validatePath(a){if(""===a.value)return a.classList.add("is-invalid"),!1;if(null!==a.value.match(/^\/[/.\w-]+$/))return a.classList.remove("is-invalid"),!0;a.classList.add("is-invalid");return!1}function validatePlnameEl(a){if(!1===validatePlname(a.value))return a.classList.add("is-invalid"),!1;a.classList.remove("is-invalid");return!0}function validatePlname(a){return""===a?!1:null===a.match(/\/|\r|\n|"|'/)?!0:!1}
function validateNotBlank(a){if(""===a.value.replace(/\s/g,""))return a.classList.add("is-invalid"),!1;a.classList.remove("is-invalid");return!0}function validateInt(a){if(""!==a.value.replace(/\d/g,""))return a.classList.add("is-invalid"),!1;a.classList.remove("is-invalid");return!0}function validateFloat(a){if(""!==a.value.replace(/[\d-.]/g,""))return a.classList.add("is-invalid"),!1;a.classList.remove("is-invalid");return!0}
function validateStream(a){if(-1<a.value.indexOf("://"))return a.classList.remove("is-invalid"),!0;a.classList.add("is-invalid");return!1}function validateHost(a){if(null!==a.value.match(/^([\w-.]+)$/))return a.classList.remove("is-invalid"),!0;a.classList.add("is-invalid");return!1};
